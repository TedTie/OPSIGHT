# OPSIGHT - 智能任务与日报管理系统 (简化版)

## 📋 项目概述

OPSIGHT 是一款基于 AI 的企业任务管理与日报分析平台，通过智能任务追踪、AI 日报生成、情绪分析与数据洞察，帮助组织建立高效的协作管理系统。本版本为简化版，专注于核心功能，适合中小团队使用。

## 🚀 快速启动

### 🎯 一键启动（推荐）

#### Windows用户
双击运行 `start_opsight.bat` 文件，系统将自动：
- 检查Python和Node.js环境
- 安装所需依赖
- 启动后端和前端服务
- 自动打开浏览器

#### 所有平台
```bash
python start_opsight.py
```

### 📍 服务地址
- **前端应用**: http://localhost:3001
- **后端API**: http://localhost:8001
- **API文档**: http://localhost:8001/docs

### 🔑 默认登录信息
- **用户名**: admin
- **密码**: admin123

### 手动启动（可选）

#### 后端启动
```bash
cd backend/minimal_enhanced
pip install -r requirements.txt
python main.py
```

#### 前端启动
```bash
cd frontend
npm install
npm run dev
```

## 🏗️ 技术架构

### 后端技术栈
- **框架**: FastAPI (高性能异步Web框架)
- **数据库**: SQLite + SQLAlchemy ORM
- **认证**: Cookie-based 简化认证
- **AI集成**: OpenRouter API (支持多种AI模型)

### 前端技术栈
- **框架**: Vue 3 (Composition API)
- **UI组件库**: Element Plus
- **状态管理**: Pinia
- **图表可视化**: ECharts
- **构建工具**: Vite
- **HTTP客户端**: Axios

## 🎯 核心功能模块

### 🔐 用户认证与权限
- **多角色权限体系**：支持普通用户、管理员、超级管理员三级权限架构
- **Cookie认证**：基于浏览器Cookie的简单身份验证
- **用户名直接登录**：无需密码，输入用户名即可登录
- **细粒度权限控制**：基于身份的权限控制，支持动态权限检查
- **安全的会话管理**：24小时Cookie有效期，自动续期
- **权限继承体系**：上级权限自动包含下级权限，简化权限管理
- **API接口保护**：所有敏感接口都有权限验证，防止未授权访问

### 📋 任务管理
- **任务创建与分配**：支持创建详细任务信息，包括标题、描述、优先级、截止时间
- **任务状态管理**：完整的任务生命周期管理（待办/进行中/已完成/已取消）
- **任务优先级设置**：支持高/中/低三级优先级，帮助用户合理安排工作
- **任务执行时间统计**：自动记录任务开始、完成时间，计算实际耗时
- **任务分配机制**：管理员可向用户分配任务，支持批量分配
- **任务进度跟踪**：实时更新任务进度，支持进度百分比显示
- **任务依赖关系**：支持设置任务间的依赖关系，确保执行顺序
- **任务模板功能**：创建常用任务模板，提高任务创建效率
- **任务提醒通知**：支持截止时间提醒、状态变更通知

#### 📝 任务类型详解
系统支持四种不同类型的任务，每种类型都有其特定的应用场景和进度跟踪方式：

- **🔢 金额任务 (Amount)**
  - **适用场景**：销售目标、筹款活动、成本控制等涉及金额统计的任务
  - **进度跟踪**：设置目标金额，实时统计当前完成金额
  - **完成条件**：当前金额达到或超过目标金额时自动标记为完成
  - **显示方式**：进度条显示完成百分比，支持金额明细查看

- **📊 数量任务 (Quantity)**
  - **适用场景**：生产计划、客户拜访、文档整理等涉及数量统计的任务
  - **进度跟踪**：设置目标数量，实时统计当前完成数量
  - **完成条件**：当前数量达到或超过目标数量时自动标记为完成
  - **显示方式**：进度条显示完成百分比，支持数量明细查看

- **🔗 接龙任务 (Jielong)**
  - **适用场景**：进度和信息收集需要访问多个学员的任务
  - **进度跟踪**：设置目标接龙数量，实时根据任务详情统计当前用户提交数量
  - **配置选项**：
    - 学员ID收集，接龙里的学员ID会被记录
    - 备注信息：为每个学员ID添加备注
    - 意向选择：是否提供意向选择选项
    - 自定义字段：支持添加自定义收集字段（文本/数字/选择）
  - **完成条件**：学员ID或关联的个人提交人数达到目标数量时自动标记为完成
  - **显示方式**：学员ID列表展示，支持导出信息

- **✅ 勾选任务 (Checkbox)**
  - **适用场景**：简单的完成/未完成类型任务，如培训参与、文档阅读等
  - **进度跟踪**：简单的已完成/未完成状态
  - **完成条件**：用户手动标记为完成
  - **显示方式**：勾选框形式，直观显示完成状态

#### 📊 任务状态说明
- **⏳ 待处理 (Pending)**：任务已创建但尚未开始执行
- **🔄 进行中 (Processing)**：任务正在执行过程中
- **✅ 已完成 (Done)**：任务已完成，达到预期目标

#### 🎯 优先级等级
- **🔴 紧急 (Urgent)**：需要立即处理的紧急任务
- **🟠 高 (High)**：重要且紧急的高优先级任务
- **🟡 中 (Medium)**：正常优先级的常规任务
- **🟢 低 (Low)**：可以延后处理的低优先级任务

#### 👥 分配类型说明
- **👤 指定用户 (User)**：将任务分配给特定的用户
- **👥 指定组 (Group)**：将任务分配给特定的用户组
- **🏷️ 指定身份 (Identity)**：将任务分配给特定身份的所有用户（如所有顾问、班主任等）
- **🌐 所有人 (All)**：将任务分配给系统中的所有用户

### 📊 智能日报

#### 📝 日报内容结构
智能日报系统支持丰富的内容字段，全面记录工作状态：

**基础信息字段：**
- **📅 工作日期**：记录具体的工作日期
- **📋 日报标题**：简洁明了的日报主题
- **📄 工作内容**：详细的工作内容描述
- **⏰ 工作时长**：实际工作时间（小时）
- **📈 任务进度**：当前任务完成情况的报告
- **📝 工作总结**：对当日工作内容的总结和评估

**状态评估字段：**
- **😊 心情评分**：1-10分制的心情状态评估
- **⚡ 效率评分**：1-10分制的工作效率自评
- **📞 通话次数**：KPI指标 - 当日拨打电话次数
- **⏱️ 通话时长**：KPI指标 - 拨打电话总时长（分钟）

**深度反思字段：**
- **🎯 取得成就**：当日工作中的亮点和成果
- **⚠️ 遇到挑战**：工作中遇到的困难和问题
- **📋 明日计划**：下一个工作日的计划安排

#### 🤖 AI 智能分析引擎

**多模型支持：**
- **Google Gemini 2.5 Pro**：擅长复杂文本理解和情感分析
- **OpenAI GPT-5**：强大的逻辑推理和建议生成能力
- **DeepSeek Chat v3.1**：高效的中文文本处理和分析

**AI分析维度：**
- **🎭 情感分析**：
  - 情感分数：0-1分制精确量化（1表示非常积极）
  - 情感描述：100字以内的情感状态分析
  - 压力识别：自动识别工作压力和焦虑情绪
  - 情绪趋势：跟踪情绪变化趋势和波动
  - 如有接龙任务，会根据学员ID进行情感分析

- **📊 工作摘要生成**：
  - 智能提取：自动提取工作内容核心要点
  - 结构化总结：150字以内的结构化工作摘要
  - 关键词提取：3-5个核心关键词标签
  - 工作分类：自动识别工作类型和性质

- **💡 反思与建议**：
  - 深度反思：200字以内的工作反思分析
  - 改进建议：150字以内的具体改进建议
  - 效率优化：基于工作模式的效率提升建议
  - 时间管理：工作时间分配和管理建议
  - 如有接龙任务，会根据学员ID进行复盘和跟进建议

#### 🔄 智能化工作流程

**自动生成流程：**
1. **任务数据收集**：自动收集当日任务完成情况，包括勾选任务、接龙任务等
2. **内容智能生成**：基于任务数据生成日报草稿
3. **用户补充完善**：用户添加个人感受和详细内容
4. **AI深度分析**：提交后自动触发AI分析流程
5. **结果实时反馈**：分析完成后立即展示结果

**分析处理机制：**
- **实时分析**：日报提交后立即启动AI分析
- **缓存优化**：分析结果智能缓存，避免重复计算
- **错误重试**：分析失败时自动重试机制
- **模型切换**：支持动态切换AI模型进行分析

#### 📈 数据洞察与可视化

**个人分析维度：**
- **情绪曲线图**：展示情绪变化趋势和稳定性
- **效率分析图**：工作效率变化和最佳时段分析
- **工作模式图**：工作习惯和时间分配可视化
- **成长轨迹图**：个人能力提升和发展轨迹

**团队分析维度：**
- **团队情绪地图**：团队整体情绪状态热力图
- **协作效率分析**：团队协作模式和效率评估
- **压力预警系统**：团队压力状态监控和预警
- **绩效对比分析**：团队成员绩效对比和排名

#### 🔍 高级查询与管理

**多维度检索：**
- **时间范围查询**：按日、周、月、季度、年度查询
- **关键词搜索**：支持全文检索和标签筛选
- **情感状态筛选**：按情感分数范围筛选日报
- **效率等级过滤**：按工作效率评分筛选
- **AI分析状态**：筛选已分析/未分析的日报

**权限控制机制：**
- **个人权限**：只能查看和编辑自己的日报
- **组内权限**：管理员可查看组内成员日报
- **全局权限**：超级管理员可查看所有日报
- **分析权限**：根据权限级别控制AI分析访问

#### 📤 导出与分享功能

**多格式导出：**
- **PDF报告**：包含图表和分析结果的完整报告
- **Excel数据**：结构化数据表格，便于进一步分析
- **Word文档**：格式化的文档报告
- **JSON数据**：原始数据格式，支持系统集成

**智能分享机制：**
- **上级分享**：一键分享给直属上级
- **团队分享**：向团队成员分享工作成果
- **匿名分享**：去除个人信息的匿名数据分享
- **定时推送**：定期自动推送日报摘要

### 📈 数据分析
- **个人绩效分析**：分析个人任务完成率、工作效率、时间分配等指标
- **团队绩效对比**：对比团队成员间的工作表现，识别优秀实践
- **可视化图表展示**：提供柱状图、折线图、饼图、热力图等多种图表类型
- **趋势分析和预测**：基于历史数据预测未来工作趋势和潜在问题
- **自定义指标计算**：支持创建自定义 KPI 指标和计算公式
- **多维度数据切片**：支持按时间、部门、项目等维度进行数据分析
- **异常数据检测**：自动识别异常工作模式和效率波动
- **报表定制功能**：支持创建定制化分析报表和仪表板
- **数据钻取分析**：支持从汇总数据钻取到明细数据进行深度分析

### 📚 知识库
- **多模块知识管理**：支持 Summary（总结）、CC（沟通协作）、SS（技能分享）、LP（学习计划）四大模块
- **知识分享和协作**：支持团队成员间的知识共享和协作编辑
- **智能搜索和推荐**：基于内容相似度和用户行为的智能搜索和推荐
- **版本控制和审核**：完整的知识库内容版本管理和审核流程
- **知识分类体系**：支持多级分类和标签管理，便于知识组织
- **访问权限控制**：细粒度的知识库访问权限控制，保护敏感信息
- **知识质量评估**：支持用户评分和反馈，维护知识库质量
- **知识使用统计**：统计知识库使用情况，识别热门和冷门内容
- **知识导入导出**：支持批量导入导出知识库内容

### 🤖 AI 配置管理
- **多 AI 模型支持**：集成 Google Gemini、OpenAI GPT、DeepSeek 等多种 AI 模型
- **API 密钥管理**：安全的 API 密钥存储和管理，支持密钥轮换
- **使用统计和监控**：详细的 AI 调用统计，包括次数、成本、成功率等
- **智能分析配置**：可配置的 AI 分析参数，如情感分析阈值、反思生成策略
- **模型性能监控**：监控不同 AI 模型的响应时间和准确性
- **使用配额管理**：设置用户和组织的 AI 使用配额，控制成本
- **AI 服务质量保障**：自动故障转移和负载均衡，确保服务稳定性
- **自定义 AI 提示词**：支持自定义 AI 分析的提示词模板
- **AI 结果质量评估**：用户可对 AI 分析结果进行评分和反馈

## 👥 用户角色与权限详解

### 🔵 普通用户 (User)
**身份标识**: `user`（普通用户身份）

#### 可操作功能：
- ✅ **个人任务管理**
  - 查看分配给自己的任务（超级管理员或管理员分配的个人任务）
  - 更新任务状态：从 `pending`（待处理）→ `processing`（进行中）→ `done`（已完成）
  - 记录任务完成情况，包括完成时间、工作小时数、完成质量评估
  - 查看任务详情：任务描述、截止时间、优先级、分配者信息
  - 添加任务执行备注和遇到的问题记录

- ✅ **日报管理**
  - 创建每日工作日报，包含：工作总结、完成任务列表、遇到问题、明日计划
  - 填写工作时长、心情评分（1-10分）、通话次数和时长等量化指标
  - 查看 AI 自动生成的情绪分析结果（0-1分制情绪评分）
  - 获取 AI 智能反思建议和工作改进建议
  - 查看个人日报历史记录，支持按日期、关键词搜索
  - 编辑和修改已提交的日报内容

- ✅ **个人数据分析**
  - 查看个人任务完成率趋势图表（按周、月统计）
  - 查看个人情绪变化曲线和情绪稳定性分析
  - 查看工作效率分析：平均完成时间、工作强度等
  - 查看个人工作习惯分析：最佳工作时段、效率峰值等
  - 导出个人工作报告（PDF/Excel格式）
  - 查看个人 KPI 达成情况和改进建议

- ✅ **个人资料管理**
  - 修改个人基本信息：姓名、头像等
  - 查看个人登录记录和使用统计
  - 管理个人界面偏好设置

#### 权限限制：
- ❌ 无法查看其他用户的任务和日报
- ❌ 无法创建或分配任务给他人
- ❌ 无法访问管理功能
- ❌ 无法查看组织级别的统计数据
- ❌ 无法访问知识库管理

### 🟡 管理员 (Admin)
**身份标识**: `admin`（管理员身份）

#### 继承普通用户所有权限，额外增加：

- ✅ **任务管理权限**
  - 创建新任务：设置任务标题、描述、优先级、截止时间
  - 分配任务给普通用户：支持分配给个人
  - 查看所有任务状态和执行进度
  - 修改任务信息：更新描述、调整截止时间、变更优先级
  - 管理任务模板：创建常用任务模板，提高分配效率
  - 监控任务执行情况：查看延期任务、未开始任务等
  - 设置任务提醒和通知机制

- ✅ **团队日报管理**
  - 查看所有普通用户的日报内容和提交情况
  - 审核日报质量，提供反馈和建议
  - 对日报内容进行评论和指导
  - 查看AI分析汇总：平均情绪分、工作强度分析等
  - 识别需要关注的成员：情绪异常、工作量过大等
  - 生成团队日报统计报告：提交率、质量评估等
  - 设置日报提交提醒和截止时间

- ✅ **组织数据分析**
  - 查看团队成员工作效率统计和排名
  - 生成团队绩效报告：完成率、质量指标、改进建议
  - 监控团队异常情况：情绪波动、效率下降、任务延期等
  - 分析团队协作效果和沟通效率
  - 查看团队资源利用情况和工作负荷分布
  - 对比不同时期的团队表现趋势
  - 导出团队分析报告供上级参考

- ✅ **知识库管理**
  - 管理知识库内容（查看、审核、推荐）
  - 上传和管理文件资源：文档、图片、视频等
  - 设置知识库内容的访问级别和权限
  - 组织知识库内容分类和标签管理
  - 维护知识库内容的时效性和准确性
  - 推广优质知识库内容给团队成员

#### 权限限制：
- ❌ 无法管理超级管理员功能
- ❌ 无法修改系统配置
- ❌ 无法管理 AI 配置
- ❌ 无法创建或删除用户账户

### 🔴 超级管理员 (Super Admin)
**身份标识**: `super_admin`

#### 拥有系统最高权限，包括：

- ✅ **系统管理权限**
  - 创建新用户账户：设置用户名、身份、所属组织
  - 编辑用户信息：修改用户基本信息、权限级别
  - 删除用户账户：支持软删除，保留数据完整性
  - 分配和修改用户权限：提升/降级用户权限级别
  - 系统配置管理：基础系统参数配置
  - 监控系统运行状态：基础性能监控

- ✅ **全局任务管理**
  - 查看和管理所有用户的任务：全局任务监控和协调
  - 跨用户分配任务：协调不同用户间的协作任务
  - 设置全局任务模板：标准化任务创建流程
  - 管理任务优先级策略：设置全局任务优先级规则
  - 监控全系统任务执行效率和质量
  - 分析任务分配合理性和资源利用率

- ✅ **全局数据访问**
  - 查看所有用户的日报内容和工作数据
  - 生成全系统统计报告：用户绩效对比分析
  - 访问所有分析功能：深度数据挖掘和趋势预测
  - 监控全系统工作效率和情绪健康状况
  - 识别系统级别的问题和改进机会
  - 制定基于数据的组织发展策略
  - 导出各类管理报告供决策参考

- ✅ **AI 系统管理**
  - 配置 AI 模型选择：Google Gemini、OpenAI GPT、DeepSeek 等
  - 管理 OpenRouter API 密钥：设置、更新、监控使用情况
  - 监控 AI 调用日志：查看调用频率、成功率、响应时间
  - 管理 AI 使用配额：设置用户的 AI 调用限制
  - 查看 AI 使用统计：成本分析、效果评估、优化建议
  - 配置 AI 分析参数：情感分析阈值、反思生成策略等
  - 管理 AI 服务质量：监控准确性、及时性、稳定性

- ✅ **知识库全权管理**
  - 管理所有知识库内容
  - 设置知识库访问级别和权限策略
  - 审核所有知识库内容：质量控制、内容合规性检查
  - 管理知识库分类体系和标签规范
  - 监控知识库使用情况和用户反馈
  - 推广优质知识库内容到全系统
  - 维护知识库内容的更新和归档策略

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Node.js 16+
- PostgreSQL 12+（完整版）
- Redis 6+（可选）

### 本地开发部署

#### 选项1：极简版（推荐）
```bash
# 一键启动，3个依赖包
python minimal_launcher.py
```
- 前端：http://localhost:3000
- 后端：http://localhost:8000
- 默认管理员：admin

#### 选项2：完整版
```bash
# 使用Docker Compose
docker-compose up -d
```

#### 选项3：开发版
```bash
# 手动启动前后端
cd backend && python main.py
cd frontend && npm run dev
```

### 默认账户
- **用户名**: admin
- **角色**: 超级管理员（极简版）
- **用户名**: jlp-zhengyuneng
- **密码**: 123456
- **角色**: 超级管理员（完整版）

## 📁 项目结构

```
KillerApp/
├── backend/                    # FastAPI 后端服务
│   ├── app/
│   │   ├── api/v1/            # API 路由定义
│   │   │   └── endpoints/     # 具体端点实现
│   │   ├── core/              # 核心配置和工具
│   │   ├── models/            # SQLAlchemy 数据模型
│   │   ├── schemas/           # Pydantic 数据模式
│   │   └── db/               # 数据库配置
│   ├── minimal/              # 极简版后端（3个依赖）
│   └── requirements.txt      # Python 依赖
├── frontend/                  # Vue3 前端应用
│   ├── src/
│   │   ├── components/       # 可复用组件
│   │   ├── views/           # 页面组件
│   │   ├── stores/          # Pinia 状态管理
│   │   └── router/          # 路由配置
│   ├── minimal/             # 极简版前端（纯HTML）
│   └── package.json         # Node.js 依赖
├── docs/                     # 项目文档
└── README.md                # 项目说明文档
```

## 🔧 配置说明

### 极简版配置
无需配置，启动即用。数据保存在 `backend/minimal/data.json`

### 完整版配置
在 `backend/.env` 文件中配置：
```bash
# 数据库配置
DATABASE_URL=postgresql://username:password@localhost:5432/opsight

# JWT 配置（如使用）
SECRET_KEY=your-secret-key-here

# AI 配置
OPENROUTER_API_KEY=your-openrouter-api-key

# Redis 配置（可选）
REDIS_URL=redis://localhost:6379/0
```

## 📊 功能特性

### 🤖 AI 智能分析
- **多模型集成架构**：通过 OpenRouter 统一接口集成 Google Gemini、OpenAI GPT、DeepSeek 等主流 AI 模型
- **智能情感分析**：基于自然语言处理技术分析用户日报中的情感倾向，量化情绪状态（0-1分制）
- **工作反思生成**：AI 自动分析工作内容，生成个性化的工作反思和改进建议
- **上下文感知分析**：结合用户历史数据和当前工作状态，提供更精准的分析结果
- **多语言支持**：支持中英文等多种语言的智能分析
- **实时分析能力**：支持实时和批量分析模式，满足不同场景需求
- **分析结果可视化**：将 AI 分析结果以图表和文字形式直观展示
- **AI 调用优化**：智能缓存和批处理机制，降低 API 调用成本
- **质量评估反馈**：用户可对 AI 分析结果进行评分，持续优化模型效果

### 📊 数据可视化
- **ECharts 图表引擎**：基于 Apache ECharts 提供丰富的图表类型和交互效果
- **实时数据更新**：WebSocket 连接实现数据实时推送和图表动态更新
- **响应式设计**：图表自适应不同屏幕尺寸，支持移动端访问
- **多维度数据分析**：支持按时间、部门、项目、用户等多个维度进行数据切片
- **自定义指标计算**：支持创建复杂的 KPI 计算公式和业务指标
- **数据钻取功能**：从汇总数据深入到明细数据的多层级分析
- **图表交互功能**：支持缩放、筛选、高亮等丰富的用户交互
- **数据导出功能**：支持将图表导出为 PNG、PDF、Excel 等多种格式
- **主题定制**：支持深色/浅色主题切换和自定义配色方案
- **性能优化**：大数据量下的图表渲染优化和内存管理

### 🔒 权限安全
- **Cookie认证**：基于浏览器Cookie的简单身份验证（极简版）
- **细粒度权限控制**：基于三级权限架构，支持身份级别的权限控制
- **API接口保护**：所有API接口都有权限验证，防止未授权访问
- **会话管理**：支持会话超时和重新登录机制
- **数据安全**：敏感数据合理存储，传输过程安全保护

## 🚀 部署指南

### Docker 部署（推荐）
```bash
# 使用 Docker Compose 一键部署
docker-compose up -d
```

### 手动部署
- **前端**: 推荐部署到 Vercel 或 Netlify
- **后端**: 推荐使用 Railway、Render 或 AWS
- **数据库**: PostgreSQL 云服务
- **极简版**: 直接运行Python脚本即可

## 📝 开发指南

### API 文档
启动后端服务后，访问 http://localhost:8000/docs 查看完整的 Swagger API 文档。

### 版本选择
- **极简版**: 适合内部小团队，快速部署
- **完整版**: 适合正式环境，功能齐全
- **开发版**: 适合二次开发和定制

---

**OPSIGHT** - 让工作更智能，让管理更高效！ 🚀