import{r as f,L as B,aa as re,o as pe,l as Z,f as o,g as e,w as l,b as d,P as x,E as C,Q as ce,e as N,t as i,h as _,K as me,G as _e,v as fe,ab as ve,U as ye,X as be,k as u,d as ge,V as Ve,Y as ke,m as we,y as he}from"./index-g0Sg6k74.js";import{a as G}from"./date-CxVpZo2G.js";import{_ as Ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ze={class:"page-container"},Me={class:"stats-grid"},xe={class:"stat-content"},Ue={class:"stat-value"},qe={class:"stat-content"},$e={class:"stat-value"},Te={class:"stat-content"},Be={class:"stat-value"},De={class:"stat-content"},Ie={class:"stat-value"},Se={class:"card-header"},Ae={class:"header-actions"},Ee={class:"filters"},Ne={class:"metric-name"},Re={class:"metric-key"},je={class:"metric-value"},Oe={class:"pagination-container"},Fe={class:"dialog-footer"},Le={key:0,class:"metric-detail"},Pe={class:"metric-chart",style:{"margin-top":"20px"}},Ze={__name:"AdminMetrics",setup(Ge){const D=f(!1),I=f(!1),k=f(!1),S=f(!1),w=f(!1),A=f(),K=f(),z=B({totalMetrics:0,activeMetrics:0,customMetrics:0,systemMetrics:0}),R=f([]),p=f(null),V=B({type:"",status:"",search:""}),v=B({page:1,size:20,total:0}),n=B({name:"",key:"",type:"business",description:"",unit:"",formula:"",update_frequency:"daily",is_active:!0}),Q={name:[{required:!0,message:"请输入指标名称",trigger:"blur"}],key:[{required:!0,message:"请输入指标键值",trigger:"blur"},{pattern:/^[a-zA-Z][a-zA-Z0-9_]*$/,message:"键值必须以字母开头，只能包含字母、数字和下划线",trigger:"blur"}],type:[{required:!0,message:"请选择指标类型",trigger:"change"}],update_frequency:[{required:!0,message:"请选择更新频率",trigger:"change"}]},X=re(()=>{c()},500),j=s=>({system:"系统指标",business:"业务指标",performance:"性能指标",user:"用户指标"})[s]||s,O=s=>({system:"info",business:"success",performance:"warning",user:"primary"})[s]||"default",Y=s=>({realtime:"实时",minute:"每分钟",hour:"每小时",daily:"每天",weekly:"每周"})[s]||s,F=(s,t)=>s==null?"-":`${s}${t?" "+t:""}`,E=async()=>{try{const s=await x.get("/admin/metrics/stats");Object.assign(z,s.data)}catch(s){console.error("获取统计数据失败:",s)}},c=async()=>{D.value=!0;try{const s={page:v.page,size:v.size,...V},t=await x.get("/admin/metrics",{params:s});R.value=t.data.items||[],v.total=t.data.total||0}catch{C.error("获取指标列表失败")}finally{D.value=!1}},H=()=>{w.value=!1,ee(),k.value=!0},J=s=>{w.value=!0,Object.assign(n,{id:parseInt(s.id),name:s.name,key:s.key,type:s.type,description:s.description,unit:s.unit,formula:s.formula,update_frequency:s.update_frequency,is_active:s.is_active}),k.value=!0},W=s=>{p.value=s,S.value=!0},ee=()=>{var s;Object.assign(n,{id:"",name:"",key:"",type:"business",description:"",unit:"",formula:"",update_frequency:"daily",is_active:!0}),(s=A.value)==null||s.clearValidate()},te=async()=>{try{await A.value.validate(),I.value=!0,w.value?(await x.put(`/admin/metrics/${n.id}`,n),C.success("更新成功")):(await x.post("/admin/metrics",n),C.success("创建成功")),k.value=!1,c(),E()}catch{C.error(w.value?"更新失败":"创建失败")}finally{I.value=!1}},le=async s=>{try{await he.confirm(`确定要删除指标 ${s.name} 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await x.delete(`/admin/metrics/${parseInt(s.id)}`),C.success("删除成功"),c(),E()}catch(t){t!=="cancel"&&C.error("删除失败")}};return pe(()=>{E(),c()}),(s,t)=>{const U=d("el-icon"),M=d("el-card"),y=d("el-button"),r=d("el-option"),q=d("el-select"),$=d("el-col"),h=d("el-input"),ae=d("el-row"),b=d("el-table-column"),T=d("el-tag"),se=d("el-table"),oe=d("el-pagination"),g=d("el-form-item"),ne=d("el-switch"),ie=d("el-form"),L=d("el-dialog"),m=d("el-descriptions-item"),ue=d("el-descriptions"),de=ce("loading");return N(),Z("div",ze,[t[29]||(t[29]=o("div",{class:"page-header"},[o("h1",{class:"page-title"},"自定义指标管理"),o("p",{class:"page-description"},"管理和配置系统自定义指标")],-1)),o("div",Me,[e(M,{class:"stat-card"},{default:l(()=>[o("div",xe,[o("div",Ue,i(z.totalMetrics),1),t[16]||(t[16]=o("div",{class:"stat-label"},"总指标数",-1))]),e(U,{class:"stat-icon"},{default:l(()=>[e(_(me))]),_:1})]),_:1}),e(M,{class:"stat-card"},{default:l(()=>[o("div",qe,[o("div",$e,i(z.activeMetrics),1),t[17]||(t[17]=o("div",{class:"stat-label"},"活跃指标",-1))]),e(U,{class:"stat-icon"},{default:l(()=>[e(_(_e))]),_:1})]),_:1}),e(M,{class:"stat-card"},{default:l(()=>[o("div",Te,[o("div",Be,i(z.customMetrics),1),t[18]||(t[18]=o("div",{class:"stat-label"},"自定义指标",-1))]),e(U,{class:"stat-icon"},{default:l(()=>[e(_(fe))]),_:1})]),_:1}),e(M,{class:"stat-card"},{default:l(()=>[o("div",De,[o("div",Ie,i(z.systemMetrics),1),t[19]||(t[19]=o("div",{class:"stat-label"},"系统指标",-1))]),e(U,{class:"stat-icon"},{default:l(()=>[e(_(ve))]),_:1})]),_:1})]),e(M,{class:"content-card"},{header:l(()=>[o("div",Se,[t[22]||(t[22]=o("span",null,"指标列表",-1)),o("div",Ae,[e(y,{type:"primary",icon:_(Ve),onClick:H},{default:l(()=>[...t[20]||(t[20]=[u(" 新增指标 ",-1)])]),_:1},8,["icon"]),e(y,{icon:_(ke),onClick:c},{default:l(()=>[...t[21]||(t[21]=[u(" 刷新 ",-1)])]),_:1},8,["icon"])])])]),default:l(()=>[o("div",Ee,[e(ae,{gutter:16},{default:l(()=>[e($,{span:6},{default:l(()=>[e(q,{modelValue:V.type,"onUpdate:modelValue":t[0]||(t[0]=a=>V.type=a),placeholder:"指标类型",clearable:"",onChange:c},{default:l(()=>[e(r,{label:"全部",value:""}),e(r,{label:"系统指标",value:"system"}),e(r,{label:"业务指标",value:"business"}),e(r,{label:"性能指标",value:"performance"}),e(r,{label:"用户指标",value:"user"})]),_:1},8,["modelValue"])]),_:1}),e($,{span:6},{default:l(()=>[e(q,{modelValue:V.status,"onUpdate:modelValue":t[1]||(t[1]=a=>V.status=a),placeholder:"状态",clearable:"",onChange:c},{default:l(()=>[e(r,{label:"全部",value:""}),e(r,{label:"启用",value:"active"}),e(r,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),e($,{span:8},{default:l(()=>[e(h,{modelValue:V.search,"onUpdate:modelValue":t[2]||(t[2]=a=>V.search=a),placeholder:"搜索指标名称或描述","prefix-icon":_(be),clearable:"",onInput:_(X)},null,8,["modelValue","prefix-icon","onInput"])]),_:1}),e($,{span:4},{default:l(()=>[e(y,{type:"primary",onClick:c},{default:l(()=>[...t[23]||(t[23]=[u("搜索",-1)])]),_:1})]),_:1})]),_:1})]),ye((N(),ge(se,{data:R.value,stripe:"",style:{width:"100%"}},{default:l(()=>[e(b,{prop:"name",label:"指标名称",width:"200"},{default:l(({row:a})=>[o("div",Ne,[o("strong",null,i(a.name),1),o("div",Re,i(a.key),1)])]),_:1}),e(b,{prop:"type",label:"类型",width:"120"},{default:l(({row:a})=>[e(T,{type:O(a.type),size:"small"},{default:l(()=>[u(i(j(a.type)),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"description",label:"描述","min-width":"200"}),e(b,{prop:"unit",label:"单位",width:"80"}),e(b,{prop:"value",label:"当前值",width:"120"},{default:l(({row:a})=>[o("span",je,i(F(a.value,a.unit)),1)]),_:1}),e(b,{label:"状态",width:"80"},{default:l(({row:a})=>[e(T,{type:a.is_active?"success":"danger",size:"small"},{default:l(()=>[u(i(a.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"updated_at",label:"更新时间",width:"180"},{default:l(({row:a})=>[u(i(_(G)(a.updated_at)),1)]),_:1}),e(b,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[e(y,{size:"small",onClick:P=>W(a)},{default:l(()=>[...t[24]||(t[24]=[u(" 查看 ",-1)])]),_:1},8,["onClick"]),e(y,{size:"small",type:"primary",onClick:P=>J(a)},{default:l(()=>[...t[25]||(t[25]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"]),e(y,{size:"small",type:"danger",onClick:P=>le(a),disabled:a.type==="system"},{default:l(()=>[...t[26]||(t[26]=[u(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[de,D.value]]),o("div",Oe,[e(oe,{"current-page":v.page,"onUpdate:currentPage":t[3]||(t[3]=a=>v.page=a),"page-size":v.size,"onUpdate:pageSize":t[4]||(t[4]=a=>v.size=a),total:v.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:c,onCurrentChange:c},null,8,["current-page","page-size","total"])])]),_:1}),e(L,{modelValue:k.value,"onUpdate:modelValue":t[14]||(t[14]=a=>k.value=a),title:w.value?"编辑指标":"新增指标",width:"600px"},{footer:l(()=>[o("span",Fe,[e(y,{onClick:t[13]||(t[13]=a=>k.value=!1)},{default:l(()=>[...t[27]||(t[27]=[u("取消",-1)])]),_:1}),e(y,{type:"primary",loading:I.value,onClick:te},{default:l(()=>[u(i(w.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:l(()=>[e(ie,{ref_key:"formRef",ref:A,model:n,rules:Q,"label-width":"100px"},{default:l(()=>[e(g,{label:"指标名称",prop:"name"},{default:l(()=>[e(h,{modelValue:n.name,"onUpdate:modelValue":t[5]||(t[5]=a=>n.name=a)},null,8,["modelValue"])]),_:1}),e(g,{label:"指标键值",prop:"key"},{default:l(()=>[e(h,{modelValue:n.key,"onUpdate:modelValue":t[6]||(t[6]=a=>n.key=a),placeholder:"用于API调用的唯一标识"},null,8,["modelValue"])]),_:1}),e(g,{label:"指标类型",prop:"type"},{default:l(()=>[e(q,{modelValue:n.type,"onUpdate:modelValue":t[7]||(t[7]=a=>n.type=a),style:{width:"100%"}},{default:l(()=>[e(r,{label:"业务指标",value:"business"}),e(r,{label:"性能指标",value:"performance"}),e(r,{label:"用户指标",value:"user"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"描述",prop:"description"},{default:l(()=>[e(h,{modelValue:n.description,"onUpdate:modelValue":t[8]||(t[8]=a=>n.description=a),type:"textarea",rows:3,placeholder:"请输入指标描述"},null,8,["modelValue"])]),_:1}),e(g,{label:"单位",prop:"unit"},{default:l(()=>[e(h,{modelValue:n.unit,"onUpdate:modelValue":t[9]||(t[9]=a=>n.unit=a),placeholder:"例如: 个, %, 秒, MB"},null,8,["modelValue"])]),_:1}),e(g,{label:"计算公式",prop:"formula"},{default:l(()=>[e(h,{modelValue:n.formula,"onUpdate:modelValue":t[10]||(t[10]=a=>n.formula=a),type:"textarea",rows:2,placeholder:"例如: SUM(tasks.completed) / COUNT(tasks.total) * 100"},null,8,["modelValue"])]),_:1}),e(g,{label:"更新频率",prop:"update_frequency"},{default:l(()=>[e(q,{modelValue:n.update_frequency,"onUpdate:modelValue":t[11]||(t[11]=a=>n.update_frequency=a),style:{width:"100%"}},{default:l(()=>[e(r,{label:"实时",value:"realtime"}),e(r,{label:"每分钟",value:"minute"}),e(r,{label:"每小时",value:"hour"}),e(r,{label:"每天",value:"daily"}),e(r,{label:"每周",value:"weekly"})]),_:1},8,["modelValue"])]),_:1}),e(g,{label:"状态"},{default:l(()=>[e(ne,{modelValue:n.is_active,"onUpdate:modelValue":t[12]||(t[12]=a=>n.is_active=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(L,{modelValue:S.value,"onUpdate:modelValue":t[15]||(t[15]=a=>S.value=a),title:"指标详情",width:"800px"},{default:l(()=>[p.value?(N(),Z("div",Le,[e(ue,{column:2,border:""},{default:l(()=>[e(m,{label:"指标名称"},{default:l(()=>[u(i(p.value.name),1)]),_:1}),e(m,{label:"指标键值"},{default:l(()=>[u(i(p.value.key),1)]),_:1}),e(m,{label:"类型"},{default:l(()=>[e(T,{type:O(p.value.type),size:"small"},{default:l(()=>[u(i(j(p.value.type)),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"状态"},{default:l(()=>[e(T,{type:p.value.is_active?"success":"danger",size:"small"},{default:l(()=>[u(i(p.value.is_active?"启用":"禁用"),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"当前值"},{default:l(()=>[u(i(F(p.value.value,p.value.unit)),1)]),_:1}),e(m,{label:"单位"},{default:l(()=>[u(i(p.value.unit||"-"),1)]),_:1}),e(m,{label:"更新频率"},{default:l(()=>[u(i(Y(p.value.update_frequency)),1)]),_:1}),e(m,{label:"更新时间"},{default:l(()=>[u(i(_(G)(p.value.updated_at)),1)]),_:1}),e(m,{label:"描述",span:2},{default:l(()=>[u(i(p.value.description||"-"),1)]),_:1}),e(m,{label:"计算公式",span:2},{default:l(()=>[o("code",null,i(p.value.formula||"-"),1)]),_:1})]),_:1}),o("div",Pe,[t[28]||(t[28]=o("h4",null,"历史趋势",-1)),o("div",{ref_key:"chartRef",ref:K,style:{width:"100%",height:"300px"}},null,512)])])):we("",!0)]),_:1},8,["modelValue"])])}}},Ye=Ce(Ze,[["__scopeId","data-v-d43b91b1"]]);export{Ye as default};
