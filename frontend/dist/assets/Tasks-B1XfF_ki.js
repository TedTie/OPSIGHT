import{a as Xe,r as q,L as H,A as ve,o as Ze,l as c,f as x,g as t,w as a,b as k,P as C,E as f,Q as ke,e as s,U as $,h as M,X as Ke,k as r,d as m,t as d,Y as We,T as Ve,Z as xe,F as z,n as N,m as b,V as et,y as P}from"./index-g0Sg6k74.js";import{a as L}from"./date-CxVpZo2G.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const lt={class:"page-container"},at={class:"card-header"},nt={class:"table-toolbar"},ot={class:"table-filters"},st={class:"admin-actions"},it={class:"table-actions"},ut={key:0},rt={key:1},dt={key:2},pt={key:3},_t={key:4},mt={class:"pagination-container"},gt={key:0,style:{"margin-top":"10px"}},ct={class:"dialog-footer"},yt={key:0,class:"task-detail"},ft={class:"jielong-config-info"},bt={key:0,class:"participation-records"},vt={key:0,class:"jielong-entries"},kt={style:{"margin-left":"8px"}},Vt={style:{"margin-left":"8px"}},xt={class:"dialog-footer"},jt={__name:"Tasks",setup(qt){const R=Xe(),X=q(!1),ne=q([]),oe=q([]),G=q([]),A=q([]),D=H({status:"",priority:"",task_type:"",search:""}),I=H({page:1,size:20,total:0}),S=q(!1),Z=q(!1),J=q(!1),je=q("basic"),Y=q(!1),K=q(!1),F=q(),qe=q(["重要","紧急","日常","项目","会议","学习","沟通"]),i=H({title:"",description:"",tags:[],task_type:"checkbox",priority:"medium",assignment_type:"user",assigned_to:null,target_group_id:null,target_identity:"",due_date:"",target_amount:null,target_quantity:null,jielong_target_count:null,jielong_config:{}}),V=H({id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"}),u=q(null),W=q([]),ee=q(!1),_=H({id:null,title:"",task_type:"",target_amount:null,target_quantity:null,completion_note:"",completed_amount:null,completed_quantity:null}),he={title:[{required:!0,message:"请输入任务标题",trigger:"blur"},{min:2,max:100,message:"标题长度在 2 到 100 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入任务描述",trigger:"blur"}],task_type:[{required:!0,message:"请选择任务类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],assignment_type:[{required:!0,message:"请选择分配类型",trigger:"change"}],target_amount:[{required:!0,message:"请输入目标金额",trigger:"blur"}],target_quantity:[{required:!0,message:"请输入目标数量",trigger:"blur"}],jielong_target_count:[{required:!0,message:"请输入目标接龙数量",trigger:"blur"}]},se=n=>({pending:"warning",processing:"primary",done:"success"})[n]||"info",ie=n=>({pending:"待处理",processing:"进行中",done:"已完成"})[n]||n,ue=n=>({low:"info",medium:"warning",high:"danger",urgent:"danger",1:"info",2:"warning",3:"danger",4:"danger"})[n]||"info",re=n=>({low:"低",medium:"中",high:"高",urgent:"紧急",1:"低",2:"中",3:"高",4:"紧急"})[n]||n,de=n=>({amount:"success",quantity:"primary",jielong:"warning",checkbox:"info"})[n]||"info",pe=n=>({amount:"金额",quantity:"数量",jielong:"接龙",checkbox:"勾选"})[n]||n,Te=n=>{i.target_amount=null,i.target_quantity=null,i.jielong_target_count=null,i.jielong_config={},Object.assign(V,{id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"})},U=async()=>{var n,e;X.value=!0;try{const o=Object.fromEntries(Object.entries(D).filter(([T,E])=>E!==""&&E!=null)),p={page:I.page,size:I.size,...o},j=await C.get("/tasks",{params:p}),h=((n=j.data)==null?void 0:n.items)??j.data??[];ne.value=Array.isArray(h)?h:[];const y=(e=j.data)==null?void 0:e.total;I.total=typeof y=="number"?y:Array.isArray(h)?h.length:0}catch{f.error("获取任务列表失败")}finally{X.value=!1}},Ce=async()=>{try{const n=await C.get("/users");oe.value=n.data.items||n.data||[]}catch(n){console.error("获取用户列表失败:",n)}},Ue=async()=>{var n;try{const e=await C.get("/groups"),o=e.data.items||e.data||[];R.isSuperAdmin?G.value=o:R.isAdmin&&((n=R.user)!=null&&n.group_id)?G.value=o.filter(p=>p.id===R.user.group_id):G.value=[]}catch(e){console.error("获取组列表失败:",e)}},we=()=>{Y.value=!1,S.value=!0},$e=n=>{Y.value=!0,Object.assign(i,{id:parseInt(n.id),title:n.title,description:n.description,tags:n.tags||[],task_type:n.task_type||"checkbox",priority:n.priority,assignment_type:n.assignment_type,assigned_to:n.assigned_to,target_group_id:n.target_group_id,target_identity:n.target_identity,due_date:n.due_date,target_amount:n.target_amount,target_quantity:n.target_quantity,jielong_target_count:n.jielong_target_count,jielong_config:n.jielong_config||{}}),n.task_type==="jielong"&&n.jielong_config&&Object.assign(V,n.jielong_config),S.value=!0},Me=()=>{F.value&&F.value.resetFields(),Object.assign(i,{title:"",description:"",tags:[],task_type:"checkbox",priority:2,assignment_type:"user",assigned_to:null,target_group_id:null,target_identity:"",due_date:"",target_amount:null,target_quantity:null,jielong_target_count:null,jielong_config:{}}),Object.assign(V,{id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"})},ze=async()=>{var n,e;if(F.value)try{await F.value.validate(),K.value=!0;const o={...i};i.task_type==="jielong"&&(o.jielong_config={...V}),i.assignment_type==="group"&&i.target_group_id?o.assigned_group_ids=[i.target_group_id]:o.assigned_group_ids=[],delete o.target_group_id,i.task_type!=="amount"&&delete o.target_amount,i.task_type!=="quantity"&&delete o.target_quantity,i.task_type!=="jielong"&&(delete o.jielong_target_count,delete o.jielong_config),Y.value?(await C.put(`/tasks/${i.id}`,o),f.success("任务更新成功")):(await C.post("/tasks",o),f.success("任务创建成功")),S.value=!1,U()}catch(o){(e=(n=o.response)==null?void 0:n.data)!=null&&e.detail?f.error(o.response.data.detail):f.error(Y.value?"更新失败":"创建失败")}finally{K.value=!1}},De=async n=>{try{await P.confirm(`确定要删除任务"${n.title}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await C.delete(`/tasks/${parseInt(n.id)}`),f.success("删除成功"),U()}catch(e){e!=="cancel"&&f.error("删除失败")}},Be=()=>{_.id=null,_.title="",_.task_type="",_.target_amount=null,_.target_quantity=null,_.completion_note="",_.completed_amount=null,_.completed_quantity=null},Ie=async()=>{try{const n={status:"completed",completion_note:_.completion_note};_.task_type==="amount"&&_.completed_amount!==null&&(n.completed_amount=_.completed_amount),_.task_type==="quantity"&&_.completed_quantity!==null&&(n.completed_quantity=_.completed_quantity),await C.put(`/tasks/${parseInt(_.id)}/status`,n),f.success("任务已完成"),J.value=!1,U()}catch{f.error("完成任务失败")}},Ae=n=>{A.value=n},Ee=async()=>{try{const e=(await C.get("/tasks/stats")).data;await P.alert(`
      <div style="text-align: left;">
        <p><strong>任务总数：</strong>${e.total||0}</p>
        <p><strong>待处理：</strong>${e.pending||0}</p>
        <p><strong>进行中：</strong>${e.processing||0}</p>
        <p><strong>已完成：</strong>${e.completed||0}</p>
        <p><strong>高优先级：</strong>${e.high_priority||0}</p>
        <p><strong>紧急任务：</strong>${e.urgent||0}</p>
      </div>
      `,"任务统计",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定"})}catch{f.error("获取任务统计失败")}},Pe=()=>{if(A.value.length===0){f.warning("请先选择要分配的任务");return}P.prompt(`确定要批量分配这 ${A.value.length} 个任务吗？请输入目标用户ID：`,"批量分配任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+$/,inputErrorMessage:"请输入有效的用户ID"}).then(async({value:n})=>{try{const e=A.value.map(o=>o.id);await C.put("/tasks/batch-assign",{task_ids:e,assigned_to:parseInt(n)}),f.success("批量分配成功"),A.value=[],U()}catch{f.error("批量分配失败")}}).catch(()=>{})},Se=async n=>{try{const{value:e}=await P.prompt(`请输入参与金额（目标：${n.target_amount}，当前：${n.current_amount||0}）：`,"参与金额任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入有效的金额",inputType:"number"}),o=parseFloat(e);if(o<=0){f.error("金额必须大于0");return}await C.post("/task-sync/sync-task-to-report",{task_id:n.id,amount:o,remark:""}),f.success("参与成功"),U()}catch(e){e!=="cancel"&&f.error("参与失败")}},Ye=async n=>{try{const{value:e}=await P.prompt(`请输入参与数量（目标：${n.target_quantity}，当前：${n.current_quantity||0}）：`,"参与数量任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+$/,inputErrorMessage:"请输入有效的数量",inputType:"number"}),o=parseInt(e);if(o<=0){f.error("数量必须大于0");return}await C.post("/task-sync/sync-task-to-report",{task_id:n.id,quantity:o,remark:""}),f.success("参与成功"),U()}catch(e){e!=="cancel"&&f.error("参与失败")}},Fe=async n=>{try{const e=[],o=n.jielong_config||{};o.id_enabled&&e.push({label:"ID",key:"id",required:!0}),o.remark_enabled&&e.push({label:"备注",key:"remark",required:!1}),o.intention_enabled&&e.push({label:"意向",key:"intention",required:!1}),o.custom_field_enabled&&o.custom_field_name&&e.push({label:o.custom_field_name,key:"custom_field",required:!1,type:o.custom_field_type||"text"});const{value:p}=await P.prompt(`请输入您的ID（当前接龙：${n.jielong_current_count||0}/${n.jielong_target_count}）：`,"参与接龙",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:y=>!y||y.trim()===""?"ID不能为空":!0}),{value:j}=await P.prompt("请输入备注（可选）：","参与接龙",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).catch(()=>({value:""})),h={id:p.trim(),remark:j||"",intention:"",custom_field:""};await C.post(`/tasks/${n.id}/jielong`,h),f.success("接龙成功"),U()}catch(e){e!=="cancel"&&f.error("接龙失败")}};ve(V,n=>{i.task_type==="jielong"&&(i.jielong_config={...n})},{deep:!0});const te=n=>n<.3?"#f56c6c":n<.7?"#e6a23c":"#67c23a",Oe=async n=>{if(n){ee.value=!0;try{const e=await C.get(`/tasks/${n}/jielong`);W.value=e.data.items||e.data||[]}catch(e){console.error("获取接龙记录失败:",e),W.value=[]}finally{ee.value=!1}}},He=n=>{u.value=n,je.value="basic",Z.value=!0,n.task_type==="jielong"&&Oe(n.id)},Ne=n=>({user:"指定用户",group:"指定组",identity:"指定身份",all:"所有人"})[n]||n,Le=n=>{switch(n.assignment_type){case"user":return n.assigned_to_username||`用户ID: ${n.assigned_to}`;case"group":return n.target_group_name||`组ID: ${n.target_group_id}`;case"identity":return n.target_identity||"-";case"all":return"所有人";default:return"-"}};return ve(D,()=>{I.page=1,U()},{deep:!0}),Ze(()=>{U(),Ce(),Ue()}),(n,e)=>{const o=k("el-button"),p=k("el-option"),j=k("el-select"),h=k("el-input"),y=k("el-table-column"),T=k("el-tag"),E=k("el-icon"),_e=k("el-table"),Re=k("el-pagination"),me=k("el-card"),v=k("el-form-item"),O=k("el-input-number"),Q=k("el-checkbox"),Ge=k("el-date-picker"),ge=k("el-form"),le=k("el-dialog"),g=k("el-descriptions-item"),ae=k("el-progress"),Je=k("el-descriptions"),Qe=k("el-alert"),B=ke("can"),ce=ke("loading");return s(),c("div",lt,[e[53]||(e[53]=x("div",{class:"page-header"},[x("h1",{class:"page-title"},"任务管理"),x("p",{class:"page-description"},"管理和跟踪您的任务")],-1)),t(me,{class:"content-card"},{header:a(()=>[x("div",at,[e[34]||(e[34]=x("span",null,"任务列表",-1)),$((s(),m(o,{type:"primary",icon:M(et),onClick:we},{default:a(()=>[...e[33]||(e[33]=[r(" 创建任务 ",-1)])]),_:1},8,["icon"])),[[B,"tasks:create"]])])]),default:a(()=>[x("div",nt,[x("div",ot,[t(j,{modelValue:D.status,"onUpdate:modelValue":e[0]||(e[0]=l=>D.status=l),placeholder:"状态",clearable:""},{default:a(()=>[t(p,{label:"待处理",value:"pending"}),t(p,{label:"进行中",value:"processing"}),t(p,{label:"已完成",value:"done"})]),_:1},8,["modelValue"]),t(j,{modelValue:D.priority,"onUpdate:modelValue":e[1]||(e[1]=l=>D.priority=l),placeholder:"优先级",clearable:""},{default:a(()=>[t(p,{label:"低",value:"low"}),t(p,{label:"中",value:"medium"}),t(p,{label:"高",value:"high"}),t(p,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"]),t(j,{modelValue:D.task_type,"onUpdate:modelValue":e[2]||(e[2]=l=>D.task_type=l),placeholder:"任务类型",clearable:""},{default:a(()=>[t(p,{label:"金额",value:"amount"}),t(p,{label:"数量",value:"quantity"}),t(p,{label:"接龙",value:"jielong"}),t(p,{label:"勾选",value:"checkbox"})]),_:1},8,["modelValue"]),t(h,{modelValue:D.search,"onUpdate:modelValue":e[3]||(e[3]=l=>D.search=l),placeholder:"搜索任务...","prefix-icon":M(Ke),clearable:""},null,8,["modelValue","prefix-icon"])]),$((s(),c("div",st,[t(o,{type:"info",onClick:Ee},{default:a(()=>[...e[35]||(e[35]=[r(" 任务统计 ",-1)])]),_:1}),$((s(),m(o,{type:"warning",onClick:Pe,disabled:A.value.length===0},{default:a(()=>[r(" 批量分配 ("+d(A.value.length)+") ",1)]),_:1},8,["disabled"])),[[B,"tasks:assign"]])])),[[B,"tasks:manage:group"]]),x("div",it,[t(o,{icon:M(We),onClick:U},{default:a(()=>[...e[36]||(e[36]=[r("刷新",-1)])]),_:1},8,["icon"])])]),$((s(),m(_e,{data:ne.value,stripe:"",style:{width:"100%"},onSelectionChange:Ae},{default:a(()=>[$(t(y,{type:"selection",width:"55"},null,512),[[B,"tasks:assign"]]),t(y,{prop:"title",label:"标题","min-width":"200"}),t(y,{prop:"description",label:"描述","min-width":"300"}),t(y,{label:"任务类型",width:"100"},{default:a(({row:l})=>[t(T,{type:de(l.task_type)},{default:a(()=>[r(d(pe(l.task_type)),1)]),_:2},1032,["type"])]),_:1}),t(y,{label:"进度",width:"150"},{default:a(({row:l})=>[l.task_type==="amount"?(s(),c("div",ut,d(l.current_amount||0)+" / "+d(l.target_amount||0),1)):l.task_type==="quantity"?(s(),c("div",rt,d(l.current_quantity||0)+" / "+d(l.target_quantity||0),1)):l.task_type==="jielong"?(s(),c("div",dt,d(l.jielong_current_count||0)+" / "+d(l.jielong_target_count||0),1)):l.task_type==="checkbox"?(s(),c("div",pt,[l.is_completed?(s(),m(E,{key:0,color:"green"},{default:a(()=>[t(M(Ve))]),_:1})):(s(),m(E,{key:1,color:"gray"},{default:a(()=>[t(M(xe))]),_:1}))])):(s(),c("div",_t,"-"))]),_:1}),t(y,{label:"标签",width:"150"},{default:a(({row:l})=>[(s(!0),c(z,null,N(l.tags||[],w=>(s(),m(T,{key:w,size:"small",style:{"margin-right":"4px"}},{default:a(()=>[r(d(w),1)]),_:2},1024))),128))]),_:1}),t(y,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(T,{type:se(l.status)},{default:a(()=>[r(d(ie(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[t(T,{type:ue(l.priority)},{default:a(()=>[r(d(re(l.priority)),1)]),_:2},1032,["type"])]),_:1}),t(y,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[r(d(M(L)(l.created_at)),1)]),_:1}),t(y,{label:"操作",width:"350",fixed:"right"},{default:a(({row:l})=>[t(o,{type:"info",size:"small",onClick:w=>He(l)},{default:a(()=>[...e[37]||(e[37]=[r(" 详情 ",-1)])]),_:1},8,["onClick"]),l.task_type==="checkbox"?$((s(),m(o,{key:0,type:l.is_completed?"success":"warning",size:"small",onClick:w=>n.quickToggleCheckbox(l),disabled:l.status==="done"},{default:a(()=>[r(d(l.is_completed?"已完成":"完成"),1)]),_:2},1032,["type","onClick","disabled"])),[[B,l,"task",{complete:!0}]]):l.task_type==="amount"?$((s(),m(o,{key:1,type:"success",size:"small",onClick:w=>Se(l),disabled:l.status==="done"},{default:a(()=>[...e[38]||(e[38]=[r(" 参与 ",-1)])]),_:1},8,["onClick","disabled"])),[[B,l,"task",{participate:!0}]]):l.task_type==="quantity"?$((s(),m(o,{key:2,type:"success",size:"small",onClick:w=>Ye(l),disabled:l.status==="done"},{default:a(()=>[...e[39]||(e[39]=[r(" 参与 ",-1)])]),_:1},8,["onClick","disabled"])),[[B,l,"task",{participate:!0}]]):l.task_type==="jielong"?$((s(),m(o,{key:3,type:"success",size:"small",onClick:w=>Fe(l),disabled:l.status==="done"},{default:a(()=>[...e[40]||(e[40]=[r(" 接龙 ",-1)])]),_:1},8,["onClick","disabled"])),[[B,l,"task",{participate:!0}]]):b("",!0),$((s(),m(o,{type:"primary",size:"small",onClick:w=>$e(l)},{default:a(()=>[...e[41]||(e[41]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[B,l,"task",{edit:!0}]]),$((s(),m(o,{type:"danger",size:"small",onClick:w=>De(l)},{default:a(()=>[...e[42]||(e[42]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])),[[B,l,"task",{delete:!0}]])]),_:1})]),_:1},8,["data"])),[[ce,X.value]]),x("div",mt,[t(Re,{"current-page":I.page,"onUpdate:currentPage":e[4]||(e[4]=l=>I.page=l),"page-size":I.size,"onUpdate:pageSize":e[5]||(e[5]=l=>I.size=l),total:I.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:U,onCurrentChange:U},null,8,["current-page","page-size","total"])])]),_:1}),t(le,{modelValue:S.value,"onUpdate:modelValue":e[26]||(e[26]=l=>S.value=l),title:Y.value?"编辑任务":"创建任务",width:"700px",onClose:Me},{footer:a(()=>[x("span",ct,[t(o,{onClick:e[25]||(e[25]=l=>S.value=!1)},{default:a(()=>[...e[43]||(e[43]=[r("取消",-1)])]),_:1}),t(o,{type:"primary",onClick:ze,loading:K.value},{default:a(()=>[r(d(Y.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[t(ge,{ref_key:"formRef",ref:F,model:i,rules:he,"label-width":"120px"},{default:a(()=>[t(v,{label:"任务标题",prop:"title"},{default:a(()=>[t(h,{modelValue:i.title,"onUpdate:modelValue":e[6]||(e[6]=l=>i.title=l),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),t(v,{label:"任务描述",prop:"description"},{default:a(()=>[t(h,{modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=l=>i.description=l),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),t(v,{label:"任务标签",prop:"tags"},{default:a(()=>[t(j,{modelValue:i.tags,"onUpdate:modelValue":e[8]||(e[8]=l=>i.tags=l),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请输入或选择标签",style:{width:"100%"}},{default:a(()=>[(s(!0),c(z,null,N(qe.value,l=>(s(),m(p,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"任务类型",prop:"task_type"},{default:a(()=>[t(j,{modelValue:i.task_type,"onUpdate:modelValue":e[9]||(e[9]=l=>i.task_type=l),placeholder:"请选择任务类型",onChange:Te},{default:a(()=>[t(p,{label:"金额任务",value:"amount"}),t(p,{label:"数量任务",value:"quantity"}),t(p,{label:"接龙任务",value:"jielong"}),t(p,{label:"勾选任务",value:"checkbox"})]),_:1},8,["modelValue"])]),_:1}),i.task_type==="amount"?(s(),m(v,{key:0,label:"目标金额",prop:"target_amount"},{default:a(()=>[t(O,{modelValue:i.target_amount,"onUpdate:modelValue":e[10]||(e[10]=l=>i.target_amount=l),min:0,precision:2,placeholder:"请输入目标金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):b("",!0),i.task_type==="quantity"?(s(),m(v,{key:1,label:"目标数量",prop:"target_quantity"},{default:a(()=>[t(O,{modelValue:i.target_quantity,"onUpdate:modelValue":e[11]||(e[11]=l=>i.target_quantity=l),min:1,placeholder:"请输入目标数量",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):b("",!0),i.task_type==="jielong"?(s(),c(z,{key:2},[t(v,{label:"目标接龙数量",prop:"jielong_target_count"},{default:a(()=>[t(O,{modelValue:i.jielong_target_count,"onUpdate:modelValue":e[12]||(e[12]=l=>i.jielong_target_count=l),min:1,placeholder:"请输入目标接龙数量",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(v,{label:"接龙配置"},{default:a(()=>[t(me,{class:"jielong-config-card"},{default:a(()=>[t(Q,{modelValue:V.id_enabled,"onUpdate:modelValue":e[13]||(e[13]=l=>V.id_enabled=l),label:"ID字段"},null,8,["modelValue"]),t(Q,{modelValue:V.remark_enabled,"onUpdate:modelValue":e[14]||(e[14]=l=>V.remark_enabled=l),label:"备注字段"},null,8,["modelValue"]),t(Q,{modelValue:V.intention_enabled,"onUpdate:modelValue":e[15]||(e[15]=l=>V.intention_enabled=l),label:"意向字段"},null,8,["modelValue"]),V.custom_field_enabled?(s(),c("div",gt,[t(v,{label:"自定义字段名称",style:{"margin-bottom":"10px"}},{default:a(()=>[t(h,{modelValue:V.custom_field_name,"onUpdate:modelValue":e[16]||(e[16]=l=>V.custom_field_name=l),placeholder:"请输入自定义字段名称"},null,8,["modelValue"])]),_:1}),t(v,{label:"自定义字段类型",style:{"margin-bottom":"10px"}},{default:a(()=>[t(j,{modelValue:V.custom_field_type,"onUpdate:modelValue":e[17]||(e[17]=l=>V.custom_field_type=l),placeholder:"请选择字段类型"},{default:a(()=>[t(p,{label:"文本",value:"text"}),t(p,{label:"数值",value:"number"})]),_:1},8,["modelValue"])]),_:1})])):b("",!0),t(Q,{modelValue:V.custom_field_enabled,"onUpdate:modelValue":e[18]||(e[18]=l=>V.custom_field_enabled=l),label:"启用自定义字段"},null,8,["modelValue"])]),_:1})]),_:1})],64)):b("",!0),t(v,{label:"优先级",prop:"priority"},{default:a(()=>[t(j,{modelValue:i.priority,"onUpdate:modelValue":e[19]||(e[19]=l=>i.priority=l),placeholder:"请选择优先级"},{default:a(()=>[t(p,{label:"低",value:"low"}),t(p,{label:"中",value:"medium"}),t(p,{label:"高",value:"high"}),t(p,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(v,{label:"分配类型",prop:"assignment_type"},{default:a(()=>[t(j,{modelValue:i.assignment_type,"onUpdate:modelValue":e[20]||(e[20]=l=>i.assignment_type=l),placeholder:"请选择分配类型"},{default:a(()=>[t(p,{label:"指定用户",value:"user"}),t(p,{label:"指定组",value:"group"}),t(p,{label:"指定身份",value:"identity"}),t(p,{label:"所有人",value:"all"})]),_:1},8,["modelValue"])]),_:1}),i.assignment_type==="user"?(s(),m(v,{key:3,label:"分配用户",prop:"assigned_to"},{default:a(()=>[t(j,{modelValue:i.assigned_to,"onUpdate:modelValue":e[21]||(e[21]=l=>i.assigned_to=l),placeholder:"请选择用户"},{default:a(()=>[(s(!0),c(z,null,N(oe.value,l=>(s(),m(p,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),i.assignment_type==="group"?(s(),m(v,{key:4,label:"分配组",prop:"target_group_id"},{default:a(()=>[t(j,{modelValue:i.target_group_id,"onUpdate:modelValue":e[22]||(e[22]=l=>i.target_group_id=l),placeholder:"请选择组"},{default:a(()=>[(s(!0),c(z,null,N(G.value,l=>(s(),m(p,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0),i.assignment_type==="identity"?(s(),m(v,{key:5,label:"目标身份",prop:"target_identity"},{default:a(()=>[t(h,{modelValue:i.target_identity,"onUpdate:modelValue":e[23]||(e[23]=l=>i.target_identity=l),placeholder:"请输入目标身份"},null,8,["modelValue"])]),_:1})):b("",!0),t(v,{label:"截止日期",prop:"due_date"},{default:a(()=>[t(Ge,{modelValue:i.due_date,"onUpdate:modelValue":e[24]||(e[24]=l=>i.due_date=l),type:"datetime",placeholder:"选择截止日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(le,{modelValue:Z.value,"onUpdate:modelValue":e[27]||(e[27]=l=>Z.value=l),title:"任务详情",width:"800px"},{default:a(()=>[u.value?(s(),c("div",yt,[t(Je,{column:2,border:""},{default:a(()=>[t(g,{label:"任务标题"},{default:a(()=>[r(d(u.value.title),1)]),_:1}),t(g,{label:"任务类型"},{default:a(()=>[t(T,{type:de(u.value.task_type)},{default:a(()=>[r(d(pe(u.value.task_type)),1)]),_:1},8,["type"])]),_:1}),t(g,{label:"任务描述",span:2},{default:a(()=>[r(d(u.value.description),1)]),_:1}),t(g,{label:"标签",span:2},{default:a(()=>[(s(!0),c(z,null,N(u.value.tags||[],l=>(s(),m(T,{key:l,size:"small",style:{"margin-right":"4px"}},{default:a(()=>[r(d(l),1)]),_:2},1024))),128))]),_:1}),t(g,{label:"状态"},{default:a(()=>[t(T,{type:se(u.value.status)},{default:a(()=>[r(d(ie(u.value.status)),1)]),_:1},8,["type"])]),_:1}),t(g,{label:"优先级"},{default:a(()=>[t(T,{type:ue(u.value.priority)},{default:a(()=>[r(d(re(u.value.priority)),1)]),_:1},8,["type"])]),_:1}),u.value.task_type==="amount"?(s(),c(z,{key:0},[t(g,{label:"目标金额"},{default:a(()=>[r(d(u.value.target_amount||0),1)]),_:1}),t(g,{label:"当前金额"},{default:a(()=>[r(d(u.value.current_amount||0),1)]),_:1}),t(g,{label:"完成进度",span:2},{default:a(()=>[t(ae,{percentage:Math.round((u.value.current_amount||0)/(u.value.target_amount||1)*100),color:te((u.value.current_amount||0)/(u.value.target_amount||1))},null,8,["percentage","color"])]),_:1})],64)):b("",!0),u.value.task_type==="quantity"?(s(),c(z,{key:1},[t(g,{label:"目标数量"},{default:a(()=>[r(d(u.value.target_quantity||0),1)]),_:1}),t(g,{label:"当前数量"},{default:a(()=>[r(d(u.value.current_quantity||0),1)]),_:1}),t(g,{label:"完成进度",span:2},{default:a(()=>[t(ae,{percentage:Math.round((u.value.current_quantity||0)/(u.value.target_quantity||1)*100),color:te((u.value.current_quantity||0)/(u.value.target_quantity||1))},null,8,["percentage","color"])]),_:1})],64)):b("",!0),u.value.task_type==="jielong"?(s(),c(z,{key:2},[t(g,{label:"目标接龙数量"},{default:a(()=>[r(d(u.value.jielong_target_count||0),1)]),_:1}),t(g,{label:"当前接龙数量"},{default:a(()=>[r(d(u.value.jielong_current_count||0),1)]),_:1}),t(g,{label:"接龙进度",span:2},{default:a(()=>[t(ae,{percentage:Math.round((u.value.jielong_current_count||0)/(u.value.jielong_target_count||1)*100),color:te((u.value.jielong_current_count||0)/(u.value.jielong_target_count||1))},null,8,["percentage","color"])]),_:1}),t(g,{label:"接龙配置",span:2},{default:a(()=>{var l,w,ye,fe;return[x("div",ft,[(l=u.value.jielong_config)!=null&&l.id_enabled?(s(),m(T,{key:0,size:"small",type:"info"},{default:a(()=>[...e[44]||(e[44]=[r("ID字段",-1)])]),_:1})):b("",!0),(w=u.value.jielong_config)!=null&&w.remark_enabled?(s(),m(T,{key:1,size:"small",type:"info"},{default:a(()=>[...e[45]||(e[45]=[r("备注字段",-1)])]),_:1})):b("",!0),(ye=u.value.jielong_config)!=null&&ye.intention_enabled?(s(),m(T,{key:2,size:"small",type:"info"},{default:a(()=>[...e[46]||(e[46]=[r("意向字段",-1)])]),_:1})):b("",!0),(fe=u.value.jielong_config)!=null&&fe.custom_field_enabled?(s(),m(T,{key:3,size:"small",type:"info"},{default:a(()=>{var be;return[r(d(((be=u.value.jielong_config)==null?void 0:be.custom_field_name)||"自定义字段"),1)]}),_:1})):b("",!0)])]}),_:1})],64)):b("",!0),u.value.task_type==="checkbox"?(s(),m(g,{key:3,label:"完成状态",span:2},{default:a(()=>[u.value.is_completed?(s(),c(z,{key:0},[t(E,{color:"green"},{default:a(()=>[t(M(Ve))]),_:1}),e[47]||(e[47]=x("span",{style:{color:"green","margin-left":"4px"}},"已完成",-1))],64)):(s(),c(z,{key:1},[t(E,{color:"gray"},{default:a(()=>[t(M(xe))]),_:1}),e[48]||(e[48]=x("span",{style:{color:"gray","margin-left":"4px"}},"未完成",-1))],64))]),_:1})):b("",!0),t(g,{label:"分配类型"},{default:a(()=>[r(d(Ne(u.value.assignment_type)),1)]),_:1}),t(g,{label:"分配对象"},{default:a(()=>[r(d(Le(u.value)),1)]),_:1}),t(g,{label:"截止日期"},{default:a(()=>[r(d(u.value.due_date?M(L)(u.value.due_date):"-"),1)]),_:1}),t(g,{label:"创建时间"},{default:a(()=>[r(d(M(L)(u.value.created_at)),1)]),_:1}),t(g,{label:"更新时间"},{default:a(()=>[r(d(u.value.updated_at?M(L)(u.value.updated_at):"-"),1)]),_:1}),t(g,{label:"创建者"},{default:a(()=>[r(d(u.value.created_by_username||"-"),1)]),_:1})]),_:1}),u.value.task_type!=="checkbox"?(s(),c("div",bt,[e[50]||(e[50]=x("h4",null,"参与记录",-1)),t(Qe,{title:"提示",type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:a(()=>[...e[49]||(e[49]=[r(" 要参与任务，请在任务列表中点击对应的快速操作按钮 ",-1)])]),_:1}),u.value.task_type==="jielong"?(s(),c("div",vt,[$((s(),m(_e,{data:W.value,size:"small"},{default:a(()=>[t(y,{prop:"sequence",label:"序号",width:"60"}),t(y,{prop:"user_username",label:"用户",width:"100"}),t(y,{prop:"id",label:"ID",width:"120"}),t(y,{prop:"remark",label:"备注"}),t(y,{prop:"created_at",label:"参与时间",width:"160"},{default:a(({row:l})=>[r(d(M(L)(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ce,ee.value]])])):b("",!0)])):b("",!0)])):b("",!0)]),_:1},8,["modelValue"]),t(le,{modelValue:J.value,"onUpdate:modelValue":e[32]||(e[32]=l=>J.value=l),title:"完成任务",width:"500px",onClose:Be},{footer:a(()=>[x("span",xt,[t(o,{onClick:e[31]||(e[31]=l=>J.value=!1)},{default:a(()=>[...e[51]||(e[51]=[r("取消",-1)])]),_:1}),t(o,{type:"primary",onClick:Ie},{default:a(()=>[...e[52]||(e[52]=[r("确认完成",-1)])]),_:1})])]),default:a(()=>[t(ge,{model:_,"label-width":"100px"},{default:a(()=>[t(v,{label:"任务标题"},{default:a(()=>[x("span",null,d(_.title),1)]),_:1}),t(v,{label:"完成备注"},{default:a(()=>[t(h,{modelValue:_.completion_note,"onUpdate:modelValue":e[28]||(e[28]=l=>_.completion_note=l),type:"textarea",rows:4,placeholder:"请输入完成备注（可选）"},null,8,["modelValue"])]),_:1}),_.task_type==="amount"?(s(),m(v,{key:0,label:"完成数量",required:""},{default:a(()=>[t(O,{modelValue:_.completed_amount,"onUpdate:modelValue":e[29]||(e[29]=l=>_.completed_amount=l),min:0,max:_.target_amount,placeholder:"请输入完成数量"},null,8,["modelValue","max"]),x("span",kt,"/ "+d(_.target_amount),1)]),_:1})):b("",!0),_.task_type==="quantity"?(s(),m(v,{key:1,label:"完成数量",required:""},{default:a(()=>[t(O,{modelValue:_.completed_quantity,"onUpdate:modelValue":e[30]||(e[30]=l=>_.completed_quantity=l),min:0,max:_.target_quantity,placeholder:"请输入完成数量"},null,8,["modelValue","max"]),x("span",Vt,"/ "+d(_.target_quantity),1)]),_:1})):b("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ut=tt(jt,[["__scopeId","data-v-e7cea5a2"]]);export{Ut as default};
