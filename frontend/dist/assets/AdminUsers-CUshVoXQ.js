import{r as v,L as T,o as Z,l as h,f as u,g as t,w as a,b as n,P as z,E as p,Q as ee,e as _,U as le,h as w,X as te,Y as ae,k as r,d as S,t as x,V as se,F as oe,n as ie,y as P}from"./index-g0Sg6k74.js";import{a as ne}from"./date-CxVpZo2G.js";import{g as re,f as de}from"./auth-CVLHtVZ3.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"page-container"},me={class:"card-header"},ce={class:"table-toolbar"},_e={class:"table-filters"},fe={class:"table-actions"},ge={key:1,class:"text-gray-400"},ve={key:1,class:"text-gray-400"},ye={class:"pagination-container"},be={__name:"AdminUsers",setup(Ve){const R=s=>({cc:"CC(顾问)",ss:"SS(班主任)",lp:"LP(英文辅导)",sa:"SA(超级分析师)"})[s]||s,$=v(!1),B=v(!1),j=v([]),D=v([]),y=v(!1),b=v(!1),E=v(),f=T({search:"",role:"",is_active:""}),m=T({page:1,size:20,total:0}),o=T({username:"",organization:"",role:"user",identity_type:null,group_id:null,is_active:!0}),A={username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,max:50,message:"用户名长度在 3 到 50 个字符",trigger:"blur"}],role:[{required:!0,message:"请选择权限",trigger:"change"}]},g=async()=>{$.value=!0;try{const s=Object.fromEntries(Object.entries(f).filter(([C,i])=>i!==""&&i!=null)),e={page:m.page,size:m.size,...s},d=await z.get("/users",{params:e});j.value=d.data.items||[],m.total=d.data.total||0}catch{p.error("获取用户列表失败")}finally{$.value=!1}},F=async()=>{try{const s=await z.get("/groups");D.value=s.data.items||[]}catch(s){console.error("获取组别列表失败:",s)}},I=()=>{b.value=!1,O(),y.value=!0},L=s=>{b.value=!0,Object.assign(o,{id:parseInt(s.id),username:s.username,organization:s.organization||"",role:s.role||"user",identity_type:s.identity_type||null,group_id:s.group_id||null,is_active:s.is_active}),y.value=!0},O=()=>{var s;Object.assign(o,{id:"",username:"",organization:"",role:"user",identity_type:null,group_id:null,is_active:!0}),(s=E.value)==null||s.clearValidate()},M=async()=>{var s;try{await E.value.validate(),B.value=!0,b.value?(await z.put(`/users/${o.id}`,o),p.success("更新成功")):(await z.post("/users",o),p.success("创建成功")),y.value=!1,g()}catch(e){((s=e.response)==null?void 0:s.status)===422?p.error("数据验证失败，请检查输入"):p.error(b.value?"更新失败":"创建失败")}finally{B.value=!1}},q=async s=>{try{await P.confirm(`确定要${s.is_active?"禁用":"启用"}用户 ${s.username} 吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z.put(`/users/${parseInt(s.id)}`,{...s,is_active:!s.is_active}),p.success("操作成功"),g()}catch(e){e!=="cancel"&&p.error("操作失败")}},G=async s=>{try{await P.confirm(`确定要删除用户 ${s.username} 吗？此操作不可恢复！`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await z.delete(`/users/${s.id}`),p.success("删除成功"),g()}catch(e){e!=="cancel"&&p.error("删除失败")}};return Z(()=>{g(),F()}),(s,e)=>{const d=n("el-button"),C=n("el-input"),i=n("el-option"),k=n("el-select"),c=n("el-table-column"),U=n("el-tag"),Q=n("el-table"),X=n("el-pagination"),Y=n("el-card"),V=n("el-form-item"),H=n("el-switch"),J=n("el-form"),K=n("el-dialog"),W=ee("loading");return _(),h("div",pe,[e[20]||(e[20]=u("div",{class:"page-header"},[u("h1",{class:"page-title"},"用户管理"),u("p",{class:"page-description"},"管理系统用户和权限")],-1)),t(Y,{class:"content-card"},{header:a(()=>[u("div",me,[e[14]||(e[14]=u("span",null,"用户列表",-1)),t(d,{type:"primary",icon:w(se),onClick:I},{default:a(()=>[...e[13]||(e[13]=[r(" 新增用户 ",-1)])]),_:1},8,["icon"])])]),default:a(()=>[u("div",ce,[u("div",_e,[t(C,{modelValue:f.search,"onUpdate:modelValue":e[0]||(e[0]=l=>f.search=l),placeholder:"搜索用户...","prefix-icon":w(te),clearable:""},null,8,["modelValue","prefix-icon"]),t(k,{modelValue:f.role,"onUpdate:modelValue":e[1]||(e[1]=l=>f.role=l),placeholder:"角色筛选",clearable:""},{default:a(()=>[t(i,{label:"普通用户",value:"user"}),t(i,{label:"管理员",value:"admin"}),t(i,{label:"超级管理员",value:"super_admin"})]),_:1},8,["modelValue"]),t(k,{modelValue:f.is_active,"onUpdate:modelValue":e[2]||(e[2]=l=>f.is_active=l),placeholder:"状态筛选",clearable:""},{default:a(()=>[t(i,{label:"启用",value:!0}),t(i,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),u("div",fe,[t(d,{icon:w(ae),onClick:g},{default:a(()=>[...e[15]||(e[15]=[r("刷新",-1)])]),_:1},8,["icon"])])]),le((_(),S(Q,{data:j.value,stripe:"",style:{width:"100%"}},{default:a(()=>[t(c,{prop:"username",label:"用户名",width:"120"}),t(c,{prop:"organization",label:"组织","min-width":"180"}),t(c,{label:"权限",width:"100"},{default:a(({row:l})=>[t(U,{type:w(re)(l.role),size:"small"},{default:a(()=>[r(x(w(de)(l.role)),1)]),_:2},1032,["type"])]),_:1}),t(c,{label:"身份",width:"120"},{default:a(({row:l})=>[l.identity_type?(_(),S(U,{key:0,type:"info",size:"small"},{default:a(()=>[r(x(R(l.identity_type)),1)]),_:2},1024)):(_(),h("span",ge,"-"))]),_:1}),t(c,{label:"组别",width:"120"},{default:a(({row:l})=>[l.group_name?(_(),S(U,{key:0,type:"primary",size:"small"},{default:a(()=>[r(x(l.group_name),1)]),_:2},1024)):(_(),h("span",ve,"-"))]),_:1}),t(c,{label:"状态",width:"80"},{default:a(({row:l})=>[t(U,{type:l.is_active?"success":"danger",size:"small"},{default:a(()=>[r(x(l.is_active?"启用":"禁用"),1)]),_:2},1032,["type"])]),_:1}),t(c,{prop:"created_at",label:"创建时间",width:"180"},{default:a(({row:l})=>[r(x(w(ne)(l.created_at)),1)]),_:1}),t(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[t(d,{type:"text",size:"small",onClick:N=>L(l)},{default:a(()=>[...e[16]||(e[16]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(d,{type:"text",size:"small",onClick:N=>q(l),disabled:l.role==="super_admin"},{default:a(()=>[r(x(l.is_active?"禁用":"启用"),1)]),_:2},1032,["onClick","disabled"]),t(d,{type:"text",size:"small",onClick:N=>G(l),disabled:l.role==="super_admin"},{default:a(()=>[...e[17]||(e[17]=[r(" 删除 ",-1)])]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["data"])),[[W,$.value]]),u("div",ye,[t(X,{"current-page":m.page,"onUpdate:currentPage":e[3]||(e[3]=l=>m.page=l),"page-size":m.size,"onUpdate:pageSize":e[4]||(e[4]=l=>m.size=l),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"])])]),_:1}),t(K,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>y.value=l),title:b.value?"编辑用户":"新增用户",width:"500px"},{footer:a(()=>[t(d,{onClick:e[11]||(e[11]=l=>y.value=!1)},{default:a(()=>[...e[18]||(e[18]=[r("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:M,loading:B.value},{default:a(()=>[...e[19]||(e[19]=[r(" 确定 ",-1)])]),_:1},8,["loading"])]),default:a(()=>[t(J,{ref_key:"formRef",ref:E,model:o,rules:A,"label-width":"80px"},{default:a(()=>[t(V,{label:"用户名",prop:"username"},{default:a(()=>[t(C,{modelValue:o.username,"onUpdate:modelValue":e[5]||(e[5]=l=>o.username=l),disabled:b.value},null,8,["modelValue","disabled"])]),_:1}),t(V,{label:"组织",prop:"organization"},{default:a(()=>[t(C,{modelValue:o.organization,"onUpdate:modelValue":e[6]||(e[6]=l=>o.organization=l),placeholder:"请输入组织名称"},null,8,["modelValue"])]),_:1}),t(V,{label:"权限",prop:"role"},{default:a(()=>[t(k,{modelValue:o.role,"onUpdate:modelValue":e[7]||(e[7]=l=>o.role=l),style:{width:"100%"}},{default:a(()=>[t(i,{label:"普通用户",value:"user"}),t(i,{label:"管理员",value:"admin"}),t(i,{label:"超级管理员",value:"super_admin"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"身份",prop:"identity_type"},{default:a(()=>[t(k,{modelValue:o.identity_type,"onUpdate:modelValue":e[8]||(e[8]=l=>o.identity_type=l),style:{width:"100%"},clearable:""},{default:a(()=>[t(i,{label:"CC(顾问)",value:"cc"}),t(i,{label:"SS(班主任)",value:"ss"}),t(i,{label:"LP(英文辅导)",value:"lp"}),t(i,{label:"SA(超级分析师)",value:"sa"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"组别",prop:"group_id"},{default:a(()=>[t(k,{modelValue:o.group_id,"onUpdate:modelValue":e[9]||(e[9]=l=>o.group_id=l),style:{width:"100%"},clearable:"",placeholder:"请选择组别"},{default:a(()=>[(_(!0),h(oe,null,ie(D.value,l=>(_(),S(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"状态"},{default:a(()=>[t(H,{modelValue:o.is_active,"onUpdate:modelValue":e[10]||(e[10]=l=>o.is_active=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ce=ue(be,[["__scopeId","data-v-ef38a90d"]]);export{Ce as default};
