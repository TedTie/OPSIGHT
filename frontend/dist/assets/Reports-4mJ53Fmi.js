import{P as mt}from"./plus-B_fooKhP.js";import{S as gt}from"./search-BGAjv0xz.js";import{R as yt}from"./refresh-DWkyc8-1.js";import{U as $e}from"./user-5wh1rPjN.js";import{m as Je,c as k,o as n,a as s,_ as ft,e as w,C as be,d as vt,b as ze,w as Ke,f as ht,k as o,j as l,h as x,x as E,E as j,u as bt,A as He,B as ye,i as c,q,l as V,F as I,r as N,p as b,t as d,G as ce,y as wt}from"./index-un4HNty9.js";import{f as F,a as xt}from"./date-qiPTsFx8.js";const Tt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function kt(Me,G){return n(),k("svg",Tt,[...G[0]||(G[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 21h18M9 8h1m-1 4h1m-1 4h1m4-8h1m-1 4h1m-1 4h1M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"},null,-1)])])}const Ct=Je({name:"tabler-building",render:kt}),Vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function St(Me,G){return n(),k("svg",Vt,[...G[0]||(G[0]=[s("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm12-4v4M8 3v4m-4 4h16m-9 4h1m0 0v3"},null,-1)])])}const pe=Je({name:"tabler-calendar",render:St}),$t={class:"page-container"},Dt={class:"card-header"},Ut={class:"table-toolbar"},jt={class:"table-filters"},Rt={class:"table-actions"},zt={class:"pagination-container"},Mt={class:"completed-tasks-section"},It={key:0,class:"summary-scope-controls"},Nt={class:"task-hierarchy-section"},At={class:"task-card-header"},Ft={class:"task-title"},Pt={class:"task-card-body"},Yt={class:"task-meta"},Lt={class:"meta-row"},qt={class:"meta-value"},Bt={class:"meta-row"},Ot={class:"meta-value"},Et={class:"task-progress"},Gt={class:"progress-label"},Kt={class:"percent-text"},Ht={class:"task-card-footer"},Jt={class:"task-card-header"},Qt={class:"task-title"},Wt={class:"task-card-body"},Xt={class:"task-meta"},Zt={class:"meta-row"},ea={class:"meta-value"},ta={class:"meta-row"},aa={class:"meta-value"},sa={class:"task-progress"},la={class:"progress-label"},oa={class:"percent-text"},na={class:"task-card-footer"},ra={class:"task-card-header"},da={class:"task-title"},ia={class:"task-card-body"},ua={class:"task-meta"},ca={class:"meta-row"},pa={class:"meta-value"},_a={class:"meta-row"},ma={class:"meta-value"},ga={class:"task-progress"},ya={class:"progress-label"},fa={class:"percent-text"},va={class:"task-card-footer"},ha={class:"task-card-header"},ba={class:"task-title"},wa={class:"task-card-body"},xa={class:"task-meta"},Ta={class:"meta-row"},ka={class:"meta-value"},Ca={class:"meta-row"},Va={class:"meta-value"},Sa={class:"task-progress"},$a={class:"progress-label"},Da={class:"percent-text"},Ua={class:"task-card-footer"},ja={class:"dialog-footer"},Ra={key:0,class:"report-detail"},za={class:"report-header"},Ma={class:"report-meta"},Ia={class:"report-section"},Na={class:"report-section"},Aa={key:0,class:"task-hierarchy-section"},Fa={class:"task-card-header"},Pa={class:"task-title"},Ya={class:"task-card-body"},La={class:"task-meta"},qa={class:"meta-row"},Ba={class:"meta-value"},Oa={class:"meta-row"},Ea={class:"meta-value"},Ga={class:"task-progress"},Ka={class:"progress-label"},Ha={class:"percent-text"},Ja={class:"task-card-header"},Qa={class:"task-title"},Wa={class:"task-card-body"},Xa={class:"task-meta"},Za={class:"meta-row"},es={class:"meta-value"},ts={class:"meta-row"},as={class:"meta-value"},ss={class:"task-progress"},ls={class:"progress-label"},os={class:"percent-text"},ns={class:"task-card-header"},rs={class:"task-title"},ds={class:"task-card-body"},is={class:"task-meta"},us={class:"meta-row"},cs={class:"meta-value"},ps={class:"meta-row"},_s={class:"meta-value"},ms={class:"task-progress"},gs={class:"progress-label"},ys={class:"percent-text"},fs={key:1},vs={key:0,class:"report-section"},hs={class:"report-section"},bs={__name:"Reports",setup(Me){var Be,Oe;const G=w(!1),we=w([]),K=be({dateRange:[],search:""}),C=vt(),ae=ze(()=>{var a,e;return!!((a=C.user)!=null&&a.is_admin)&&!((e=C.user)!=null&&e.is_super_admin)}),P=ze(()=>{var a;return!!((a=C.user)!=null&&a.is_super_admin)}),_e=w(null),X=w(null),xe=w(null),Te=w([]),Y=w([]),B=be({page:1,size:20,total:0}),Z=w(!1),De=w(!1),ee=w(!1),Ue=w(!1),fe=w(),z=w(null),U=be({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),Qe=ze(()=>{var e,r,i,y,_,g,m,v,h;const a=(r=(e=z.value)==null?void 0:e.ai_analysis)==null?void 0:r.tasks_snapshot;return!!(a&&((i=a.completed_today)!=null&&i.length||(y=a.completedToday)!=null&&y.length||(_=a.due_today)!=null&&_.length||(g=a.dueToday)!=null&&g.length||(m=a.ongoing)!=null&&m.length||(v=a.ongoing_uncompleted)!=null&&v.length||(h=a.overdue_uncompleted)!=null&&h.length))}),p=be({report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0});w([]);const We=w([]),Ie=w(!1),Ne=w(!1),je=w(!1),S=be({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),Xe=bt(),A=w("all"),ve=w(null),me=w(null),ke=w(null),Ze=w([{label:"CC(顾问)",value:"cc"},{label:"SS(班主任)",value:"ss"},{label:"LP(英文辅导)",value:"lp"}]),et={report_date:[{required:!0,message:"请选择日报日期",trigger:"change"}],summary:[{required:!0,message:"请输入工作摘要",trigger:"blur"},{min:10,max:500,message:"摘要长度在 10 到 500 个字符",trigger:"blur"}],completed_tasks:[],next_day_plan:[{required:!0,message:"请输入明日计划",trigger:"blur"}]},se=a=>({pending:"待处理",processing:"进行中",done:"已完成"})[a]||a,le=a=>{const e=String(a||"").toLowerCase(),r=(e.match(/(pending|processing|done)/)||[])[1]||e;return{pending:"info",processing:"warning",done:"success"}[r]||"info"},oe=a=>{const e={user:"指定用户",group:"指定组",identity:"指定身份",all:"所有人"},r=String(a||"").toLowerCase(),i=(r.match(/(user|group|identity|all)/)||[])[1]||r;return e[i]||i},ne=a=>{var e,r,i,y;switch(a.assignment_type){case"user":if(a.assigned_to_username)return a.assigned_to_username;if(a.assigned_to&&((e=C.user)==null?void 0:e.id)===a.assigned_to)return((r=C.user)==null?void 0:r.username)||"";if(a.assigned_to){const _=(Y.value||[]).find(g=>g.id===a.assigned_to);return(_==null?void 0:_.username)||"未知用户"}return"未知用户";case"group":if(a.target_group_name)return a.target_group_name;if(a.target_group_id!=null){const _=Number(a.target_group_id),g=(Te.value||[]).find(m=>Number(m.id)===_);return g!=null&&g.name?g.name:((i=C.user)==null?void 0:i.group_id)===_&&((y=C.user)!=null&&y.group_name)?C.user.group_name:"未知组"}return"未知组";case"identity":return a.target_identity||"-";case"all":return"所有人";default:return"-"}},re=a=>{const e=String(a||"").toLowerCase(),r=(e.match(/(user|group|identity|all)/)||[])[1]||e;return{user:$e,group:Ct,identity:$e,all:$e}[r]||$e},Ce=a=>{a!=null&&a.id&&Xe.push({path:"/tasks",query:{openTaskId:a.id}})},Ve=(...a)=>{for(const e of a)if(e!=null)return e;return 0},Re=(a,e)=>{const r=Number(a)||0,i=Number(e);return!i||i<=0?0:r/i},H=a=>{if(!a)return 0;let e=0;switch(a.task_type){case"amount":e=Re(a.current_amount,a.target_amount);break;case"quantity":e=Re(a.current_quantity,a.target_quantity);break;case"jielong":{const r=Ve(a.personal_jielong_current_count,a.jielong_current_count,0),i=Ve(a.personal_jielong_target_count,a.jielong_target_count,0);e=Re(r,i);break}case"checkbox":e=a.is_completed?1:0;break;default:e=a.status==="done"?1:0}return isFinite(e)||(e=0),Math.max(0,Math.min(1,e))},M=a=>Math.round(H(a)*100),de=a=>{if(!a)return"-";switch(a.task_type){case"amount":return`${a.current_amount||0} / ${a.target_amount||0}`;case"quantity":return`${a.current_quantity||0} / ${a.target_quantity||0}`;case"jielong":{const e=Ve(a.personal_jielong_current_count,a.jielong_current_count,0),r=Ve(a.personal_jielong_target_count,a.jielong_target_count,0);return`${e} / ${r}`}case"checkbox":return a.is_completed?"已完成":"未完成";default:return"-"}},ie=a=>a>=.8?"#67C23A":a>=.3?"#E6A23C":"#F56C6C",Se=a=>({id:a.id,title:a.title,task_type:a.task_type,assignment_type:a.assignment_type,assigned_to:a.assigned_to,target_group_id:a.target_group_id,target_identity:a.target_identity,assigned_to_username:a.assigned_to_username,target_group_name:a.target_group_name,status:a.status,is_completed:a.is_completed,due_date:a.due_date,updated_at:a.updated_at,target_amount:a.target_amount,current_amount:a.current_amount,target_quantity:a.target_quantity,current_quantity:a.current_quantity,personal_jielong_target_count:a.personal_jielong_target_count,personal_jielong_current_count:a.personal_jielong_current_count,jielong_target_count:a.jielong_target_count,jielong_current_count:a.jielong_current_count}),Ae=()=>({completed_today:(S.completedToday||[]).map(Se),due_today:(S.dueToday||[]).map(Se),ongoing:(S.ongoing||[]).map(Se),overdue_uncompleted:(S.overdue||[]).map(Se)}),tt=async()=>{var a,e,r,i,y;Ie.value=!0;try{const _={page:1,size:100};P.value&&A.value==="user"&&ve.value&&(_.assigned_to=ve.value);const g=await E.get("/tasks",{params:_});let m=Array.isArray(g.data)?g.data:((a=g.data)==null?void 0:a.items)||g.data||[];const v=h=>{const u=String(h||"").toLowerCase(),f=u.match(/(user|group|identity|all)/);return f?f[1]:u};if(ae.value&&A.value==="group"){const h=me.value||((e=C.user)==null?void 0:e.group_id);if(h){const u=(Y.value||[]).map(f=>f.id);m=m.filter(f=>{const T=v(f.assignment_type);return T==="group"&&f.target_group_id===h||T==="user"&&u.includes(f.assigned_to)||T==="all"})}}else if(!ae.value&&!P.value){const h=(r=C.user)==null?void 0:r.id,u=(i=C.user)==null?void 0:i.group_id,f=String(((y=C.user)==null?void 0:y.identity_type)||"").toLowerCase();m=m.filter(T=>{const $=v(T.assignment_type);return $==="user"&&T.assigned_to===h||$==="group"&&T.target_group_id===u||$==="identity"&&String(T.target_identity||"").toLowerCase()===f||$==="all"})}else if(P.value){if(A.value==="group"&&me.value){const h=me.value,u=(Y.value||[]).filter(f=>f.group_id===h).map(f=>f.id);m=m.filter(f=>{const T=v(f.assignment_type);return T==="group"&&f.target_group_id===h||T==="user"&&u.includes(f.assigned_to)||T==="all"})}if(A.value==="identity"&&ke.value){const h=String(ke.value||"").toLowerCase();m=m.filter(u=>v(u.assignment_type)==="identity"&&String(u.target_identity||"").toLowerCase()===h)}}return m}catch{return j.error("获取任务用于汇总失败"),[]}finally{Ie.value=!1}},Fe=(a,e)=>{if(!a||!e)return!1;const r=new Date(a),i=new Date(e);return r.getFullYear()===i.getFullYear()&&r.getMonth()===i.getMonth()&&r.getDate()===i.getDate()},J=async()=>{Ne.value=!0;try{const a=p.report_date||F(new Date),e=new Date(a+"T00:00:00"),r=await tt(),i=[],y=[],_=[],g=[],m=[];r.forEach(u=>{const f=String(u.status||"").toLowerCase(),$=((f.match(/(pending|processing|done)/)||[])[1]||f)==="done"||u.is_completed===!0,D=u.due_date?new Date(u.due_date.replace(" ","T")):null,L=u.updated_at?new Date(String(u.updated_at).replace(" ","T")):null,R=!!(D&&Fe(D,e)),Q=!!(D&&D<e);$&&L&&Fe(L,e)&&_.push(u),R?$?i.push(u):y.push(u):!D||D&&D>e?$||g.push(u):!$&&Q&&m.push(u)});const v=[];_.length&&v.push(`【今日完成】
`+_.map(u=>`• ${u.title}`).join(`
`));const h=[];i.length&&h.push(...i.map(u=>`• ${u.title}（已完成）`)),y.length&&h.push(...y.map(u=>`• ${u.title}（未完成）`)),h.length&&v.push(`【今日到期】
`+h.join(`
`)),g.length&&v.push(`【正在进行（未到期/无截止）】
`+g.map(u=>`• ${u.title}`).join(`
`)),m.length&&v.push(`【逾期未完成】
`+m.map(u=>`• ${u.title}`).join(`
`)),p.completed_tasks=v.length?v.join(`

`):`【今日完成】
无

【今日到期】
无

【正在进行（未到期/无截止）】
无`,S.completedToday=_,S.dueToday=[...i,...y],S.ongoing=g,S.overdue=m}catch{j.error("自动加载任务汇总失败")}finally{Ne.value=!1}};P.value?A.value="all":ae.value?(A.value="group",me.value=((Be=C.user)==null?void 0:Be.group_id)||null):(A.value="user",ve.value=((Oe=C.user)==null?void 0:Oe.id)||null),Ke(()=>Z.value,a=>{a&&J()}),Ke(()=>p.report_date,()=>{Z.value&&J()});const O=async()=>{var a,e,r;G.value=!0;try{const i={page:B.page,size:B.size,search:K.search};K.dateRange&&K.dateRange.length===2&&(i.start_date=K.dateRange[0],i.end_date=K.dateRange[1]),P.value?(_e.value&&(i.group_id=_e.value),X.value&&(i.user_id=X.value)):ae.value?((a=C.user)!=null&&a.group_id&&(i.group_id=C.user.group_id),X.value&&(i.user_id=X.value)):(e=C.user)!=null&&e.id&&(i.user_id=C.user.id);const _=(await E.get("/reports",{params:i})).data,g=m=>({id:m.id,report_date:m.work_date,summary:m.work_summary??m.title??"",completed_tasks:m.task_progress??"",issues_encountered:m.challenges??"",next_day_plan:m.tomorrow_plan??"",call_count:m.call_count??0,call_duration:m.call_duration??0,ai_analysis:m.ai_analysis||{},created_at:m.created_at,updated_at:m.updated_at});if(Array.isArray(_))we.value=_.map(g),B.total=_.length||0;else if(_&&typeof _=="object"){const m=_.items||[];we.value=m.map(g),B.total=typeof _.total=="number"?_.total:((r=_.items)==null?void 0:r.length)||0}else we.value=[],B.total=0}catch{j.error("获取日报列表失败")}finally{G.value=!1}},at=async()=>{try{const a=await E.get("/groups",{params:{page:1,size:100}});Te.value=a.data.items||[]}catch{}},Pe=async()=>{var a;if(!((a=C.user)!=null&&a.group_id)){Y.value=[];return}try{const e=await E.get(`/groups/${C.user.group_id}/members`);Y.value=e.data||[]}catch{Y.value=[]}},Ye=async()=>{try{let e=(await E.get("/users",{params:{page:1,size:100}})).data.items||[];_e.value&&(e=e.filter(r=>r.group_id===_e.value)),xe.value&&(e=e.filter(r=>String(r.identity_type||"").toLowerCase()===String(xe.value||"").toLowerCase())),Y.value=e}catch{Y.value=[]}},Le=async()=>{P.value?await Ye():ae.value&&await Pe()},st=async()=>{await Le(),await O()},lt=()=>{ee.value=!1,p.report_date=new Date().toISOString().split("T")[0],Z.value=!0,J()},qe=w(!1),ot=async a=>{var i,y,_,g,m,v,h,u,f;const e=(i=a==null?void 0:a.ai_analysis)==null?void 0:i.tasks_snapshot;if(!(e&&((y=e.completed_today)!=null&&y.length||(_=e.completedToday)!=null&&_.length||(g=e.due_today)!=null&&g.length||(m=e.dueToday)!=null&&m.length||(v=e.ongoing)!=null&&v.length||(h=e.ongoing_uncompleted)!=null&&h.length))){qe.value=!0;try{const $=((u=(await E.post(`/reports/${parseInt(a.id)}/build-snapshot`)).data)==null?void 0:u.ai_analysis)||{};z.value&&(z.value.ai_analysis=$);const D=($==null?void 0:$.tasks_snapshot)||null;D&&(U.completedToday=D.completed_today||D.completedToday||[],U.dueToday=D.due_today||D.dueToday||[],U.ongoing=D.ongoing||D.ongoing_uncompleted||D.ongoingUncompleted||[],U.overdue=D.overdue_uncompleted||[])}catch(T){((f=T==null?void 0:T.response)==null?void 0:f.status)!==403&&(console.error("[Reports] build-snapshot failed",T),j.error("构建任务卡片快照失败"))}finally{qe.value=!1}}},nt=async a=>{var r;z.value=a;const e=((r=a==null?void 0:a.ai_analysis)==null?void 0:r.tasks_snapshot)||null;e?(U.completedToday=e.completed_today||e.completedToday||[],U.dueToday=e.due_today||e.dueToday||[],U.ongoing=e.ongoing||e.ongoing_uncompleted||e.ongoingUncompleted||[],U.overdue=e.overdue_uncompleted||[]):(U.completedToday=[],U.dueToday=[],U.ongoing=[],U.overdue=[]),De.value=!0,await ot(a)},rt=a=>{ee.value=!0,Object.assign(p,{id:parseInt(a.id),report_date:a.report_date,summary:a.summary,completed_tasks:"",issues_encountered:a.issues_encountered||"",next_day_plan:a.next_day_plan,call_count:a.call_count||0,call_duration:a.call_duration||0}),Z.value=!0,J()},dt=()=>{fe.value&&fe.value.resetFields(),Object.assign(p,{report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0}),We.value=[]},it=async()=>{var a,e;if(fe.value)try{await fe.value.validate(),Ue.value=!0,await J();const i=[...S.completedToday||[],...S.dueToday||[],...S.ongoing||[]].map(v=>H(v)).filter(v=>Number.isFinite(v)),y=i.length?i.reduce((v,h)=>v+h,0)/i.length:.7,_=Math.max(1,Math.min(10,Math.round(y*10))),m=[`【工作摘要】
${p.summary||""}`,`【完成任务】
${p.completed_tasks||""}`,`【遇到问题】
${p.issues_encountered||""}`,`【明日计划】
${p.next_day_plan||""}`].join(`

`);if(ee.value){const v={work_summary:p.summary||void 0,task_progress:p.completed_tasks||void 0,challenges:p.issues_encountered||void 0,tomorrow_plan:p.next_day_plan||void 0,call_count:Number.isFinite(Number(p.call_count))?Number(p.call_count):void 0,call_duration:Number.isFinite(Number(p.call_duration))?Number(p.call_duration):void 0,content:m||void 0,title:(p.summary||`日报 ${p.report_date||""}`).slice(0,200),tasks_snapshot:Ae()};await E.put(`/reports/${p.id}`,v),j.success("日报更新成功")}else{const v=F(new Date),h=p.report_date||v,u={work_date:h,title:(p.summary||`日报 ${h}`).slice(0,200),content:m,work_hours:0,task_progress:p.completed_tasks||"",work_summary:p.summary||"",mood_score:0,efficiency_score:_,call_count:Number.isFinite(Number(p.call_count))?Number(p.call_count):0,call_duration:Number.isFinite(Number(p.call_duration))?Number(p.call_duration):0,achievements:void 0,challenges:p.issues_encountered||void 0,tomorrow_plan:p.next_day_plan||void 0,tasks_snapshot:Ae()};console.debug("[Reports] POST /reports payload",u),await E.post("/reports",u),j.success("日报提交成功")}Z.value=!1,O()}catch(r){const i=(a=r==null?void 0:r.response)==null?void 0:a.status,y=(e=r==null?void 0:r.response)==null?void 0:e.data;if(y!=null&&y.detail)j.error(y.detail);else if(i)if(i===500)j.error("服务器内部错误：请稍后重试或联系管理员");else if(i===422){const _=Array.isArray(y==null?void 0:y.detail)?y.detail.map(g=>g.msg).join("; "):"请求参数不合法";j.error(`提交失败：${_}`)}else j.error(`提交失败（HTTP ${i}）`);else j.error(ee.value?"更新失败":"提交失败");console.error("[Reports] Submit error",{isEdit:ee.value,reportForm:{...p},status:i,data:y})}finally{Ue.value=!1}},ut=async a=>{try{await wt.confirm(`确定要删除${F(a.report_date)}的日报吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await E.delete(`/reports/${parseInt(a.id)}`),j.success("删除成功"),O()}catch(e){e!=="cancel"&&j.error("删除失败")}},ct=async()=>{var a,e;je.value=!0;try{const r=new Date().toISOString().split("T")[0],i=await E.post("/task-sync/auto-generate-daily-report",{date:r});i.data.success?(j.success("自动生成日报成功"),O()):j.warning(i.data.message||"自动生成日报失败")}catch(r){console.error("自动生成日报失败:",r),(e=(a=r.response)==null?void 0:a.data)!=null&&e.detail?j.error(r.response.data.detail):j.error("自动生成日报失败")}finally{je.value=!1}};return ht(async()=>{await at(),P.value?await Ye():ae.value&&await Pe(),await O()}),(a,e)=>{const r=x("el-button"),i=x("el-date-picker"),y=x("el-input"),_=x("el-option"),g=x("el-select"),m=x("el-table-column"),v=x("el-table"),h=x("el-pagination"),u=x("el-card"),f=x("el-form-item"),T=x("el-alert"),$=x("el-radio-button"),D=x("el-radio-group"),L=x("el-tag"),R=x("el-icon"),Q=x("el-progress"),W=x("el-col"),te=x("el-row"),ue=x("el-empty"),Ee=x("el-input-number"),pt=x("el-form"),Ge=x("el-dialog"),he=He("can"),_t=He("loading");return n(),k("div",$t,[e[62]||(e[62]=s("div",{class:"page-header"},[s("h1",{class:"page-title"},"日报管理"),s("p",{class:"page-description"},"查看和管理您的日报")],-1)),o(u,{class:"content-card"},{header:l(()=>[s("div",Dt,[e[22]||(e[22]=s("span",null,"日报列表",-1)),ye((n(),c(r,{type:"primary",icon:V(mt),onClick:lt},{default:l(()=>[...e[21]||(e[21]=[b(" 写日报 ",-1)])]),_:1},8,["icon"])),[[he,"reports:create"]])])]),default:l(()=>[s("div",Ut,[s("div",jt,[o(i,{modelValue:K.dateRange,"onUpdate:modelValue":e[0]||(e[0]=t=>K.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),o(y,{modelValue:K.search,"onUpdate:modelValue":e[1]||(e[1]=t=>K.search=t),placeholder:"搜索日报...","prefix-icon":V(gt),clearable:""},null,8,["modelValue","prefix-icon"]),ae.value?(n(),c(g,{key:0,modelValue:X.value,"onUpdate:modelValue":e[2]||(e[2]=t=>X.value=t),placeholder:"筛选本组用户",clearable:"",onChange:O},{default:l(()=>[(n(!0),k(I,null,N(Y.value,t=>(n(),c(_,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0),P.value?(n(),c(g,{key:1,modelValue:_e.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_e.value=t),placeholder:"选择组别",clearable:"",onChange:st},{default:l(()=>[(n(!0),k(I,null,N(Te.value,t=>(n(),c(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0),P.value?(n(),c(g,{key:2,modelValue:xe.value,"onUpdate:modelValue":e[4]||(e[4]=t=>xe.value=t),placeholder:"身份类型(CC(顾问)/SS(班主任)/LP(英文辅导))",clearable:"",onChange:Le},{default:l(()=>[o(_,{label:"CC(顾问)",value:"cc"}),o(_,{label:"SS(班主任)",value:"ss"}),o(_,{label:"LP(英文辅导)",value:"lp"})]),_:1},8,["modelValue"])):q("",!0),P.value?(n(),c(g,{key:3,modelValue:X.value,"onUpdate:modelValue":e[5]||(e[5]=t=>X.value=t),placeholder:"筛选用户",clearable:"",onChange:O},{default:l(()=>[(n(!0),k(I,null,N(Y.value,t=>(n(),c(_,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0)]),s("div",Rt,[o(r,{icon:V(yt),onClick:O},{default:l(()=>[...e[23]||(e[23]=[b("刷新",-1)])]),_:1},8,["icon"]),ye((n(),c(r,{type:"info",onClick:ct,loading:je.value},{default:l(()=>[...e[24]||(e[24]=[b(" 自动生成今日日报 ",-1)])]),_:1},8,["loading"])),[[he,"reports:auto_generate"]])])]),ye((n(),c(v,{data:we.value,stripe:"",style:{width:"100%"}},{default:l(()=>[o(m,{prop:"report_date",label:"日期",width:"120"},{default:l(({row:t})=>[b(d(V(F)(t.report_date)),1)]),_:1}),o(m,{prop:"summary",label:"摘要","min-width":"300"}),o(m,{prop:"created_at",label:"创建时间",width:"180"},{default:l(({row:t})=>[b(d(V(xt)(t.created_at)),1)]),_:1}),o(m,{label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[ye((n(),c(r,{type:"primary",size:"small",onClick:ge=>nt(t)},{default:l(()=>[...e[25]||(e[25]=[b(" 查看 ",-1)])]),_:1},8,["onClick"])),[[he,t,"report",{view:!0}]]),ye((n(),c(r,{type:"warning",size:"small",onClick:ge=>rt(t)},{default:l(()=>[...e[26]||(e[26]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[he,t,"report",{edit:!0}]]),ye((n(),c(r,{type:"danger",size:"small",onClick:ge=>ut(t)},{default:l(()=>[...e[27]||(e[27]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])),[[he,t,"report",{delete:!0}]])]),_:1})]),_:1},8,["data"])),[[_t,G.value]]),s("div",zt,[o(h,{"current-page":B.page,"onUpdate:currentPage":e[6]||(e[6]=t=>B.page=t),"page-size":B.size,"onUpdate:pageSize":e[7]||(e[7]=t=>B.size=t),total:B.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),o(Ge,{modelValue:Z.value,"onUpdate:modelValue":e[19]||(e[19]=t=>Z.value=t),title:ee.value?"编辑日报":"写日报",width:"800px",onClose:dt},{footer:l(()=>[s("span",ja,[o(r,{onClick:e[18]||(e[18]=t=>Z.value=!1)},{default:l(()=>[...e[48]||(e[48]=[b("取消",-1)])]),_:1}),o(r,{type:"primary",onClick:it,loading:Ue.value},{default:l(()=>[b(d(ee.value?"更新":"提交"),1)]),_:1},8,["loading"])])]),default:l(()=>[o(pt,{ref_key:"formRef",ref:fe,model:p,rules:et,"label-width":"100px"},{default:l(()=>[o(f,{label:"日报日期",prop:"report_date"},{default:l(()=>[o(i,{modelValue:p.report_date,"onUpdate:modelValue":e[8]||(e[8]=t=>p.report_date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",disabled:ee.value},null,8,["modelValue","disabled"])]),_:1}),o(f,{label:"工作摘要",prop:"summary"},{default:l(()=>[o(y,{modelValue:p.summary,"onUpdate:modelValue":e[9]||(e[9]=t=>p.summary=t),type:"textarea",rows:3,placeholder:"请简要描述今日工作内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(f,{label:"完成任务",prop:"completed_tasks"},{default:l(()=>[s("div",Mt,[o(T,{title:"已自动加载：当日到期（已/未完成） + 正在进行未完成 + 逾期（今日完成/未完成）",type:"info",closable:!1,style:{"margin-bottom":"10px"}}),P.value?(n(),k("div",It,[o(D,{modelValue:A.value,"onUpdate:modelValue":e[10]||(e[10]=t=>A.value=t),size:"small",onChange:J},{default:l(()=>[o($,{label:"all"},{default:l(()=>[...e[28]||(e[28]=[b("全部",-1)])]),_:1}),o($,{label:"user"},{default:l(()=>[...e[29]||(e[29]=[b("个人",-1)])]),_:1}),o($,{label:"group"},{default:l(()=>[...e[30]||(e[30]=[b("组别",-1)])]),_:1}),o($,{label:"identity"},{default:l(()=>[...e[31]||(e[31]=[b("角色",-1)])]),_:1})]),_:1},8,["modelValue"]),A.value==="user"?(n(),c(g,{key:0,modelValue:ve.value,"onUpdate:modelValue":e[11]||(e[11]=t=>ve.value=t),placeholder:"选择用户",filterable:"",style:{width:"220px"},onChange:J},{default:l(()=>[(n(!0),k(I,null,N(Y.value,t=>(n(),c(_,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0),A.value==="group"?(n(),c(g,{key:1,modelValue:me.value,"onUpdate:modelValue":e[12]||(e[12]=t=>me.value=t),placeholder:"选择组别",filterable:"",style:{width:"220px"},onChange:J},{default:l(()=>[(n(!0),k(I,null,N(Te.value,t=>(n(),c(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0),A.value==="identity"?(n(),c(g,{key:2,modelValue:ke.value,"onUpdate:modelValue":e[13]||(e[13]=t=>ke.value=t),placeholder:"选择角色",filterable:"",style:{width:"220px"},onChange:J},{default:l(()=>[(n(!0),k(I,null,N(Ze.value,t=>(n(),c(_,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):q("",!0)])):q("",!0),s("div",Nt,[e[44]||(e[44]=s("h4",{class:"hierarchy-title"},"今日完成",-1)),S.completedToday.length>0?(n(),c(te,{key:0,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(S.completedToday,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`completed-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",At,[s("span",Ft,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",Pt,[s("div",Yt,[s("div",Lt,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[32]||(e[32]=s("span",{class:"meta-label"},"分配：",-1)),s("span",qt,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",Bt,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[33]||(e[33]=s("span",{class:"meta-label"},"截止：",-1)),s("span",Ot,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",Et,[s("span",Gt,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",Kt,d(M(t))+"%",1)])]),s("div",Ht,[o(r,{type:"primary",size:"small",onClick:ge=>Ce(t)},{default:l(()=>[...e[34]||(e[34]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:1,description:"无"})),e[45]||(e[45]=s("h4",{class:"hierarchy-title"},"今日到期",-1)),S.dueToday.length>0?(n(),c(te,{key:2,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(S.dueToday,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`due-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",Jt,[s("span",Qt,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",Wt,[s("div",Xt,[s("div",Zt,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[35]||(e[35]=s("span",{class:"meta-label"},"分配：",-1)),s("span",ea,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",ta,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[36]||(e[36]=s("span",{class:"meta-label"},"截止：",-1)),s("span",aa,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",sa,[s("span",la,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",oa,d(M(t))+"%",1)])]),s("div",na,[o(r,{type:"primary",size:"small",onClick:ge=>Ce(t)},{default:l(()=>[...e[37]||(e[37]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:3,description:"无"})),e[46]||(e[46]=s("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),S.ongoing.length>0?(n(),c(te,{key:4,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(S.ongoing,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`ongoing-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",ra,[s("span",da,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",ia,[s("div",ua,[s("div",ca,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[38]||(e[38]=s("span",{class:"meta-label"},"分配：",-1)),s("span",pa,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",_a,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[39]||(e[39]=s("span",{class:"meta-label"},"截止：",-1)),s("span",ma,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",ga,[s("span",ya,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",fa,d(M(t))+"%",1)])]),s("div",va,[o(r,{type:"primary",size:"small",onClick:ge=>Ce(t)},{default:l(()=>[...e[40]||(e[40]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:5,description:"无"})),e[47]||(e[47]=s("h4",{class:"hierarchy-title"},"逾期（未完成）",-1)),S.overdue.length>0?(n(),c(te,{key:6,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(S.overdue,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`overdue-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",ha,[s("span",ba,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",wa,[s("div",xa,[s("div",Ta,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[41]||(e[41]=s("span",{class:"meta-label"},"分配：",-1)),s("span",ka,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",Ca,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[42]||(e[42]=s("span",{class:"meta-label"},"截止：",-1)),s("span",Va,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",Sa,[s("span",$a,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",Da,d(M(t))+"%",1)])]),s("div",Ua,[o(r,{type:"primary",size:"small",onClick:ge=>Ce(t)},{default:l(()=>[...e[43]||(e[43]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:7,description:"无"}))])])]),_:1}),o(f,{label:"遇到问题",prop:"issues_encountered"},{default:l(()=>[o(y,{modelValue:p.issues_encountered,"onUpdate:modelValue":e[14]||(e[14]=t=>p.issues_encountered=t),type:"textarea",rows:3,placeholder:"描述工作中遇到的问题和困难",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(f,{label:"明日计划",prop:"next_day_plan"},{default:l(()=>[o(y,{modelValue:p.next_day_plan,"onUpdate:modelValue":e[15]||(e[15]=t=>p.next_day_plan=t),type:"textarea",rows:3,placeholder:"描述明日的工作计划",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(te,{gutter:20},{default:l(()=>[o(W,{span:12},{default:l(()=>[o(f,{label:"KPI 通次",prop:"call_count"},{default:l(()=>[o(Ee,{modelValue:p.call_count,"onUpdate:modelValue":e[16]||(e[16]=t=>p.call_count=t),min:0,step:1,placeholder:"今日拨打次数"},null,8,["modelValue"])]),_:1})]),_:1}),o(W,{span:12},{default:l(()=>[o(f,{label:"KPI 通时",prop:"call_duration"},{default:l(()=>[o(Ee,{modelValue:p.call_duration,"onUpdate:modelValue":e[17]||(e[17]=t=>p.call_duration=t),min:0,step:1,placeholder:"拨打总时长（分钟）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),o(Ge,{modelValue:De.value,"onUpdate:modelValue":e[20]||(e[20]=t=>De.value=t),title:"查看日报",width:"800px"},{default:l(()=>[z.value?(n(),k("div",Ra,[s("div",za,[s("h3",null,d(V(F)(z.value.report_date))+" 日报",1),s("div",Ma,[z.value.call_count!==void 0&&z.value.call_duration!==void 0?(n(),c(L,{key:0,type:"success"},{default:l(()=>[b(" KPI 通次/通时: "+d(z.value.call_count)+"/"+d(z.value.call_duration),1)]),_:1})):q("",!0)])]),s("div",Ia,[e[49]||(e[49]=s("h4",null,"工作摘要",-1)),s("p",null,d(z.value.summary),1)]),s("div",Na,[e[59]||(e[59]=s("h4",null,"完成任务",-1)),Qe.value?(n(),k("div",Aa,[e[56]||(e[56]=s("h4",{class:"hierarchy-title"},"今日完成",-1)),U.completedToday.length>0?(n(),c(te,{key:0,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(U.completedToday,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`view-completed-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",Fa,[s("span",Pa,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",Ya,[s("div",La,[s("div",qa,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[50]||(e[50]=s("span",{class:"meta-label"},"分配：",-1)),s("span",Ba,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",Oa,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[51]||(e[51]=s("span",{class:"meta-label"},"截止：",-1)),s("span",Ea,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",Ga,[s("span",Ka,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",Ha,d(M(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:1,description:"无"})),e[57]||(e[57]=s("h4",{class:"hierarchy-title"},"今日到期",-1)),U.dueToday.length>0?(n(),c(te,{key:2,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(U.dueToday,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`view-due-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",Ja,[s("span",Qa,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",Wa,[s("div",Xa,[s("div",Za,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[52]||(e[52]=s("span",{class:"meta-label"},"分配：",-1)),s("span",es,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",ts,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[53]||(e[53]=s("span",{class:"meta-label"},"截止：",-1)),s("span",as,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",ss,[s("span",ls,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",os,d(M(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:3,description:"无"})),e[58]||(e[58]=s("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),U.ongoing.length>0?(n(),c(te,{key:4,gutter:12},{default:l(()=>[(n(!0),k(I,null,N(U.ongoing,t=>(n(),c(W,{xs:24,sm:12,md:12,lg:8,key:`view-ongoing-${t.id}`},{default:l(()=>[o(u,{class:"task-card",shadow:"always"},{default:l(()=>[s("div",ns,[s("span",rs,d(t.title),1),o(L,{type:le(t.status),size:"small"},{default:l(()=>[b(d(se(t.status)),1)]),_:2},1032,["type"])]),s("div",ds,[s("div",is,[s("div",us,[o(R,{class:"meta-icon"},{default:l(()=>[(n(),c(ce(re(t.assignment_type))))]),_:2},1024),e[54]||(e[54]=s("span",{class:"meta-label"},"分配：",-1)),s("span",cs,d(oe(t.assignment_type))+" · "+d(ne(t)),1)]),s("div",ps,[o(R,{class:"meta-icon"},{default:l(()=>[o(V(pe))]),_:1}),e[55]||(e[55]=s("span",{class:"meta-label"},"截止：",-1)),s("span",_s,d(t.due_date?V(F)(t.due_date):"无"),1)])]),s("div",ms,[s("span",gs,d(de(t)),1),o(Q,{percentage:M(t),"stroke-width":10,color:ie(H(t)),"show-text":!1},null,8,["percentage","color"]),s("span",ys,d(M(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(n(),c(ue,{key:5,description:"无"}))])):(n(),k("p",fs,d(z.value.completed_tasks),1))]),z.value.issues_encountered?(n(),k("div",vs,[e[60]||(e[60]=s("h4",null,"遇到问题",-1)),s("p",null,d(z.value.issues_encountered),1)])):q("",!0),s("div",hs,[e[61]||(e[61]=s("h4",null,"明日计划",-1)),s("p",null,d(z.value.next_day_plan),1)])])):q("",!0)]),_:1},8,["modelValue"])])}}},Ss=ft(bs,[["__scopeId","data-v-a278f353"]]);export{Ss as default};
