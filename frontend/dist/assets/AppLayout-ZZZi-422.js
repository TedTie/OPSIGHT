import{u as Y,a as G,r as M,c as D,o as j,b as i,d as b,e as p,w as s,f as c,g as e,h as u,i as Z,j as F,k as d,l as E,m as k,F as U,n as ee,p as te,t as N,q as se,s as K,v as O,x as oe,E as H,y as ne,z as ae,A as J,B as le,C as re,D as ue,G as ie,H as de,I as ce,J as me,K as _e}from"./index-g0Sg6k74.js";import{_ as V}from"./_plugin-vue_export-helper-DlAUqK2U.js";const pe={class:"header-left"},fe={class:"header-right"},ge={class:"notification-header"},ve={class:"notification-list"},Ae=["onClick"],Se={class:"notification-content"},he={class:"notification-title"},we={class:"notification-message"},ye={class:"notification-time"},be={key:0,class:"notification-dot"},ke={key:0,class:"empty-notifications"},xe={class:"user-info"},Ce={class:"username"},Ne={__name:"AppHeader",emits:["toggle-sidebar"],setup(I,{emit:S}){const n=Y(),h=G(),v=S,g=M(0),m=M([]),w=[{id:1,title:"任务提醒",message:"您有一个任务即将到期，请及时处理",type:"task",is_read:!1,created_at:new Date(Date.now()-1e3*60*30)},{id:2,title:"系统通知",message:"系统将于今晚22:00进行维护，预计持续1小时",type:"system",is_read:!1,created_at:new Date(Date.now()-1e3*60*60*2)},{id:3,title:"日报提醒",message:"今日日报尚未提交，请及时完成",type:"report",is_read:!0,created_at:new Date(Date.now()-1e3*60*60*4)}],o=D(()=>{var a;return((a=h.user)==null?void 0:a.avatar)||""}),t=D(()=>{var r;const a=h.user;return a?a.full_name?a.full_name.charAt(0).toUpperCase():((r=a.username)==null?void 0:r.charAt(0).toUpperCase())||"U":""}),l=()=>{v("toggle-sidebar")},_=async a=>{switch(a){case"profile":n.push("/profile");break;case"settings":n.push("/settings");break;case"logout":try{await ne.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.logout(),n.push("/login")}catch{}break}},$=a=>{switch(a){case"viewAll":H.info("跳转到通知页面");break}},T=a=>{switch(a.is_read=!0,z(),a.type){case"task":n.push("/tasks");break;case"report":n.push("/reports");break;case"system":H.info(a.message);break}},L=()=>{m.value.forEach(a=>{a.is_read=!0}),z(),H.success("所有通知已标记为已读")},z=()=>{g.value=m.value.filter(a=>!a.is_read).length},P=a=>{const y=new Date-a,x=Math.floor(y/(1e3*60)),C=Math.floor(y/(1e3*60*60)),A=Math.floor(y/(1e3*60*60*24));return x<1?"刚刚":x<60?`${x}分钟前`:C<24?`${C}小时前`:A<7?`${A}天前`:a.toLocaleDateString()},Q=()=>{m.value=[...w],z()};return j(()=>{Q()}),(a,r)=>{const y=i("el-button"),x=i("el-badge"),C=i("el-divider"),A=i("el-icon"),B=i("el-dropdown-item"),R=i("el-dropdown-menu"),q=i("el-dropdown"),W=i("el-avatar"),X=i("el-header");return p(),b(X,{class:"app-header"},{default:s(()=>[c("div",pe,[e(y,{type:"text",icon:u(Z),class:"menu-toggle",onClick:l},null,8,["icon"]),r[0]||(r[0]=c("h1",{class:"app-title"},"OPSIGHT",-1))]),c("div",fe,[e(q,{onCommand:$,trigger:"click"},{dropdown:s(()=>[e(R,null,{default:s(()=>[c("div",ge,[r[2]||(r[2]=c("span",null,"通知消息",-1)),e(y,{type:"text",size:"small",onClick:L},{default:s(()=>[...r[1]||(r[1]=[d("全部已读",-1)])]),_:1})]),e(C,{style:{margin:"8px 0"}}),c("div",ve,[(p(!0),E(U,null,ee(m.value,f=>(p(),E("div",{key:f.id,class:te(["notification-item",{unread:!f.is_read}]),onClick:$e=>T(f)},[c("div",Se,[c("div",he,N(f.title),1),c("div",we,N(f.message),1),c("div",ye,N(P(f.created_at)),1)]),f.is_read?k("",!0):(p(),E("div",be))],10,Ae))),128)),m.value.length===0?(p(),E("div",ke," 暂无通知消息 ")):k("",!0)]),e(C,{style:{margin:"8px 0"}}),e(B,{command:"viewAll"},{default:s(()=>[e(A,null,{default:s(()=>[e(u(F))]),_:1}),r[3]||(r[3]=d(" 查看全部通知 ",-1))]),_:1})]),_:1})]),default:s(()=>[e(x,{value:g.value,hidden:g.value===0},{default:s(()=>[e(y,{type:"text",icon:u(F),class:"header-button"},null,8,["icon"])]),_:1},8,["value","hidden"])]),_:1}),e(q,{onCommand:_},{dropdown:s(()=>[e(R,null,{default:s(()=>[e(B,{command:"profile"},{default:s(()=>[e(A,null,{default:s(()=>[e(u(K))]),_:1}),r[4]||(r[4]=d(" 个人资料 ",-1))]),_:1}),e(B,{command:"settings"},{default:s(()=>[e(A,null,{default:s(()=>[e(u(O))]),_:1}),r[5]||(r[5]=d(" 设置 ",-1))]),_:1}),e(B,{divided:"",command:"logout"},{default:s(()=>[e(A,null,{default:s(()=>[e(u(oe))]),_:1}),r[6]||(r[6]=d(" 退出登录 ",-1))]),_:1})]),_:1})]),default:s(()=>{var f;return[c("div",xe,[e(W,{size:32,src:o.value},{default:s(()=>[d(N(t.value),1)]),_:1},8,["src"]),c("span",Ce,N((f=u(h).user)==null?void 0:f.username),1),e(A,{class:"dropdown-icon"},{default:s(()=>[e(u(se))]),_:1})])]}),_:1})])]),_:1})}}},De=V(Ne,[["__scopeId","data-v-9b8893e9"]]),Ie={class:"sidebar-content"},Be={__name:"AppSidebar",props:{collapsed:{type:Boolean,default:!1}},setup(I){const S=ae(),n=G(),h=D(()=>S.path),v=M(null),g=()=>{try{const o=JSON.parse(localStorage.getItem("user")||"null");v.value=o,console.log("User state updated:",o)}catch(o){console.error("Error parsing user from localStorage:",o),v.value=null}},m=D(()=>{if(n.user&&n.user.role){const t=n.user.role==="super_admin";return console.log("isSuperAdmin computed (authStore):",{user:n.user.username,role:n.user.role,isSuperAdmin:t}),t}const o=v.value;if(o&&o.role){const t=o.role==="super_admin";return console.log("isSuperAdmin computed (userState):",{user:o.username,role:o.role,isSuperAdmin:t}),t}try{const t=JSON.parse(localStorage.getItem("user")||"null"),l=t&&t.role==="super_admin";return console.log("isSuperAdmin computed (localStorage):",{user:t==null?void 0:t.username,role:t==null?void 0:t.role,isSuperAdmin:l}),l}catch(t){return console.error("Error reading from localStorage:",t),!1}}),w=D(()=>{if(n.user&&n.user.role){const t=n.user.role==="admin"||n.user.role==="super_admin";return console.log("isAdmin computed (authStore):",{user:n.user.username,role:n.user.role,isAdmin:t}),t}const o=v.value;if(o&&o.role){const t=o.role==="admin"||o.role==="super_admin";return console.log("isAdmin computed (userState):",{user:o.username,role:o.role,isAdmin:t}),t}try{const t=JSON.parse(localStorage.getItem("user")||"null"),l=t&&(t.role==="admin"||t.role==="super_admin");return console.log("isAdmin computed (localStorage):",{user:t==null?void 0:t.username,role:t==null?void 0:t.role,isAdmin:l}),l}catch(t){return console.error("Error reading from localStorage:",t),!1}});return j(()=>{console.log("AppSidebar mounted"),g(),window.addEventListener("storage",g),console.log("AuthStore state:",{user:n.user,isAuthenticated:n.isAuthenticated,isAdmin:n.isAdmin,isSuperAdmin:n.isSuperAdmin}),n.user||(console.log("No user in authStore, calling initAuth..."),n.initAuth())}),J(()=>n.user,o=>{console.log("AuthStore user changed:",o),o?v.value=o:g()},{immediate:!0}),J(m,o=>{console.log("isSuperAdmin changed:",o)},{immediate:!0}),J(w,o=>{console.log("isAdmin changed:",o)},{immediate:!0}),(o,t)=>{const l=i("el-icon"),_=i("el-menu-item"),$=i("el-sub-menu"),T=i("el-menu"),L=i("el-aside");return p(),b(L,{width:I.collapsed?"64px":"240px",class:"app-sidebar"},{default:s(()=>[c("div",Ie,[e(T,{"default-active":h.value,collapse:I.collapsed,"unique-opened":!0,class:"sidebar-menu",router:""},{default:s(()=>[e(_,{index:"/dashboard"},{title:s(()=>[...t[0]||(t[0]=[d("仪表板",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(le))]),_:1})]),_:1}),e(_,{index:"/tasks"},{title:s(()=>[...t[1]||(t[1]=[d("任务管理",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(re))]),_:1})]),_:1}),e(_,{index:"/reports"},{title:s(()=>[...t[2]||(t[2]=[d("日报管理",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(ue))]),_:1})]),_:1}),e(_,{index:"/analytics"},{title:s(()=>[...t[3]||(t[3]=[d("数据分析",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(ie))]),_:1})]),_:1}),e(_,{index:"/knowledge-base"},{title:s(()=>[...t[4]||(t[4]=[d("知识库",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(de))]),_:1})]),_:1}),m.value?(p(),b(_,{key:0,index:"/settings"},{title:s(()=>[...t[5]||(t[5]=[d("设置",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(O))]),_:1})]),_:1})):k("",!0),w.value?(p(),b($,{key:1,index:"admin-menu"},{title:s(()=>[e(l,null,{default:s(()=>[e(u(O))]),_:1}),t[6]||(t[6]=c("span",null,"管理功能",-1))]),default:s(()=>[e(_,{index:"/admin/users"},{title:s(()=>[...t[7]||(t[7]=[d("用户管理",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(K))]),_:1})]),_:1}),e(_,{index:"/admin/groups"},{title:s(()=>[...t[8]||(t[8]=[d("组别管理",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(ce))]),_:1})]),_:1}),m.value?(p(),b(_,{key:0,index:"/admin/ai"},{title:s(()=>[...t[9]||(t[9]=[d("AI配置",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(me))]),_:1})]),_:1})):k("",!0),m.value?(p(),b(_,{key:1,index:"/admin/metrics"},{title:s(()=>[...t[10]||(t[10]=[d("自定义指标",-1)])]),default:s(()=>[e(l,null,{default:s(()=>[e(u(_e))]),_:1})]),_:1})):k("",!0)]),_:1})):k("",!0)]),_:1},8,["default-active","collapse"])])]),_:1},8,["width"])}}},Ee=V(Be,[["__scopeId","data-v-1a103be8"]]),Me={__name:"AppLayout",setup(I){const S=M(!1),n=()=>{S.value=!S.value};return(h,v)=>{const g=i("router-view"),m=i("el-main"),w=i("el-container");return p(),b(w,{class:"app-layout"},{default:s(()=>[e(Ee,{collapsed:S.value},null,8,["collapsed"]),e(w,{class:"main-container"},{default:s(()=>[e(De,{onToggleSidebar:n}),e(m,{class:"app-main"},{default:s(()=>[e(g)]),_:1})]),_:1})]),_:1})}}},ze=V(Me,[["__scopeId","data-v-72409c0f"]]);export{ze as default};
