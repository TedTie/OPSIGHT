import{c as A,l as _,e as p,g as s,O as et,h as d,a as st,L,r as k,o as at,u as nt,f as e,t as r,w as a,b as v,P as C,Q as ot,R as lt,S as it,T as rt,D as dt,U as P,m as R,F as B,n as I,k as y,d as ct,V as ut,W as pt,G as ft}from"./index-g0Sg6k74.js";import{f as W,a as mt}from"./date-CxVpZo2G.js";import{u as _t,i as gt,a as vt,b as yt,c as ht,d as kt,e as wt,f as xt,g as Tt,H as bt}from"./index.esm.min-qddng1nX.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $t={class:"chart-container"},Ct={__name:"TaskChart",props:{type:{type:String,default:"pie",validator:w=>["pie","bar","line"].includes(w)},data:{type:Array,default:()=>[]},title:{type:String,default:""},height:{type:String,default:"300px"}},setup(w){_t([gt,vt,yt,ht,kt,wt,xt,Tt]);const o=w,i=A(()=>({title:{text:o.title,left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:o.title,type:"pie",radius:"50%",data:o.data,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),f=A(()=>({title:{text:o.title,left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o.data.map(u=>u.name)},yAxis:{type:"value"},series:[{name:o.title,type:"bar",data:o.data.map(u=>u.value),itemStyle:{color:"#409EFF"}}]})),x=A(()=>({title:{text:o.title,left:"center",textStyle:{fontSize:16,fontWeight:"normal"}},tooltip:{trigger:"axis"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:o.data.map(u=>u.name)},yAxis:{type:"value"},series:[{name:o.title,type:"line",data:o.data.map(u=>u.value),smooth:!0,itemStyle:{color:"#67C23A"}}]})),T=A(()=>{switch(o.type){case"pie":return i.value;case"bar":return f.value;case"line":return x.value;default:return i.value}});return(u,S)=>(p(),_("div",$t,[s(d(bt),{option:T.value,style:et({height:w.height,width:"100%"}),autoresize:""},null,8,["option","style"])]))}},V=H(Ct,[["__scopeId","data-v-8ae302a3"]]),St={class:"dashboard"},At={class:"welcome-section"},Dt={class:"stats-content"},Rt={class:"stats-icon pending"},Wt={class:"stats-info"},Ft={class:"stats-content"},Ot={class:"stats-icon progress"},Et={class:"stats-info"},zt={class:"stats-content"},Mt={class:"stats-icon completed"},Ut={class:"stats-info"},Lt={class:"stats-content"},Pt={class:"stats-icon reports"},Bt={class:"stats-info"},It={class:"card-header"},Vt={class:"task-list"},Ht=["onClick"],Nt={class:"task-info"},jt={class:"task-meta"},qt={class:"task-date"},Gt={key:0,class:"empty-state"},Qt={class:"card-header"},Xt={class:"report-list"},Jt=["onClick"],Kt={class:"report-info"},Yt={class:"report-meta"},Zt={class:"report-date"},te={key:0,class:"empty-state"},ee={class:"efficiency-item"},se={class:"efficiency-value"},ae={class:"efficiency-item"},ne={class:"efficiency-value"},oe={class:"efficiency-item"},le={class:"efficiency-value"},ie={class:"action-buttons"},re={__name:"Dashboard",setup(w){const o=nt(),i=st(),f=L({pendingTasks:0,inProgressTasks:0,completedTasks:0,reportsThisWeek:0}),x=k([]),T=k(!1),u=k([]),S=k(!1),F=k([]),D=k([]),b=L({avgCompletionTime:0,weeklyCompletionRate:0,totalWorkHours:0}),N=n=>({pending:"warning",processing:"primary",done:"success"})[n]||"info",j=n=>({pending:"待处理",processing:"进行中",done:"已完成"})[n]||n,q=n=>n>=.7?"success":n>=.3?"warning":"danger",G=n=>{o.push(`/tasks/${parseInt(n.id)}`)},Q=n=>{o.push(`/reports/${parseInt(n.id)}`)},X=async()=>{var n;if(!i.isAuthenticated){console.log("User not authenticated, skipping stats fetch");return}try{const t=await C.get("/tasks/stats/summary");Object.assign(f,t.data),F.value=[{name:"待处理",value:f.pendingTasks},{name:"进行中",value:f.inProgressTasks},{name:"已完成",value:f.completedTasks}]}catch(t){console.error("Failed to fetch stats:",t),((n=t.response)==null?void 0:n.status)===401&&(i.logout(),o.push("/login"))}},J=async()=>{var n;if(!i.isAuthenticated){console.log("User not authenticated, skipping weekly trend fetch");return}try{const t=await C.get("/tasks/weekly-trend");D.value=t.data.map(g=>({name:g.date,value:g.count}))}catch(t){if(console.error("Failed to fetch weekly trend:",t),((n=t.response)==null?void 0:n.status)===401){i.logout(),o.push("/login");return}D.value=[{name:"周一",value:5},{name:"周二",value:8},{name:"周三",value:12},{name:"周四",value:7},{name:"周五",value:10},{name:"周六",value:3},{name:"周日",value:2}]}},K=async()=>{var n;if(!i.isAuthenticated){console.log("User not authenticated, skipping efficiency fetch");return}try{const t=await C.get("/reports/efficiency");Object.assign(b,t.data)}catch(t){if(console.error("Failed to fetch efficiency:",t),((n=t.response)==null?void 0:n.status)===401){i.logout(),o.push("/login");return}Object.assign(b,{avgCompletionTime:4.5,weeklyCompletionRate:85,totalWorkHours:42})}},Y=async()=>{var n;if(!i.isAuthenticated){console.log("User not authenticated, skipping recent tasks fetch");return}T.value=!0;try{const t=await C.get("/tasks",{params:{limit:5,sort:"-created_at"}});x.value=t.data||[]}catch(t){if(console.error("Failed to fetch recent tasks:",t),((n=t.response)==null?void 0:n.status)===401){i.logout(),o.push("/login");return}}finally{T.value=!1}},Z=async()=>{var n;if(!i.isAuthenticated){console.log("User not authenticated, skipping reports fetch");return}S.value=!0;try{const t=await C.get("/reports",{params:{limit:5,sort:"-created_at"}});u.value=t.data||[]}catch(t){if(console.error("Failed to fetch recent reports:",t),((n=t.response)==null?void 0:n.status)===401){i.logout(),o.push("/login");return}}finally{S.value=!1}};return at(async()=>{if(!i.isAuthenticated){o.push("/login");return}try{await i.fetchUserInfo()}catch(n){console.error("Token validation failed:",n),o.push("/login");return}await Promise.allSettled([X(),J(),K(),Y(),Z()])}),(n,t)=>{var M,U;const g=v("el-icon"),m=v("el-card"),c=v("el-col"),h=v("el-row"),$=v("el-button"),O=v("el-tag"),E=v("el-empty"),z=ot("loading");return p(),_("div",St,[e("div",At,[e("h1",null,"欢迎回来，"+r(((M=d(i).user)==null?void 0:M.full_name)||((U=d(i).user)==null?void 0:U.username))+"！",1),e("p",null,"今天是 "+r(d(W)(new Date,"yyyy年MM月dd日 EEEE")),1)]),s(h,{gutter:20,class:"stats-row"},{default:a(()=>[s(c,{xs:24,sm:12,md:6},{default:a(()=>[s(m,{class:"stats-card"},{default:a(()=>[e("div",Dt,[e("div",Rt,[s(g,null,{default:a(()=>[s(d(lt))]),_:1})]),e("div",Wt,[e("h3",null,r(f.pendingTasks),1),t[5]||(t[5]=e("p",null,"待处理任务",-1))])])]),_:1})]),_:1}),s(c,{xs:24,sm:12,md:6},{default:a(()=>[s(m,{class:"stats-card"},{default:a(()=>[e("div",Ft,[e("div",Ot,[s(g,null,{default:a(()=>[s(d(it))]),_:1})]),e("div",Et,[e("h3",null,r(f.inProgressTasks),1),t[6]||(t[6]=e("p",null,"进行中任务",-1))])])]),_:1})]),_:1}),s(c,{xs:24,sm:12,md:6},{default:a(()=>[s(m,{class:"stats-card"},{default:a(()=>[e("div",zt,[e("div",Mt,[s(g,null,{default:a(()=>[s(d(rt))]),_:1})]),e("div",Ut,[e("h3",null,r(f.completedTasks),1),t[7]||(t[7]=e("p",null,"已完成任务",-1))])])]),_:1})]),_:1}),s(c,{xs:24,sm:12,md:6},{default:a(()=>[s(m,{class:"stats-card"},{default:a(()=>[e("div",Lt,[e("div",Pt,[s(g,null,{default:a(()=>[s(d(dt))]),_:1})]),e("div",Bt,[e("h3",null,r(f.reportsThisWeek),1),t[8]||(t[8]=e("p",null,"本周日报",-1))])])]),_:1})]),_:1})]),_:1}),s(h,{gutter:20,class:"content-row"},{default:a(()=>[s(c,{xs:24,lg:12},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[e("div",It,[t[10]||(t[10]=e("span",null,"最近任务",-1)),s($,{type:"text",onClick:t[0]||(t[0]=l=>n.$router.push("/tasks"))},{default:a(()=>[...t[9]||(t[9]=[y(" 查看全部 ",-1)])]),_:1})])]),default:a(()=>[P((p(),_("div",Vt,[(p(!0),_(B,null,I(x.value,l=>(p(),_("div",{key:l.id,class:"task-item",onClick:tt=>G(l)},[e("div",Nt,[e("h4",null,r(l.title),1),e("p",null,r(l.description),1),e("div",jt,[s(O,{type:N(l.status),size:"small"},{default:a(()=>[y(r(j(l.status)),1)]),_:2},1032,["type"]),e("span",qt,r(d(W)(l.created_at)),1)])])],8,Ht))),128)),x.value.length===0?(p(),_("div",Gt,[s(E,{description:"暂无任务"})])):R("",!0)])),[[z,T.value]])]),_:1})]),_:1}),s(c,{xs:24,lg:12},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[e("div",Qt,[t[12]||(t[12]=e("span",null,"最近日报",-1)),s($,{type:"text",onClick:t[1]||(t[1]=l=>n.$router.push("/reports"))},{default:a(()=>[...t[11]||(t[11]=[y(" 查看全部 ",-1)])]),_:1})])]),default:a(()=>[P((p(),_("div",Xt,[(p(!0),_(B,null,I(u.value,l=>(p(),_("div",{key:l.id,class:"report-item",onClick:tt=>Q(l)},[e("div",Kt,[e("h4",null,r(d(W)(l.report_date))+" 日报",1),e("p",null,r(l.summary||"暂无摘要"),1),e("div",Yt,[l.ai_result?(p(),ct(O,{key:0,type:q(l.ai_result.emotion_score),size:"small"},{default:a(()=>[y(" 情感: "+r(l.ai_result.emotion_score),1)]),_:2},1032,["type"])):R("",!0),e("span",Zt,r(d(mt)(l.created_at)),1)])])],8,Jt))),128)),u.value.length===0?(p(),_("div",te,[s(E,{description:"暂无日报"})])):R("",!0)])),[[z,S.value]])]),_:1})]),_:1})]),_:1}),s(h,{gutter:20,class:"charts-row"},{default:a(()=>[s(c,{xs:24,lg:12},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[...t[13]||(t[13]=[e("span",null,"任务状态分布",-1)])]),default:a(()=>[s(V,{type:"pie",data:F.value,title:"",height:"300px"},null,8,["data"])]),_:1})]),_:1}),s(c,{xs:24,lg:12},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[...t[14]||(t[14]=[e("span",null,"本周任务趋势",-1)])]),default:a(()=>[s(V,{type:"line",data:D.value,title:"",height:"300px"},null,8,["data"])]),_:1})]),_:1})]),_:1}),s(h,{gutter:20,class:"efficiency-row"},{default:a(()=>[s(c,{span:24},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[...t[15]||(t[15]=[e("span",null,"工作效率分析",-1)])]),default:a(()=>[s(h,{gutter:20},{default:a(()=>[s(c,{xs:24,md:8},{default:a(()=>[e("div",ee,[t[16]||(t[16]=e("h4",null,"平均完成时间",-1)),e("div",se,r(b.avgCompletionTime)+"小时 ",1),t[17]||(t[17]=e("p",{class:"efficiency-desc"},"任务平均完成时间",-1))])]),_:1}),s(c,{xs:24,md:8},{default:a(()=>[e("div",ae,[t[18]||(t[18]=e("h4",null,"本周完成率",-1)),e("div",ne,r(b.weeklyCompletionRate)+"% ",1),t[19]||(t[19]=e("p",{class:"efficiency-desc"},"本周任务完成率",-1))])]),_:1}),s(c,{xs:24,md:8},{default:a(()=>[e("div",oe,[t[20]||(t[20]=e("h4",null,"工作时长",-1)),e("div",le,r(b.totalWorkHours)+"小时 ",1),t[21]||(t[21]=e("p",{class:"efficiency-desc"},"本周总工作时长",-1))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),s(h,{gutter:20,class:"quick-actions"},{default:a(()=>[s(c,{span:24},{default:a(()=>[s(m,{class:"content-card"},{header:a(()=>[...t[22]||(t[22]=[e("span",null,"快速操作",-1)])]),default:a(()=>[e("div",ie,[s($,{type:"primary",icon:d(ut),onClick:t[2]||(t[2]=l=>n.$router.push("/tasks"))},{default:a(()=>[...t[23]||(t[23]=[y(" 创建任务 ",-1)])]),_:1},8,["icon"]),s($,{type:"success",icon:d(pt),onClick:t[3]||(t[3]=l=>n.$router.push("/reports"))},{default:a(()=>[...t[24]||(t[24]=[y(" 写日报 ",-1)])]),_:1},8,["icon"]),s($,{type:"info",icon:d(ft),onClick:t[4]||(t[4]=l=>n.$router.push("/analytics"))},{default:a(()=>[...t[25]||(t[25]=[y(" 查看分析 ",-1)])]),_:1},8,["icon"])])]),_:1})]),_:1})]),_:1})])}}},fe=H(re,[["__scopeId","data-v-e1baaf0d"]]);export{fe as default};
