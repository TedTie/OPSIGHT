import{_ as ee,d as ut,C as dt,e as N,b as Y,w as J,f as ge,h as D,c as P,o as C,k as x,i as K,q as U,j as M,p as Z,F as he,r as fe,x as F,a as v,t as R,v as At,n as Ct,s as ct,l as Ie,E as le,B as Dt,A as Rt}from"./index-DxUxAYfJ.js";import{b as ke,g as pt,c as mt}from"./date-qiPTsFx8.js";import{ae as It,af as kt,_ as te,a1 as k,d as Lt,ag as ht,ah as He,ai as _e,aj as Tt,ak as ft,al as Q,am as _t,an as Fe,e as L,ao as Vt,ap as Le,aq as Pt,ar as Ot,U as B,as as se,m as Zt,at as Nt,au as Et,av as zt,i as vt,T as Bt,aw as gt,L as Ue,ax as Wt,G as Ye,ay as $t,V as Kt,R as pe,az as Gt,aA as Xe,W as qe,aB as Ht,Z as Ft,aC as Ut,aD as Yt,aE as Xt,aF as je,aG as qt,P as jt,aH as Jt,a as Qt,a6 as Te,a7 as Je,a8 as ea,a9 as ta,aa,ab as ra,ad as na,ac as oa}from"./index.esm.min-BfHqzkm4.js";var Qe="\0_ec_interaction_mutex";function et(s,r){return!!ia(s)[r]}function ia(s){return s[Qe]||(s[Qe]={})}It({type:"takeGlobalCursor",event:"globalCursorTaken",update:"update"},kt);var sa=function(s){te(r,s);function r(e){var t=s.call(this)||this;t._zr=e;var a=k(t._mousedownHandler,t),n=k(t._mousemoveHandler,t),o=k(t._mouseupHandler,t),i=k(t._mousewheelHandler,t),u=k(t._pinchHandler,t);return t.enable=function(l,d){this.disable(),this._opt=Lt(ht(d)||{},{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),l==null&&(l=!0),(l===!0||l==="move"||l==="pan")&&(e.on("mousedown",a),e.on("mousemove",n),e.on("mouseup",o)),(l===!0||l==="scale"||l==="zoom")&&(e.on("mousewheel",i),e.on("pinch",u))},t.disable=function(){e.off("mousedown",a),e.off("mousemove",n),e.off("mouseup",o),e.off("mousewheel",i),e.off("pinch",u)},t}return r.prototype.isDragging=function(){return this._dragging},r.prototype.isPinching=function(){return this._pinching},r.prototype.setPointerChecker=function(e){this.pointerChecker=e},r.prototype.dispose=function(){this.disable()},r.prototype._mousedownHandler=function(e){if(!He(e)){for(var t=e.target;t;){if(t.draggable)return;t=t.__hostTarget||t.parent}var a=e.offsetX,n=e.offsetY;this.pointerChecker&&this.pointerChecker(e,a,n)&&(this._x=a,this._y=n,this._dragging=!0)}},r.prototype._mousemoveHandler=function(e){if(!(!this._dragging||!me("moveOnMouseMove",e,this._opt)||e.gestureEvent==="pinch"||et(this._zr,"globalPan"))){var t=e.offsetX,a=e.offsetY,n=this._x,o=this._y,i=t-n,u=a-o;this._x=t,this._y=a,this._opt.preventDefaultMouseMove&&_e(e.event),yt(this,"pan","moveOnMouseMove",e,{dx:i,dy:u,oldX:n,oldY:o,newX:t,newY:a,isAvailableBehavior:null})}},r.prototype._mouseupHandler=function(e){He(e)||(this._dragging=!1)},r.prototype._mousewheelHandler=function(e){var t=me("zoomOnMouseWheel",e,this._opt),a=me("moveOnMouseWheel",e,this._opt),n=e.wheelDelta,o=Math.abs(n),i=e.offsetX,u=e.offsetY;if(!(n===0||!t&&!a)){if(t){var l=o>3?1.4:o>1?1.2:1.1,d=n>0?l:1/l;Me(this,"zoom","zoomOnMouseWheel",e,{scale:d,originX:i,originY:u,isAvailableBehavior:null})}if(a){var h=Math.abs(n),p=(n>0?1:-1)*(h>3?.4:h>1?.15:.05);Me(this,"scrollMove","moveOnMouseWheel",e,{scrollDelta:p,originX:i,originY:u,isAvailableBehavior:null})}}},r.prototype._pinchHandler=function(e){if(!et(this._zr,"globalPan")){var t=e.pinchScale>1?1.1:1/1.1;Me(this,"zoom",null,e,{scale:t,originX:e.pinchX,originY:e.pinchY,isAvailableBehavior:null})}},r}(Tt);function Me(s,r,e,t,a){s.pointerChecker&&s.pointerChecker(t,a.originX,a.originY)&&(_e(t.event),yt(s,r,e,t,a))}function yt(s,r,e,t,a){a.isAvailableBehavior=k(me,null,e,t),s.trigger(r,a)}function me(s,r,e){var t=e[s];return!s||t&&(!ft(t)||r.event[t+"Key"])}function ye(s,r,e,t,a,n){s=s||0;var o=e[1]-e[0];if(a!=null&&(a=re(a,[0,o])),n!=null&&(n=Math.max(n,a??0)),t==="all"){var i=Math.abs(r[1]-r[0]);i=re(i,[0,o]),a=n=re(i,[a,n]),t=0}r[0]=re(r[0],e),r[1]=re(r[1],e);var u=Se(r,t);r[t]+=s;var l=a||0,d=e.slice();u.sign<0?d[0]+=l:d[1]-=l,r[t]=re(r[t],d);var h;return h=Se(r,t),a!=null&&(h.sign!==u.sign||h.span<a)&&(r[1-t]=r[t]+u.sign*a),h=Se(r,t),n!=null&&h.span>n&&(r[1-t]=r[t]+h.sign*n),r}function Se(s,r){var e=s[r]-s[1-r];return{span:Math.abs(e),sign:e>0?-1:e<0?1:r?-1:1}}function re(s,r){return Math.min(r[1]!=null?r[1]:1/0,Math.max(r[0]!=null?r[0]:-1/0,s))}var tt=["x","y","radius","angle","single"],la=["cartesian2d","polar","singleAxis"];function ua(s){var r=s.get("coordinateSystem");return _t(la,r)>=0}function q(s){return s+"Axis"}function da(s,r){var e=Q(),t=[],a=Q();s.eachComponent({mainType:"dataZoom",query:r},function(d){a.get(d.uid)||i(d)});var n;do n=!1,s.eachComponent("dataZoom",o);while(n);function o(d){!a.get(d.uid)&&u(d)&&(i(d),n=!0)}function i(d){a.set(d.uid,!0),t.push(d),l(d)}function u(d){var h=!1;return d.eachTargetAxis(function(p,f){var m=e.get(p);m&&m[f]&&(h=!0)}),h}function l(d){d.eachTargetAxis(function(h,p){(e.get(h)||e.set(h,[]))[p]=!0})}return t}function wt(s){var r=s.ecModel,e={infoList:[],infoMap:Q()};return s.eachTargetAxis(function(t,a){var n=r.getComponent(q(t),a);if(n){var o=n.getCoordSysModel();if(o){var i=o.uid,u=e.infoMap.get(i);u||(u={model:o,axisModels:[]},e.infoList.push(u),e.infoMap.set(i,u)),u.axisModels.push(n)}}}),e}var Ae=function(){function s(){this.indexList=[],this.indexMap=[]}return s.prototype.add=function(r){this.indexMap[r]||(this.indexList.push(r),this.indexMap[r]=!0)},s}(),ve=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=r.type,e._autoThrottle=!0,e._noTarget=!0,e._rangePropMode=["percent","percent"],e}return r.prototype.init=function(e,t,a){var n=at(e);this.settledOption=n,this.mergeDefaultAndTheme(e,a),this._doInit(n)},r.prototype.mergeOption=function(e){var t=at(e);Fe(this.option,e,!0),Fe(this.settledOption,t,!0),this._doInit(t)},r.prototype._doInit=function(e){var t=this.option;this._setDefaultThrottle(e),this._updateRangeUse(e);var a=this.settledOption;L([["start","startValue"],["end","endValue"]],function(n,o){this._rangePropMode[o]==="value"&&(t[n[0]]=a[n[0]]=null)},this),this._resetTarget()},r.prototype._resetTarget=function(){var e=this.get("orient",!0),t=this._targetAxisInfoMap=Q(),a=this._fillSpecifiedTargetAxis(t);a?this._orient=e||this._makeAutoOrientByTargetAxis():(this._orient=e||"horizontal",this._fillAutoTargetAxisByOrient(t,this._orient)),this._noTarget=!0,t.each(function(n){n.indexList.length&&(this._noTarget=!1)},this)},r.prototype._fillSpecifiedTargetAxis=function(e){var t=!1;return L(tt,function(a){var n=this.getReferringComponents(q(a),Vt);if(n.specified){t=!0;var o=new Ae;L(n.models,function(i){o.add(i.componentIndex)}),e.set(a,o)}},this),t},r.prototype._fillAutoTargetAxisByOrient=function(e,t){var a=this.ecModel,n=!0;if(n){var o=t==="vertical"?"y":"x",i=a.findComponents({mainType:o+"Axis"});u(i,o)}if(n){var i=a.findComponents({mainType:"singleAxis",filter:function(d){return d.get("orient",!0)===t}});u(i,"single")}function u(l,d){var h=l[0];if(h){var p=new Ae;if(p.add(h.componentIndex),e.set(d,p),n=!1,d==="x"||d==="y"){var f=h.getReferringComponents("grid",Le).models[0];f&&L(l,function(m){h.componentIndex!==m.componentIndex&&f===m.getReferringComponents("grid",Le).models[0]&&p.add(m.componentIndex)})}}}n&&L(tt,function(l){if(n){var d=a.findComponents({mainType:q(l),filter:function(p){return p.get("type",!0)==="category"}});if(d[0]){var h=new Ae;h.add(d[0].componentIndex),e.set(l,h),n=!1}}},this)},r.prototype._makeAutoOrientByTargetAxis=function(){var e;return this.eachTargetAxis(function(t){!e&&(e=t)},this),e==="y"?"vertical":"horizontal"},r.prototype._setDefaultThrottle=function(e){if(e.hasOwnProperty("throttle")&&(this._autoThrottle=!1),this._autoThrottle){var t=this.ecModel.option;this.option.throttle=t.animation&&t.animationDurationUpdate>0?100:20}},r.prototype._updateRangeUse=function(e){var t=this._rangePropMode,a=this.get("rangeMode");L([["start","startValue"],["end","endValue"]],function(n,o){var i=e[n[0]]!=null,u=e[n[1]]!=null;i&&!u?t[o]="percent":!i&&u?t[o]="value":a?t[o]=a[o]:i&&(t[o]="percent")})},r.prototype.noTarget=function(){return this._noTarget},r.prototype.getFirstTargetAxisModel=function(){var e;return this.eachTargetAxis(function(t,a){e==null&&(e=this.ecModel.getComponent(q(t),a))},this),e},r.prototype.eachTargetAxis=function(e,t){this._targetAxisInfoMap.each(function(a,n){L(a.indexList,function(o){e.call(t,n,o)})})},r.prototype.getAxisProxy=function(e,t){var a=this.getAxisModel(e,t);if(a)return a.__dzAxisProxy},r.prototype.getAxisModel=function(e,t){var a=this._targetAxisInfoMap.get(e);if(a&&a.indexMap[t])return this.ecModel.getComponent(q(e),t)},r.prototype.setRawRange=function(e){var t=this.option,a=this.settledOption;L([["start","startValue"],["end","endValue"]],function(n){(e[n[0]]!=null||e[n[1]]!=null)&&(t[n[0]]=a[n[0]]=e[n[0]],t[n[1]]=a[n[1]]=e[n[1]])},this),this._updateRangeUse(e)},r.prototype.setCalculatedRange=function(e){var t=this.option;L(["start","startValue","end","endValue"],function(a){t[a]=e[a]})},r.prototype.getPercentRange=function(){var e=this.findRepresentativeAxisProxy();if(e)return e.getDataPercentWindow()},r.prototype.getValueRange=function(e,t){if(e==null&&t==null){var a=this.findRepresentativeAxisProxy();if(a)return a.getDataValueWindow()}else return this.getAxisProxy(e,t).getDataValueWindow()},r.prototype.findRepresentativeAxisProxy=function(e){if(e)return e.__dzAxisProxy;for(var t,a=this._targetAxisInfoMap.keys(),n=0;n<a.length;n++)for(var o=a[n],i=this._targetAxisInfoMap.get(o),u=0;u<i.indexList.length;u++){var l=this.getAxisProxy(o,i.indexList[u]);if(l.hostedBy(this))return l;t||(t=l)}return t},r.prototype.getRangePropMode=function(){return this._rangePropMode.slice()},r.prototype.getOrient=function(){return this._orient},r.type="dataZoom",r.dependencies=["xAxis","yAxis","radiusAxis","angleAxis","singleAxis","series","toolbox"],r.defaultOption={z:4,filterMode:"filter",start:0,end:100},r}(Pt);function at(s){var r={};return L(["start","end","startValue","endValue","throttle"],function(e){s.hasOwnProperty(e)&&(r[e]=s[e])}),r}var bt=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=r.type,e}return r.prototype.render=function(e,t,a,n){this.dataZoomModel=e,this.ecModel=t,this.api=a},r.type="dataZoom",r}(Ot),ne=L,rt=se,ca=function(){function s(r,e,t,a){this._dimName=r,this._axisIndex=e,this.ecModel=a,this._dataZoomModel=t}return s.prototype.hostedBy=function(r){return this._dataZoomModel===r},s.prototype.getDataValueWindow=function(){return this._valueWindow.slice()},s.prototype.getDataPercentWindow=function(){return this._percentWindow.slice()},s.prototype.getTargetSeriesModels=function(){var r=[];return this.ecModel.eachSeries(function(e){if(ua(e)){var t=q(this._dimName),a=e.getReferringComponents(t,Le).models[0];a&&this._axisIndex===a.componentIndex&&r.push(e)}},this),r},s.prototype.getAxisModel=function(){return this.ecModel.getComponent(this._dimName+"Axis",this._axisIndex)},s.prototype.getMinMaxSpan=function(){return ht(this._minMaxSpan)},s.prototype.calculateDataWindow=function(r){var e=this._dataExtent,t=this.getAxisModel(),a=t.axis.scale,n=this._dataZoomModel.getRangePropMode(),o=[0,100],i=[],u=[],l;ne(["start","end"],function(p,f){var m=r[p],_=r[p+"Value"];n[f]==="percent"?(m==null&&(m=o[f]),_=a.parse(B(m,o,e))):(l=!0,_=_==null?e[f]:a.parse(_),m=B(_,e,o)),u[f]=_==null||isNaN(_)?e[f]:_,i[f]=m==null||isNaN(m)?o[f]:m}),rt(u),rt(i);var d=this._minMaxSpan;l?h(u,i,e,o,!1):h(i,u,o,e,!0);function h(p,f,m,_,y){var g=y?"Span":"ValueSpan";ye(0,p,m,"all",d["min"+g],d["max"+g]);for(var c=0;c<2;c++)f[c]=B(p[c],m,_,!0),y&&(f[c]=a.parse(f[c]))}return{valueWindow:u,percentWindow:i}},s.prototype.reset=function(r){if(r===this._dataZoomModel){var e=this.getTargetSeriesModels();this._dataExtent=pa(this,this._dimName,e),this._updateMinMaxSpan();var t=this.calculateDataWindow(r.settledOption);this._valueWindow=t.valueWindow,this._percentWindow=t.percentWindow,this._setAxisModel()}},s.prototype.filterData=function(r,e){if(r!==this._dataZoomModel)return;var t=this._dimName,a=this.getTargetSeriesModels(),n=r.get("filterMode"),o=this._valueWindow;if(n==="none")return;ne(a,function(u){var l=u.getData(),d=l.mapDimensionsAll(t);if(d.length){if(n==="weakFilter"){var h=l.getStore(),p=Zt(d,function(f){return l.getDimensionIndex(f)},l);l.filterSelf(function(f){for(var m,_,y,g=0;g<d.length;g++){var c=h.get(p[g],f),S=!isNaN(c),w=c<o[0],A=c>o[1];if(S&&!w&&!A)return!0;S&&(y=!0),w&&(m=!0),A&&(_=!0)}return y&&m&&_})}else ne(d,function(f){if(n==="empty")u.setData(l=l.map(f,function(_){return i(_)?_:NaN}));else{var m={};m[f]=o,l.selectRange(m)}});ne(d,function(f){l.setApproximateExtent(o,f)})}});function i(u){return u>=o[0]&&u<=o[1]}},s.prototype._updateMinMaxSpan=function(){var r=this._minMaxSpan={},e=this._dataZoomModel,t=this._dataExtent;ne(["min","max"],function(a){var n=e.get(a+"Span"),o=e.get(a+"ValueSpan");o!=null&&(o=this.getAxisModel().axis.scale.parse(o)),o!=null?n=B(t[0]+o,t,[0,100],!0):n!=null&&(o=B(n,[0,100],t,!0)-t[0]),r[a+"Span"]=n,r[a+"ValueSpan"]=o},this)},s.prototype._setAxisModel=function(){var r=this.getAxisModel(),e=this._percentWindow,t=this._valueWindow;if(e){var a=Nt(t,[0,500]);a=Math.min(a,20);var n=r.axis.scale.rawExtentInfo;e[0]!==0&&n.setDeterminedMinMax("min",+t[0].toFixed(a)),e[1]!==100&&n.setDeterminedMinMax("max",+t[1].toFixed(a)),n.freeze()}},s}();function pa(s,r,e){var t=[1/0,-1/0];ne(e,function(o){Et(t,o.getData(),r)});var a=s.getAxisModel(),n=zt(a.axis.scale,a,t).calculate();return[n.min,n.max]}var ma={getTargetSeries:function(s){function r(a){s.eachComponent("dataZoom",function(n){n.eachTargetAxis(function(o,i){var u=s.getComponent(q(o),i);a(o,i,u,n)})})}r(function(a,n,o,i){o.__dzAxisProxy=null});var e=[];r(function(a,n,o,i){o.__dzAxisProxy||(o.__dzAxisProxy=new ca(a,n,i,s),e.push(o.__dzAxisProxy))});var t=Q();return L(e,function(a){L(a.getTargetSeriesModels(),function(n){t.set(n.uid,n)})}),t},overallReset:function(s,r){s.eachComponent("dataZoom",function(e){e.eachTargetAxis(function(t,a){e.getAxisProxy(t,a).reset(e)}),e.eachTargetAxis(function(t,a){e.getAxisProxy(t,a).filterData(e,r)})}),s.eachComponent("dataZoom",function(e){var t=e.findRepresentativeAxisProxy();if(t){var a=t.getDataPercentWindow(),n=t.getDataValueWindow();e.setCalculatedRange({start:a[0],end:a[1],startValue:n[0],endValue:n[1]})}})}};function ha(s){s.registerAction("dataZoom",function(r,e){var t=da(e,r);L(t,function(a){a.setRawRange({start:r.start,end:r.end,startValue:r.startValue,endValue:r.endValue})})})}var nt=!1;function xt(s){nt||(nt=!0,s.registerProcessor(s.PRIORITY.PROCESSOR.FILTER,ma),ha(s),s.registerSubTypeDefaulter("dataZoom",function(){return"slider"}))}var fa=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=r.type,e}return r.type="dataZoom.inside",r.defaultOption=vt(ve.defaultOption,{disabled:!1,zoomLock:!1,zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!1,preventDefaultMouseMove:!0}),r}(ve),Ve=Bt();function _a(s,r,e){Ve(s).coordSysRecordMap.each(function(t){var a=t.dataZoomInfoMap.get(r.uid);a&&(a.getRange=e)})}function va(s,r){for(var e=Ve(s).coordSysRecordMap,t=e.keys(),a=0;a<t.length;a++){var n=t[a],o=e.get(n),i=o.dataZoomInfoMap;if(i){var u=r.uid,l=i.get(u);l&&(i.removeKey(u),i.keys().length||Mt(e,o))}}}function Mt(s,r){if(r){s.removeKey(r.model.uid);var e=r.controller;e&&e.dispose()}}function ga(s,r){var e={model:r,containsPoint:Ue(wa,r),dispatchAction:Ue(ya,s),dataZoomInfoMap:null,controller:null},t=e.controller=new sa(s.getZr());return L(["pan","zoom","scrollMove"],function(a){t.on(a,function(n){var o=[];e.dataZoomInfoMap.each(function(i){if(n.isAvailableBehavior(i.model.option)){var u=(i.getRange||{})[a],l=u&&u(i.dzReferCoordSysInfo,e.model.mainType,e.controller,n);!i.model.get("disabled",!0)&&l&&o.push({dataZoomId:i.model.id,start:l[0],end:l[1]})}}),o.length&&e.dispatchAction(o)})}),e}function ya(s,r){s.isDisposed()||s.dispatchAction({type:"dataZoom",animation:{easing:"cubicOut",duration:100},batch:r})}function wa(s,r,e,t){return s.coordinateSystem.containPoint([e,t])}function ba(s){var r,e="type_",t={type_true:2,type_move:1,type_false:0,type_undefined:-1},a=!0;return s.each(function(n){var o=n.model,i=o.get("disabled",!0)?!1:o.get("zoomLock",!0)?"move":!0;t[e+i]>t[e+r]&&(r=i),a=a&&o.get("preventDefaultMouseMove",!0)}),{controlType:r,opt:{zoomOnMouseWheel:!0,moveOnMouseMove:!0,moveOnMouseWheel:!0,preventDefaultMouseMove:!!a}}}function xa(s){s.registerProcessor(s.PRIORITY.PROCESSOR.FILTER,function(r,e){var t=Ve(e),a=t.coordSysRecordMap||(t.coordSysRecordMap=Q());a.each(function(n){n.dataZoomInfoMap=null}),r.eachComponent({mainType:"dataZoom",subType:"inside"},function(n){var o=wt(n);L(o.infoList,function(i){var u=i.model.uid,l=a.get(u)||a.set(u,ga(e,i.model)),d=l.dataZoomInfoMap||(l.dataZoomInfoMap=Q());d.set(n.uid,{dzReferCoordSysInfo:i,model:n,getRange:null})})}),a.each(function(n){var o=n.controller,i,u=n.dataZoomInfoMap;if(u){var l=u.keys()[0];l!=null&&(i=u.get(l))}if(!i){Mt(a,n);return}var d=ba(u);o.enable(d.controlType,d.opt),o.setPointerChecker(n.containsPoint),gt(n,"dispatchAction",i.model.get("throttle",!0),"fixRate")})})}var Ma=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type="dataZoom.inside",e}return r.prototype.render=function(e,t,a){if(s.prototype.render.apply(this,arguments),e.noTarget()){this._clear();return}this.range=e.getPercentRange(),_a(a,e,{pan:k(Ce.pan,this),zoom:k(Ce.zoom,this),scrollMove:k(Ce.scrollMove,this)})},r.prototype.dispose=function(){this._clear(),s.prototype.dispose.apply(this,arguments)},r.prototype._clear=function(){va(this.api,this.dataZoomModel),this.range=null},r.type="dataZoom.inside",r}(bt),Ce={zoom:function(s,r,e,t){var a=this.range,n=a.slice(),o=s.axisModels[0];if(o){var i=De[r](null,[t.originX,t.originY],o,e,s),u=(i.signal>0?i.pixelStart+i.pixelLength-i.pixel:i.pixel-i.pixelStart)/i.pixelLength*(n[1]-n[0])+n[0],l=Math.max(1/t.scale,0);n[0]=(n[0]-u)*l+u,n[1]=(n[1]-u)*l+u;var d=this.dataZoomModel.findRepresentativeAxisProxy().getMinMaxSpan();if(ye(0,n,[0,100],0,d.minSpan,d.maxSpan),this.range=n,a[0]!==n[0]||a[1]!==n[1])return n}},pan:ot(function(s,r,e,t,a,n){var o=De[t]([n.oldX,n.oldY],[n.newX,n.newY],r,a,e);return o.signal*(s[1]-s[0])*o.pixel/o.pixelLength}),scrollMove:ot(function(s,r,e,t,a,n){var o=De[t]([0,0],[n.scrollDelta,n.scrollDelta],r,a,e);return o.signal*(s[1]-s[0])*n.scrollDelta})};function ot(s){return function(r,e,t,a){var n=this.range,o=n.slice(),i=r.axisModels[0];if(i){var u=s(o,i,r,e,t,a);if(ye(u,o,[0,100],"all"),this.range=o,n[0]!==o[0]||n[1]!==o[1])return o}}}var De={grid:function(s,r,e,t,a){var n=e.axis,o={},i=a.model.coordinateSystem.getRect();return s=s||[0,0],n.dim==="x"?(o.pixel=r[0]-s[0],o.pixelLength=i.width,o.pixelStart=i.x,o.signal=n.inverse?1:-1):(o.pixel=r[1]-s[1],o.pixelLength=i.height,o.pixelStart=i.y,o.signal=n.inverse?-1:1),o},polar:function(s,r,e,t,a){var n=e.axis,o={},i=a.model.coordinateSystem,u=i.getRadiusAxis().getExtent(),l=i.getAngleAxis().getExtent();return s=s?i.pointToCoord(s):[0,0],r=i.pointToCoord(r),e.mainType==="radiusAxis"?(o.pixel=r[0]-s[0],o.pixelLength=u[1]-u[0],o.pixelStart=u[0],o.signal=n.inverse?1:-1):(o.pixel=r[1]-s[1],o.pixelLength=l[1]-l[0],o.pixelStart=l[0],o.signal=n.inverse?-1:1),o},singleAxis:function(s,r,e,t,a){var n=e.axis,o=a.model.coordinateSystem.getRect(),i={};return s=s||[0,0],n.orient==="horizontal"?(i.pixel=r[0]-s[0],i.pixelLength=o.width,i.pixelStart=o.x,i.signal=n.inverse?1:-1):(i.pixel=r[1]-s[1],i.pixelLength=o.height,i.pixelStart=o.y,i.signal=n.inverse?-1:1),i}};function Sa(s){xt(s),s.registerComponentModel(fa),s.registerComponentView(Ma),xa(s)}var Aa=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=r.type,e}return r.type="dataZoom.slider",r.layoutMode="box",r.defaultOption=vt(ve.defaultOption,{show:!0,right:"ph",top:"ph",width:"ph",height:"ph",left:null,bottom:null,borderColor:"#d2dbee",borderRadius:3,backgroundColor:"rgba(47,69,84,0)",dataBackground:{lineStyle:{color:"#d2dbee",width:.5},areaStyle:{color:"#d2dbee",opacity:.2}},selectedDataBackground:{lineStyle:{color:"#8fb0f7",width:.5},areaStyle:{color:"#8fb0f7",opacity:.2}},fillerColor:"rgba(135,175,274,0.2)",handleIcon:"path://M-9.35,34.56V42m0-40V9.5m-2,0h4a2,2,0,0,1,2,2v21a2,2,0,0,1-2,2h-4a2,2,0,0,1-2-2v-21A2,2,0,0,1-11.35,9.5Z",handleSize:"100%",handleStyle:{color:"#fff",borderColor:"#ACB8D1"},moveHandleSize:7,moveHandleIcon:"path://M-320.9-50L-320.9-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-348-41-339-50-320.9-50z M-212.3-50L-212.3-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-239.4-41-230.4-50-212.3-50z M-103.7-50L-103.7-50c18.1,0,27.1,9,27.1,27.1V85.7c0,18.1-9,27.1-27.1,27.1l0,0c-18.1,0-27.1-9-27.1-27.1V-22.9C-130.9-41-121.8-50-103.7-50z",moveHandleStyle:{color:"#D2DBEE",opacity:.7},showDetail:!0,showDataShadow:"auto",realtime:!0,zoomLock:!1,textStyle:{color:"#6E7079"},brushSelect:!0,brushStyle:{color:"rgba(135,175,274,0.15)"},emphasis:{handleLabel:{show:!0},handleStyle:{borderColor:"#8FB0F7"},moveHandleStyle:{color:"#8FB0F7"}}}),r}(ve),oe=pe,it=7,Ca=1,Re=30,Da=7,ie="horizontal",st="vertical",Ra=5,Ia=["line","bar","candlestick","scatter"],ka={easing:"cubicOut",duration:100,delay:0},La=function(s){te(r,s);function r(){var e=s!==null&&s.apply(this,arguments)||this;return e.type=r.type,e._displayables={},e}return r.prototype.init=function(e,t){this.api=t,this._onBrush=k(this._onBrush,this),this._onBrushEnd=k(this._onBrushEnd,this)},r.prototype.render=function(e,t,a,n){if(s.prototype.render.apply(this,arguments),gt(this,"_dispatchZoomAction",e.get("throttle"),"fixRate"),this._orient=e.getOrient(),e.get("show")===!1){this.group.removeAll();return}if(e.noTarget()){this._clear(),this.group.removeAll();return}(!n||n.type!=="dataZoom"||n.from!==this.uid)&&this._buildView(),this._updateView()},r.prototype.dispose=function(){this._clear(),s.prototype.dispose.apply(this,arguments)},r.prototype._clear=function(){Wt(this,"_dispatchZoomAction");var e=this.api.getZr();e.off("mousemove",this._onBrush),e.off("mouseup",this._onBrushEnd)},r.prototype._buildView=function(){var e=this.group;e.removeAll(),this._brushing=!1,this._displayables.brushRect=null,this._resetLocation(),this._resetInterval();var t=this._displayables.sliderGroup=new Ye;this._renderBackground(),this._renderHandle(),this._renderDataShadow(),e.add(t),this._positionGroup()},r.prototype._resetLocation=function(){var e=this.dataZoomModel,t=this.api,a=e.get("brushSelect"),n=a?Da:0,o=this._findCoordRect(),i={width:t.getWidth(),height:t.getHeight()},u=this._orient===ie?{right:i.width-o.x-o.width,top:i.height-Re-it-n,width:o.width,height:Re}:{right:it,top:o.y,width:Re,height:o.height},l=$t(e.option);L(["right","top","width","height"],function(h){l[h]==="ph"&&(l[h]=u[h])});var d=Kt(l,i);this._location={x:d.x,y:d.y},this._size=[d.width,d.height],this._orient===st&&this._size.reverse()},r.prototype._positionGroup=function(){var e=this.group,t=this._location,a=this._orient,n=this.dataZoomModel.getFirstTargetAxisModel(),o=n&&n.get("inverse"),i=this._displayables.sliderGroup,u=(this._dataShadowInfo||{}).otherAxisInverse;i.attr(a===ie&&!o?{scaleY:u?1:-1,scaleX:1}:a===ie&&o?{scaleY:u?1:-1,scaleX:-1}:a===st&&!o?{scaleY:u?-1:1,scaleX:1,rotation:Math.PI/2}:{scaleY:u?-1:1,scaleX:-1,rotation:Math.PI/2});var l=e.getBoundingRect([i]);e.x=t.x-l.x,e.y=t.y-l.y,e.markRedraw()},r.prototype._getViewExtent=function(){return[0,this._size[0]]},r.prototype._renderBackground=function(){var e=this.dataZoomModel,t=this._size,a=this._displayables.sliderGroup,n=e.get("brushSelect");a.add(new oe({silent:!0,shape:{x:0,y:0,width:t[0],height:t[1]},style:{fill:e.get("backgroundColor")},z2:-40}));var o=new oe({shape:{x:0,y:0,width:t[0],height:t[1]},style:{fill:"transparent"},z2:0,onclick:k(this._onClickPanel,this)}),i=this.api.getZr();n?(o.on("mousedown",this._onBrushStart,this),o.cursor="crosshair",i.on("mousemove",this._onBrush),i.on("mouseup",this._onBrushEnd)):(i.off("mousemove",this._onBrush),i.off("mouseup",this._onBrushEnd)),a.add(o)},r.prototype._renderDataShadow=function(){var e=this._dataShadowInfo=this._prepareDataShadowInfo();if(this._displayables.dataShadowSegs=[],!e)return;var t=this._size,a=this._shadowSize||[],n=e.series,o=n.getRawData(),i=n.getShadowDim&&n.getShadowDim(),u=i&&o.getDimensionInfo(i)?n.getShadowDim():e.otherDim;if(u==null)return;var l=this._shadowPolygonPts,d=this._shadowPolylinePts;if(o!==this._shadowData||u!==this._shadowDim||t[0]!==a[0]||t[1]!==a[1]){var h=o.getDataExtent(u),p=(h[1]-h[0])*.3;h=[h[0]-p,h[1]+p];var f=[0,t[1]],m=[0,t[0]],_=[[t[0],0],[0,0]],y=[],g=m[1]/(o.count()-1),c=0,S=Math.round(o.count()/t[0]),w;o.each([u],function(O,E){if(S>0&&E%S){c+=g;return}var z=O==null||isNaN(O)||O==="",j=z?0:B(O,h,f,!0);z&&!w&&E?(_.push([_[_.length-1][0],0]),y.push([y[y.length-1][0],0])):!z&&w&&(_.push([c,0]),y.push([c,0])),_.push([c,j]),y.push([c,j]),c+=g,w=z}),l=this._shadowPolygonPts=_,d=this._shadowPolylinePts=y}this._shadowData=o,this._shadowDim=u,this._shadowSize=[t[0],t[1]];var A=this.dataZoomModel;function b(O){var E=A.getModel(O?"selectedDataBackground":"dataBackground"),z=new Ye,j=new Jt({shape:{points:l},segmentIgnoreThreshold:1,style:E.getModel("areaStyle").getAreaStyle(),silent:!0,z2:-20}),ue=new Qt({shape:{points:d},segmentIgnoreThreshold:1,style:E.getModel("lineStyle").getLineStyle(),silent:!0,z2:-19});return z.add(j),z.add(ue),z}for(var T=0;T<3;T++){var G=b(T===1);this._displayables.sliderGroup.add(G),this._displayables.dataShadowSegs.push(G)}},r.prototype._prepareDataShadowInfo=function(){var e=this.dataZoomModel,t=e.get("showDataShadow");if(t!==!1){var a,n=this.ecModel;return e.eachTargetAxis(function(o,i){var u=e.getAxisProxy(o,i).getTargetSeriesModels();L(u,function(l){if(!a&&!(t!==!0&&_t(Ia,l.get("type"))<0)){var d=n.getComponent(q(o),i).axis,h=Ta(o),p,f=l.coordinateSystem;h!=null&&f.getOtherAxis&&(p=f.getOtherAxis(d).inverse),h=l.getData().mapDimension(h),a={thisAxis:d,series:l,thisDim:o,otherDim:h,otherAxisInverse:p}}},this)},this),a}},r.prototype._renderHandle=function(){var e=this.group,t=this._displayables,a=t.handles=[null,null],n=t.handleLabels=[null,null],o=this._displayables.sliderGroup,i=this._size,u=this.dataZoomModel,l=this.api,d=u.get("borderRadius")||0,h=u.get("brushSelect"),p=t.filler=new oe({silent:h,style:{fill:u.get("fillerColor")},textConfig:{position:"inside"}});o.add(p),o.add(new oe({silent:!0,subPixelOptimize:!0,shape:{x:0,y:0,width:i[0],height:i[1],r:d},style:{stroke:u.get("dataBackgroundColor")||u.get("borderColor"),lineWidth:Ca,fill:"rgba(0,0,0,0)"}})),L([0,1],function(S){var w=u.get("handleIcon");!Gt[w]&&w.indexOf("path://")<0&&w.indexOf("image://")<0&&(w="path://"+w);var A=Xe(w,-1,0,2,2,null,!0);A.attr({cursor:lt(this._orient),draggable:!0,drift:k(this._onDragMove,this,S),ondragend:k(this._onDragEnd,this),onmouseover:k(this._showDataInfo,this,!0),onmouseout:k(this._showDataInfo,this,!1),z2:5});var b=A.getBoundingRect(),T=u.get("handleSize");this._handleHeight=qe(T,this._size[1]),this._handleWidth=b.width/b.height*this._handleHeight,A.setStyle(u.getModel("handleStyle").getItemStyle()),A.style.strokeNoScale=!0,A.rectHover=!0,A.ensureState("emphasis").style=u.getModel(["emphasis","handleStyle"]).getItemStyle(),Ht(A);var G=u.get("handleColor");G!=null&&(A.style.fill=G),o.add(a[S]=A);var O=u.getModel("textStyle"),E=u.get("handleLabel")||{},z=E.show||!1;e.add(n[S]=new Ft({silent:!0,invisible:!z,style:Ut(O,{x:0,y:0,text:"",verticalAlign:"middle",align:"center",fill:O.getTextColor(),font:O.getFont()}),z2:10}))},this);var f=p;if(h){var m=qe(u.get("moveHandleSize"),i[1]),_=t.moveHandle=new pe({style:u.getModel("moveHandleStyle").getItemStyle(),silent:!0,shape:{r:[0,0,2,2],y:i[1]-.5,height:m}}),y=m*.8,g=t.moveHandleIcon=Xe(u.get("moveHandleIcon"),-y/2,-y/2,y,y,"#fff",!0);g.silent=!0,g.y=i[1]+m/2-.5,_.ensureState("emphasis").style=u.getModel(["emphasis","moveHandleStyle"]).getItemStyle();var c=Math.min(i[1]/2,Math.max(m,10));f=t.moveZone=new pe({invisible:!0,shape:{y:i[1]-c,height:m+c}}),f.on("mouseover",function(){l.enterEmphasis(_)}).on("mouseout",function(){l.leaveEmphasis(_)}),o.add(_),o.add(g),o.add(f)}f.attr({draggable:!0,cursor:lt(this._orient),drift:k(this._onDragMove,this,"all"),ondragstart:k(this._showDataInfo,this,!0),ondragend:k(this._onDragEnd,this),onmouseover:k(this._showDataInfo,this,!0),onmouseout:k(this._showDataInfo,this,!1)})},r.prototype._resetInterval=function(){var e=this._range=this.dataZoomModel.getPercentRange(),t=this._getViewExtent();this._handleEnds=[B(e[0],[0,100],t,!0),B(e[1],[0,100],t,!0)]},r.prototype._updateInterval=function(e,t){var a=this.dataZoomModel,n=this._handleEnds,o=this._getViewExtent(),i=a.findRepresentativeAxisProxy().getMinMaxSpan(),u=[0,100];ye(t,n,o,a.get("zoomLock")?"all":e,i.minSpan!=null?B(i.minSpan,u,o,!0):null,i.maxSpan!=null?B(i.maxSpan,u,o,!0):null);var l=this._range,d=this._range=se([B(n[0],o,u,!0),B(n[1],o,u,!0)]);return!l||l[0]!==d[0]||l[1]!==d[1]},r.prototype._updateView=function(e){var t=this._displayables,a=this._handleEnds,n=se(a.slice()),o=this._size;L([0,1],function(f){var m=t.handles[f],_=this._handleHeight;m.attr({scaleX:_/2,scaleY:_/2,x:a[f]+(f?-1:1),y:o[1]/2-_/2})},this),t.filler.setShape({x:n[0],y:0,width:n[1]-n[0],height:o[1]});var i={x:n[0],width:n[1]-n[0]};t.moveHandle&&(t.moveHandle.setShape(i),t.moveZone.setShape(i),t.moveZone.getBoundingRect(),t.moveHandleIcon&&t.moveHandleIcon.attr("x",i.x+i.width/2));for(var u=t.dataShadowSegs,l=[0,n[0],n[1],o[0]],d=0;d<u.length;d++){var h=u[d],p=h.getClipPath();p||(p=new pe,h.setClipPath(p)),p.setShape({x:l[d],y:0,width:l[d+1]-l[d],height:o[1]})}this._updateDataInfo(e)},r.prototype._updateDataInfo=function(e){var t=this.dataZoomModel,a=this._displayables,n=a.handleLabels,o=this._orient,i=["",""];if(t.get("showDetail")){var u=t.findRepresentativeAxisProxy();if(u){var l=u.getAxisModel().axis,d=this._range,h=e?u.calculateDataWindow({start:d[0],end:d[1]}).valueWindow:u.getDataValueWindow();i=[this._formatLabel(h[0],l),this._formatLabel(h[1],l)]}}var p=se(this._handleEnds.slice());f.call(this,0),f.call(this,1);function f(m){var _=Yt(a.handles[m].parent,this.group),y=Xt(m===0?"right":"left",_),g=this._handleWidth/2+Ra,c=je([p[m]+(m===0?-g:g),this._size[1]/2],_);n[m].setStyle({x:c[0],y:c[1],verticalAlign:o===ie?"middle":y,align:o===ie?y:"center",text:i[m]})}},r.prototype._formatLabel=function(e,t){var a=this.dataZoomModel,n=a.get("labelFormatter"),o=a.get("labelPrecision");(o==null||o==="auto")&&(o=t.getPixelPrecision());var i=e==null||isNaN(e)?"":t.type==="category"||t.type==="time"?t.scale.getLabel({value:Math.round(e)}):e.toFixed(Math.min(o,20));return qt(n)?n(e,i):ft(n)?n.replace("{value}",i):i},r.prototype._showDataInfo=function(e){var t=this.dataZoomModel.get("handleLabel")||{},a=t.show||!1,n=this.dataZoomModel.getModel(["emphasis","handleLabel"]),o=n.get("show")||!1,i=e||this._dragging?o:a,u=this._displayables,l=u.handleLabels;l[0].attr("invisible",!i),l[1].attr("invisible",!i),u.moveHandle&&this.api[i?"enterEmphasis":"leaveEmphasis"](u.moveHandle,1)},r.prototype._onDragMove=function(e,t,a,n){this._dragging=!0,_e(n.event);var o=this._displayables.sliderGroup.getLocalTransform(),i=je([t,a],o,!0),u=this._updateInterval(e,i[0]),l=this.dataZoomModel.get("realtime");this._updateView(!l),u&&l&&this._dispatchZoomAction(!0)},r.prototype._onDragEnd=function(){this._dragging=!1,this._showDataInfo(!1);var e=this.dataZoomModel.get("realtime");!e&&this._dispatchZoomAction(!1)},r.prototype._onClickPanel=function(e){var t=this._size,a=this._displayables.sliderGroup.transformCoordToLocal(e.offsetX,e.offsetY);if(!(a[0]<0||a[0]>t[0]||a[1]<0||a[1]>t[1])){var n=this._handleEnds,o=(n[0]+n[1])/2,i=this._updateInterval("all",a[0]-o);this._updateView(),i&&this._dispatchZoomAction(!1)}},r.prototype._onBrushStart=function(e){var t=e.offsetX,a=e.offsetY;this._brushStart=new jt(t,a),this._brushing=!0,this._brushStartTime=+new Date},r.prototype._onBrushEnd=function(e){if(this._brushing){var t=this._displayables.brushRect;if(this._brushing=!1,!!t){t.attr("ignore",!0);var a=t.shape,n=+new Date;if(!(n-this._brushStartTime<200&&Math.abs(a.width)<5)){var o=this._getViewExtent(),i=[0,100];this._range=se([B(a.x,o,i,!0),B(a.x+a.width,o,i,!0)]),this._handleEnds=[a.x,a.x+a.width],this._updateView(),this._dispatchZoomAction(!1)}}}},r.prototype._onBrush=function(e){this._brushing&&(_e(e.event),this._updateBrushRect(e.offsetX,e.offsetY))},r.prototype._updateBrushRect=function(e,t){var a=this._displayables,n=this.dataZoomModel,o=a.brushRect;o||(o=a.brushRect=new oe({silent:!0,style:n.getModel("brushStyle").getItemStyle()}),a.sliderGroup.add(o)),o.attr("ignore",!1);var i=this._brushStart,u=this._displayables.sliderGroup,l=u.transformCoordToLocal(e,t),d=u.transformCoordToLocal(i.x,i.y),h=this._size;l[0]=Math.max(Math.min(h[0],l[0]),0),o.setShape({x:d[0],y:0,width:l[0]-d[0],height:h[1]})},r.prototype._dispatchZoomAction=function(e){var t=this._range;this.api.dispatchAction({type:"dataZoom",from:this.uid,dataZoomId:this.dataZoomModel.id,animation:e?ka:null,start:t[0],end:t[1]})},r.prototype._findCoordRect=function(){var e,t=wt(this.dataZoomModel).infoList;if(!e&&t.length){var a=t[0].model.coordinateSystem;e=a.getRect&&a.getRect()}if(!e){var n=this.api.getWidth(),o=this.api.getHeight();e={x:n*.2,y:o*.2,width:n*.6,height:o*.6}}return e},r.type="dataZoom.slider",r}(bt);function Ta(s){var r={x:"y",y:"x",radius:"angle",angle:"radius"};return r[s]}function lt(s){return s==="vertical"?"ns-resize":"ew-resize"}function Va(s){s.registerComponentModel(Aa),s.registerComponentView(La),xt(s)}function Pa(s){Te(Sa),Te(Va)}const Oa={class:"filters-bar"},Za={__name:"FilterBar",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(s,{emit:r}){const e=s,t=r,a=ut(),n=dt({timeRange:e.modelValue.timeRange||"month",dateRange:e.modelValue.dateRange||[],groupId:e.modelValue.groupId||null,role:e.modelValue.role??(a!=null&&a.isSuperAdmin?"ALL":"CC"),userId:e.modelValue.userId||null}),o=N([]),i=N([]),u=Y(()=>n.groupId?i.value.filter(f=>f.group_id===n.groupId):i.value);function l(){t("update:modelValue",{...n})}function d(){if(n.timeRange==="today"){const f=ke();n.dateRange=[f,f]}else n.timeRange==="week"?n.dateRange=pt(new Date):n.timeRange==="month"&&(n.dateRange=mt(new Date));l()}function h(){u.value.some(m=>m.id===n.userId)||(n.userId=null),l()}async function p(){try{const[{data:f},{data:m}]=await Promise.all([F.get("/groups",{params:{page:1,size:100},suppressErrorMessage:!0}),F.get("/users",{params:{page:1,size:100},suppressErrorMessage:!0})]);o.value=Array.isArray(f==null?void 0:f.items)?f.items:[],i.value=Array.isArray(m==null?void 0:m.items)?m.items:[]}catch{o.value=[],i.value=[]}}return J(()=>e.modelValue,f=>{Object.assign(n,f||{})}),ge(()=>{if(!a.user)try{a.initAuth()}catch{}a.isSuperAdmin&&n.role!=="ALL"&&(n.role="ALL",l()),p()}),(f,m)=>{const _=D("el-radio-button"),y=D("el-radio-group"),g=D("el-date-picker"),c=D("el-option"),S=D("el-select");return C(),P("div",Oa,[x(y,{modelValue:n.timeRange,"onUpdate:modelValue":m[0]||(m[0]=w=>n.timeRange=w),onChange:d},{default:M(()=>[x(_,{label:"today"},{default:M(()=>[...m[5]||(m[5]=[Z("ä»Šæ—¥",-1)])]),_:1}),x(_,{label:"week"},{default:M(()=>[...m[6]||(m[6]=[Z("æœ¬å‘¨",-1)])]),_:1}),x(_,{label:"month"},{default:M(()=>[...m[7]||(m[7]=[Z("æœ¬æœˆ",-1)])]),_:1}),x(_,{label:"custom"},{default:M(()=>[...m[8]||(m[8]=[Z("è‡ªå®šä¹‰",-1)])]),_:1})]),_:1},8,["modelValue"]),n.timeRange==="custom"?(C(),K(g,{key:0,modelValue:n.dateRange,"onUpdate:modelValue":m[1]||(m[1]=w=>n.dateRange=w),type:"daterange","range-separator":"è‡³","start-placeholder":"å¼€å§‹æ—¥æœŸ","end-placeholder":"ç»“æŸæ—¥æœŸ",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:l},null,8,["modelValue"])):U("",!0),x(S,{modelValue:n.role,"onUpdate:modelValue":m[2]||(m[2]=w=>n.role=w),placeholder:"è§†è§’",style:{width:"160px"},onChange:l},{default:M(()=>[x(c,{label:"CC(é¡¾é—®)",value:"CC"}),x(c,{label:"SS(ç­ä¸»ä»»)",value:"SS"}),x(c,{label:"LP(è‹±æ–‡è¾…å¯¼)",value:"LP"}),x(c,{label:"å…¨ä½“",value:"ALL"})]),_:1},8,["modelValue"]),x(S,{modelValue:n.groupId,"onUpdate:modelValue":m[3]||(m[3]=w=>n.groupId=w),placeholder:"ç»„ç»‡",clearable:"",style:{width:"200px"},onChange:h},{default:M(()=>[x(c,{label:"å…¨éƒ¨ç»„ç»‡",value:null}),(C(!0),P(he,null,fe(o.value,w=>(C(),K(c,{key:w.id,label:w.name,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),x(S,{modelValue:n.userId,"onUpdate:modelValue":m[4]||(m[4]=w=>n.userId=w),placeholder:"ç”¨æˆ·",clearable:"",filterable:"",style:{width:"220px"},onChange:l},{default:M(()=>[x(c,{label:"å…¨éƒ¨ç”¨æˆ·",value:null}),(C(!0),P(he,null,fe(u.value,w=>(C(),K(c,{key:w.id,label:w.username,value:w.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])}}},Na=ee(Za,[["__scopeId","data-v-7b4a5060"]]),Ea={class:"card-top"},za={class:"title"},Ba={class:"value"},Wa={key:0,class:"unit"},$a={__name:"DataCard",props:{title:{type:String,required:!0},value:{type:[Number,String],default:0},unit:{type:String,default:""},metricKey:{type:String,required:!0},isActive:{type:Boolean,default:!1}},emits:["cardClick","aiClick"],setup(s,{emit:r}){const e=s,t=r,a=Y(()=>e.value===null||e.value===void 0||e.value===""?"â€”":typeof e.value=="number"&&typeof e.unit=="string"&&e.unit.includes("USD")?new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",maximumFractionDigits:0}).format(e.value):typeof e.value=="number"?e.value.toLocaleString():e.value);function n(){t("cardClick",e.metricKey)}const o=N({});function i(l){const d=l.currentTarget.getBoundingClientRect(),h=l.clientX-d.left,p=l.clientY-d.top;o.value={"--mouse-x":`${h}px`,"--mouse-y":`${p}px`}}function u(){o.value={}}return(l,d)=>{const h=D("el-button"),p=D("el-card");return C(),K(p,{class:ct(["data-card hover-effect",{active:s.isActive}]),onClick:n,onMousemove:i,onMouseleave:u,style:Ct(o.value)},{default:M(()=>[v("div",Ea,[v("div",za,R(s.title),1),x(h,{text:"",type:"primary",onClick:d[0]||(d[0]=At(f=>t("aiClick",s.metricKey),["stop"]))},{default:M(()=>[...d[1]||(d[1]=[Z("AIæ´žå¯Ÿ",-1)])]),_:1})]),v("div",Ba,R(a.value),1),s.unit?(C(),P("div",Wa,R(s.unit),1)):U("",!0)]),_:1},8,["class","style"])}}},Ka=ee($a,[["__scopeId","data-v-68eff4ff"]]),Ga={class:"grid-container"},Ha={key:0,class:"empty"},Fa={key:1,class:"grid"},Ua={__name:"CardGrid",props:{summaryData:{type:Object,required:!0},activeMetricKey:{type:String,default:""},visibleKeys:{type:Array,default:()=>[]}},emits:["cardClick","aiClick"],setup(s,{emit:r}){const e=s,t=r,a={task_completion_rate:{name:"ä»»åŠ¡å®ŒæˆçŽ‡",unit:"%"},period_sales_amount:{name:"é”€å”®æ€»é¢",unit:"USD"},sales_achievement_rate:{name:"é”€å”®ç›®æ ‡è¾¾æˆçŽ‡",unit:"%"},period_new_sign_amount:{name:"æ–°å•é‡‘é¢",unit:"USD"},new_sign_count:{name:"æ–°å•å•é‡",unit:"å•"},new_sign_achievement_rate:{name:"æ–°å•ç›®æ ‡è¾¾æˆçŽ‡",unit:"%"},period_referral_amount:{name:"è½¬ä»‹ç»é‡‘é¢",unit:"USD"},referral_count:{name:"è½¬ä»‹ç»å•é‡",unit:"å•"},referral_achievement_rate:{name:"è½¬ä»‹ç»ç›®æ ‡è¾¾æˆçŽ‡",unit:"%"},period_total_renewal_amount:{name:"æ€»ç»­è´¹é‡‘é¢",unit:"USD"},total_renewal_achievement_rate:{name:"æ€»ç»­è´¹ç›®æ ‡è¾¾æˆçŽ‡",unit:"%"},period_upgrade_amount:{name:"å‡èˆ±é‡‘é¢",unit:"USD"},upgrade_count:{name:"å‡èˆ±å•é‡",unit:"å•"},upgrade_rate:{name:"å‡èˆ±çŽ‡",unit:"%"},report_submission_rate:{name:"æ—¥æŠ¥æäº¤çŽ‡",unit:"%"}},n=Y(()=>{const o=Object.keys(e.summaryData||{});return e.visibleKeys&&e.visibleKeys.length>0?e.visibleKeys.filter(i=>o.includes(i)):o});return(o,i)=>{const u=D("el-card");return C(),P("div",Ga,[x(u,{class:"content-card",shadow:"never"},{header:M(()=>[...i[0]||(i[0]=[v("div",{class:"card-header"},[v("span",null,"æŒ‡æ ‡æ¦‚è§ˆ")],-1)])]),default:M(()=>[n.value.length===0?(C(),P("div",Ha,"æš‚æ— æ•°æ®")):(C(),P("div",Fa,[(C(!0),P(he,null,fe(n.value,l=>{var d,h;return C(),K(Ka,{key:l,metricKey:l,title:((d=a[l])==null?void 0:d.name)||l,unit:((h=a[l])==null?void 0:h.unit)||"",value:s.summaryData[l],isActive:s.activeMetricKey===l,onCardClick:p=>t("cardClick",l),onAiClick:p=>t("aiClick",l)},null,8,["metricKey","title","unit","value","isActive","onCardClick","onAiClick"])}),128))]))]),_:1})])}}},Ya=ee(Ua,[["__scopeId","data-v-869ff2dd"]]),Xa={class:"trend-module"},qa={key:0,class:"empty"},ja={key:1},Ja={class:"toolbar"},Qa=Object.assign({name:"TrendChartModule",components:{"v-chart":Je}},{__name:"TrendChartModule",props:{metricKey:{type:String,default:""},filterParams:{type:Object,required:!0}},setup(s){Te([ea,ta,aa,ra,na,Pa,oa]);const r=s,e=N(!1),t=N([]);async function a(){var o,i,u,l;if(r.metricKey){e.value=!0;try{const[d,h]=((o=r.filterParams)==null?void 0:o.dateRange)||[],p=((i=r.filterParams)==null?void 0:i.role)||"CC",f=p==="CC",m=p==="SS";let _=[];if(r.metricKey==="period_sales_amount")_=f?["new_sign_amount","referral_amount"]:m?["renewal_amount","upgrade_amount"]:["new_sign_amount","referral_amount","renewal_amount","upgrade_amount"];else if(r.metricKey==="period_new_sign_amount")_=["new_sign_amount"];else if(r.metricKey==="period_referral_amount")_=["referral_amount"];else if(r.metricKey==="period_renewal_amount")_=["renewal_amount"];else if(r.metricKey==="period_upgrade_amount")_=["upgrade_amount"];else if(r.metricKey==="period_total_renewal_amount")_=["renewal_amount","upgrade_amount"];else if(r.metricKey==="referral_count")_=["referral_count"];else if(r.metricKey==="renewal_count")_=["renewal_count"];else if(r.metricKey==="upgrade_count")_=["upgrade_count"];else{t.value=[],e.value=!1;return}const y=f?"CC":m?"SS":void 0,{data:g}=await F.get("/analytics/trend",{params:{start_date:d,end_date:h,identity_type:y,metrics:_,group_id:((u=r.filterParams)==null?void 0:u.groupId)||void 0,user_id:((l=r.filterParams)==null?void 0:l.userId)||void 0}}),c=(g==null?void 0:g.series)||[];t.value=c.map(S=>{const w=(()=>{if(r.metricKey==="period_sales_amount"){const T=Number(S.new_sign_amount||0),G=Number(S.referral_amount||0),O=Number(S.renewal_amount||0),E=Number(S.upgrade_amount||0);return T+G+O+E}if(r.metricKey==="period_total_renewal_amount"){const T=Number(S.renewal_amount||0),G=Number(S.upgrade_amount||0);return T+G}const b={period_new_sign_amount:"new_sign_amount",period_referral_amount:"referral_amount",period_renewal_amount:"renewal_amount",period_upgrade_amount:"upgrade_amount",referral_count:"referral_count",renewal_count:"renewal_count",upgrade_count:"upgrade_count"}[r.metricKey];return Number(S[b]||0)})();return{date:S.date,value:w}})}catch{le.error("èŽ·å–è¶‹åŠ¿æ•°æ®å¤±è´¥")}finally{e.value=!1}}}J(()=>r.metricKey,()=>{a()}),J(()=>r.filterParams,()=>{a()},{deep:!0});const n=Y(()=>{const o=t.value.map(u=>u.date),i=t.value.map(u=>u.value);return{title:{text:"æŒ‡æ ‡è¶‹åŠ¿"},tooltip:{trigger:"axis"},grid:{left:40,right:20,bottom:60},dataZoom:[{type:"inside"},{type:"slider"}],xAxis:{type:"category",data:o},yAxis:{type:"value"},legend:{data:["å€¼"]},series:[{name:"å€¼",type:"line",data:i,smooth:!0}]}});return(o,i)=>{const u=D("el-button");return C(),P("div",Xa,[s.metricKey?(C(),P("div",ja,[v("div",Ja,[x(u,{size:"small",loading:e.value,onClick:a},{default:M(()=>[...i[0]||(i[0]=[Z("åˆ·æ–°è¶‹åŠ¿",-1)])]),_:1},8,["loading"])]),x(Ie(Je),{class:"chart",option:n.value,autoresize:""},null,8,["option"])])):(C(),P("div",qa,"è¯·é€‰æ‹©ä¸€ä¸ªæŒ‡æ ‡æŸ¥çœ‹è¶‹åŠ¿"))])}}}),er=ee(Qa,[["__scopeId","data-v-f63e1247"]]),tr={class:"ranking-container"},ar={class:"header-row"},rr={key:1,class:"ranking-content"},nr={class:"podium-wrap"},or={class:"podium"},ir={key:0,class:"podium-item second"},sr={class:"avatar-wrap"},lr=["title"],ur={class:"podium-value"},dr={key:1,class:"podium-item first"},cr={class:"avatar-wrap"},pr=["title"],mr={class:"podium-value"},hr={key:2,class:"podium-item third"},fr={class:"avatar-wrap"},_r=["title"],vr={class:"podium-value"},gr={class:"rank-list"},yr={class:"rank-num"},wr=["title"],br={class:"row-value"},xr={class:"card-header"},Mr={class:"my-rank-row"},Sr={class:"user-cell"},Ar={class:"name"},Cr={class:"value"},Dr={__name:"RankingList",props:{metricKey:{type:String,default:""},filterParams:{type:Object,required:!0}},setup(s){const r=s,e=N(!1),t=N([]),a=N(null),n={task_completion_rate:{name:"ä»»åŠ¡å®ŒæˆçŽ‡"},period_sales_amount:{name:"é”€å”®æ€»é¢"},sales_achievement_rate:{name:"é”€å”®ç›®æ ‡è¾¾æˆçŽ‡"},period_new_sign_amount:{name:"æ–°å•é‡‘é¢"},new_sign_count:{name:"æ–°å•å•é‡"},new_sign_achievement_rate:{name:"æ–°å•ç›®æ ‡è¾¾æˆçŽ‡"},period_referral_amount:{name:"è½¬ä»‹ç»é‡‘é¢"},referral_count:{name:"è½¬ä»‹ç»å•é‡"},referral_achievement_rate:{name:"è½¬ä»‹ç»ç›®æ ‡è¾¾æˆçŽ‡"},period_total_renewal_amount:{name:"æ€»ç»­è´¹é‡‘é¢"},total_renewal_achievement_rate:{name:"æ€»ç»­è´¹ç›®æ ‡è¾¾æˆçŽ‡"},period_upgrade_amount:{name:"å‡èˆ±é‡‘é¢"},upgrade_count:{name:"å‡èˆ±å•é‡"},upgrade_rate:{name:"å‡èˆ±çŽ‡"},report_submission_rate:{name:"æ—¥æŠ¥æäº¤çŽ‡"}},o=Y(()=>{var h;return((h=n[r.metricKey])==null?void 0:h.name)||r.metricKey}),i=Y(()=>{var p;const h=(p=a.value)==null?void 0:p.user_id;return!h||!Array.isArray(t.value)?!1:t.value.some(f=>f.user_id===h)});async function u(){var h,p,f,m;if(!r.metricKey){t.value=[],a.value=null;return}e.value=!0;try{const[_,y]=((h=r.filterParams)==null?void 0:h.dateRange)||[],g={metric_key:r.metricKey,start_date:_,end_date:y,group_id:((p=r.filterParams)==null?void 0:p.groupId)||void 0,user_id:((f=r.filterParams)==null?void 0:f.userId)||void 0,role_scope:((m=r.filterParams)==null?void 0:m.role)||void 0},{data:c}=await F.get("/analytics/ranking",{params:g,suppressErrorMessage:!0}),S=Array.isArray(c==null?void 0:c.top_10)?c.top_10:[];console.log("[RankingList] Fetched top10:",S),t.value=S,a.value=(c==null?void 0:c.current_user_rank)||null,console.log("[RankingList] Fetched currentUserRank:",a.value)}catch{le.warning("èŽ·å–æŽ’è¡Œæ¦œå¤±è´¥"),t.value=[],a.value=null}finally{e.value=!1}}J(()=>r.metricKey,()=>{u()}),J(()=>r.filterParams,()=>{u()},{deep:!0}),ge(()=>{u()});const l=Y(()=>Array.isArray(t.value)?t.value.slice(0,3):[]),d=Y(()=>Array.isArray(t.value)?t.value.slice(3):[]);return(h,p)=>{const f=D("el-tag"),m=D("el-button"),_=D("el-empty"),y=D("el-avatar"),g=D("el-card");return C(),P("div",tr,[v("div",ar,[p[1]||(p[1]=v("span",{class:"title"},"æŽ’è¡Œæ¦œ",-1)),s.metricKey?(C(),K(f,{key:0,type:"primary",size:"small"},{default:M(()=>[Z("æŒ‡æ ‡ï¼š"+R(o.value),1)]),_:1})):U("",!0),x(m,{class:"refresh-btn",loading:e.value,onClick:u},{default:M(()=>[...p[0]||(p[0]=[Z("åˆ·æ–°",-1)])]),_:1},8,["loading"])]),!e.value&&(!t.value||t.value.length===0)?(C(),K(_,{key:0,description:"æš‚æ— æŽ’åæ•°æ®"})):(C(),P("div",rr,[v("div",nr,[p[5]||(p[5]=v("div",{class:"podium-banner"},null,-1)),v("div",or,[l.value[1]?(C(),P("div",ir,[v("div",sr,[x(y,{size:68,src:l.value[1].avatar_url},null,8,["src"]),p[2]||(p[2]=v("span",{class:"medal medal-silver","aria-hidden":"true"},"ðŸ¥ˆ",-1))]),v("div",{class:"podium-name",title:l.value[1].name||"â€”"},R(l.value[1].name||"â€”"),9,lr),v("div",ur,R(l.value[1].formatted_value??l.value[1].value??"â€”"),1)])):U("",!0),l.value[0]?(C(),P("div",dr,[v("div",cr,[x(y,{size:88,src:l.value[0].avatar_url},null,8,["src"]),p[3]||(p[3]=v("span",{class:"medal medal-gold","aria-hidden":"true"},"ðŸ¥‡",-1))]),v("div",{class:"podium-name",title:l.value[0].name||"â€”"},R(l.value[0].name||"â€”"),9,pr),v("div",mr,R(l.value[0].formatted_value??l.value[0].value??"â€”"),1)])):U("",!0),l.value[2]?(C(),P("div",hr,[v("div",fr,[x(y,{size:68,src:l.value[2].avatar_url},null,8,["src"]),p[4]||(p[4]=v("span",{class:"medal medal-bronze","aria-hidden":"true"},"ðŸ¥‰",-1))]),v("div",{class:"podium-name",title:l.value[2].name||"â€”"},R(l.value[2].name||"â€”"),9,_r),v("div",vr,R(l.value[2].formatted_value??l.value[2].value??"â€”"),1)])):U("",!0)])]),v("div",gr,[(C(!0),P(he,null,fe(d.value,c=>(C(),P("div",{key:c.user_id||c.rank,class:"rank-row"},[v("div",yr,R(c.rank),1),x(y,{size:36,src:c.avatar_url},null,8,["src"]),v("div",{class:"row-name",title:c.name||"â€”"},R(c.name||"â€”"),9,wr),v("div",br,R(c.formatted_value??c.value??"â€”"),1)]))),128))])])),a.value&&!i.value?(C(),K(g,{key:2,class:"my-rank-card",shadow:"never"},{header:M(()=>[v("div",xr,[p[7]||(p[7]=v("span",null,"æˆ‘çš„æŽ’å",-1)),x(f,{type:"success",size:"small"},{default:M(()=>[...p[6]||(p[6]=[Z("ä¸åœ¨Top10ï¼Œå•ç‹¬æ˜¾ç¤º",-1)])]),_:1})])]),default:M(()=>[v("div",Mr,[x(f,{size:"small"},{default:M(()=>[Z("ç¬¬ "+R(a.value.rank)+" å",1)]),_:1}),v("div",Sr,[x(y,{size:28,src:a.value.avatar_url},null,8,["src"]),v("span",Ar,R(a.value.name||"â€”"),1)]),v("span",Cr,R(a.value.formatted_value??a.value.value??"â€”"),1)])]),_:1})):U("",!0)])}}},Rr=ee(Dr,[["__scopeId","data-v-f4f3a138"]]),Ir={class:"card-header"},kr={class:"header-actions"},Lr={class:"user-cell"},Tr={class:"name"},Vr={class:"rate-cell"},Pr={__name:"AdminTeamPerformance",props:{filterParams:{type:Object,required:!0}},setup(s){const r=s,e=N(!1),t=N([]),a=l=>l==null?"-":new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(l),n=l=>l>=100?"success":l>=80?"warning":"exception",o=l=>l.completed_amount>=l.goal_amount&&l.goal_amount>0?"text-success":"";async function i(){var l,d,h;e.value=!0;try{const[p,f]=((l=r.filterParams)==null?void 0:l.dateRange)||[],m={start_date:p,end_date:f,group_id:((d=r.filterParams)==null?void 0:d.groupId)||void 0,role_scope:((h=r.filterParams)==null?void 0:h.role)||void 0},{data:_}=await F.get("/analytics/team-performance",{params:m});t.value=Array.isArray(_)?_:[]}catch(p){console.error("Fetch team performance failed:",p),le.warning("èŽ·å–å›¢é˜Ÿç»©æ•ˆæ•°æ®å¤±è´¥")}finally{e.value=!1}}const u=l=>{const{columns:d,data:h}=l,p=[];return d.forEach((f,m)=>{if(m===0){p[m]="åˆè®¡";return}if(["username","identity"].includes(f.property)){p[m]="";return}const _=h.map(y=>Number(y[f.property]));if(f.property==="goal_amount"||f.property==="completed_amount")if(_.every(y=>Number.isNaN(y)))p[m]="";else{const y=_.reduce((g,c)=>{const S=Number(c);return Number.isNaN(S)?g:g+c},0);p[m]=a(y),f.property==="goal_amount"&&(p.totalGoal=y),f.property==="completed_amount"&&(p.totalCompleted=y)}else if(f.property==="completion_rate"){const y=p.totalGoal||0,g=p.totalCompleted||0;if(y>0){const c=(g/y*100).toFixed(1);p[m]=c+"%"}else g>0?p[m]="100.0%":p[m]="0.0%"}else p[m]=""}),p};return J(()=>r.filterParams,()=>{i()},{deep:!0}),ge(()=>{i()}),(l,d)=>{const h=D("el-button"),p=D("el-table-column"),f=D("el-tag"),m=D("el-progress"),_=D("el-table"),y=D("el-card"),g=Rt("loading");return C(),K(y,{class:"team-performance-card",shadow:"never"},{header:M(()=>[v("div",Ir,[d[1]||(d[1]=v("span",null,"å›¢é˜Ÿç»©æ•ˆè¡¨",-1)),v("div",kr,[x(h,{type:"primary",link:"",loading:e.value,onClick:i},{default:M(()=>[...d[0]||(d[0]=[Z("åˆ·æ–°",-1)])]),_:1},8,["loading"])])])]),default:M(()=>[Dt((C(),K(_,{data:t.value,border:"",stripe:"",style:{width:"100%"},"show-summary":"","summary-method":u,"max-height":"500"},{default:M(()=>[x(p,{prop:"group_name",label:"ç»„åˆ«",sortable:"","min-width":"120"}),x(p,{prop:"username",label:"å§“å","min-width":"120"},{default:M(({row:c})=>[v("div",Lr,[v("span",Tr,R(c.username),1),x(f,{size:"small",effect:"plain"},{default:M(()=>[Z(R(c.identity),1)]),_:2},1024)])]),_:1}),x(p,{prop:"goal_amount",label:"ç›®æ ‡é‡‘é¢","min-width":"140",align:"right",sortable:""},{default:M(({row:c})=>[Z(R(a(c.goal_amount)),1)]),_:1}),x(p,{prop:"completed_amount",label:"å·²å®Œæˆé‡‘é¢","min-width":"140",align:"right",sortable:""},{default:M(({row:c})=>[v("span",{class:ct(o(c))},R(a(c.completed_amount)),3)]),_:1}),x(p,{prop:"completion_rate",label:"å®ŒæˆçŽ‡","min-width":"180",sortable:""},{default:M(({row:c})=>[v("div",Vr,[x(m,{percentage:Math.min(c.completion_rate,100),status:n(c.completion_rate),format:()=>c.completion_rate+"%"},null,8,["percentage","status","format"])])]),_:1})]),_:1},8,["data"])),[[g,e.value]])]),_:1})}}},Or=ee(Pr,[["__scopeId","data-v-56e9dbfa"]]),Zr={class:"page-container"},Nr={class:"card-header"},Er={class:"header-actions"},zr={class:"card-header"},Br={class:"header-actions"},Wr={class:"card-header"},$r={class:"header-actions"},Kr={style:{"white-space":"pre-wrap","min-height":"120px"}},Gr={__name:"AnalyticsDashboard",setup(s){var y;const r=N(!1),e=ut(),t=e!=null&&e.isSuperAdmin?"ALL":String(((y=e==null?void 0:e.user)==null?void 0:y.identity_type)||"CC").toUpperCase(),a=N({timeRange:"month",dateRange:[],groupId:null,role:t,userId:null}),n=dt({}),o=N(""),i=Y(()=>a.value.role||"CC"),u=Y(()=>{if(e.isSuperAdmin)return["task_completion_rate","report_submission_rate","period_sales_amount","sales_achievement_rate","period_new_sign_amount","new_sign_count","new_sign_achievement_rate","period_referral_amount","referral_count","referral_achievement_rate","period_total_renewal_amount","total_renewal_achievement_rate","period_upgrade_amount","upgrade_count","upgrade_rate"];const g=["task_completion_rate","report_submission_rate","period_sales_amount"];return i.value==="CC"?g.concat(["period_new_sign_amount","new_sign_count","new_sign_achievement_rate","period_referral_amount","referral_count","referral_achievement_rate"]):i.value==="SS"?g.concat(["period_total_renewal_amount","total_renewal_achievement_rate","period_upgrade_amount","upgrade_count","upgrade_rate"]):g}),l={task_completion_rate:{name:"ä»»åŠ¡å®ŒæˆçŽ‡"},period_sales_amount:{name:"é”€å”®æ€»é¢"},sales_achievement_rate:{name:"é”€å”®ç›®æ ‡è¾¾æˆçŽ‡"},period_new_sign_amount:{name:"æ–°å•é‡‘é¢"},new_sign_count:{name:"æ–°å•å•é‡"},new_sign_achievement_rate:{name:"æ–°å•ç›®æ ‡è¾¾æˆçŽ‡"},period_referral_amount:{name:"è½¬ä»‹ç»é‡‘é¢"},referral_count:{name:"è½¬ä»‹ç»å•é‡"},referral_achievement_rate:{name:"è½¬ä»‹ç»ç›®æ ‡è¾¾æˆçŽ‡"},period_total_renewal_amount:{name:"æ€»ç»­è´¹é‡‘é¢"},total_renewal_achievement_rate:{name:"æ€»ç»­è´¹ç›®æ ‡è¾¾æˆçŽ‡"},period_upgrade_amount:{name:"å‡èˆ±é‡‘é¢"},upgrade_count:{name:"å‡èˆ±å•é‡"},upgrade_rate:{name:"å‡èˆ±çŽ‡"},report_submission_rate:{name:"æ—¥æŠ¥æäº¤çŽ‡"}};function d(){const g=a.value.timeRange;if(g==="today"){const c=ke();a.value.dateRange=[c,c]}else g==="week"?a.value.dateRange=pt(new Date):g==="month"&&(a.value.dateRange=mt(new Date))}async function h(){var g;r.value=!0;try{const[c,S]=a.value.dateRange||[],w=a.value.groupId||void 0,A=a.value.userId||void 0,b=a.value.role||"CC",T=S||c||ke(),G=new Date(T),O=G.getFullYear(),E=G.getMonth()+1,{data:z}=await F.get("/analytics/data",{params:{start_date:c,end_date:S,group_id:w,user_id:A,role_scope:b}}),j=(z==null?void 0:z.metrics)||{};let ue=null,Pe=null,Oe=null,Ze=null,V=null,W=null;if(b==="CC"||b==="ALL")try{const{data:I}=await F.get("/analytics/summary",{params:{identity_type:"CC",group_id:w,user_id:A,year:O,month:E}});if(ue=(I==null?void 0:I.month)||null,Oe=(I==null?void 0:I.goal)||null,A)try{const{data:H}=await F.get("/goals/monthly/personal",{params:{identity_type:"CC",group_id:w,user_id:A,year:O,month:E},suppressErrorMessage:!0});V=(Array.isArray(H==null?void 0:H.items)?H.items[0]:null)||null}catch{}}catch{}if(b==="SS"||b==="ALL")try{const{data:I}=await F.get("/analytics/summary",{params:{identity_type:"SS",group_id:w,user_id:A,year:O,month:E}});if(Pe=(I==null?void 0:I.month)||null,Ze=(I==null?void 0:I.goal)||null,A)try{const{data:H}=await F.get("/goals/monthly/personal",{params:{identity_type:"SS",group_id:w,user_id:A,year:O,month:E},suppressErrorMessage:!0});W=(Array.isArray(H==null?void 0:H.items)?H.items[0]:null)||null}catch{}}catch{}const ae=ue||{},X=Pe||{},de=Oe||{},ce=Ze||{},Ne=Number(ae.new_sign_amount||0)+Number(ae.referral_amount||0),Ee=Number(X.renewal_amount||0)+Number(X.upgrade_amount||0),we=b==="CC"?Ne:b==="SS"?Ee:Ne+Ee,be=(()=>{const I=Number(X.renewal_amount||0)+Number(X.upgrade_amount||0);return b==="SS"||b==="ALL"?I:null})(),$={task_completion_rate:j.task_completion_rate??null,report_submission_rate:j.report_submission_rate??null,period_sales_amount:we,period_new_sign_amount:b==="CC"||b==="ALL"?ae.new_sign_amount??null:null,new_sign_count:b==="CC"||b==="ALL"?ae.new_sign_count??null:null,period_referral_amount:b==="CC"||b==="ALL"?ae.referral_amount??null:null,referral_count:b==="CC"||b==="ALL"?ae.referral_count??null:null,period_total_renewal_amount:be,period_upgrade_amount:b==="SS"||b==="ALL"?X.upgrade_amount??null:null,upgrade_count:b==="SS"||b==="ALL"?X.upgrade_count??null:null},ze=(()=>{if(A){if(b==="CC"){const xe=Number((V==null?void 0:V.new_sign_target_amount)||0),St=Number((V==null?void 0:V.referral_target_amount)||0);return xe+St}if(b==="SS")return Number((W==null?void 0:W.renewal_total_target_amount)||0);const I=Number((V==null?void 0:V.new_sign_target_amount)||0)+Number((V==null?void 0:V.referral_target_amount)||0),H=Number((W==null?void 0:W.renewal_total_target_amount)||0);return I+H}return b==="CC"?Number(de.amount_target||0):b==="SS"?Number(ce.amount_target||0):Number(de.amount_target||0)+Number(ce.amount_target||0)})();$.sales_achievement_rate=ze>0&&we!=null?Number(we)/ze*100:null;const Be=Number(A?(V==null?void 0:V.new_sign_target_amount)||0:de.new_sign_target_amount||0);$.new_sign_achievement_rate=(b==="CC"||b==="ALL")&&Be>0&&$.period_new_sign_amount!=null?Number($.period_new_sign_amount)/Be*100:null;const We=Number(A?(V==null?void 0:V.referral_target_amount)||0:de.referral_target_amount||0);$.referral_achievement_rate=(b==="CC"||b==="ALL")&&We>0&&$.period_referral_amount!=null?Number($.period_referral_amount)/We*100:null;const $e=Number(A?(W==null?void 0:W.renewal_total_target_amount)||0:ce.renewal_total_target_amount||0);$.total_renewal_achievement_rate=(b==="SS"||b==="ALL")&&$e>0&&be!=null?Number(be)/$e*100:null;const Ke=Number(A?(W==null?void 0:W.upgrade_target_count)||0:ce.upgrade_target_count||0),Ge=Ke>0&&$.upgrade_count!=null?Number($.upgrade_count)/Ke*100:null;if(A)$.upgrade_rate=Ge;else{const I=((g=X==null?void 0:X.progress)==null?void 0:g.upgrade_rate)??null;$.upgrade_rate=Ge??I??null}for(const I of Object.keys(n))delete n[I];Object.assign(n,$),o.value||(o.value="task_completion_rate")}catch{le.error("èŽ·å–æ±‡æ€»æ•°æ®å¤±è´¥")}finally{r.value=!1}}function p(g){o.value=g}const f=N(!1),m=N("");async function _(g){try{const[c,S]=a.value.dateRange||[],A={question:`è¯·ç”Ÿæˆå½“å‰ç­›é€‰èŒƒå›´ä¸‹çš„AIæ€»ç»“ï¼Œå¹¶é‡ç‚¹å…³æ³¨æŒ‡æ ‡ï¼š${g}`,output_target:a.value.userId?"personal":"team",role_scope:a.value.role||void 0,group_id:a.value.groupId||void 0,user_id:a.value.userId||void 0,start_date:c,end_date:S,page_context:"analytics_dashboard",identity_hint:a.value.role||void 0},{data:b}=await F.post("/ai/answer",A);m.value=(b==null?void 0:b.answer)||"â€”",f.value=!0}catch{le.error("èŽ·å–AIæ´žå¯Ÿå¤±è´¥")}}return ge(()=>{if(!e.user)try{e.initAuth()}catch{}e.isSuperAdmin&&a.value.role!=="ALL"&&(a.value.role="ALL"),d(),h()}),J(a,()=>{h()},{deep:!0}),(g,c)=>{const S=D("el-button"),w=D("el-card"),A=D("el-tag"),b=D("el-dialog");return C(),P("div",Zr,[c[8]||(c[8]=v("div",{class:"page-header"},[v("h1",{class:"page-title"},"æ•°æ®åˆ†æžä»ªè¡¨ç›˜"),v("p",{class:"page-description"},"ç»Ÿä¸€ç­›é€‰ã€å¡ç‰‡æ¦‚è§ˆã€è”åŠ¨è¶‹åŠ¿ä¸ŽAIæ´žå¯Ÿ")],-1)),x(w,{class:"content-card"},{header:M(()=>[v("div",Nr,[c[4]||(c[4]=v("span",null,"ç­›é€‰æ¡ä»¶",-1)),v("div",Er,[x(S,{loading:r.value,onClick:h},{default:M(()=>[...c[3]||(c[3]=[Z("åˆ·æ–°",-1)])]),_:1},8,["loading"])])])]),default:M(()=>[x(Na,{modelValue:a.value,"onUpdate:modelValue":c[0]||(c[0]=T=>a.value=T)},null,8,["modelValue"])]),_:1}),x(Ya,{summaryData:n,activeMetricKey:o.value,visibleKeys:u.value,onCardClick:p,onAiClick:_},null,8,["summaryData","activeMetricKey","visibleKeys"]),x(w,{class:"chart-card"},{header:M(()=>[v("div",zr,[c[5]||(c[5]=v("span",null,"è¶‹åŠ¿åˆ†æž",-1)),v("div",Br,[o.value?(C(),K(A,{key:0,type:"primary",size:"small"},{default:M(()=>[Z("æŒ‡æ ‡ï¼š"+R(o.value),1)]),_:1})):U("",!0)])])]),default:M(()=>[x(er,{metricKey:o.value,filterParams:a.value},null,8,["metricKey","filterParams"])]),_:1}),x(w,{class:"chart-card"},{header:M(()=>[v("div",Wr,[c[6]||(c[6]=v("span",null,"æŽ’è¡Œæ¦œ",-1)),v("div",$r,[o.value?(C(),K(A,{key:0,type:"primary",size:"small"},{default:M(()=>{var T;return[Z("æŒ‡æ ‡ï¼š"+R(((T=l[o.value])==null?void 0:T.name)||o.value),1)]}),_:1})):U("",!0)])])]),default:M(()=>[x(Rr,{metricKey:o.value,filterParams:a.value},null,8,["metricKey","filterParams"])]),_:1}),Ie(e).isAdmin||Ie(e).isSuperAdmin?(C(),K(Or,{key:0,filterParams:a.value},null,8,["filterParams"])):U("",!0),x(b,{modelValue:f.value,"onUpdate:modelValue":c[2]||(c[2]=T=>f.value=T),title:"AIæ´žå¯Ÿ",width:"620px"},{footer:M(()=>[x(S,{onClick:c[1]||(c[1]=T=>f.value=!1)},{default:M(()=>[...c[7]||(c[7]=[Z("å…³é—­",-1)])]),_:1})]),default:M(()=>[v("div",Kr,R(m.value||"â€”"),1)]),_:1},8,["modelValue"])])}}},Yr=ee(Gr,[["__scopeId","data-v-bdd1ab81"]]);export{Yr as default};
