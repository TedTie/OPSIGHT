import{m as b,c as d,o as i,a as r,_ as te,b as H,F as ce,r as me,n as ke,t as N,u as be,d as ye,e as $,f as _e,w as ee,g as xe,h,i as C,j as s,k as t,l as D,p as v,q as A,s as ve,v as Se,x as Z,E as de,y as Ae,z as Me,A as $e,B as Ce}from"./index-DxUxAYfJ.js";import{U as Be}from"./user-DHlPW-H9.js";import{T as Ie}from"./chart-line-Be8n-pD8.js";import{D as Te}from"./file-text-CpSO7nFI.js";const Ee={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function De(_,a){return i(),d("svg",Ee,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M4 6a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm5-2v16"}),r("path",{d:"m14 10l2 2l-2 2"})],-1)])])}const Ne=b({name:"tabler-layout-sidebar-left-expand",render:De}),Re={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function ze(_,a){return i(),d("svg",Re,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 5a2 2 0 1 1 4 0a7 7 0 0 1 4 6v3a4 4 0 0 0 2 3H4a4 4 0 0 0 2-3v-3a7 7 0 0 1 4-6M9 17v1a3 3 0 0 0 6 0v-1"},null,-1)])])}const fe=b({name:"tabler-bell",render:ze}),Ve={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function je(_,a){return i(),d("svg",Ve,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 0 0 2.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 0 0 1.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 0 0-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 0 0-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 0 0-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 0 0-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 0 0 1.066-2.573c-.94-1.543.826-3.31 2.37-2.37c1 .608 2.296.07 2.572-1.065"}),r("path",{d:"M9 12a3 3 0 1 0 6 0a3 3 0 0 0-6 0"})],-1)])])}const Le=b({name:"tabler-settings",render:je}),He={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Oe(_,a){return i(),d("svg",He,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M14 8V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h7a2 2 0 0 0 2-2v-2"}),r("path",{d:"M9 12h12l-3-3m0 6l3-3"})],-1)])])}const qe=b({name:"tabler-logout",render:Oe}),Je={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Fe(_,a){return i(),d("svg",Je,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"m6 9l6 6l6-6"},null,-1)])])}const Pe=b({name:"tabler-chevron-down",render:Fe}),Ue={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Ye(_,a){return i(),d("svg",Ue,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 3h.393a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 2.992z"},null,-1)])])}const Ge=b({name:"tabler-moon",render:Ye}),Ke={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Xe(_,a){return i(),d("svg",Ke,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 12a4 4 0 1 0 8 0a4 4 0 1 0-8 0m-5 0h1m8-9v1m8 8h1m-9 8v1M5.6 5.6l.7.7m12.1-.7l-.7.7m0 11.4l.7.7m-12.1-.7l-.7.7"},null,-1)])])}const Qe=b({name:"tabler-sun",render:Xe}),We={class:"text-flip","aria-hidden":"true"},Ze={__name:"TextFlip",props:{text:{type:String,required:!0},duration:{type:Number,default:600},stagger:{type:Number,default:60}},setup(_){const a=_,u=H(()=>Array.from(a.text));return(S,M)=>(i(),d("span",We,[(i(!0),d(ce,null,me(u.value,(c,f)=>(i(),d("span",{key:f+"-"+c,class:"flip-char",style:ke({"--delay":`${f*_.stagger}ms`,"--dur":`${_.duration}ms`})},N(c),5))),128))]))}},et=te(Ze,[["__scopeId","data-v-49aa6d28"]]),tt={class:"header-left"},ot={class:"app-title"},st={class:"header-right"},nt={class:"notification-header"},at={class:"notification-list"},rt={key:0,class:"empty-notifications"},lt=["onClick"],it={class:"notification-content"},ut={class:"notification-title"},dt={class:"notification-message"},ct={class:"notification-time"},mt={key:0,class:"notification-dot"},_t={key:1,class:"empty-notifications"},pt={class:"notif-dialog-toolbar"},ht={class:"notif-dialog-list"},vt={key:0,class:"empty-notifications"},ft={key:1},gt=["onClick"],kt={class:"notification-title"},yt={class:"notification-message"},wt={class:"notification-time"},bt={class:"notification-actions"},xt={key:0,class:"notification-dot"},St={key:0,class:"empty-notifications"},At={class:"user-info"},Mt={class:"username"},ge="notifications_read_map",$t={__name:"AppHeader",emits:["toggle-sidebar"],setup(_,{emit:a}){"false".toLowerCase();const u=be(),S=ye(),M=$(0),c=$([]),f=$(!1),B=$(!1),I=$("all"),R=H(()=>({all:c.value.length,task:c.value.filter(e=>e.type==="task").length,system:c.value.filter(e=>e.type==="system").length,report:c.value.filter(e=>e.type==="report").length})),Y=H(()=>I.value==="all"?c.value:c.value.filter(e=>e.type===I.value)),oe=()=>{},l=$({}),o=()=>{try{l.value=JSON.parse(localStorage.getItem(ge)||"{}")}catch{l.value={}}},x=()=>{try{localStorage.setItem(ge,JSON.stringify(l.value))}catch{}},g=H(()=>{var n;const e=((n=S.user)==null?void 0:n.avatar_url)||"";return console.log("[AppHeader] userAvatar:",e,"user:",S.user),e}),w=H(()=>{var n;const e=S.user;return e?e.full_name?e.full_name.charAt(0).toUpperCase():((n=e.username)==null?void 0:n.charAt(0).toUpperCase())||"U":""}),J=()=>{sidebarCollapsed.value=!sidebarCollapsed.value},O=$(localStorage.getItem("theme")==="dark"),G=e=>{const n=document.documentElement;e?(n.classList.add("dark-mode"),n.style.setProperty("color-scheme","dark")):(n.classList.remove("dark-mode"),n.style.setProperty("color-scheme","light")),localStorage.setItem("theme",e?"dark":"light")},se=()=>{O.value=!O.value,G(O.value)};G(O.value);const ne=async e=>{switch(e){case"profile":u.push("/profile");break;case"settings":u.push("/settings");break;case"logout":try{await Ae.confirm("确定要退出登录吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await S.logout(),u.push("/login")}catch{}break}},ae=e=>{switch(e){case"viewAll":B.value=!0;break}},F=e=>{e.is_read=!0,l.value[e.id]=!0,x(),z(),he([e.id])},K=e=>{var n,k;switch(F(e),e.type){case"task":(n=e.meta)!=null&&n.taskId?u.push({path:"/tasks",query:{openTaskId:e.meta.taskId}}):u.push("/tasks");break;case"report":(k=e.meta)!=null&&k.date?u.push({path:"/reports",query:{date:e.meta.date}}):u.push("/reports");break;case"system":de.info(e.message);break}},re=e=>{var n;try{(n=e==null?void 0:e.meta)!=null&&n.taskId?(F(e),u.push({path:"/tasks",query:{openTaskId:e.meta.taskId}})):u.push("/tasks")}catch(k){console.error("跳转完成任务失败：",k),de.error("打开任务完成入口失败")}},X=()=>{c.value.forEach(e=>{e.is_read=!0,l.value[e.id]=!0}),x(),z(),he(c.value.map(e=>e.id)),de.success("所有通知已标记为已读")},z=()=>{M.value=c.value.filter(e=>!e.is_read).length},Q=e=>{const n=typeof e=="string"?new Date(e):e,y=new Date-n,V=Math.floor(y/(1e3*60)),T=Math.floor(y/(1e3*60*60)),j=Math.floor(y/(1e3*60*60*24));return V<1?"刚刚":V<60?`${V}分钟前`:T<24?`${T}小时前`:j<7?`${j}天前`:n.toLocaleDateString()},W=async()=>{var e;if(!S.isAuthenticated){c.value=[],z();return}f.value=!0;try{const n=[],y=(await Z.get("/tasks",{params:{page:1,size:50},suppressErrorMessage:!0})).data,V=Array.isArray(y)?y:y.items||y.data||[],T=new Date,j=24*60*60*1e3;V.forEach(p=>{if(p.is_completed===!0||p.status==="done"||!p.due_date)return;const E=new Date(p.due_date),q=E.getTime()-T.getTime(),U=q<0,ie=q>=0&&q<=j;!U&&!ie||n.push({id:`task-${p.id}`,title:U?"任务逾期":"任务提醒",message:U?`${p.title} 已逾期`:`${p.title} 将在24小时内到期`,type:"task",is_read:!1,created_at:E,meta:{taskId:p.id}})});const P=(e=S.user)==null?void 0:e.id;if(P){const p=new Date().toISOString().split("T")[0],E=(await Z.get("/reports",{params:{page:1,size:1,date_from:p,date_to:p,user_id:P},suppressErrorMessage:!0})).data;(Array.isArray(E)?E.length:(E.items||E.data||[]).length||0)===0&&n.push({id:`report-${p}`,title:"日报提醒",message:"今日日报尚未提交，请及时完成",type:"report",is_read:!1,created_at:new Date,meta:{date:p}})}c.value=n.sort((p,L)=>new Date(L.created_at)-new Date(p.created_at)),c.value.forEach(p=>{l.value[p.id]&&(p.is_read=!0)}),z()}catch(n){console.error("刷新通知失败：",n),c.value.length===0&&(c.value=[],z())}finally{f.value=!1}},pe=async()=>{var e;try{const n=await Z.get("/notifications/read-map",{suppressErrorMessage:!0});(((e=n==null?void 0:n.data)==null?void 0:e.ids)||[]).forEach(y=>{l.value[y]=!0}),x(),c.value.forEach(y=>{l.value[y.id]&&(y.is_read=!0)}),z()}catch{}},he=async e=>{if(!(!Array.isArray(e)||e.length===0))try{await Z.post("/notifications/read",{ids:e},{suppressErrorMessage:!0})}catch{}};_e(async()=>{o(),await pe(),await W()}),ee(()=>S.user,async()=>{o(),await pe(),await W()});let le;return _e(()=>{le=setInterval(()=>W(),5*60*1e3)}),xe(()=>{le&&clearInterval(le)}),(e,n)=>{const k=h("el-button"),y=h("el-badge"),V=h("el-divider"),T=h("el-icon"),j=h("el-dropdown-item"),P=h("el-dropdown-menu"),p=h("el-dropdown"),L=h("el-tab-pane"),E=h("el-tabs"),q=h("el-dialog"),U=h("el-avatar"),ie=h("el-header");return i(),C(ie,{class:"app-header"},{default:s(()=>[r("div",tt,[t(k,{type:"text",icon:D(Ne),class:"menu-toggle",onClick:J},null,8,["icon"]),t(k,{type:"text",icon:O.value?D(Qe):D(Ge),class:"theme-toggle",onClick:se},null,8,["icon"]),r("h1",ot,[t(et,{text:"OPSIGHT"})])]),r("div",st,[t(p,{onCommand:ae,trigger:"click"},{dropdown:s(()=>[t(P,null,{default:s(()=>[r("div",nt,[n[3]||(n[3]=r("span",null,"通知消息",-1)),t(k,{type:"text",size:"small",onClick:X},{default:s(()=>[...n[2]||(n[2]=[v("全部已读",-1)])]),_:1})]),t(V,{style:{margin:"8px 0"}}),r("div",at,[f.value?(i(),d("div",rt,"加载中…")):A("",!0),(i(!0),d(ce,null,me(c.value,m=>(i(),d("div",{key:m.id,class:ve(["notification-item",{unread:!m.is_read}]),onClick:ue=>K(m)},[r("div",it,[r("div",ut,N(m.title),1),r("div",dt,N(m.message),1),r("div",ct,N(Q(m.created_at)),1)]),m.is_read?A("",!0):(i(),d("div",mt))],10,lt))),128)),c.value.length===0&&!f.value?(i(),d("div",_t," 暂无通知消息 ")):A("",!0)]),t(V,{style:{margin:"8px 0"}}),t(j,{command:"viewAll"},{default:s(()=>[t(T,null,{default:s(()=>[t(D(fe))]),_:1}),n[4]||(n[4]=v(" 查看全部通知 ",-1))]),_:1})]),_:1})]),default:s(()=>[t(y,{value:M.value,hidden:M.value===0},{default:s(()=>[t(k,{type:"text",icon:D(fe),class:"header-button"},null,8,["icon"])]),_:1},8,["value","hidden"])]),_:1}),t(q,{modelValue:B.value,"onUpdate:modelValue":n[1]||(n[1]=m=>B.value=m),title:"通知消息",width:"560px"},{default:s(()=>[r("div",pt,[t(k,{text:"",size:"small",loading:f.value,onClick:W},{default:s(()=>[...n[5]||(n[5]=[v("刷新",-1)])]),_:1},8,["loading"]),t(k,{text:"",size:"small",onClick:X},{default:s(()=>[...n[6]||(n[6]=[v("全部已读",-1)])]),_:1})]),t(E,{modelValue:I.value,"onUpdate:modelValue":n[0]||(n[0]=m=>I.value=m),class:"notif-tabs",onTabChange:oe},{default:s(()=>[t(L,{label:`全部(${R.value.all})`,name:"all"},null,8,["label"]),t(L,{label:`任务提醒(${R.value.task})`,name:"task"},null,8,["label"]),t(L,{label:`系统通知(${R.value.system})`,name:"system"},null,8,["label"]),t(L,{label:`日报提醒(${R.value.report})`,name:"report"},null,8,["label"])]),_:1},8,["modelValue"]),r("div",ht,[f.value?(i(),d("div",vt,"加载中…")):(i(),d("div",ft,[(i(!0),d(ce,null,me(Y.value,m=>{var ue;return i(),d("div",{key:m.id,class:ve(["notification-item",{unread:!m.is_read}])},[r("div",{class:"notification-content",onClick:we=>K(m)},[r("div",kt,N(m.title),1),r("div",yt,N(m.message),1),r("div",wt,N(Q(m.created_at)),1)],8,gt),r("div",bt,[m.type==="task"&&((ue=m.meta)!=null&&ue.taskId)?(i(),C(k,{key:0,size:"small",type:"primary",text:"",onClick:Se(we=>re(m),["stop"])},{default:s(()=>[...n[7]||(n[7]=[v("完成",-1)])]),_:1},8,["onClick"])):A("",!0)]),m.is_read?A("",!0):(i(),d("div",xt))],2)}),128)),Y.value.length===0?(i(),d("div",St," 暂无通知消息 ")):A("",!0)]))])]),_:1},8,["modelValue"]),t(p,{onCommand:ne},{dropdown:s(()=>[t(P,null,{default:s(()=>[t(j,{command:"profile"},{default:s(()=>[t(T,null,{default:s(()=>[t(D(Be))]),_:1}),n[8]||(n[8]=v(" 个人资料 ",-1))]),_:1}),t(j,{divided:"",command:"logout"},{default:s(()=>[t(T,null,{default:s(()=>[t(D(qe))]),_:1}),n[9]||(n[9]=v(" 退出登录 ",-1))]),_:1})]),_:1})]),default:s(()=>{var m;return[r("div",At,[t(U,{size:32,src:g.value},{default:s(()=>[v(N(w.value),1)]),_:1},8,["src"]),r("span",Mt,N((m=D(S).user)==null?void 0:m.username),1),t(T,{class:"dropdown-icon"},{default:s(()=>[t(D(Pe))]),_:1})])]}),_:1})])]),_:1})}}},Ct=te($t,[["__scopeId","data-v-686275be"]]),Bt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function It(_,a){return i(),d("svg",Bt,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M3 3v18h18"}),r("path",{d:"M7 15a2 2 0 1 0 4 0a2 2 0 1 0-4 0m4-10a2 2 0 1 0 4 0a2 2 0 1 0-4 0m5 7a2 2 0 1 0 4 0a2 2 0 1 0-4 0m5-9l-6 1.5m-.887 2.15l2.771 3.695M16 12.5l-5 2"})],-1)])])}const Tt=b({name:"tabler-chart-dots2",render:It}),Et={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Dt(_,a){return i(),d("svg",Et,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M5 6a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1z"}),r("path",{d:"M9 9h6v6H9zm-6 1h2m-2 4h2m5-11v2m4-2v2m7 5h-2m2 4h-2m-5 7v-2m-4 2v-2"})],-1)])])}const Nt=b({name:"tabler-cpu",render:Dt}),Rt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function zt(_,a){return i(),d("svg",Rt,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 7a4 4 0 1 0 8 0a4 4 0 1 0-8 0M3 21v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2m1-17.87a4 4 0 0 1 0 7.75M21 21v-2a4 4 0 0 0-3-3.85"},null,-1)])])}const Vt=b({name:"tabler-users",render:zt}),jt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Lt(_,a){return i(),d("svg",jt,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M3 21h4L20 8a1.5 1.5 0 0 0-4-4L3 17zM14.5 5.5l4 4"}),r("path",{d:"M12 8L7 3L3 7l5 5M7 8L5.5 9.5M16 12l5 5l-4 4l-5-5m4 1l-1.5 1.5"})],-1)])])}const Ht=b({name:"tabler-tools",render:Lt}),Ot={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function qt(_,a){return i(),d("svg",Ot,[...a[0]||(a[0]=[r("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[r("path",{d:"M19 4v16H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2z"}),r("path",{d:"M19 16H7a2 2 0 0 0-2 2M9 8h6"})],-1)])])}const Jt=b({name:"tabler-book2",render:qt}),Ft={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Pt(_,a){return i(),d("svg",Ft,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.615 20H7a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8m-3 5l2 2l4-4M9 8h4m-4 4h2"},null,-1)])])}const Ut=b({name:"tabler-checklist",render:Pt}),Yt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Gt(_,a){return i(),d("svg",Yt,[...a[0]||(a[0]=[r("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 4h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1m0 12h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1v-2a1 1 0 0 1 1-1m10-4h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-6a1 1 0 0 1 1-1m0-8h4a1 1 0 0 1 1 1v2a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1"},null,-1)])])}const Kt=b({name:"tabler-layout-dashboard",render:Gt}),Xt={class:"sidebar-content"},Qt={__name:"AppSidebar",props:{collapsed:{type:Boolean,default:!1}},setup(_){const a=Me(),u=ye(),S=H(()=>a.path),M=$(null),c=()=>{try{const l=JSON.parse(localStorage.getItem("user")||"null");M.value=l,console.log("User state updated:",l)}catch(l){console.error("Error parsing user from localStorage:",l),M.value=null}},f=H(()=>{if(u.user&&u.user.role){const o=u.user.role==="super_admin";return console.log("isSuperAdmin computed (authStore):",{user:u.user.username,role:u.user.role,isSuperAdmin:o}),o}const l=M.value;if(l&&l.role){const o=l.role==="super_admin";return console.log("isSuperAdmin computed (userState):",{user:l.username,role:l.role,isSuperAdmin:o}),o}try{const o=JSON.parse(localStorage.getItem("user")||"null"),x=o&&o.role==="super_admin";return console.log("isSuperAdmin computed (localStorage):",{user:o==null?void 0:o.username,role:o==null?void 0:o.role,isSuperAdmin:x}),x}catch(o){return console.error("Error reading from localStorage:",o),!1}}),B=H(()=>{if(u.user&&u.user.role){const o=u.user.role==="admin"||u.user.role==="super_admin";return console.log("isAdmin computed (authStore):",{user:u.user.username,role:u.user.role,isAdmin:o}),o}const l=M.value;if(l&&l.role){const o=l.role==="admin"||l.role==="super_admin";return console.log("isAdmin computed (userState):",{user:l.username,role:l.role,isAdmin:o}),o}try{const o=JSON.parse(localStorage.getItem("user")||"null"),x=o&&(o.role==="admin"||o.role==="super_admin");return console.log("isAdmin computed (localStorage):",{user:o==null?void 0:o.username,role:o==null?void 0:o.role,isAdmin:x}),x}catch(o){return console.error("Error reading from localStorage:",o),!1}});_e(()=>{console.log("AppSidebar mounted"),c(),window.addEventListener("storage",c),console.log("AuthStore state:",{user:u.user,isAuthenticated:u.isAuthenticated,isAdmin:u.isAdmin,isSuperAdmin:u.isSuperAdmin}),u.user||(console.log("No user in authStore, calling initAuth..."),u.initAuth())}),ee(()=>u.user,l=>{console.log("AuthStore user changed:",l),l?M.value=l:c()},{immediate:!0}),ee(f,l=>{console.log("isSuperAdmin changed:",l)},{immediate:!0}),ee(B,l=>{console.log("isAdmin changed:",l)},{immediate:!0});const I=$(null),R=$({}),Y=l=>{var o;try{const g=(((o=I.value)==null?void 0:o.$el)||I.value||l.currentTarget).getBoundingClientRect(),w=l.clientX-g.left,J=l.clientY-g.top;R.value={"--sb-x":`${w}px`,"--sb-y":`${J}px`}}catch{}},oe=()=>{R.value={}};return(l,o)=>{const x=Kt,g=h("el-icon"),w=h("el-menu-item"),J=Ut,O=Te,G=Ie,se=Jt,ne=Le,ae=Ht,F=Vt,K=Nt,re=Tt,X=h("el-sub-menu"),z=h("el-menu"),Q=h("el-aside");return i(),C(Q,{width:_.collapsed?"64px":"240px",class:"app-sidebar",ref_key:"asideRef",ref:I,style:ke(R.value),onMousemove:Y,onMouseleave:oe},{default:s(()=>[r("div",Xt,[t(z,{"default-active":S.value,collapse:_.collapsed,"unique-opened":!0,class:"sidebar-menu",router:""},{default:s(()=>[t(w,{index:"/dashboard"},{title:s(()=>[...o[0]||(o[0]=[v("仪表板",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(x)]),_:1})]),_:1}),t(w,{index:"/tasks"},{title:s(()=>[...o[1]||(o[1]=[v("任务管理",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(J)]),_:1})]),_:1}),t(w,{index:"/reports"},{title:s(()=>[...o[2]||(o[2]=[v("日报管理",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(O)]),_:1})]),_:1}),t(w,{index:"/analytics"},{title:s(()=>[...o[3]||(o[3]=[v("数据分析",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(G)]),_:1})]),_:1}),B.value?(i(),C(w,{key:0,index:"/knowledge-base"},{title:s(()=>[...o[4]||(o[4]=[v("知识库",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(se)]),_:1})]),_:1})):A("",!0),f.value?(i(),C(w,{key:1,index:"/settings"},{title:s(()=>[...o[5]||(o[5]=[v("设置",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(ne)]),_:1})]),_:1})):A("",!0),B.value?(i(),C(X,{key:2,index:"admin-menu"},{title:s(()=>[t(g,null,{default:s(()=>[t(ae)]),_:1}),o[6]||(o[6]=r("span",null,"管理功能",-1))]),default:s(()=>[f.value?(i(),C(w,{key:0,index:"/admin/users"},{title:s(()=>[...o[7]||(o[7]=[v("用户管理",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(F)]),_:1})]),_:1})):A("",!0),t(w,{index:"/admin/groups"},{title:s(()=>[...o[8]||(o[8]=[v("组别管理",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(F)]),_:1})]),_:1}),f.value?(i(),C(w,{key:1,index:"/admin/ai"},{title:s(()=>[...o[9]||(o[9]=[v("AI配置",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(K)]),_:1})]),_:1})):A("",!0),f.value?(i(),C(w,{key:2,index:"/admin/metrics"},{title:s(()=>[...o[10]||(o[10]=[v("自定义指标",-1)])]),default:s(()=>[t(g,null,{default:s(()=>[t(re)]),_:1})]),_:1})):A("",!0)]),_:1})):A("",!0)]),_:1},8,["default-active","collapse"])])]),_:1},8,["width","style"])}}},Wt=te(Qt,[["__scopeId","data-v-6e1d9d23"]]),Zt={__name:"AppLayout",setup(_){const a=$(!0),u=()=>{a.value=!a.value};return(S,M)=>{const c=h("router-view"),f=h("el-main"),B=h("el-container"),I=$e("click-spark");return i(),C(B,{class:"app-layout"},{default:s(()=>[t(Wt,{collapsed:a.value},null,8,["collapsed"]),t(B,{class:"main-container"},{default:s(()=>[t(Ct,{onToggleSidebar:u}),Ce((i(),C(f,{class:"app-main bubble-bg"},{default:s(()=>[t(c)]),_:1})),[[I,{color:"rgb(153,255,133)"}]])]),_:1})]),_:1})}}},no=te(Zt,[["__scopeId","data-v-7477194b"]]);export{no as default};
