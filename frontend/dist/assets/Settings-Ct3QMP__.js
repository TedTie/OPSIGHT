import{r as g,L as z,o as M,l as P,f as r,g as a,w as t,b as m,P as _,e as C,F as j,n as G,d as $,k as y,E as i,y as J}from"./index-g0Sg6k74.js";import{_ as K}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Y={class:"page-container"},H={class:"data-management"},Q={class:"management-item"},W={class:"management-item"},X={class:"management-item"},Z={__name:"Settings",setup(ee){const f=g(!1),v=g(!1),b=g(!1),k=g(!1),V=g(),x=g(),s=z({provider:"openrouter",api_key:"",base_url:"https://openrouter.ai/api/v1",default_model:"openai/gpt-5",max_tokens:2e3,temperature:.7}),d=z({system_name:"KillerApp",timezone:"Asia/Shanghai",language:"zh-CN",auto_analysis:!0,data_retention_days:90}),R=g([{label:"Google Gemini 2.5 Pro",value:"google/gemini-2.5-pro"},{label:"OpenAI GPT-5",value:"openai/gpt-5"},{label:"DeepSeek Chat v3.1",value:"deepseek/deepseek-chat-v3.1"}]),T={provider:[{required:!0,message:"请选择API提供商",trigger:"change"}],api_key:[{required:!0,message:"请输入API密钥",trigger:"blur"}],default_model:[{required:!0,message:"请选择默认模型",trigger:"change"}]},h={system_name:[{required:!0,message:"请输入系统名称",trigger:"blur"}],timezone:[{required:!0,message:"请选择时区",trigger:"change"}],language:[{required:!0,message:"请选择语言",trigger:"change"}]},U=async()=>{try{const l=await _.get("/settings/ai");Object.assign(s,{provider:l.data.provider,api_key:l.data.api_key,base_url:l.data.base_url,default_model:l.data.model_name,max_tokens:l.data.max_tokens,temperature:l.data.temperature});const e=await _.get("/settings/system");Object.assign(d,{system_name:e.data.system_name,timezone:e.data.timezone,language:e.data.language,auto_analysis:e.data.auto_analysis,data_retention_days:e.data.data_retention_days})}catch(l){console.error("获取设置失败:",l)}},F=async()=>{var l,e;if(V.value)try{await V.value.validate(),f.value=!0;const o={provider:s.provider,api_key:s.api_key,base_url:s.base_url,model_name:s.default_model,max_tokens:s.max_tokens,temperature:s.temperature};await _.put("/settings/ai",o),i.success("AI设置保存成功")}catch(o){(e=(l=o.response)==null?void 0:l.data)!=null&&e.detail?i.error(o.response.data.detail):i.error("保存失败")}finally{f.value=!1}},B=async()=>{var l,e;if(x.value)try{await x.value.validate(),f.value=!0;const o={system_name:d.system_name,timezone:d.timezone,language:d.language,auto_analysis:d.auto_analysis,data_retention_days:d.data_retention_days};await _.put("/settings/system",o),i.success("系统设置保存成功")}catch(o){(e=(l=o.response)==null?void 0:l.data)!=null&&e.detail?i.error(o.response.data.detail):i.error("保存失败")}finally{f.value=!1}},E=async()=>{var l,e;if(!s.api_key){i.warning("请先输入API密钥");return}v.value=!0;try{const o={provider:s.provider,api_key:s.api_key,base_url:s.base_url,model_name:s.default_model,max_tokens:100,temperature:s.temperature},p=await _.post("/settings/ai/test",o);p.data.success?i.success(`连接测试成功: ${p.data.response}`):i.error(`连接测试失败: ${p.data.message}`)}catch(o){(e=(l=o.response)==null?void 0:l.data)!=null&&e.detail?i.error(`连接测试失败: ${o.response.data.detail}`):i.error("连接测试失败")}finally{v.value=!1}},q=async()=>{b.value=!0;try{const l=await _.get("/settings/export");i.success(l.data.message)}catch(l){i.error("导出数据失败"),console.error("Export data error:",l)}finally{b.value=!1}},N=async()=>{k.value=!0;try{await _.post("/settings/clear-cache"),i.success("缓存清理成功")}catch(l){i.error("清理缓存失败"),console.error("Clear cache error:",l)}finally{k.value=!1}},D=async()=>{try{await J.confirm("确定要重置所有设置吗？此操作不可恢复。","确认重置",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _.post("/settings/reset"),i.success("设置重置成功"),await U()}catch(l){l!=="cancel"&&(i.error("设置重置失败"),console.error("Reset settings error:",l))}};return M(()=>{U()}),(l,e)=>{const o=m("el-option"),p=m("el-select"),u=m("el-form-item"),w=m("el-input"),I=m("el-input-number"),L=m("el-slider"),c=m("el-button"),S=m("el-form"),A=m("el-card"),O=m("el-switch");return C(),P("div",Y,[e[25]||(e[25]=r("div",{class:"page-header"},[r("h1",{class:"page-title"},"系统设置"),r("p",{class:"page-description"},"配置系统参数和AI服务")],-1)),a(A,{class:"content-card"},{header:t(()=>[...e[11]||(e[11]=[r("div",{class:"card-header"},[r("span",null,"AI服务配置")],-1)])]),default:t(()=>[a(S,{ref_key:"aiFormRef",ref:V,model:s,rules:T,"label-width":"120px"},{default:t(()=>[a(u,{label:"API提供商",prop:"provider"},{default:t(()=>[a(p,{modelValue:s.provider,"onUpdate:modelValue":e[0]||(e[0]=n=>s.provider=n),placeholder:"选择AI服务提供商"},{default:t(()=>[a(o,{label:"OpenRouter",value:"openrouter"}),a(o,{label:"OpenAI",value:"openai"}),a(o,{label:"Claude",value:"claude"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"API密钥",prop:"api_key"},{default:t(()=>[a(w,{modelValue:s.api_key,"onUpdate:modelValue":e[1]||(e[1]=n=>s.api_key=n),type:"password",placeholder:"请输入API密钥","show-password":""},null,8,["modelValue"])]),_:1}),a(u,{label:"API基础URL",prop:"base_url"},{default:t(()=>[a(w,{modelValue:s.base_url,"onUpdate:modelValue":e[2]||(e[2]=n=>s.base_url=n),placeholder:"API基础URL（可选）"},null,8,["modelValue"])]),_:1}),a(u,{label:"默认模型",prop:"default_model"},{default:t(()=>[a(p,{modelValue:s.default_model,"onUpdate:modelValue":e[3]||(e[3]=n=>s.default_model=n),placeholder:"选择默认模型",filterable:"","allow-create":""},{default:t(()=>[(C(!0),P(j,null,G(R.value,n=>(C(),$(o,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"最大Token数",prop:"max_tokens"},{default:t(()=>[a(I,{modelValue:s.max_tokens,"onUpdate:modelValue":e[4]||(e[4]=n=>s.max_tokens=n),min:100,max:8e3,step:100,placeholder:"最大Token数"},null,8,["modelValue"])]),_:1}),a(u,{label:"温度参数",prop:"temperature"},{default:t(()=>[a(L,{modelValue:s.temperature,"onUpdate:modelValue":e[5]||(e[5]=n=>s.temperature=n),min:0,max:2,step:.1,"show-input":"","input-size":"small"},null,8,["modelValue"])]),_:1}),a(u,null,{default:t(()=>[a(c,{type:"primary",onClick:F,loading:f.value},{default:t(()=>[...e[12]||(e[12]=[y(" 保存配置 ",-1)])]),_:1},8,["loading"]),a(c,{onClick:E,loading:v.value},{default:t(()=>[...e[13]||(e[13]=[y(" 测试连接 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(A,{class:"content-card"},{header:t(()=>[...e[14]||(e[14]=[r("div",{class:"card-header"},[r("span",null,"系统配置")],-1)])]),default:t(()=>[a(S,{ref_key:"systemFormRef",ref:x,model:d,rules:h,"label-width":"120px"},{default:t(()=>[a(u,{label:"系统名称",prop:"system_name"},{default:t(()=>[a(w,{modelValue:d.system_name,"onUpdate:modelValue":e[6]||(e[6]=n=>d.system_name=n),placeholder:"系统名称"},null,8,["modelValue"])]),_:1}),a(u,{label:"时区设置",prop:"timezone"},{default:t(()=>[a(p,{modelValue:d.timezone,"onUpdate:modelValue":e[7]||(e[7]=n=>d.timezone=n),placeholder:"选择时区"},{default:t(()=>[a(o,{label:"北京时间 (UTC+8)",value:"Asia/Shanghai"}),a(o,{label:"东京时间 (UTC+9)",value:"Asia/Tokyo"}),a(o,{label:"纽约时间 (UTC-5)",value:"America/New_York"}),a(o,{label:"伦敦时间 (UTC+0)",value:"Europe/London"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"语言设置",prop:"language"},{default:t(()=>[a(p,{modelValue:d.language,"onUpdate:modelValue":e[8]||(e[8]=n=>d.language=n),placeholder:"选择语言"},{default:t(()=>[a(o,{label:"简体中文",value:"zh-CN"}),a(o,{label:"English",value:"en-US"}),a(o,{label:"日本語",value:"ja-JP"})]),_:1},8,["modelValue"])]),_:1}),a(u,{label:"自动分析",prop:"auto_analysis"},{default:t(()=>[a(O,{modelValue:d.auto_analysis,"onUpdate:modelValue":e[9]||(e[9]=n=>d.auto_analysis=n),"active-text":"开启","inactive-text":"关闭"},null,8,["modelValue"]),e[15]||(e[15]=r("div",{class:"form-help-text"}," 开启后，系统将自动对新提交的日报进行AI分析 ",-1))]),_:1}),a(u,{label:"数据保留期",prop:"data_retention_days"},{default:t(()=>[a(I,{modelValue:d.data_retention_days,"onUpdate:modelValue":e[10]||(e[10]=n=>d.data_retention_days=n),min:30,max:365,placeholder:"数据保留天数"},null,8,["modelValue"]),e[16]||(e[16]=r("div",{class:"form-help-text"}," 超过此天数的数据将被自动清理 ",-1))]),_:1}),a(u,null,{default:t(()=>[a(c,{type:"primary",onClick:B,loading:f.value},{default:t(()=>[...e[17]||(e[17]=[y(" 保存配置 ",-1)])]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1}),a(A,{class:"content-card"},{header:t(()=>[...e[18]||(e[18]=[r("div",{class:"card-header"},[r("span",null,"数据管理")],-1)])]),default:t(()=>[r("div",H,[r("div",Q,[e[20]||(e[20]=r("div",{class:"item-info"},[r("h4",null,"导出数据"),r("p",null,"导出所有任务和日报数据")],-1)),a(c,{type:"primary",onClick:q,loading:b.value},{default:t(()=>[...e[19]||(e[19]=[y(" 导出数据 ",-1)])]),_:1},8,["loading"])]),r("div",W,[e[22]||(e[22]=r("div",{class:"item-info"},[r("h4",null,"清理缓存"),r("p",null,"清理系统缓存和临时文件")],-1)),a(c,{onClick:N,loading:k.value},{default:t(()=>[...e[21]||(e[21]=[y(" 清理缓存 ",-1)])]),_:1},8,["loading"])]),r("div",X,[e[24]||(e[24]=r("div",{class:"item-info"},[r("h4",null,"重置设置"),r("p",null,"将所有设置恢复为默认值")],-1)),a(c,{type:"danger",onClick:D},{default:t(()=>[...e[23]||(e[23]=[y(" 重置设置 ",-1)])]),_:1})])])]),_:1})])}}},le=K(Z,[["__scopeId","data-v-02bb84de"]]);export{le as default};
