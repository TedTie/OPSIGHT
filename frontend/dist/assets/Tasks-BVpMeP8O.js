import{m as wt,c,o as i,a as C,_ as zt,d as At,e as j,C as re,b as Tt,w as Le,f as Qe,z as Ut,k as t,j as o,h as z,x as T,E as x,u as St,A as Ge,B as M,l as f,p as r,i as g,t as p,F as V,r as O,q as v,y as te}from"./index-D85A-Gbf.js";import{P as $t}from"./plus-D71D2uAo.js";import{S as Mt}from"./search-CNhkWBrQ.js";import{R as Dt}from"./refresh-CdRpkY-J.js";import{C as Je}from"./check-BSiTM46G.js";import{a as K}from"./date-qiPTsFx8.js";const Bt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function It(We,_){return i(),c("svg",Bt,[..._[0]||(_[0]=[C("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M18 6L6 18M6 6l12 12"},null,-1)])])}const Ke=wt({name:"tabler-x",render:It}),Rt={class:"page-container"},Et={class:"card-header"},Pt={class:"table-toolbar"},Ft={class:"table-filters"},Yt={class:"admin-actions"},Nt={class:"table-actions"},Ot={key:0},Ht={key:1},Lt={key:2},Qt={key:3},Gt={key:4},Jt={class:"pagination-container"},Kt={key:0,style:{"margin-top":"10px"}},Wt={class:"dialog-footer"},Xt={key:0,class:"task-detail"},Zt={style:{display:"flex",gap:"12px","align-items":"center"}},el={class:"jielong-config-info"},tl={key:0,class:"participation-records"},ll={key:0,class:"amount-records"},al={style:{"margin-bottom":"8px",display:"flex",gap:"12px","align-items":"center"}},nl={key:1,class:"quantity-records"},ol={style:{"margin-bottom":"8px",display:"flex",gap:"12px","align-items":"center"}},ul={key:2,class:"jielong-entries"},il={style:{"margin-bottom":"8px",display:"flex",gap:"12px","align-items":"center"}},rl={key:1,class:"participation-records"},sl={style:{"margin-bottom":"8px",display:"flex",gap:"12px","align-items":"center"}},dl={style:{"margin-left":"8px"}},pl={style:{"margin-left":"8px"}},_l={class:"dialog-footer"},ml={__name:"Tasks",setup(We){const _=At();St();const Xe=Ut(),me=j(!1),Se=j([]),$e=j([]),se=j([]),W=j([]),Y=re({status:"",priority:"",task_type:"",search:""}),H=re({page:1,size:20,total:0}),le=j(!1),ge=j(!1),de=j(!1),Ze=j("basic"),ae=j(!1),ce=j(!1),ne=j(),et=j(["重要","紧急","日常","项目","会议","学习","沟通"]),d=re({title:"",description:"",tags:[],task_type:"checkbox",priority:"medium",assignment_type:"user",assigned_to:null,target_group_id:null,target_identity:"",due_date:"",target_amount:null,target_quantity:null,jielong_target_count:null,jielong_config:{}}),U=re({id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"}),n=j(null),ye=j([]),fe=j(!1),R=j("mine"),Q=j([]),q=j(null),ve=j([]),be=j([]),ke=j([]),Ve=j(!1),je=j(!1),xe=j(!1),E=j("mine"),P=j("mine"),F=j("mine");Tt({get(){var e;const a=(e=n.value)==null?void 0:e.task_type;return a==="jielong"?R.value:a==="amount"?E.value:a==="quantity"?P.value:a==="checkbox"?F.value:"mine"},set(a){var u;const e=(u=n.value)==null?void 0:u.task_type;e==="jielong"?(R.value=a,qe()):e==="amount"?(E.value=a,he()):e==="quantity"?(P.value=a,ze()):e==="checkbox"&&(F.value=a,Te())}});const tt=async()=>{if(!(_.isAdmin||_.isSuperAdmin)){Q.value=[],q.value=null;return}try{const a=await T.get("/users",{params:{page:1,size:200}}),e=a.data.items||a.data||[];Q.value=e.map(u=>({id:u.id,username:u.username}))}catch(a){console.error("加载用户列表失败:",a),Q.value=[]}},oe=()=>{var a;(a=n.value)!=null&&a.id&&(n.value.task_type==="jielong"?pe(n.value.id):n.value.task_type==="amount"?Ce(n.value.id):n.value.task_type==="quantity"?we(n.value.id):n.value.task_type==="checkbox"&&Ae(n.value.id),X())},k=re({id:null,title:"",task_type:"",target_amount:null,target_quantity:null,completion_note:"",completed_amount:null,completed_quantity:null}),lt={title:[{required:!0,message:"请输入任务标题",trigger:"blur"},{min:2,max:100,message:"标题长度在 2 到 100 个字符",trigger:"blur"}],description:[{required:!0,message:"请输入任务描述",trigger:"blur"}],task_type:[{required:!0,message:"请选择任务类型",trigger:"change"}],priority:[{required:!0,message:"请选择优先级",trigger:"change"}],assignment_type:[{required:!0,message:"请选择分配类型",trigger:"change"}],target_amount:[{required:!0,message:"请输入目标金额",trigger:"blur"}],target_quantity:[{required:!0,message:"请输入目标数量",trigger:"blur"}],jielong_target_count:[{required:!0,message:"请输入目标接龙数量",trigger:"blur"}]},Me=a=>({pending:"warning",processing:"primary",done:"success"})[a]||"info",De=a=>({pending:"待处理",processing:"进行中",done:"已完成"})[a]||a,Be=a=>({low:"info",medium:"warning",high:"danger",urgent:"danger",1:"info",2:"warning",3:"danger",4:"danger"})[a]||"info",Ie=a=>({low:"低",medium:"中",high:"高",urgent:"紧急",1:"低",2:"中",3:"高",4:"紧急"})[a]||a,Re=a=>({amount:"success",quantity:"primary",jielong:"warning",checkbox:"info"})[a]||"info",Ee=a=>({amount:"金额",quantity:"数量",jielong:"接龙",checkbox:"勾选"})[a]||a,at=a=>{d.target_amount=null,d.target_quantity=null,d.jielong_target_count=null,d.jielong_config={},Object.assign(U,{id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"})},$=async()=>{var a,e;me.value=!0;try{const u=Object.fromEntries(Object.entries(Y).filter(([h,L])=>L!==""&&L!=null)),s={page:H.page,size:H.size,...u},w=await T.get("/tasks",{params:s}),B=m((a=w.data)==null?void 0:a.items,w.data,[]);Se.value=Array.isArray(B)?B:[];const b=(e=w.data)==null?void 0:e.total;H.total=typeof b=="number"?b:Array.isArray(B)?B.length:0}catch{x.error("获取任务列表失败")}finally{me.value=!1}},nt=async()=>{try{const a=await T.get("/users");$e.value=a.data.items||a.data||[]}catch(a){console.error("获取用户列表失败:",a)}},ot=async()=>{var a;try{const e=await T.get("/groups"),u=e.data.items||e.data||[];_.isSuperAdmin?se.value=u:_.isAdmin&&((a=_.user)!=null&&a.group_id)?se.value=u.filter(s=>s.id===_.user.group_id):se.value=[]}catch(e){console.error("获取组列表失败:",e)}},ut=()=>{ae.value=!1,le.value=!0},it=a=>{ae.value=!0,Object.assign(d,{id:parseInt(a.id),title:a.title,description:a.description,tags:a.tags||[],task_type:a.task_type||"checkbox",priority:a.priority,assignment_type:a.assignment_type,assigned_to:a.assigned_to,target_group_id:a.target_group_id,target_identity:a.target_identity,due_date:a.due_date,target_amount:a.target_amount,target_quantity:a.target_quantity,jielong_target_count:a.jielong_target_count,jielong_config:a.jielong_config||{}}),a.task_type==="jielong"&&a.jielong_config&&Object.assign(U,a.jielong_config),le.value=!0},X=async()=>{if(n.value)try{const a={};(_.isAdmin||_.isSuperAdmin)&&q.value&&(a.view_user_id=q.value),n.value.task_type==="jielong"?a.scope=R.value:n.value.task_type==="amount"?a.scope=E.value:n.value.task_type==="quantity"?a.scope=P.value:n.value.task_type==="checkbox"&&(a.scope=F.value);const e=await T.get(`/tasks/${n.value.id}`,{params:a});n.value=e.data,$()}catch{x.error("刷新任务详情失败")}},rt=()=>{ne.value&&ne.value.resetFields(),Object.assign(d,{title:"",description:"",tags:[],task_type:"checkbox",priority:"medium",assignment_type:"user",assigned_to:null,target_group_id:null,target_identity:"",due_date:"",target_amount:null,target_quantity:null,jielong_target_count:null,jielong_config:{}}),Object.assign(U,{id_enabled:!0,remark_enabled:!0,intention_enabled:!1,custom_field_enabled:!1,custom_field_name:"",custom_field_type:"text"})},st=async()=>{var a,e;if(ne.value)try{await ne.value.validate(),ce.value=!0;const u={...d};d.task_type==="jielong"&&(u.jielong_config={...U}),d.assignment_type==="group"&&d.target_group_id?u.assigned_group_ids=[d.target_group_id]:u.assigned_group_ids=[],d.assignment_type==="user"&&d.assigned_to?u.assigned_user_ids=[parseInt(d.assigned_to)]:u.assigned_user_ids=[],delete u.target_group_id,delete u.assigned_to,d.task_type!=="amount"&&delete u.target_amount,d.task_type!=="quantity"&&delete u.target_quantity,d.task_type!=="jielong"&&(delete u.jielong_target_count,delete u.jielong_config),ae.value?(await T.put(`/tasks/${d.id}`,u),x.success("任务更新成功")):(await T.post("/tasks",u),x.success("任务创建成功")),le.value=!1,$()}catch(u){(e=(a=u.response)==null?void 0:a.data)!=null&&e.detail?x.error(u.response.data.detail):x.error(ae.value?"更新失败":"创建失败")}finally{ce.value=!1}},dt=async a=>{try{await te.confirm(`确定要删除任务"${a.title}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await T.delete(`/tasks/${parseInt(a.id)}`),x.success("删除成功"),$()}catch(e){e!=="cancel"&&x.error("删除失败")}},pt=()=>{k.id=null,k.title="",k.task_type="",k.target_amount=null,k.target_quantity=null,k.completion_note="",k.completed_amount=null,k.completed_quantity=null},_t=async()=>{try{const a={status:"completed",completion_note:k.completion_note};k.task_type==="amount"&&k.completed_amount!==null&&(a.completed_amount=k.completed_amount),k.task_type==="quantity"&&k.completed_quantity!==null&&(a.completed_quantity=k.completed_quantity),await T.put(`/tasks/${parseInt(k.id)}/status`,a),x.success("任务已完成"),de.value=!1,$()}catch{x.error("完成任务失败")}},mt=a=>{W.value=a},gt=async()=>{try{const e=(await T.get("/tasks/stats")).data;await te.alert(`
      <div style="text-align: left;">
        <p><strong>任务总数：</strong>${e.total||0}</p>
        <p><strong>待处理：</strong>${e.pending||0}</p>
        <p><strong>进行中：</strong>${e.processing||0}</p>
        <p><strong>已完成：</strong>${e.completed||0}</p>
        <p><strong>高优先级：</strong>${e.high_priority||0}</p>
        <p><strong>紧急任务：</strong>${e.urgent||0}</p>
      </div>
      `,"任务统计",{dangerouslyUseHTMLString:!0,confirmButtonText:"确定"})}catch{x.error("获取任务统计失败")}},ct=()=>{if(W.value.length===0){x.warning("请先选择要分配的任务");return}te.prompt(`确定要批量分配这 ${W.value.length} 个任务吗？请输入目标用户ID：`,"批量分配任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+$/,inputErrorMessage:"请输入有效的用户ID"}).then(async({value:a})=>{try{const e=W.value.map(u=>u.id);await T.put("/tasks/batch-assign",{task_ids:e,assigned_to:parseInt(a)}),x.success("批量分配成功"),W.value=[],$()}catch{x.error("批量分配失败")}}).catch(()=>{})},yt=async a=>{try{const{value:e}=await te.prompt(`请输入参与金额（目标：${a.target_amount}，当前：${a.current_amount||0}）：`,"参与金额任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+(\.\d{1,2})?$/,inputErrorMessage:"请输入有效的金额",inputType:"number"}),u=parseFloat(e);if(u<=0){x.error("金额必须大于0");return}await T.post("/task-sync/sync-task-to-report",{task_id:a.id,amount:u,remark:""}),x.success("参与成功"),$()}catch(e){e!=="cancel"&&x.error("参与失败")}},ft=async a=>{try{const{value:e}=await te.prompt(`请输入参与数量（目标：${a.target_quantity}，当前：${a.current_quantity||0}）：`,"参与数量任务",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/^\d+$/,inputErrorMessage:"请输入有效的数量",inputType:"number"}),u=parseInt(e);if(u<=0){x.error("数量必须大于0");return}await T.post("/task-sync/sync-task-to-report",{task_id:a.id,quantity:u,remark:""}),x.success("参与成功"),$()}catch(e){e!=="cancel"&&x.error("参与失败")}},vt=async a=>{var e;try{const u=[],s=a.jielong_config||{};s.id_enabled&&u.push({label:"ID",key:"id",required:!0}),s.remark_enabled&&u.push({label:"备注",key:"remark",required:!1}),s.intention_enabled&&u.push({label:"意向",key:"intention",required:!1}),s.custom_field_enabled&&s.custom_field_name&&u.push({label:s.custom_field_name,key:"custom_field",required:!1,type:s.custom_field_type||"text"});const w=a.personal_jielong_current_count!==void 0&&a.personal_jielong_current_count!==null?a.personal_jielong_current_count:a.jielong_current_count||0,B=a.personal_jielong_target_count!==void 0&&a.personal_jielong_target_count!==null?a.personal_jielong_target_count:a.jielong_target_count||0,{value:b}=await te.prompt(`请输入您的ID（当前接龙：${w}/${B}）：`,"参与接龙",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:G=>!G||G.trim()===""?"ID不能为空":!0}),{value:h}=await te.prompt("请输入备注（可选）：","参与接龙",{confirmButtonText:"确定",cancelButtonText:"取消",inputType:"textarea"}).catch(()=>({value:""})),L={id:b.trim(),remark:h||"",intention:"",custom_field:""};await T.post(`/tasks/${a.id}/jielong`,L),x.success("接龙成功"),$(),((e=n.value)==null?void 0:e.id)===a.id&&(X(),pe(a.id))}catch(u){u!=="cancel"&&x.error("接龙失败")}},bt=async a=>{try{const e=!a.is_completed;await T.put(`/task-sync/sync-task-to-report/${a.id}`,{is_completed:e}),x.success(e?"任务已完成":"任务已取消完成"),$()}catch{x.error("操作失败")}};Le(U,a=>{d.task_type==="jielong"&&(d.jielong_config={...a})},{deep:!0});const Z=a=>a<.3?"#f56c6c":a<.7?"#e6a23c":"#67c23a",m=(...a)=>{for(const e of a)if(e!=null)return e},D=(a,e)=>{const u=Number(a)||0,s=Number(e);return!s||s<=0?0:u/s},pe=async a=>{var e;if(a){fe.value=!0;try{const u={};(_.isAdmin||_.isSuperAdmin)&&q.value?u.user_id=q.value:R.value==="mine"&&((e=_.user)!=null&&e.id)&&(u.user_id=_.user.id);const s=await T.get(`/tasks/${a}/jielong`,{params:u});ye.value=s.data.items||s.data||[]}catch(u){console.error("获取接龙记录失败:",u),ye.value=[]}finally{fe.value=!1}}},qe=()=>{var a;(a=n.value)!=null&&a.id&&(pe(n.value.id),X())},Ce=async a=>{var e;if(a){Ve.value=!0;try{const u={};(_.isAdmin||_.isSuperAdmin)&&q.value?u.user_id=q.value:E.value==="mine"&&((e=_.user)!=null&&e.id)&&(u.user_id=_.user.id);const s=await T.get(`/tasks/${a}/records`,{params:u});ve.value=s.data.items||s.data||[]}catch(u){console.error("获取金额记录失败:",u),ve.value=[]}finally{Ve.value=!1}}},he=()=>{var a;(a=n.value)!=null&&a.id&&(Ce(n.value.id),X())},we=async a=>{var e;if(a){je.value=!0;try{const u={};(_.isAdmin||_.isSuperAdmin)&&q.value?u.user_id=q.value:P.value==="mine"&&((e=_.user)!=null&&e.id)&&(u.user_id=_.user.id);const s=await T.get(`/tasks/${a}/records`,{params:u});be.value=s.data.items||s.data||[]}catch(u){console.error("获取数量记录失败:",u),be.value=[]}finally{je.value=!1}}},ze=()=>{var a;(a=n.value)!=null&&a.id&&(we(n.value.id),X())},Ae=async a=>{var e;if(a){xe.value=!0;try{const u={};(_.isAdmin||_.isSuperAdmin)&&q.value?u.user_id=q.value:F.value==="mine"&&((e=_.user)!=null&&e.id)&&(u.user_id=_.user.id);const s=await T.get(`/tasks/${a}/completions`,{params:u});ke.value=s.data.items||s.data||[]}catch(u){console.error("获取完成记录失败:",u),ke.value=[]}finally{xe.value=!1}}},Te=()=>{var a;(a=n.value)!=null&&a.id&&(Ae(n.value.id),X())},Pe=a=>{n.value=a,Ze.value="basic",ge.value=!0,tt(),a.task_type==="jielong"?(R.value="mine",pe(a.id)):a.task_type==="amount"?(E.value="mine",Ce(a.id)):a.task_type==="quantity"?(P.value="mine",we(a.id)):a.task_type==="checkbox"&&(F.value="mine",Ae(a.id)),X()},kt=async a=>{var e;if(a)try{const u=await T.get(`/tasks/${a}`,{params:{scope:"mine"}}),s=u.data||((e=u.data)==null?void 0:e.item)||u.data;s&&s.id?Pe(s):x.error("未找到任务详情")}catch{x.error("打开任务详情失败")}};Qe(()=>{$();const a=Number(Xe.query.openTaskId);a&&kt(a)});const Vt=a=>({user:"指定用户",group:"指定组",identity:"指定身份",all:"所有人"})[a]||a,jt=a=>{switch(a.assignment_type){case"user":return a.assigned_to_username||`用户ID: ${a.assigned_to}`;case"group":return a.target_group_name||`组ID: ${a.target_group_id}`;case"identity":return a.target_identity||"-";case"all":return"所有人";default:return"-"}};return Le(Y,()=>{H.page=1,$()},{deep:!0}),Qe(()=>{$(),(_.isAdmin||_.isSuperAdmin)&&nt(),ot()}),(a,e)=>{const u=z("el-button"),s=z("el-option"),w=z("el-select"),B=z("el-input"),b=z("el-table-column"),h=z("el-tag"),L=z("el-icon"),G=z("el-table"),xt=z("el-pagination"),Fe=z("el-card"),A=z("el-form-item"),ue=z("el-input-number"),_e=z("el-checkbox"),qt=z("el-date-picker"),Ye=z("el-form"),Ue=z("el-dialog"),y=z("el-descriptions-item"),S=z("el-radio-button"),J=z("el-radio-group"),ee=z("el-progress"),Ct=z("el-descriptions"),ht=z("el-alert"),N=Ge("can"),ie=Ge("loading");return i(),c("div",Rt,[e[88]||(e[88]=C("div",{class:"page-header"},[C("h1",{class:"page-title"},"任务管理"),C("p",{class:"page-description"},"管理和跟踪您的任务")],-1)),t(Fe,{class:"content-card"},{header:o(()=>[C("div",Et,[e[47]||(e[47]=C("span",null,"任务列表",-1)),M((i(),g(u,{type:"primary",icon:f($t),onClick:ut},{default:o(()=>[...e[46]||(e[46]=[r(" 创建任务 ",-1)])]),_:1},8,["icon"])),[[N,"tasks:create"]])])]),default:o(()=>[C("div",Pt,[C("div",Ft,[t(w,{modelValue:Y.status,"onUpdate:modelValue":e[0]||(e[0]=l=>Y.status=l),placeholder:"状态",clearable:""},{default:o(()=>[t(s,{label:"待处理",value:"pending"}),t(s,{label:"进行中",value:"processing"}),t(s,{label:"已完成",value:"done"})]),_:1},8,["modelValue"]),t(w,{modelValue:Y.priority,"onUpdate:modelValue":e[1]||(e[1]=l=>Y.priority=l),placeholder:"优先级",clearable:""},{default:o(()=>[t(s,{label:"低",value:"low"}),t(s,{label:"中",value:"medium"}),t(s,{label:"高",value:"high"}),t(s,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"]),t(w,{modelValue:Y.task_type,"onUpdate:modelValue":e[2]||(e[2]=l=>Y.task_type=l),placeholder:"任务类型",clearable:""},{default:o(()=>[t(s,{label:"金额",value:"amount"}),t(s,{label:"数量",value:"quantity"}),t(s,{label:"接龙",value:"jielong"}),t(s,{label:"勾选",value:"checkbox"})]),_:1},8,["modelValue"]),t(B,{modelValue:Y.search,"onUpdate:modelValue":e[3]||(e[3]=l=>Y.search=l),placeholder:"搜索任务...","prefix-icon":f(Mt),clearable:""},null,8,["modelValue","prefix-icon"])]),M((i(),c("div",Yt,[t(u,{type:"info",onClick:gt},{default:o(()=>[...e[48]||(e[48]=[r(" 任务统计 ",-1)])]),_:1}),M((i(),g(u,{type:"warning",onClick:ct,disabled:W.value.length===0},{default:o(()=>[r(" 批量分配 ("+p(W.value.length)+") ",1)]),_:1},8,["disabled"])),[[N,"tasks:assign"]])])),[[N,"tasks:manage:group"]]),C("div",Nt,[t(u,{icon:f(Dt),onClick:$},{default:o(()=>[...e[49]||(e[49]=[r("刷新",-1)])]),_:1},8,["icon"])])]),M((i(),g(G,{data:Se.value,stripe:"",style:{width:"100%"},onSelectionChange:mt},{default:o(()=>[M(t(b,{type:"selection",width:"55"},null,512),[[N,"tasks:assign"]]),t(b,{prop:"title",label:"标题","min-width":"200"}),t(b,{prop:"description",label:"描述","min-width":"300"}),t(b,{label:"任务类型",width:"100"},{default:o(({row:l})=>[t(h,{type:Re(l.task_type)},{default:o(()=>[r(p(Ee(l.task_type)),1)]),_:2},1032,["type"])]),_:1}),t(b,{label:"进度",width:"150"},{default:o(({row:l})=>[l.task_type==="amount"?(i(),c("div",Ot,p(l.current_amount||0)+" / "+p(l.target_amount||0),1)):l.task_type==="quantity"?(i(),c("div",Ht,p(l.current_quantity||0)+" / "+p(l.target_quantity||0),1)):l.task_type==="jielong"?(i(),c("div",Lt,p(l.personal_jielong_current_count!==void 0&&l.personal_jielong_current_count!==null?l.personal_jielong_current_count:l.jielong_current_count||0)+" / "+p(l.personal_jielong_target_count!==void 0&&l.personal_jielong_target_count!==null?l.personal_jielong_target_count:l.jielong_target_count||0),1)):l.task_type==="checkbox"?(i(),c("div",Qt,[l.is_completed?(i(),g(L,{key:0,color:"green"},{default:o(()=>[t(f(Je))]),_:1})):(i(),g(L,{key:1,color:"gray"},{default:o(()=>[t(f(Ke))]),_:1}))])):(i(),c("div",Gt,"-"))]),_:1}),t(b,{label:"标签",width:"150"},{default:o(({row:l})=>[(i(!0),c(V,null,O(l.tags||[],I=>(i(),g(h,{key:I,size:"small",style:{"margin-right":"4px"}},{default:o(()=>[r(p(I),1)]),_:2},1024))),128))]),_:1}),t(b,{prop:"status",label:"状态",width:"100"},{default:o(({row:l})=>[t(h,{type:Me(l.status)},{default:o(()=>[r(p(De(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"priority",label:"优先级",width:"100"},{default:o(({row:l})=>[t(h,{type:Be(l.priority)},{default:o(()=>[r(p(Ie(l.priority)),1)]),_:2},1032,["type"])]),_:1}),t(b,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:l})=>[r(p(f(K)(l.created_at)),1)]),_:1}),t(b,{label:"操作",width:"350",fixed:"right"},{default:o(({row:l})=>[t(u,{type:"info",size:"small",onClick:I=>Pe(l)},{default:o(()=>[...e[50]||(e[50]=[r(" 详情 ",-1)])]),_:1},8,["onClick"]),l.task_type==="checkbox"?M((i(),g(u,{key:0,type:l.is_completed?"success":"warning",size:"small",onClick:I=>bt(l),disabled:l.status==="done"},{default:o(()=>[r(p(l.is_completed?"已完成":"完成"),1)]),_:2},1032,["type","onClick","disabled"])),[[N,l,"task",{complete:!0}]]):l.task_type==="amount"?M((i(),g(u,{key:1,type:"success",size:"small",onClick:I=>yt(l),disabled:l.status==="done"},{default:o(()=>[...e[51]||(e[51]=[r(" 参与 ",-1)])]),_:1},8,["onClick","disabled"])),[[N,l,"task",{participate:!0}]]):l.task_type==="quantity"?M((i(),g(u,{key:2,type:"success",size:"small",onClick:I=>ft(l),disabled:l.status==="done"},{default:o(()=>[...e[52]||(e[52]=[r(" 参与 ",-1)])]),_:1},8,["onClick","disabled"])),[[N,l,"task",{participate:!0}]]):l.task_type==="jielong"?M((i(),g(u,{key:3,type:"success",size:"small",onClick:I=>vt(l),disabled:l.status==="done"},{default:o(()=>[...e[53]||(e[53]=[r(" 接龙 ",-1)])]),_:1},8,["onClick","disabled"])),[[N,l,"task",{participate:!0}]]):v("",!0),M((i(),g(u,{type:"primary",size:"small",onClick:I=>it(l)},{default:o(()=>[...e[54]||(e[54]=[r(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[N,l,"task",{edit:!0}]]),M((i(),g(u,{type:"danger",size:"small",onClick:I=>dt(l)},{default:o(()=>[...e[55]||(e[55]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])),[[N,l,"task",{delete:!0}]])]),_:1})]),_:1},8,["data"])),[[ie,me.value]]),C("div",Jt,[t(xt,{"current-page":H.page,"onUpdate:currentPage":e[4]||(e[4]=l=>H.page=l),"page-size":H.size,"onUpdate:pageSize":e[5]||(e[5]=l=>H.size=l),total:H.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:$},null,8,["current-page","page-size","total"])])]),_:1}),t(Ue,{modelValue:le.value,"onUpdate:modelValue":e[26]||(e[26]=l=>le.value=l),title:ae.value?"编辑任务":"创建任务",width:"700px",onClose:rt},{footer:o(()=>[C("span",Wt,[t(u,{onClick:e[25]||(e[25]=l=>le.value=!1)},{default:o(()=>[...e[56]||(e[56]=[r("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:st,loading:ce.value},{default:o(()=>[r(p(ae.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:o(()=>[t(Ye,{ref_key:"formRef",ref:ne,model:d,rules:lt,"label-width":"120px"},{default:o(()=>[t(A,{label:"任务标题",prop:"title"},{default:o(()=>[t(B,{modelValue:d.title,"onUpdate:modelValue":e[6]||(e[6]=l=>d.title=l),placeholder:"请输入任务标题"},null,8,["modelValue"])]),_:1}),t(A,{label:"任务描述",prop:"description"},{default:o(()=>[t(B,{modelValue:d.description,"onUpdate:modelValue":e[7]||(e[7]=l=>d.description=l),type:"textarea",rows:3,placeholder:"请输入任务描述"},null,8,["modelValue"])]),_:1}),t(A,{label:"任务标签",prop:"tags"},{default:o(()=>[t(w,{modelValue:d.tags,"onUpdate:modelValue":e[8]||(e[8]=l=>d.tags=l),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请输入或选择标签",style:{width:"100%"}},{default:o(()=>[(i(!0),c(V,null,O(et.value,l=>(i(),g(s,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(A,{label:"任务类型",prop:"task_type"},{default:o(()=>[t(w,{modelValue:d.task_type,"onUpdate:modelValue":e[9]||(e[9]=l=>d.task_type=l),placeholder:"请选择任务类型",onChange:at},{default:o(()=>[t(s,{label:"金额任务",value:"amount"}),t(s,{label:"数量任务",value:"quantity"}),t(s,{label:"接龙任务",value:"jielong"}),t(s,{label:"勾选任务",value:"checkbox"})]),_:1},8,["modelValue"])]),_:1}),d.task_type==="amount"?(i(),g(A,{key:0,label:"目标金额",prop:"target_amount"},{default:o(()=>[t(ue,{modelValue:d.target_amount,"onUpdate:modelValue":e[10]||(e[10]=l=>d.target_amount=l),min:0,precision:2,placeholder:"请输入目标金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):v("",!0),d.task_type==="quantity"?(i(),g(A,{key:1,label:"目标数量",prop:"target_quantity"},{default:o(()=>[t(ue,{modelValue:d.target_quantity,"onUpdate:modelValue":e[11]||(e[11]=l=>d.target_quantity=l),min:1,placeholder:"请输入目标数量",style:{width:"100%"}},null,8,["modelValue"])]),_:1})):v("",!0),d.task_type==="jielong"?(i(),c(V,{key:2},[t(A,{label:"目标接龙数量",prop:"jielong_target_count"},{default:o(()=>[t(ue,{modelValue:d.jielong_target_count,"onUpdate:modelValue":e[12]||(e[12]=l=>d.jielong_target_count=l),min:1,placeholder:"请输入目标接龙数量",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),t(A,{label:"接龙配置"},{default:o(()=>[t(Fe,{class:"jielong-config-card"},{default:o(()=>[t(_e,{modelValue:U.id_enabled,"onUpdate:modelValue":e[13]||(e[13]=l=>U.id_enabled=l),label:"ID字段"},null,8,["modelValue"]),t(_e,{modelValue:U.remark_enabled,"onUpdate:modelValue":e[14]||(e[14]=l=>U.remark_enabled=l),label:"备注字段"},null,8,["modelValue"]),t(_e,{modelValue:U.intention_enabled,"onUpdate:modelValue":e[15]||(e[15]=l=>U.intention_enabled=l),label:"意向字段"},null,8,["modelValue"]),U.custom_field_enabled?(i(),c("div",Kt,[t(A,{label:"自定义字段名称",style:{"margin-bottom":"10px"}},{default:o(()=>[t(B,{modelValue:U.custom_field_name,"onUpdate:modelValue":e[16]||(e[16]=l=>U.custom_field_name=l),placeholder:"请输入自定义字段名称"},null,8,["modelValue"])]),_:1}),t(A,{label:"自定义字段类型",style:{"margin-bottom":"10px"}},{default:o(()=>[t(w,{modelValue:U.custom_field_type,"onUpdate:modelValue":e[17]||(e[17]=l=>U.custom_field_type=l),placeholder:"请选择字段类型"},{default:o(()=>[t(s,{label:"文本",value:"text"}),t(s,{label:"数值",value:"number"})]),_:1},8,["modelValue"])]),_:1})])):v("",!0),t(_e,{modelValue:U.custom_field_enabled,"onUpdate:modelValue":e[18]||(e[18]=l=>U.custom_field_enabled=l),label:"启用自定义字段"},null,8,["modelValue"])]),_:1})]),_:1})],64)):v("",!0),t(A,{label:"优先级",prop:"priority"},{default:o(()=>[t(w,{modelValue:d.priority,"onUpdate:modelValue":e[19]||(e[19]=l=>d.priority=l),placeholder:"请选择优先级"},{default:o(()=>[t(s,{label:"低",value:"low"}),t(s,{label:"中",value:"medium"}),t(s,{label:"高",value:"high"}),t(s,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(A,{label:"分配类型",prop:"assignment_type"},{default:o(()=>[t(w,{modelValue:d.assignment_type,"onUpdate:modelValue":e[20]||(e[20]=l=>d.assignment_type=l),placeholder:"请选择分配类型"},{default:o(()=>[t(s,{label:"指定用户",value:"user"}),t(s,{label:"指定组",value:"group"}),t(s,{label:"指定身份",value:"identity"}),t(s,{label:"所有人",value:"all"})]),_:1},8,["modelValue"])]),_:1}),d.assignment_type==="user"?(i(),g(A,{key:3,label:"分配用户",prop:"assigned_to"},{default:o(()=>[t(w,{modelValue:d.assigned_to,"onUpdate:modelValue":e[21]||(e[21]=l=>d.assigned_to=l),placeholder:"请选择用户"},{default:o(()=>[(i(!0),c(V,null,O($e.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("",!0),d.assignment_type==="group"?(i(),g(A,{key:4,label:"分配组",prop:"target_group_id"},{default:o(()=>[t(w,{modelValue:d.target_group_id,"onUpdate:modelValue":e[22]||(e[22]=l=>d.target_group_id=l),placeholder:"请选择组"},{default:o(()=>[(i(!0),c(V,null,O(se.value,l=>(i(),g(s,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):v("",!0),d.assignment_type==="identity"?(i(),g(A,{key:5,label:"目标身份",prop:"target_identity"},{default:o(()=>[t(w,{modelValue:d.target_identity,"onUpdate:modelValue":e[23]||(e[23]=l=>d.target_identity=l),placeholder:"请选择目标身份"},{default:o(()=>[t(s,{label:"CC(顾问)",value:"cc"}),t(s,{label:"SS(班主任)",value:"ss"}),t(s,{label:"LP(英文辅导)",value:"lp"}),t(s,{label:"SA(超级分析师)",value:"sa"})]),_:1},8,["modelValue"])]),_:1})):v("",!0),t(A,{label:"截止日期",prop:"due_date"},{default:o(()=>[t(qt,{modelValue:d.due_date,"onUpdate:modelValue":e[24]||(e[24]=l=>d.due_date=l),type:"datetime",placeholder:"选择截止日期",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(Ue,{modelValue:ge.value,"onUpdate:modelValue":e[40]||(e[40]=l=>ge.value=l),title:"任务详情",width:"800px"},{default:o(()=>[n.value?(i(),c("div",Xt,[t(Ct,{column:2,border:""},{default:o(()=>[t(y,{label:"任务标题"},{default:o(()=>[r(p(n.value.title),1)]),_:1}),t(y,{label:"任务类型"},{default:o(()=>[t(h,{type:Re(n.value.task_type)},{default:o(()=>[r(p(Ee(n.value.task_type)),1)]),_:1},8,["type"])]),_:1}),t(y,{label:"任务描述",span:2},{default:o(()=>[r(p(n.value.description),1)]),_:1}),t(y,{label:"标签",span:2},{default:o(()=>[(i(!0),c(V,null,O(n.value.tags||[],l=>(i(),g(h,{key:l,size:"small",style:{"margin-right":"4px"}},{default:o(()=>[r(p(l),1)]),_:2},1024))),128))]),_:1}),t(y,{label:"视角",span:2},{default:o(()=>[C("div",Zt,[n.value.task_type==="jielong"?(i(),g(J,{key:0,modelValue:R.value,"onUpdate:modelValue":e[27]||(e[27]=l=>R.value=l),size:"small",onChange:qe},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[57]||(e[57]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[58]||(e[58]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"])):n.value.task_type==="amount"?(i(),g(J,{key:1,modelValue:E.value,"onUpdate:modelValue":e[28]||(e[28]=l=>E.value=l),size:"small",onChange:he},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[59]||(e[59]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[60]||(e[60]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"])):n.value.task_type==="quantity"?(i(),g(J,{key:2,modelValue:P.value,"onUpdate:modelValue":e[29]||(e[29]=l=>P.value=l),size:"small",onChange:ze},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[61]||(e[61]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[62]||(e[62]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"])):n.value.task_type==="checkbox"?(i(),g(J,{key:3,modelValue:F.value,"onUpdate:modelValue":e[30]||(e[30]=l=>F.value=l),size:"small",onChange:Te},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[63]||(e[63]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[64]||(e[64]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"])):v("",!0),f(_).isAdmin||f(_).isSuperAdmin?(i(),c(V,{key:4},[t(w,{modelValue:q.value,"onUpdate:modelValue":e[31]||(e[31]=l=>q.value=l),placeholder:"筛选用户",filterable:"",clearable:"",size:"small",style:{width:"220px"},onChange:oe},{default:o(()=>[(i(!0),c(V,null,O(Q.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(_).isAdmin&&!f(_).isSuperAdmin?(i(),g(h,{key:0,type:"warning",size:"small"},{default:o(()=>[...e[65]||(e[65]=[r(" 仅显示本组成员 ",-1)])]),_:1})):v("",!0)],64)):v("",!0)])]),_:1}),t(y,{label:"状态"},{default:o(()=>[t(h,{type:Me(n.value.status)},{default:o(()=>[r(p(De(n.value.status)),1)]),_:1},8,["type"])]),_:1}),t(y,{label:"优先级"},{default:o(()=>[t(h,{type:Be(n.value.priority)},{default:o(()=>[r(p(Ie(n.value.priority)),1)]),_:1},8,["type"])]),_:1}),n.value.task_type==="amount"?(i(),c(V,{key:0},[E.value==="mine"||q.value?(i(),c(V,{key:0},[t(y,{label:"目标金额"},{default:o(()=>[r(p(m(n.value.personal_target_amount,n.value.target_amount,0)),1)]),_:1}),t(y,{label:"当前金额"},{default:o(()=>[r(p(m(n.value.personal_current_amount,n.value.current_amount,0)),1)]),_:1}),t(y,{label:"完成进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(D(m(n.value.personal_current_amount,n.value.current_amount,0),m(n.value.personal_target_amount,n.value.target_amount,1))*100),color:Z(D(m(n.value.personal_current_amount,n.value.current_amount,0),m(n.value.personal_target_amount,n.value.target_amount,1)))},null,8,["percentage","color"])]),_:1})],64)):(i(),c(V,{key:1},[t(y,{label:"目标金额"},{default:o(()=>[r(p(m(n.value.aggregate_target_amount,(n.value.target_amount||0)*m(n.value.participant_count,1),n.value.target_amount||0)),1)]),_:1}),t(y,{label:"当前金额"},{default:o(()=>[r(p(m(n.value.aggregate_current_amount,n.value.current_amount,0)),1)]),_:1}),t(y,{label:"完成进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(D(m(n.value.aggregate_current_amount,n.value.current_amount,0),m(n.value.aggregate_target_amount,(n.value.target_amount||1)*m(n.value.participant_count,1),n.value.target_amount||1))*100),color:Z(D(m(n.value.aggregate_current_amount,n.value.current_amount,0),m(n.value.aggregate_target_amount,(n.value.target_amount||1)*m(n.value.participant_count,1),n.value.target_amount||1)))},null,8,["percentage","color"])]),_:1})],64))],64)):v("",!0),n.value.task_type==="quantity"?(i(),c(V,{key:1},[P.value==="mine"||q.value?(i(),c(V,{key:0},[t(y,{label:"目标数量"},{default:o(()=>[r(p(m(n.value.personal_target_quantity,n.value.target_quantity,0)),1)]),_:1}),t(y,{label:"当前数量"},{default:o(()=>[r(p(m(n.value.personal_current_quantity,n.value.current_quantity,0)),1)]),_:1}),t(y,{label:"完成进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(D(m(n.value.personal_current_quantity,n.value.current_quantity,0),m(n.value.personal_target_quantity,n.value.target_quantity,1))*100),color:Z(D(m(n.value.personal_current_quantity,n.value.current_quantity,0),m(n.value.personal_target_quantity,n.value.target_quantity,1)))},null,8,["percentage","color"])]),_:1})],64)):(i(),c(V,{key:1},[t(y,{label:"目标数量"},{default:o(()=>[r(p(m(n.value.aggregate_target_quantity,(n.value.target_quantity||0)*m(n.value.participant_count,1),n.value.target_quantity||0)),1)]),_:1}),t(y,{label:"当前数量"},{default:o(()=>[r(p(m(n.value.aggregate_current_quantity,n.value.current_quantity,0)),1)]),_:1}),t(y,{label:"完成进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(D(m(n.value.aggregate_current_quantity,n.value.current_quantity,0),m(n.value.aggregate_target_quantity,(n.value.target_quantity||1)*m(n.value.participant_count,1),n.value.target_quantity||1))*100),color:Z(D(m(n.value.aggregate_current_quantity,n.value.current_quantity,0),m(n.value.aggregate_target_quantity,(n.value.target_quantity||1)*m(n.value.participant_count,1),n.value.target_quantity||1)))},null,8,["percentage","color"])]),_:1})],64))],64)):v("",!0),n.value.task_type==="jielong"?(i(),c(V,{key:2},[R.value==="mine"||q.value?(i(),c(V,{key:0},[t(y,{label:"目标接龙数量"},{default:o(()=>[r(p(m(n.value.personal_jielong_target_count,n.value.jielong_target_count,0)),1)]),_:1}),t(y,{label:"当前接龙数量"},{default:o(()=>[r(p(m(n.value.personal_jielong_current_count,n.value.jielong_current_count,0)),1)]),_:1}),t(y,{label:"接龙进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(m(n.value.personal_jielong_progress,D(m(n.value.personal_jielong_current_count,n.value.jielong_current_count,0),m(n.value.personal_jielong_target_count,n.value.jielong_target_count,1)))*100),color:Z(m(n.value.personal_jielong_progress,D(m(n.value.personal_jielong_current_count,n.value.jielong_current_count,0),m(n.value.personal_jielong_target_count,n.value.jielong_target_count,1))))},null,8,["percentage","color"])]),_:1})],64)):(i(),c(V,{key:1},[t(y,{label:"目标接龙数量"},{default:o(()=>[r(p(m(n.value.aggregate_jielong_target_count,(n.value.jielong_target_count||0)*m(n.value.participant_count,1),n.value.jielong_target_count||0)),1)]),_:1}),t(y,{label:"当前接龙数量"},{default:o(()=>[r(p(n.value.jielong_current_count||0),1)]),_:1}),t(y,{label:"接龙进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round(m(n.value.aggregate_jielong_progress,D(n.value.jielong_current_count||0,m(n.value.aggregate_jielong_target_count,(n.value.jielong_target_count||1)*m(n.value.participant_count,1),n.value.jielong_target_count||1)))*100),color:Z(m(n.value.aggregate_jielong_progress,D(n.value.jielong_current_count||0,m(n.value.aggregate_jielong_target_count,(n.value.jielong_target_count||1)*m(n.value.participant_count,1),n.value.jielong_target_count||1))))},null,8,["percentage","color"])]),_:1})],64)),t(y,{label:"接龙配置",span:2},{default:o(()=>{var l,I,Ne,Oe;return[C("div",el,[(l=n.value.jielong_config)!=null&&l.id_enabled?(i(),g(h,{key:0,size:"small",type:"info"},{default:o(()=>[...e[66]||(e[66]=[r("ID字段",-1)])]),_:1})):v("",!0),(I=n.value.jielong_config)!=null&&I.remark_enabled?(i(),g(h,{key:1,size:"small",type:"info"},{default:o(()=>[...e[67]||(e[67]=[r("备注字段",-1)])]),_:1})):v("",!0),(Ne=n.value.jielong_config)!=null&&Ne.intention_enabled?(i(),g(h,{key:2,size:"small",type:"info"},{default:o(()=>[...e[68]||(e[68]=[r("意向字段",-1)])]),_:1})):v("",!0),(Oe=n.value.jielong_config)!=null&&Oe.custom_field_enabled?(i(),g(h,{key:3,size:"small",type:"info"},{default:o(()=>{var He;return[r(p(((He=n.value.jielong_config)==null?void 0:He.custom_field_name)||"自定义字段"),1)]}),_:1})):v("",!0)])]}),_:1})],64)):v("",!0),n.value.task_type==="checkbox"?(i(),c(V,{key:3},[F.value==="mine"||q.value?(i(),g(y,{key:0,label:"完成状态",span:2},{default:o(()=>[(n.value.personal_is_completed!==void 0&&n.value.personal_is_completed!==null?n.value.personal_is_completed:n.value.is_completed)?(i(),c(V,{key:0},[t(L,{color:"green"},{default:o(()=>[t(f(Je))]),_:1}),e[69]||(e[69]=C("span",{style:{color:"green","margin-left":"4px"}},"已完成",-1))],64)):(i(),c(V,{key:1},[t(L,{color:"gray"},{default:o(()=>[t(f(Ke))]),_:1}),e[70]||(e[70]=C("span",{style:{color:"gray","margin-left":"4px"}},"未完成",-1))],64))]),_:1})):(i(),c(V,{key:1},[t(y,{label:"完成人数"},{default:o(()=>[r(p(n.value.completed_count||0)+" / "+p(n.value.participant_count||0),1)]),_:1}),t(y,{label:"完成进度",span:2},{default:o(()=>[t(ee,{percentage:Math.round((n.value.aggregate_checkbox_progress||0)*100),color:Z(n.value.aggregate_checkbox_progress||0)},null,8,["percentage","color"])]),_:1})],64))],64)):v("",!0),t(y,{label:"分配类型"},{default:o(()=>[r(p(Vt(n.value.assignment_type)),1)]),_:1}),t(y,{label:"分配对象"},{default:o(()=>[r(p(jt(n.value)),1)]),_:1}),t(y,{label:"截止日期"},{default:o(()=>[r(p(n.value.due_date?f(K)(n.value.due_date):"-"),1)]),_:1}),t(y,{label:"创建时间"},{default:o(()=>[r(p(f(K)(n.value.created_at)),1)]),_:1}),t(y,{label:"更新时间"},{default:o(()=>[r(p(n.value.updated_at?f(K)(n.value.updated_at):"-"),1)]),_:1}),t(y,{label:"创建者"},{default:o(()=>[r(p(n.value.created_by_username||"-"),1)]),_:1})]),_:1}),n.value.task_type!=="checkbox"?(i(),c("div",tl,[e[81]||(e[81]=C("h4",null,"参与记录",-1)),t(ht,{title:"提示",type:"info",closable:!1,style:{"margin-bottom":"16px"}},{default:o(()=>[...e[71]||(e[71]=[r(" 要参与任务，请在任务列表中点击对应的快速操作按钮 ",-1)])]),_:1}),n.value.task_type==="amount"?(i(),c("div",ll,[C("div",al,[t(J,{modelValue:E.value,"onUpdate:modelValue":e[32]||(e[32]=l=>E.value=l),size:"small",onChange:he},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[72]||(e[72]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[73]||(e[73]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"]),t(h,{type:"info",size:"small"},{default:o(()=>[r(p(E.value==="mine"?"按当前用户筛选":"显示全部记录"),1)]),_:1}),f(_).isAdmin||f(_).isSuperAdmin?(i(),c(V,{key:0},[t(w,{modelValue:q.value,"onUpdate:modelValue":e[33]||(e[33]=l=>q.value=l),placeholder:"筛选用户",filterable:"",clearable:"",size:"small",style:{width:"220px"},onChange:oe},{default:o(()=>[(i(!0),c(V,null,O(Q.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(_).isAdmin&&!f(_).isSuperAdmin?(i(),g(h,{key:0,type:"warning",size:"small"},{default:o(()=>[...e[74]||(e[74]=[r(" 仅显示本组成员 ",-1)])]),_:1})):v("",!0)],64)):v("",!0)]),M((i(),g(G,{data:ve.value,size:"small"},{default:o(()=>[t(b,{prop:"sequence",label:"序号",width:"60"}),t(b,{prop:"user_username",label:"用户",width:"120"}),t(b,{prop:"value",label:"金额/值",width:"120"}),t(b,{prop:"created_at",label:"参与时间",width:"160"},{default:o(({row:l})=>[r(p(f(K)(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ie,Ve.value]])])):v("",!0),n.value.task_type==="quantity"?(i(),c("div",nl,[C("div",ol,[t(J,{modelValue:P.value,"onUpdate:modelValue":e[34]||(e[34]=l=>P.value=l),size:"small",onChange:ze},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[75]||(e[75]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[76]||(e[76]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"]),t(h,{type:"info",size:"small"},{default:o(()=>[r(p(P.value==="mine"?"按当前用户筛选":"显示全部记录"),1)]),_:1}),f(_).isAdmin||f(_).isSuperAdmin?(i(),c(V,{key:0},[t(w,{modelValue:q.value,"onUpdate:modelValue":e[35]||(e[35]=l=>q.value=l),placeholder:"筛选用户",filterable:"",clearable:"",size:"small",style:{width:"220px"},onChange:oe},{default:o(()=>[(i(!0),c(V,null,O(Q.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(_).isAdmin&&!f(_).isSuperAdmin?(i(),g(h,{key:0,type:"warning",size:"small"},{default:o(()=>[...e[77]||(e[77]=[r(" 仅显示本组成员 ",-1)])]),_:1})):v("",!0)],64)):v("",!0)]),M((i(),g(G,{data:be.value,size:"small"},{default:o(()=>[t(b,{prop:"sequence",label:"序号",width:"60"}),t(b,{prop:"user_username",label:"用户",width:"120"}),t(b,{prop:"value",label:"数量/值",width:"120"}),t(b,{prop:"created_at",label:"参与时间",width:"160"},{default:o(({row:l})=>[r(p(f(K)(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ie,je.value]])])):v("",!0),n.value.task_type==="jielong"?(i(),c("div",ul,[C("div",il,[t(J,{modelValue:R.value,"onUpdate:modelValue":e[36]||(e[36]=l=>R.value=l),size:"small",onChange:qe},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[78]||(e[78]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[79]||(e[79]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"]),t(h,{type:"info",size:"small"},{default:o(()=>[r(p(R.value==="mine"?"按当前用户筛选":"显示全部记录"),1)]),_:1}),f(_).isAdmin||f(_).isSuperAdmin?(i(),c(V,{key:0},[t(w,{modelValue:q.value,"onUpdate:modelValue":e[37]||(e[37]=l=>q.value=l),placeholder:"筛选用户",filterable:"",clearable:"",size:"small",style:{width:"220px"},onChange:oe},{default:o(()=>[(i(!0),c(V,null,O(Q.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(_).isAdmin&&!f(_).isSuperAdmin?(i(),g(h,{key:0,type:"warning",size:"small"},{default:o(()=>[...e[80]||(e[80]=[r(" 仅显示本组成员 ",-1)])]),_:1})):v("",!0)],64)):v("",!0)]),M((i(),g(G,{data:ye.value,size:"small"},{default:o(()=>[t(b,{prop:"sequence",label:"序号",width:"60"}),t(b,{prop:"user_username",label:"用户",width:"100"}),t(b,{prop:"id",label:"ID",width:"120"}),t(b,{prop:"remark",label:"备注"}),t(b,{prop:"created_at",label:"参与时间",width:"160"},{default:o(({row:l})=>[r(p(f(K)(l.created_at)),1)]),_:1})]),_:1},8,["data"])),[[ie,fe.value]])])):v("",!0)])):v("",!0),n.value.task_type==="checkbox"?(i(),c("div",rl,[e[85]||(e[85]=C("h4",null,"完成记录",-1)),C("div",sl,[t(J,{modelValue:F.value,"onUpdate:modelValue":e[38]||(e[38]=l=>F.value=l),size:"small",onChange:Te},{default:o(()=>[t(S,{label:"mine"},{default:o(()=>[...e[82]||(e[82]=[r("我的",-1)])]),_:1}),t(S,{label:"all"},{default:o(()=>[...e[83]||(e[83]=[r("全部",-1)])]),_:1})]),_:1},8,["modelValue"]),t(h,{type:"info",size:"small"},{default:o(()=>[r(p(F.value==="mine"?"按当前用户筛选":"显示全部记录"),1)]),_:1}),f(_).isAdmin||f(_).isSuperAdmin?(i(),c(V,{key:0},[t(w,{modelValue:q.value,"onUpdate:modelValue":e[39]||(e[39]=l=>q.value=l),placeholder:"筛选用户",filterable:"",clearable:"",size:"small",style:{width:"220px"},onChange:oe},{default:o(()=>[(i(!0),c(V,null,O(Q.value,l=>(i(),g(s,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),f(_).isAdmin&&!f(_).isSuperAdmin?(i(),g(h,{key:0,type:"warning",size:"small"},{default:o(()=>[...e[84]||(e[84]=[r(" 仅显示本组成员 ",-1)])]),_:1})):v("",!0)],64)):v("",!0)]),M((i(),g(G,{data:ke.value,size:"small"},{default:o(()=>[t(b,{prop:"sequence",label:"序号",width:"60"}),t(b,{prop:"user_username",label:"用户",width:"120"}),t(b,{prop:"completion_value",label:"完成值",width:"120"}),t(b,{prop:"completed_at",label:"完成时间",width:"160"},{default:o(({row:l})=>[r(p(f(K)(l.completed_at)),1)]),_:1})]),_:1},8,["data"])),[[ie,xe.value]])])):v("",!0)])):v("",!0)]),_:1},8,["modelValue"]),t(Ue,{modelValue:de.value,"onUpdate:modelValue":e[45]||(e[45]=l=>de.value=l),title:"完成任务",width:"500px",onClose:pt},{footer:o(()=>[C("span",_l,[t(u,{onClick:e[44]||(e[44]=l=>de.value=!1)},{default:o(()=>[...e[86]||(e[86]=[r("取消",-1)])]),_:1}),t(u,{type:"primary",onClick:_t},{default:o(()=>[...e[87]||(e[87]=[r("确认完成",-1)])]),_:1})])]),default:o(()=>[t(Ye,{model:k,"label-width":"100px"},{default:o(()=>[t(A,{label:"任务标题"},{default:o(()=>[C("span",null,p(k.title),1)]),_:1}),t(A,{label:"完成备注"},{default:o(()=>[t(B,{modelValue:k.completion_note,"onUpdate:modelValue":e[41]||(e[41]=l=>k.completion_note=l),type:"textarea",rows:4,placeholder:"请输入完成备注（可选）"},null,8,["modelValue"])]),_:1}),k.task_type==="amount"?(i(),g(A,{key:0,label:"完成数量",required:""},{default:o(()=>[t(ue,{modelValue:k.completed_amount,"onUpdate:modelValue":e[42]||(e[42]=l=>k.completed_amount=l),min:0,max:k.target_amount,placeholder:"请输入完成数量"},null,8,["modelValue","max"]),C("span",dl,"/ "+p(k.target_amount),1)]),_:1})):v("",!0),k.task_type==="quantity"?(i(),g(A,{key:1,label:"完成数量",required:""},{default:o(()=>[t(ue,{modelValue:k.completed_quantity,"onUpdate:modelValue":e[43]||(e[43]=l=>k.completed_quantity=l),min:0,max:k.target_quantity,placeholder:"请输入完成数量"},null,8,["modelValue","max"]),C("span",pl,"/ "+p(k.target_quantity),1)]),_:1})):v("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},kl=zt(ml,[["__scopeId","data-v-3c85ef68"]]);export{kl as default};
