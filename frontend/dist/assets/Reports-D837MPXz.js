import{P as vt}from"./plus-CcGQCmxA.js";import{S as ht}from"./search-pfnW19QO.js";import{R as wt}from"./refresh-_vdEKoog.js";import{U as De}from"./user-DHlPW-H9.js";import{m as Qe,c as V,o as r,a as l,_ as bt,f as Ke,b as Te,e as x,C as ke,d as Vt,w as He,x as J,E as j,k as s,j as o,h as k,u as xt,A as Je,B as he,i as _,q as F,l as C,F as I,r as P,p as b,t as u,G as fe,y as Tt}from"./index-DxUxAYfJ.js";import{f as G,a as kt}from"./date-qiPTsFx8.js";const Ct={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function St(Ie,Q){return r(),V("svg",Ct,[...Q[0]||(Q[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 21h18M9 8h1m-1 4h1m-1 4h1m4-8h1m-1 4h1m-1 4h1M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"},null,-1)])])}const Ut=Qe({name:"tabler-building",render:St}),$t={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function Nt(Ie,Q){return r(),V("svg",$t,[...Q[0]||(Q[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm12-4v4M8 3v4m-4 4h16m-9 4h1m0 0v3"},null,-1)])])}const ye=Qe({name:"tabler-calendar",render:Nt}),Dt={class:"page-container"},Rt={class:"card-header"},jt={class:"table-toolbar"},zt={class:"table-filters"},Mt={class:"table-actions"},It={key:0},At={key:1,style:{color:"#999"}},Ft={class:"pagination-container"},Lt={class:"completed-tasks-section"},Pt={key:0,class:"summary-scope-controls"},Yt={class:"task-hierarchy-section"},qt={class:"task-card-header"},Bt={class:"task-title"},Ot={class:"task-card-body"},Gt={class:"task-meta"},Et={class:"meta-row"},Kt={class:"meta-value"},Ht={class:"meta-row"},Jt={class:"meta-value"},Qt={class:"task-progress"},Wt={class:"progress-label"},Xt={class:"percent-text"},Zt={class:"task-card-footer"},ea={class:"task-card-header"},ta={class:"task-title"},aa={class:"task-card-body"},la={class:"task-meta"},sa={class:"meta-row"},oa={class:"meta-value"},na={class:"meta-row"},ra={class:"meta-value"},ua={class:"task-progress"},da={class:"progress-label"},ia={class:"percent-text"},ca={class:"task-card-footer"},_a={class:"task-card-header"},pa={class:"task-title"},ma={class:"task-card-body"},ga={class:"task-meta"},fa={class:"meta-row"},ya={class:"meta-value"},va={class:"meta-row"},ha={class:"meta-value"},wa={class:"task-progress"},ba={class:"progress-label"},Va={class:"percent-text"},xa={class:"task-card-footer"},Ta={class:"task-card-header"},ka={class:"task-title"},Ca={class:"task-card-body"},Sa={class:"task-meta"},Ua={class:"meta-row"},$a={class:"meta-value"},Na={class:"meta-row"},Da={class:"meta-value"},Ra={class:"task-progress"},ja={class:"progress-label"},za={class:"percent-text"},Ma={class:"task-card-footer"},Ia={class:"dialog-footer"},Aa={key:0,class:"report-detail"},Fa={class:"report-header"},La={class:"report-meta"},Pa={class:"report-section"},Ya={class:"report-section"},qa={key:0,class:"task-hierarchy-section"},Ba={class:"task-card-header"},Oa={class:"task-title"},Ga={class:"task-card-body"},Ea={class:"task-meta"},Ka={class:"meta-row"},Ha={class:"meta-value"},Ja={class:"meta-row"},Qa={class:"meta-value"},Wa={class:"task-progress"},Xa={class:"progress-label"},Za={class:"percent-text"},el={class:"task-card-header"},tl={class:"task-title"},al={class:"task-card-body"},ll={class:"task-meta"},sl={class:"meta-row"},ol={class:"meta-value"},nl={class:"meta-row"},rl={class:"meta-value"},ul={class:"task-progress"},dl={class:"progress-label"},il={class:"percent-text"},cl={class:"task-card-header"},_l={class:"task-title"},pl={class:"task-card-body"},ml={class:"task-meta"},gl={class:"meta-row"},fl={class:"meta-value"},yl={class:"meta-row"},vl={class:"meta-value"},hl={class:"task-progress"},wl={class:"progress-label"},bl={class:"percent-text"},Vl={key:1},xl={key:0,class:"report-section"},Tl={class:"report-section"},kl={__name:"Reports",setup(Ie){var Oe,Ge;Ke(async()=>{Y.value?(await Ye(),await ot()):ne.value&&await qe(),await O()});const Q=x(!1),Ce=x([]),W=ke({dateRange:[],search:""}),T=Vt(),ne=Te(()=>T.isAdmin),Y=Te(()=>T.isSuperAdmin),re=x(null),E=x(null),le=x(null),we=x([]),q=x([]),We=Te(()=>{if(!le.value)return we.value;const a=q.value.filter(d=>String(d.identity_type||"").toLowerCase()===le.value.toLowerCase()),e=new Set(a.map(d=>d.group_id).filter(Boolean));return we.value.filter(d=>e.has(d.id))}),Xe=Te(()=>{let a=q.value;return le.value&&(a=a.filter(e=>String(e.identity_type||"").toLowerCase()===le.value.toLowerCase())),re.value&&(a=a.filter(e=>e.group_id===re.value)),a}),K=ke({page:1,size:20,total:0}),se=x(!1),Re=x(!1),oe=x(!1),je=x(!1),be=x(),w=x(null),D=ke({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),Ze=Te(()=>{var e,d,p,y,m,i,v,g,h;const a=(d=(e=w.value)==null?void 0:e.ai_analysis)==null?void 0:d.tasks_snapshot;return!!(a&&((p=a.completed_today)!=null&&p.length||(y=a.completedToday)!=null&&y.length||(m=a.due_today)!=null&&m.length||(i=a.dueToday)!=null&&i.length||(v=a.ongoing)!=null&&v.length||(g=a.ongoing_uncompleted)!=null&&g.length||(h=a.overdue_uncompleted)!=null&&h.length))}),n=ke({report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0,actual_amount:0,new_sign_amount:0,referral_amount:0,referral_count:0,renewal_amount:0,upgrade_amount:0,renewal_count:0,upgrade_count:0});x([]);const et=x([]),Ae=x(!1),Fe=x(!1),ze=x(!1),U=ke({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),tt=xt(),B=x("all"),Ve=x(null),ve=x(null),Se=x(null),at=x([{label:"CC(顾问)",value:"cc"},{label:"SS(班主任)",value:"ss"},{label:"LP(英文辅导)",value:"lp"}]),lt={report_date:[{required:!0,message:"请选择日报日期",trigger:"change"}],summary:[{required:!0,message:"请输入工作摘要",trigger:"blur"},{min:10,max:500,message:"摘要长度在 10 到 500 个字符",trigger:"blur"}],completed_tasks:[],next_day_plan:[{required:!0,message:"请输入明日计划",trigger:"blur"}]},ue=a=>({pending:"待处理",processing:"进行中",done:"已完成"})[a]||a,de=a=>{const e=String(a||"").toLowerCase(),d=(e.match(/(pending|processing|done)/)||[])[1]||e;return{pending:"info",processing:"warning",done:"success"}[d]||"info"},ie=a=>{const e={user:"指定用户",group:"指定组",identity:"指定身份",all:"所有人"},d=String(a||"").toLowerCase(),p=(d.match(/(user|group|identity|all)/)||[])[1]||d;return e[p]||p},ce=a=>{var e,d,p,y;switch(a.assignment_type){case"user":if(a.assigned_to_username)return a.assigned_to_username;if(a.assigned_to&&((e=T.user)==null?void 0:e.id)===a.assigned_to)return((d=T.user)==null?void 0:d.username)||"";if(a.assigned_to){const m=(q.value||[]).find(i=>i.id===a.assigned_to);return(m==null?void 0:m.username)||"未知用户"}return"未知用户";case"group":if(a.target_group_name)return a.target_group_name;if(a.target_group_id!=null){const m=Number(a.target_group_id),i=(we.value||[]).find(v=>Number(v.id)===m);return i!=null&&i.name?i.name:((p=T.user)==null?void 0:p.group_id)===m&&((y=T.user)!=null&&y.group_name)?T.user.group_name:"未知组"}return"未知组";case"identity":return a.target_identity||"-";case"all":return"所有人";default:return"-"}},_e=a=>{const e=String(a||"").toLowerCase(),d=(e.match(/(user|group|identity|all)/)||[])[1]||e;return{user:De,group:Ut,identity:De,all:De}[d]||De},Ue=a=>{a!=null&&a.id&&tt.push({path:"/tasks",query:{openTaskId:a.id}})},$e=(...a)=>{for(const e of a)if(e!=null)return e;return 0},Me=(a,e)=>{const d=Number(a)||0,p=Number(e);return!p||p<=0?0:d/p},X=a=>{if(!a)return 0;let e=0;switch(a.task_type){case"amount":e=Me(a.current_amount,a.target_amount);break;case"quantity":e=Me(a.current_quantity,a.target_quantity);break;case"jielong":{const d=$e(a.personal_jielong_current_count,a.jielong_current_count,0),p=$e(a.personal_jielong_target_count,a.jielong_target_count,0);e=Me(d,p);break}case"checkbox":e=a.is_completed?1:0;break;default:e=a.status==="done"?1:0}return isFinite(e)||(e=0),Math.max(0,Math.min(1,e))},A=a=>Math.round(X(a)*100),pe=a=>{if(!a)return"-";switch(a.task_type){case"amount":return`${a.current_amount||0} / ${a.target_amount||0}`;case"quantity":return`${a.current_quantity||0} / ${a.target_quantity||0}`;case"jielong":{const e=$e(a.personal_jielong_current_count,a.jielong_current_count,0),d=$e(a.personal_jielong_target_count,a.jielong_target_count,0);return`${e} / ${d}`}case"checkbox":return a.is_completed?"已完成":"未完成";default:return"-"}},me=a=>a>=.8?"#67C23A":a>=.3?"#E6A23C":"#F56C6C",Ne=a=>({id:a.id,title:a.title,task_type:a.task_type,assignment_type:a.assignment_type,assigned_to:a.assigned_to,target_group_id:a.target_group_id,target_identity:a.target_identity,assigned_to_username:a.assigned_to_username,target_group_name:a.target_group_name,status:a.status,is_completed:a.is_completed,due_date:a.due_date,updated_at:a.updated_at,target_amount:a.target_amount,current_amount:a.current_amount,target_quantity:a.target_quantity,current_quantity:a.current_quantity,personal_jielong_target_count:a.personal_jielong_target_count,personal_jielong_current_count:a.personal_jielong_current_count,jielong_target_count:a.jielong_target_count,jielong_current_count:a.jielong_current_count}),Le=()=>({completed_today:(U.completedToday||[]).map(Ne),due_today:(U.dueToday||[]).map(Ne),ongoing:(U.ongoing||[]).map(Ne),overdue_uncompleted:(U.overdue||[]).map(Ne)}),st=async()=>{var a,e,d,p,y;Ae.value=!0;try{const m={page:1,size:100};Y.value&&B.value==="user"&&Ve.value&&(m.assigned_to=Ve.value);const i=await J.get("/tasks",{params:m});let v=Array.isArray(i.data)?i.data:((a=i.data)==null?void 0:a.items)||i.data||[];const g=h=>{const c=String(h||"").toLowerCase(),f=c.match(/(user|group|identity|all)/);return f?f[1]:c};if(ne.value&&B.value==="group"){const h=ve.value||((e=T.user)==null?void 0:e.group_id);if(h){const c=(q.value||[]).map(f=>f.id);v=v.filter(f=>{const S=g(f.assignment_type);return S==="group"&&f.target_group_id===h||S==="user"&&c.includes(f.assigned_to)||S==="all"})}}else if(!ne.value&&!Y.value){const h=(d=T.user)==null?void 0:d.id,c=(p=T.user)==null?void 0:p.group_id,f=String(((y=T.user)==null?void 0:y.identity_type)||"").toLowerCase();v=v.filter(S=>{const $=g(S.assignment_type);return $==="user"&&S.assigned_to===h||$==="group"&&S.target_group_id===c||$==="identity"&&String(S.target_identity||"").toLowerCase()===f||$==="all"})}else if(Y.value){if(B.value==="group"&&ve.value){const h=ve.value,c=(q.value||[]).filter(f=>f.group_id===h).map(f=>f.id);v=v.filter(f=>{const S=g(f.assignment_type);return S==="group"&&f.target_group_id===h||S==="user"&&c.includes(f.assigned_to)||S==="all"})}if(B.value==="identity"&&Se.value){const h=String(Se.value||"").toLowerCase();v=v.filter(c=>g(c.assignment_type)==="identity"&&String(c.target_identity||"").toLowerCase()===h)}}return v}catch{return j.error("获取任务用于汇总失败"),[]}finally{Ae.value=!1}},Pe=(a,e)=>{if(!a||!e)return!1;const d=new Date(a),p=new Date(e);return d.getFullYear()===p.getFullYear()&&d.getMonth()===p.getMonth()&&d.getDate()===p.getDate()},Z=async()=>{Fe.value=!0;try{const a=n.report_date||G(new Date),e=new Date(a+"T00:00:00"),d=await st(),p=[],y=[],m=[],i=[],v=[];d.forEach(c=>{const f=String(c.status||"").toLowerCase(),$=((f.match(/(pending|processing|done)/)||[])[1]||f)==="done"||c.is_completed===!0,N=c.due_date?new Date(c.due_date.replace(" ","T")):null,L=c.updated_at?new Date(String(c.updated_at).replace(" ","T")):null,z=!!(N&&Pe(N,e)),ee=!!(N&&N<e);$&&L&&Pe(L,e)&&m.push(c),z?$?p.push(c):y.push(c):!N||N&&N>e?$||i.push(c):!$&&ee&&v.push(c)});const g=[];m.length&&g.push(`【今日完成】
`+m.map(c=>`• ${c.title}`).join(`
`));const h=[];p.length&&h.push(...p.map(c=>`• ${c.title}（已完成）`)),y.length&&h.push(...y.map(c=>`• ${c.title}（未完成）`)),h.length&&g.push(`【今日到期】
`+h.join(`
`)),i.length&&g.push(`【正在进行（未到期/无截止）】
`+i.map(c=>`• ${c.title}`).join(`
`)),v.length&&g.push(`【逾期未完成】
`+v.map(c=>`• ${c.title}`).join(`
`)),n.completed_tasks=g.length?g.join(`

`):`【今日完成】
无

【今日到期】
无

【正在进行（未到期/无截止）】
无`,U.completedToday=m,U.dueToday=[...p,...y],U.ongoing=i,U.overdue=v}catch{j.error("自动加载任务汇总失败")}finally{Fe.value=!1}};Y.value?B.value="all":ne.value?(B.value="group",ve.value=((Oe=T.user)==null?void 0:Oe.group_id)||null):(B.value="user",Ve.value=((Ge=T.user)==null?void 0:Ge.id)||null),He(()=>se.value,a=>{a&&Z()}),He(()=>n.report_date,()=>{se.value&&Z()});const O=async()=>{var a,e,d,p;Q.value=!0;try{const y={page:K.page,size:K.size,search:W.search};W.dateRange&&W.dateRange.length===2&&(y.start_date=W.dateRange[0],y.end_date=W.dateRange[1]),Y.value?(le.value&&(y.identity_type=le.value),re.value&&(y.group_id=re.value),E.value&&(y.user_id=E.value)):ne.value?((a=T.user)!=null&&a.group_id&&(y.group_id=T.user.group_id),E.value&&(y.user_id=E.value)):(e=T.user)!=null&&e.id&&(y.user_id=T.user.id);const i=(await J.get("/reports",{params:y})).data;console.log("[Reports] API Response:",i),(d=i==null?void 0:i.items)!=null&&d[0]&&(console.log("[Reports] First report sample:",i.items[0]),console.log("[Reports] Submitter field:",i.items[0].submitter));const v=g=>({id:g.id,report_date:g.work_date,summary:g.work_summary??g.title??"",completed_tasks:g.task_progress??"",issues_encountered:g.challenges??"",next_day_plan:g.tomorrow_plan??"",call_count:g.call_count??0,call_duration:g.call_duration??0,actual_amount:g.actual_amount??0,new_sign_amount:g.new_sign_amount??0,referral_amount:g.referral_amount??0,referral_count:g.referral_count??0,renewal_amount:g.renewal_amount??0,upgrade_amount:g.upgrade_amount??0,renewal_count:g.renewal_count??0,upgrade_count:g.upgrade_count??0,ai_analysis:g.ai_analysis||{},submitter:g.submitter||null,created_at:g.created_at,updated_at:g.updated_at});if(Array.isArray(i))Ce.value=i.map(v),K.total=i.length||0;else if(i&&typeof i=="object"){const g=i.items||[];Ce.value=g.map(v),K.total=typeof i.total=="number"?i.total:((p=i.items)==null?void 0:p.length)||0}else Ce.value=[],K.total=0}catch{j.error("获取日报列表失败")}finally{Q.value=!1}},Ye=async()=>{try{const a=await J.get("/groups",{params:{page:1,size:100}});we.value=a.data.items||[]}catch{}},qe=async()=>{var a;if(!((a=T.user)!=null&&a.group_id)){q.value=[];return}try{const e=await J.get(`/groups/${T.user.group_id}/members`);q.value=e.data||[]}catch{q.value=[]}},ot=async()=>{if(Y.value)try{const a={page:1,size:500},e=await J.get("/users",{params:a});q.value=e.data.items||[]}catch{q.value=[]}},nt=()=>{re.value=null,E.value=null,O()},rt=()=>{E.value=null,O()},ut=()=>{oe.value=!1,n.report_date=new Date().toISOString().split("T")[0],se.value=!0,Z()},Be=x(!1),dt=async a=>{var p,y,m,i,v,g,h,c,f;const e=(p=a==null?void 0:a.ai_analysis)==null?void 0:p.tasks_snapshot;if(!(e&&((y=e.completed_today)!=null&&y.length||(m=e.completedToday)!=null&&m.length||(i=e.due_today)!=null&&i.length||(v=e.dueToday)!=null&&v.length||(g=e.ongoing)!=null&&g.length||(h=e.ongoing_uncompleted)!=null&&h.length))){Be.value=!0;try{const $=((c=(await J.post(`/reports/${parseInt(a.id)}/build-snapshot`)).data)==null?void 0:c.ai_analysis)||{};w.value&&(w.value.ai_analysis=$);const N=($==null?void 0:$.tasks_snapshot)||null;N&&(D.completedToday=N.completed_today||N.completedToday||[],D.dueToday=N.due_today||N.dueToday||[],D.ongoing=N.ongoing||N.ongoing_uncompleted||N.ongoingUncompleted||[],D.overdue=N.overdue_uncompleted||[])}catch(S){((f=S==null?void 0:S.response)==null?void 0:f.status)!==403&&(console.error("[Reports] build-snapshot failed",S),j.error("构建任务卡片快照失败"))}finally{Be.value=!1}}},it=async a=>{var d;w.value=a;const e=((d=a==null?void 0:a.ai_analysis)==null?void 0:d.tasks_snapshot)||null;e?(D.completedToday=e.completed_today||e.completedToday||[],D.dueToday=e.due_today||e.dueToday||[],D.ongoing=e.ongoing||e.ongoing_uncompleted||e.ongoingUncompleted||[],D.overdue=e.overdue_uncompleted||[]):(D.completedToday=[],D.dueToday=[],D.ongoing=[],D.overdue=[]),Re.value=!0,await dt(a)},ct=a=>{oe.value=!0,Object.assign(n,{id:parseInt(a.id),report_date:a.report_date,summary:a.summary,completed_tasks:"",issues_encountered:a.issues_encountered||"",next_day_plan:a.next_day_plan,call_count:a.call_count||0,call_duration:a.call_duration||0}),se.value=!0,Z()},_t=()=>{be.value&&be.value.resetFields(),Object.assign(n,{report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0,actual_amount:0,new_sign_amount:0,referral_amount:0,referral_count:0,renewal_amount:0,upgrade_amount:0,renewal_count:0,upgrade_count:0}),et.value=[]},pt=async()=>{var a,e,d;if(be.value)try{await be.value.validate(),je.value=!0,await Z();const y=[...U.completedToday||[],...U.dueToday||[],...U.ongoing||[]].map(h=>X(h)).filter(h=>Number.isFinite(h)),m=y.length?y.reduce((h,c)=>h+c,0)/y.length:.7,i=Math.max(1,Math.min(10,Math.round(m*10))),g=[`【工作摘要】
${n.summary||""}`,`【完成任务】
${n.completed_tasks||""}`,`【遇到问题】
${n.issues_encountered||""}`,`【明日计划】
${n.next_day_plan||""}`].join(`

`);if(oe.value){const h={work_summary:n.summary||void 0,task_progress:n.completed_tasks||void 0,challenges:n.issues_encountered||void 0,tomorrow_plan:n.next_day_plan||void 0,call_count:Number.isFinite(Number(n.call_count))?Number(n.call_count):void 0,call_duration:Number.isFinite(Number(n.call_duration))?Number(n.call_duration):void 0,content:g||void 0,title:(n.summary||`日报 ${n.report_date||""}`).slice(0,200),tasks_snapshot:Le(),actual_amount:Number(n.actual_amount)||0,new_sign_amount:Number(n.new_sign_amount)||0,referral_amount:Number(n.referral_amount)||0,referral_count:Number(n.referral_count)||0,renewal_amount:Number(n.renewal_amount)||0,upgrade_amount:Number(n.upgrade_amount)||0,renewal_count:Number(n.renewal_count)||0,upgrade_count:Number(n.upgrade_count)||0};await J.put(`/reports/${n.id}`,h),j.success("日报更新成功")}else{const h=G(new Date),c=n.report_date||h,f={work_date:c,title:(n.summary||`日报 ${c}`).slice(0,200),content:g,work_hours:0,task_progress:n.completed_tasks||"",work_summary:n.summary||"",efficiency_score:i,call_count:Number.isFinite(Number(n.call_count))?Number(n.call_count):0,call_duration:Number.isFinite(Number(n.call_duration))?Number(n.call_duration):0,achievements:void 0,challenges:n.issues_encountered||void 0,tomorrow_plan:n.next_day_plan||void 0,tasks_snapshot:Le(),created_by:((a=T.user)==null?void 0:a.id)||void 0,actual_amount:Number(n.actual_amount)||0,new_sign_amount:Number(n.new_sign_amount)||0,referral_amount:Number(n.referral_amount)||0,referral_count:Number(n.referral_count)||0,renewal_amount:Number(n.renewal_amount)||0,upgrade_amount:Number(n.upgrade_amount)||0,renewal_count:Number(n.renewal_count)||0,upgrade_count:Number(n.upgrade_count)||0};console.debug("[Reports] POST /reports payload",f),await J.post("/reports",f),j.success("日报提交成功")}se.value=!1,O()}catch(p){const y=(e=p==null?void 0:p.response)==null?void 0:e.status,m=(d=p==null?void 0:p.response)==null?void 0:d.data;if(m!=null&&m.detail)j.error(m.detail);else if(y)if(y===500)j.error("服务器内部错误：请稍后重试或联系管理员");else if(y===422){const i=Array.isArray(m==null?void 0:m.detail)?m.detail.map(v=>v.msg).join("; "):"请求参数不合法";j.error(`提交失败：${i}`)}else j.error(`提交失败（HTTP ${y}）`);else j.error(oe.value?"更新失败":"提交失败");console.error("[Reports] Submit error",{isEdit:oe.value,reportForm:{...n},status:y,data:m})}finally{je.value=!1}},mt=async a=>{try{await Tt.confirm(`确定要删除${G(a.report_date)}的日报吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await J.delete(`/reports/${parseInt(a.id)}`),j.success("删除成功"),O()}catch(e){e!=="cancel"&&j.error("删除失败")}},gt=async()=>{var a,e;ze.value=!0;try{const d=new Date().toISOString().split("T")[0],p=await J.post("/task-sync/auto-generate-daily-report",{date:d});p.data.success?(j.success("自动生成日报成功"),O()):j.warning(p.data.message||"自动生成日报失败")}catch(d){console.error("自动生成日报失败:",d),(e=(a=d.response)==null?void 0:a.data)!=null&&e.detail?j.error(d.response.data.detail):j.error("自动生成日报失败")}finally{ze.value=!1}};return Ke(async()=>{await Ye(),Y.value?await fetchAllUsersForSuperAdmin():ne.value&&await qe(),await O()}),(a,e)=>{const d=k("el-button"),p=k("el-date-picker"),y=k("el-input"),m=k("el-option"),i=k("el-select"),v=k("el-table-column"),g=k("el-table"),h=k("el-pagination"),c=k("el-card"),f=k("el-form-item"),S=k("el-alert"),$=k("el-radio-button"),N=k("el-radio-group"),L=k("el-tag"),z=k("el-icon"),ee=k("el-progress"),R=k("el-col"),te=k("el-row"),ge=k("el-empty"),H=k("el-input-number"),ft=k("el-form"),Ee=k("el-dialog"),xe=Je("can"),yt=Je("loading");return r(),V("div",Dt,[e[70]||(e[70]=l("div",{class:"page-header"},[l("h1",{class:"page-title"},"日报管理"),l("p",{class:"page-description"},"查看和管理您的日报")],-1)),s(c,{class:"content-card"},{header:o(()=>[l("div",Rt,[e[30]||(e[30]=l("span",null,"日报列表",-1)),he((r(),_(d,{type:"primary",icon:C(vt),onClick:ut},{default:o(()=>[...e[29]||(e[29]=[b(" 写日报 ",-1)])]),_:1},8,["icon"])),[[xe,"reports:create"]])])]),default:o(()=>[l("div",jt,[l("div",zt,[s(p,{modelValue:W.dateRange,"onUpdate:modelValue":e[0]||(e[0]=t=>W.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),s(y,{modelValue:W.search,"onUpdate:modelValue":e[1]||(e[1]=t=>W.search=t),placeholder:"搜索日报...","prefix-icon":C(ht),clearable:""},null,8,["modelValue","prefix-icon"]),ne.value?(r(),_(i,{key:0,modelValue:E.value,"onUpdate:modelValue":e[2]||(e[2]=t=>E.value=t),placeholder:"筛选本组用户",clearable:"",onChange:O},{default:o(()=>[(r(!0),V(I,null,P(q.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),Y.value?(r(),_(i,{key:1,modelValue:le.value,"onUpdate:modelValue":e[3]||(e[3]=t=>le.value=t),placeholder:"选择身份",clearable:"",onChange:nt},{default:o(()=>[s(m,{label:"全部",value:null}),s(m,{label:"CC(顾问)",value:"cc"}),s(m,{label:"SS(班主任)",value:"ss"}),s(m,{label:"LP(英文辅导)",value:"lp"})]),_:1},8,["modelValue"])):F("",!0),Y.value?(r(),_(i,{key:2,modelValue:re.value,"onUpdate:modelValue":e[4]||(e[4]=t=>re.value=t),placeholder:"选择组别",clearable:"",onChange:rt},{default:o(()=>[s(m,{label:"全部",value:null}),(r(!0),V(I,null,P(We.value,t=>(r(),_(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),Y.value?(r(),_(i,{key:3,modelValue:E.value,"onUpdate:modelValue":e[5]||(e[5]=t=>E.value=t),placeholder:"选择用户",clearable:"",onChange:O},{default:o(()=>[s(m,{label:"全部",value:null}),(r(!0),V(I,null,P(Xe.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)]),l("div",Mt,[s(d,{icon:C(wt),onClick:O},{default:o(()=>[...e[31]||(e[31]=[b("刷新",-1)])]),_:1},8,["icon"]),he((r(),_(d,{type:"info",onClick:gt,loading:ze.value},{default:o(()=>[...e[32]||(e[32]=[b(" 自动生成今日日报 ",-1)])]),_:1},8,["loading"])),[[xe,"reports:auto_generate"]])])]),he((r(),_(g,{data:Ce.value,stripe:"",style:{width:"100%"}},{default:o(()=>[s(v,{prop:"report_date",label:"日期",width:"120"},{default:o(({row:t})=>[b(u(C(G)(t.report_date)),1)]),_:1}),s(v,{label:"提交人",width:"150"},{default:o(({row:t})=>[t.submitter?(r(),V("span",It,u(t.submitter.username),1)):(r(),V("span",At,"—"))]),_:1}),s(v,{prop:"summary",label:"摘要","min-width":"300"}),s(v,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:t})=>[b(u(C(kt)(t.created_at)),1)]),_:1}),s(v,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[he((r(),_(d,{type:"primary",size:"small",onClick:ae=>it(t)},{default:o(()=>[...e[33]||(e[33]=[b(" 查看 ",-1)])]),_:1},8,["onClick"])),[[xe,t,"report",{view:!0}]]),he((r(),_(d,{type:"warning",size:"small",onClick:ae=>ct(t)},{default:o(()=>[...e[34]||(e[34]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[xe,t,"report",{edit:!0}]]),he((r(),_(d,{type:"danger",size:"small",onClick:ae=>mt(t)},{default:o(()=>[...e[35]||(e[35]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])),[[xe,t,"report",{delete:!0}]])]),_:1})]),_:1},8,["data"])),[[yt,Q.value]]),l("div",Ft,[s(h,{"current-page":K.page,"onUpdate:currentPage":e[6]||(e[6]=t=>K.page=t),"page-size":K.size,"onUpdate:pageSize":e[7]||(e[7]=t=>K.size=t),total:K.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:O},null,8,["current-page","page-size","total"])])]),_:1}),s(Ee,{modelValue:se.value,"onUpdate:modelValue":e[27]||(e[27]=t=>se.value=t),title:oe.value?"编辑日报":"写日报",width:"800px",onClose:_t},{footer:o(()=>[l("span",Ia,[s(d,{onClick:e[26]||(e[26]=t=>se.value=!1)},{default:o(()=>[...e[56]||(e[56]=[b("取消",-1)])]),_:1}),s(d,{type:"primary",onClick:pt,loading:je.value},{default:o(()=>[b(u(oe.value?"更新":"提交"),1)]),_:1},8,["loading"])])]),default:o(()=>[s(ft,{ref_key:"formRef",ref:be,model:n,rules:lt,"label-width":"100px"},{default:o(()=>[s(f,{label:"日报日期",prop:"report_date"},{default:o(()=>[s(p,{modelValue:n.report_date,"onUpdate:modelValue":e[8]||(e[8]=t=>n.report_date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",disabled:oe.value},null,8,["modelValue","disabled"])]),_:1}),s(f,{label:"工作摘要",prop:"summary"},{default:o(()=>[s(y,{modelValue:n.summary,"onUpdate:modelValue":e[9]||(e[9]=t=>n.summary=t),type:"textarea",rows:3,placeholder:"请简要描述今日工作内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(f,{label:"完成任务",prop:"completed_tasks"},{default:o(()=>[l("div",Lt,[s(S,{title:"已自动加载：当日到期（已/未完成） + 正在进行未完成 + 逾期（今日完成/未完成）",type:"info",closable:!1,style:{"margin-bottom":"10px"}}),Y.value?(r(),V("div",Pt,[s(N,{modelValue:B.value,"onUpdate:modelValue":e[10]||(e[10]=t=>B.value=t),size:"small",onChange:Z},{default:o(()=>[s($,{label:"all"},{default:o(()=>[...e[36]||(e[36]=[b("全部",-1)])]),_:1}),s($,{label:"user"},{default:o(()=>[...e[37]||(e[37]=[b("个人",-1)])]),_:1}),s($,{label:"group"},{default:o(()=>[...e[38]||(e[38]=[b("组别",-1)])]),_:1}),s($,{label:"identity"},{default:o(()=>[...e[39]||(e[39]=[b("角色",-1)])]),_:1})]),_:1},8,["modelValue"]),B.value==="user"?(r(),_(i,{key:0,modelValue:Ve.value,"onUpdate:modelValue":e[11]||(e[11]=t=>Ve.value=t),placeholder:"选择用户",filterable:"",style:{width:"220px"},onChange:Z},{default:o(()=>[(r(!0),V(I,null,P(q.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),B.value==="group"?(r(),_(i,{key:1,modelValue:ve.value,"onUpdate:modelValue":e[12]||(e[12]=t=>ve.value=t),placeholder:"选择组别",filterable:"",style:{width:"220px"},onChange:Z},{default:o(()=>[(r(!0),V(I,null,P(we.value,t=>(r(),_(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),B.value==="identity"?(r(),_(i,{key:2,modelValue:Se.value,"onUpdate:modelValue":e[13]||(e[13]=t=>Se.value=t),placeholder:"选择角色",filterable:"",style:{width:"220px"},onChange:Z},{default:o(()=>[(r(!0),V(I,null,P(at.value,t=>(r(),_(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)])):F("",!0),l("div",Yt,[e[52]||(e[52]=l("h4",{class:"hierarchy-title"},"今日完成",-1)),U.completedToday.length>0?(r(),_(te,{key:0,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(U.completedToday,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`completed-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",qt,[l("span",Bt,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",Ot,[l("div",Gt,[l("div",Et,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[40]||(e[40]=l("span",{class:"meta-label"},"分配：",-1)),l("span",Kt,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",Ht,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[41]||(e[41]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Jt,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",Qt,[l("span",Wt,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Xt,u(A(t))+"%",1)])]),l("div",Zt,[s(d,{type:"primary",size:"small",onClick:ae=>Ue(t)},{default:o(()=>[...e[42]||(e[42]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:1,description:"无"})),e[53]||(e[53]=l("h4",{class:"hierarchy-title"},"今日到期",-1)),U.dueToday.length>0?(r(),_(te,{key:2,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(U.dueToday,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`due-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",ea,[l("span",ta,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",aa,[l("div",la,[l("div",sa,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[43]||(e[43]=l("span",{class:"meta-label"},"分配：",-1)),l("span",oa,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",na,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[44]||(e[44]=l("span",{class:"meta-label"},"截止：",-1)),l("span",ra,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",ua,[l("span",da,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",ia,u(A(t))+"%",1)])]),l("div",ca,[s(d,{type:"primary",size:"small",onClick:ae=>Ue(t)},{default:o(()=>[...e[45]||(e[45]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:3,description:"无"})),e[54]||(e[54]=l("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),U.ongoing.length>0?(r(),_(te,{key:4,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(U.ongoing,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`ongoing-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",_a,[l("span",pa,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",ma,[l("div",ga,[l("div",fa,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[46]||(e[46]=l("span",{class:"meta-label"},"分配：",-1)),l("span",ya,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",va,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[47]||(e[47]=l("span",{class:"meta-label"},"截止：",-1)),l("span",ha,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",wa,[l("span",ba,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Va,u(A(t))+"%",1)])]),l("div",xa,[s(d,{type:"primary",size:"small",onClick:ae=>Ue(t)},{default:o(()=>[...e[48]||(e[48]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:5,description:"无"})),e[55]||(e[55]=l("h4",{class:"hierarchy-title"},"逾期（未完成）",-1)),U.overdue.length>0?(r(),_(te,{key:6,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(U.overdue,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`overdue-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",Ta,[l("span",ka,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",Ca,[l("div",Sa,[l("div",Ua,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[49]||(e[49]=l("span",{class:"meta-label"},"分配：",-1)),l("span",$a,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",Na,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[50]||(e[50]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Da,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",Ra,[l("span",ja,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",za,u(A(t))+"%",1)])]),l("div",Ma,[s(d,{type:"primary",size:"small",onClick:ae=>Ue(t)},{default:o(()=>[...e[51]||(e[51]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:7,description:"无"}))])])]),_:1}),s(f,{label:"遇到问题",prop:"issues_encountered"},{default:o(()=>[s(y,{modelValue:n.issues_encountered,"onUpdate:modelValue":e[14]||(e[14]=t=>n.issues_encountered=t),type:"textarea",rows:3,placeholder:"描述工作中遇到的问题和困难",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(f,{label:"明日计划",prop:"next_day_plan"},{default:o(()=>[s(y,{modelValue:n.next_day_plan,"onUpdate:modelValue":e[15]||(e[15]=t=>n.next_day_plan=t),type:"textarea",rows:3,placeholder:"描述明日的工作计划",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(te,{gutter:20},{default:o(()=>[s(R,{span:12},{default:o(()=>[s(f,{label:"KPI 通次",prop:"call_count"},{default:o(()=>[s(H,{modelValue:n.call_count,"onUpdate:modelValue":e[16]||(e[16]=t=>n.call_count=t),min:0,step:1,placeholder:"今日拨打次数"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"KPI 通时",prop:"call_duration"},{default:o(()=>[s(H,{modelValue:n.call_duration,"onUpdate:modelValue":e[17]||(e[17]=t=>n.call_duration=t),min:0,step:1,placeholder:"拨打总时长（分钟）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(te,{gutter:20},{default:o(()=>{var t,ae;return[String(((t=C(T).user)==null?void 0:t.identity_type)||"").toLowerCase()==="cc"?(r(),V(I,{key:0},[s(R,{span:12},{default:o(()=>[s(f,{label:"当日实收金额",prop:"actual_amount"},{default:o(()=>[s(H,{modelValue:n.actual_amount,"onUpdate:modelValue":e[18]||(e[18]=M=>n.actual_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"新签金额",prop:"new_sign_amount"},{default:o(()=>[s(H,{modelValue:n.new_sign_amount,"onUpdate:modelValue":e[19]||(e[19]=M=>n.new_sign_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"转介绍金额",prop:"referral_amount"},{default:o(()=>[s(H,{modelValue:n.referral_amount,"onUpdate:modelValue":e[20]||(e[20]=M=>n.referral_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"转介绍单量",prop:"referral_count"},{default:o(()=>[s(H,{modelValue:n.referral_count,"onUpdate:modelValue":e[21]||(e[21]=M=>n.referral_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})],64)):String(((ae=C(T).user)==null?void 0:ae.identity_type)||"").toLowerCase()==="ss"?(r(),V(I,{key:1},[s(R,{span:12},{default:o(()=>[s(f,{label:"续费金额",prop:"renewal_amount"},{default:o(()=>[s(H,{modelValue:n.renewal_amount,"onUpdate:modelValue":e[22]||(e[22]=M=>n.renewal_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"升级金额",prop:"upgrade_amount"},{default:o(()=>[s(H,{modelValue:n.upgrade_amount,"onUpdate:modelValue":e[23]||(e[23]=M=>n.upgrade_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"续费单量",prop:"renewal_count"},{default:o(()=>[s(H,{modelValue:n.renewal_count,"onUpdate:modelValue":e[24]||(e[24]=M=>n.renewal_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(R,{span:12},{default:o(()=>[s(f,{label:"升级单量",prop:"upgrade_count"},{default:o(()=>[s(H,{modelValue:n.upgrade_count,"onUpdate:modelValue":e[25]||(e[25]=M=>n.upgrade_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})],64)):F("",!0)]}),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(Ee,{modelValue:Re.value,"onUpdate:modelValue":e[28]||(e[28]=t=>Re.value=t),title:"查看日报",width:"800px"},{default:o(()=>[w.value?(r(),V("div",Aa,[l("div",Fa,[l("h3",null,u(C(G)(w.value.report_date))+" 日报",1),l("div",La,[w.value.call_count!==void 0&&w.value.call_duration!==void 0?(r(),_(L,{key:0,type:"success"},{default:o(()=>[b(" KPI 通次/通时: "+u(w.value.call_count)+"/"+u(w.value.call_duration),1)]),_:1})):F("",!0),w.value.actual_amount||w.value.new_sign_amount||w.value.referral_amount||w.value.referral_count?(r(),_(L,{key:1,type:"warning",style:{"margin-left":"8px"}},{default:o(()=>[b(" CC 金额/单量: "+u(w.value.actual_amount)+" / 新签 "+u(w.value.new_sign_amount)+" / 转介 "+u(w.value.referral_amount)+" / 转介单量 "+u(w.value.referral_count),1)]),_:1})):F("",!0),w.value.renewal_amount||w.value.upgrade_amount||w.value.renewal_count||w.value.upgrade_count?(r(),_(L,{key:2,type:"info",style:{"margin-left":"8px"}},{default:o(()=>[b(" SS 金额/单量: 续费 "+u(w.value.renewal_amount)+" / 升级 "+u(w.value.upgrade_amount)+" / 续费单量 "+u(w.value.renewal_count)+" / 升级单量 "+u(w.value.upgrade_count),1)]),_:1})):F("",!0)])]),l("div",Pa,[e[57]||(e[57]=l("h4",null,"工作摘要",-1)),l("p",null,u(w.value.summary),1)]),l("div",Ya,[e[67]||(e[67]=l("h4",null,"完成任务",-1)),Ze.value?(r(),V("div",qa,[e[64]||(e[64]=l("h4",{class:"hierarchy-title"},"今日完成",-1)),D.completedToday.length>0?(r(),_(te,{key:0,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(D.completedToday,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`view-completed-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",Ba,[l("span",Oa,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",Ga,[l("div",Ea,[l("div",Ka,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[58]||(e[58]=l("span",{class:"meta-label"},"分配：",-1)),l("span",Ha,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",Ja,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[59]||(e[59]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Qa,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",Wa,[l("span",Xa,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Za,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:1,description:"无"})),e[65]||(e[65]=l("h4",{class:"hierarchy-title"},"今日到期",-1)),D.dueToday.length>0?(r(),_(te,{key:2,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(D.dueToday,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`view-due-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",el,[l("span",tl,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",al,[l("div",ll,[l("div",sl,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[60]||(e[60]=l("span",{class:"meta-label"},"分配：",-1)),l("span",ol,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",nl,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[61]||(e[61]=l("span",{class:"meta-label"},"截止：",-1)),l("span",rl,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",ul,[l("span",dl,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",il,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:3,description:"无"})),e[66]||(e[66]=l("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),D.ongoing.length>0?(r(),_(te,{key:4,gutter:12},{default:o(()=>[(r(!0),V(I,null,P(D.ongoing,t=>(r(),_(R,{xs:24,sm:12,md:12,lg:8,key:`view-ongoing-${t.id}`},{default:o(()=>[s(c,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",cl,[l("span",_l,u(t.title),1),s(L,{type:de(t.status),size:"small"},{default:o(()=>[b(u(ue(t.status)),1)]),_:2},1032,["type"])]),l("div",pl,[l("div",ml,[l("div",gl,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(fe(_e(t.assignment_type))))]),_:2},1024),e[62]||(e[62]=l("span",{class:"meta-label"},"分配：",-1)),l("span",fl,u(ie(t.assignment_type))+" · "+u(ce(t)),1)]),l("div",yl,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ye))]),_:1}),e[63]||(e[63]=l("span",{class:"meta-label"},"截止：",-1)),l("span",vl,u(t.due_date?C(G)(t.due_date):"无"),1)])]),l("div",hl,[l("span",wl,u(pe(t)),1),s(ee,{percentage:A(t),"stroke-width":10,color:me(X(t)),"show-text":!1},null,8,["percentage","color"]),l("span",bl,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(ge,{key:5,description:"无"}))])):(r(),V("p",Vl,u(w.value.completed_tasks),1))]),w.value.issues_encountered?(r(),V("div",xl,[e[68]||(e[68]=l("h4",null,"遇到问题",-1)),l("p",null,u(w.value.issues_encountered),1)])):F("",!0),l("div",Tl,[e[69]||(e[69]=l("h4",null,"明日计划",-1)),l("p",null,u(w.value.next_day_plan),1)])])):F("",!0)]),_:1},8,["modelValue"])])}}},Rl=bt(kl,[["__scopeId","data-v-2e925855"]]);export{Rl as default};
