import{_ as ee,e as v,b as Z,w as me,f as te,h as i,A as le,c as V,o as c,a as o,k as e,B as ae,j as l,p as m,i as F,t as f,F as M,r as B,x as D,E as U,l as fe,q as se}from"./index-un4HNty9.js";import{R as be}from"./refresh-DWkyc8-1.js";const ge={class:"list-header"},ye={class:"agent-assign"},ue="__create__",ie="__FEATURE_PERSONAL__",de="__FEATURE_TEAM__",Ve={__name:"CombinedAIConfig",setup(ne){const x=v(!1),b=v([]),T=v([]),k=v(!1),g=v(!1),a=v({name:"",description:"",provider:"openai",model_name:"",system_prompt:"",temperature:.7,max_tokens:1024,is_active:!0}),A=v(null),_=v([]),P=[{value:ie,label:"个人数据洞察（固定选择）"},{value:de,label:"团队数据洞察（固定选择）"}],L=Z(()=>[...(b.value||[]).map(t=>({value:t.id,label:t.name})),...P]),E=v(""),q=[{label:"通用对话",value:"chat"},{label:"内容生成",value:"content"},{label:"文本分析",value:"analysis"},{label:"翻译",value:"translate"},{label:"摘要",value:"summarize"},{label:"问答",value:"qa"}],Q={chat:"你是一名友善且高效的助手，擅长通用对话与任务协助。请用简洁、明确的方式回答用户问题。",content:"你是一名资深内容创作者。根据用户意图生成高质量文案，保持结构清晰、语气自然，并给出可执行的建议。",analysis:"你是一名文本分析专家。请从事实准确性、结构逻辑、情感倾向等维度分析输入文本，并给出客观结论。",translate:"你是一名专业翻译。保持原文含义不变，语言自然流畅；必要时可解释关键术语的译法选择。",summarize:"你是一名摘要助手。请在忠实原文的前提下，生成结构化要点摘要，突出结论与行动项。",qa:"你是一名知识问答助手。请先给出直接答案，再提供简短的依据或出处，避免无根据的臆测。"},W=()=>{a.value.system_prompt||(a.value.system_prompt=Q[E.value]||"")},I=[{label:"OpenRouter",value:"openrouter"},{label:"OpenAI",value:"openai"},{label:"Claude",value:"claude"},{label:"Gemini",value:"gemini"},{label:"DeepSeek",value:"deepseek"}],X={openai:["gpt-4o","gpt-4o-mini","gpt-4.1","gpt-4.1-mini","o4-mini"],claude:["claude-3-5-sonnet-latest","claude-3-5-haiku-latest","claude-3-opus-latest"],gemini:["gemini-1.5-pro","gemini-1.5-flash"],deepseek:["deepseek-chat","deepseek-reasoner"],openrouter:["openrouter/anthropic/claude-3-5-sonnet","openrouter/google/gemini-1.5-pro","openrouter/openai/gpt-4o"]},r=Z(()=>X[a.value.provider]||[]);me(()=>a.value.provider,()=>{r.value.length&&!r.value.includes(a.value.model_name)&&(a.value.model_name=r.value[0])});const u=async()=>{try{const{data:d}=await D.get("/api/v1/ai/agents");T.value=d||[]}catch(d){console.error(d),U.error("获取智能体失败")}},z=async()=>{x.value=!0;try{const{data:d}=await D.get("/api/v1/ai/functions");b.value=(d||[]).map(t=>({id:t.id,name:t.name,description:t.description,type:t.function_type??"custom",agent_id:t.agent_id??null,is_active:t.is_active??!0}))}catch(d){console.error(d),U.error("获取功能点失败")}finally{x.value=!1}},j=async(d,t)=>{if(t===ue){A.value=d.id,G(),d.agent_id=null;return}await R(d,t)},R=async(d,t)=>{try{const p={agent_id:t};await D.put(`/api/v1/ai/functions/${d.id}`,p),U.success("已更新关联智能体")}catch(p){console.error(p),U.error("更新失败")}},$=async(d,t)=>{try{const p={is_active:t};await D.put(`/api/v1/ai/functions/${d.id}`,p),U.success("状态已更新")}catch(p){console.error(p),U.error("更新失败")}},G=()=>{Object.assign(a.value,{name:"",description:"",provider:"openai",model_name:"",system_prompt:"",temperature:.7,max_tokens:1024,is_active:!0}),E.value="",k.value=!0,_.value=[]},H=async()=>{var d;try{const t={name:a.value.name,description:a.value.description,provider:a.value.provider,model_name:a.value.model_name,system_prompt:a.value.system_prompt,temperature:a.value.temperature,max_tokens:a.value.max_tokens,is_active:a.value.is_active},{data:p}=await D.post("/api/v1/ai/agents",t);if(U.success("智能体创建成功"),k.value=!1,await u(),A.value){const y=(p==null?void 0:p.id)||((d=T.value[0])==null?void 0:d.id),O=b.value.find(w=>w.id===A.value);A.value=null,O&&y&&(O.agent_id=y,await R(O,y))}const s=p==null?void 0:p.id;if(s&&_.value.length){for(const y of _.value)if(typeof y=="number"){const O=b.value.find(w=>w.id===y);O&&(O.agent_id=s,await R(O,s))}_.value=[],U.success("已为选定功能点绑定该智能体"),await z()}}catch(t){console.error(t),U.error("保存失败")}},J=d=>{const t=b.value.find(p=>p.name===d);return t?t.id:d==="个人数据洞察"?ie:de},K=d=>{const t=J(d==="personal"?"个人数据洞察":"团队数据洞察");_.value.includes(t)||(_.value.push(t),U.success("已添加到绑定列表"))},S=async()=>{await Promise.all([u(),z()])};return te(S),(d,t)=>{const p=i("el-button"),s=i("el-alert"),y=i("el-table-column"),O=i("el-tag"),w=i("el-option"),N=i("el-select"),re=i("el-switch"),pe=i("el-table"),Y=i("el-input"),C=i("el-form-item"),oe=i("el-input-number"),_e=i("el-form"),ce=i("el-dialog"),ve=le("loading");return c(),V("div",null,[o("div",ge,[t[17]||(t[17]=o("h3",null,"配置（智能体与功能点）",-1)),o("div",null,[e(p,{type:"primary",onClick:t[0]||(t[0]=n=>G())},{default:l(()=>[...t[15]||(t[15]=[m("新增智能体",-1)])]),_:1}),e(p,{link:"",onClick:S},{default:l(()=>[...t[16]||(t[16]=[m("刷新",-1)])]),_:1})])]),e(s,{type:"info","show-icon":"",class:"mb-12",closable:!1},{default:l(()=>[...t[18]||(t[18]=[m(" 在此统一创建功能点、创建智能体，并为功能点分配智能体。 ",-1)])]),_:1}),ae((c(),F(pe,{data:b.value,border:"",style:{width:"100%"}},{default:l(()=>[e(y,{prop:"id",label:"ID",width:"80"}),e(y,{prop:"name",label:"名称","min-width":"180"}),e(y,{prop:"description",label:"描述","min-width":"220"}),e(y,{prop:"type",label:"类型",width:"140"},{default:l(({row:n})=>[e(O,null,{default:l(()=>[m(f(n.type||"custom"),1)]),_:2},1024)]),_:1}),e(y,{label:"关联智能体","min-width":"260"},{default:l(({row:n})=>[o("div",ye,[e(N,{modelValue:n.agent_id,"onUpdate:modelValue":h=>n.agent_id=h,placeholder:"选择智能体",style:{width:"220px"},onChange:h=>j(n,h),filterable:""},{default:l(()=>[(c(!0),V(M,null,B(T.value,h=>(c(),F(w,{key:h.id,label:h.name,value:h.id},null,8,["label","value"]))),128)),e(w,{label:"新建智能体…",value:ue})]),_:1},8,["modelValue","onUpdate:modelValue","onChange"])])]),_:1}),e(y,{label:"启用",width:"120"},{default:l(({row:n})=>[e(re,{modelValue:n.is_active,"onUpdate:modelValue":h=>n.is_active=h,onChange:h=>$(n,h)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1},8,["data"])),[[ve,x.value]]),e(ce,{modelValue:k.value,"onUpdate:modelValue":t[14]||(t[14]=n=>k.value=n),title:g.value?"编辑智能体":"新增智能体",width:"680px"},{footer:l(()=>[e(p,{onClick:t[13]||(t[13]=n=>k.value=!1)},{default:l(()=>[...t[21]||(t[21]=[m("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:H},{default:l(()=>[...t[22]||(t[22]=[m("保存",-1)])]),_:1})]),default:l(()=>[e(_e,{model:a.value,"label-width":"100px"},{default:l(()=>[e(C,{label:"名称"},{default:l(()=>[e(Y,{modelValue:a.value.name,"onUpdate:modelValue":t[1]||(t[1]=n=>a.value.name=n),placeholder:"Agent 名称"},null,8,["modelValue"])]),_:1}),e(C,{label:"描述"},{default:l(()=>[e(Y,{modelValue:a.value.description,"onUpdate:modelValue":t[2]||(t[2]=n=>a.value.description=n),type:"textarea",rows:2},null,8,["modelValue"])]),_:1}),e(C,{label:"提供商"},{default:l(()=>[e(N,{modelValue:a.value.provider,"onUpdate:modelValue":t[3]||(t[3]=n=>a.value.provider=n),placeholder:"选择提供商"},{default:l(()=>[(c(),V(M,null,B(I,n=>e(w,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"作用"},{default:l(()=>[e(N,{modelValue:E.value,"onUpdate:modelValue":t[4]||(t[4]=n=>E.value=n),placeholder:"选择用途",onChange:W},{default:l(()=>[(c(),V(M,null,B(q,n=>e(w,{key:n.value,label:n.label,value:n.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"模型"},{default:l(()=>[e(N,{modelValue:a.value.model_name,"onUpdate:modelValue":t[5]||(t[5]=n=>a.value.model_name=n),placeholder:"选择模型",filterable:"","allow-create":"","default-first-option":""},{default:l(()=>[(c(!0),V(M,null,B(r.value,n=>(c(),F(w,{key:n,label:n,value:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"System Prompt"},{default:l(()=>[e(Y,{modelValue:a.value.system_prompt,"onUpdate:modelValue":t[6]||(t[6]=n=>a.value.system_prompt=n),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(C,{label:"绑定功能点"},{default:l(()=>[e(N,{modelValue:_.value,"onUpdate:modelValue":t[7]||(t[7]=n=>_.value=n),multiple:"",placeholder:"选择要绑定的功能点",style:{width:"100%"},filterable:""},{default:l(()=>[(c(!0),V(M,null,B(L.value,n=>(c(),F(w,{key:n.value,label:n.label,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(C,null,{default:l(()=>[e(p,{link:"",onClick:t[8]||(t[8]=n=>K("personal"))},{default:l(()=>[...t[19]||(t[19]=[m("快速绑定：个人数据洞察",-1)])]),_:1}),e(p,{link:"",onClick:t[9]||(t[9]=n=>K("team"))},{default:l(()=>[...t[20]||(t[20]=[m("快速绑定：团队数据洞察",-1)])]),_:1})]),_:1}),e(C,{label:"温度"},{default:l(()=>[e(oe,{modelValue:a.value.temperature,"onUpdate:modelValue":t[10]||(t[10]=n=>a.value.temperature=n),min:0,max:2,step:.1},null,8,["modelValue"])]),_:1}),e(C,{label:"Max Tokens"},{default:l(()=>[e(oe,{modelValue:a.value.max_tokens,"onUpdate:modelValue":t[11]||(t[11]=n=>a.value.max_tokens=n),min:256,step:128},null,8,["modelValue"])]),_:1}),e(C,{label:"状态"},{default:l(()=>[e(N,{modelValue:a.value.is_active,"onUpdate:modelValue":t[12]||(t[12]=n=>a.value.is_active=n)},{default:l(()=>[e(w,{label:"启用",value:!0}),e(w,{label:"关闭",value:!1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ke=ee(Ve,[["__scopeId","data-v-c8babe1d"]]),we={class:"list-header"},xe={class:"filters"},Ce={class:"ellipsis"},he={key:0},Ue={key:1},Ae={class:"pagination"},$e={key:0},Ee={class:"log-content"},Oe={class:"content-box"},Te={class:"content-box"},Ie={key:0},Se={class:"content-box error"},De={__name:"LogViewer",setup(ne){const x=v(!1),b=v([]),T=v(0),k=v(1),g=v(20),a=v({status:"",function_id:""}),A=v(!1),_=v(null),P=v([]),L=r=>({success:"成功",failed:"失败",pending:"进行中"})[r]||r,E=r=>({success:"success",failed:"danger",pending:"warning"})[r]||"info",q=r=>new Date(r).toLocaleString(),Q=r=>new Date(r.completed_at).getTime()-new Date(r.created_at).getTime(),W=async()=>{try{const{data:r}=await D.get("/ai/functions");P.value=r||[]}catch{}},I=async()=>{x.value=!0;try{const r={page:k.value,size:g.value};a.value.status&&(r.status=a.value.status),a.value.function_id&&(r.function_id=a.value.function_id);const{data:u}=await D.get("/ai/logs",{params:r});b.value=u.items||[],T.value=u.total||0}catch(r){console.error(r)}finally{x.value=!1}},X=r=>{_.value=r,A.value=!0};return te(async()=>{await Promise.all([W(),I()])}),(r,u)=>{const z=i("el-option"),j=i("el-select"),R=i("el-button"),$=i("el-table-column"),G=i("el-tooltip"),H=i("el-tag"),J=i("el-table"),K=i("el-pagination"),S=i("el-descriptions-item"),d=i("el-descriptions"),t=i("el-dialog"),p=le("loading");return c(),V("div",null,[o("div",we,[u[6]||(u[6]=o("h3",null,"调用日志",-1)),o("div",xe,[e(j,{modelValue:a.value.status,"onUpdate:modelValue":u[0]||(u[0]=s=>a.value.status=s),placeholder:"状态",clearable:"",onChange:I,style:{width:"140px"}},{default:l(()=>[e(z,{label:"成功",value:"success"}),e(z,{label:"失败",value:"failed"}),e(z,{label:"进行中",value:"pending"})]),_:1},8,["modelValue"]),e(j,{modelValue:a.value.function_id,"onUpdate:modelValue":u[1]||(u[1]=s=>a.value.function_id=s),placeholder:"功能点",clearable:"",onChange:I,style:{width:"180px"}},{default:l(()=>[(c(!0),V(M,null,B(P.value,s=>(c(),F(z,{key:s.id,label:s.name,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(R,{icon:fe(be),onClick:I},{default:l(()=>[...u[5]||(u[5]=[m("刷新",-1)])]),_:1},8,["icon"])])]),ae((c(),F(J,{data:b.value,border:"",style:{width:"100%"}},{default:l(()=>[e($,{prop:"created_at",label:"时间",width:"180"},{default:l(({row:s})=>[m(f(q(s.created_at)),1)]),_:1}),e($,{prop:"function_name",label:"功能点",width:"160"}),e($,{prop:"user_name",label:"用户",width:"120"}),e($,{label:"输入","min-width":"220"},{default:l(({row:s})=>[e(G,{content:s.input_text,placement:"top"},{default:l(()=>[o("span",Ce,f(s.input_text),1)]),_:2},1032,["content"])]),_:1}),e($,{label:"状态",width:"90"},{default:l(({row:s})=>[e(H,{type:E(s.status)},{default:l(()=>[m(f(L(s.status)),1)]),_:2},1032,["type"])]),_:1}),e($,{prop:"tokens_used",label:"Tokens",width:"100"}),e($,{label:"耗时",width:"100"},{default:l(({row:s})=>[s.completed_at&&s.created_at?(c(),V("span",he,f(Q(s))+"ms",1)):(c(),V("span",Ue,"-"))]),_:1}),e($,{label:"操作",width:"120",fixed:"right"},{default:l(({row:s})=>[e(R,{link:"",size:"small",onClick:y=>X(s)},{default:l(()=>[...u[7]||(u[7]=[m("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[p,x.value]]),o("div",Ae,[e(K,{"current-page":k.value,"onUpdate:currentPage":u[2]||(u[2]=s=>k.value=s),"page-size":g.value,"onUpdate:pageSize":u[3]||(u[3]=s=>g.value=s),total:T.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:I},null,8,["current-page","page-size","total"])]),e(t,{modelValue:A.value,"onUpdate:modelValue":u[4]||(u[4]=s=>A.value=s),title:"日志详情",width:"720px"},{default:l(()=>[_.value?(c(),V("div",$e,[e(d,{column:2,border:""},{default:l(()=>[e(S,{label:"时间"},{default:l(()=>[m(f(q(_.value.created_at)),1)]),_:1}),e(S,{label:"功能点"},{default:l(()=>[m(f(_.value.function_name),1)]),_:1}),e(S,{label:"用户"},{default:l(()=>[m(f(_.value.user_name),1)]),_:1}),e(S,{label:"状态"},{default:l(()=>[e(H,{type:E(_.value.status)},{default:l(()=>[m(f(L(_.value.status)),1)]),_:1},8,["type"])]),_:1}),e(S,{label:"Tokens"},{default:l(()=>[m(f(_.value.tokens_used||"-"),1)]),_:1})]),_:1}),o("div",Ee,[u[9]||(u[9]=o("h4",null,"输入",-1)),o("div",Oe,f(_.value.input_text),1),u[10]||(u[10]=o("h4",null,"输出",-1)),o("div",Te,f(_.value.output_text||"无"),1),_.value.error_message?(c(),V("div",Ie,[u[8]||(u[8]=o("h4",null,"错误",-1)),o("div",Se,f(_.value.error_message),1)])):se("",!0)])])):se("",!0)]),_:1},8,["modelValue"])])}}},Pe=ee(De,[["__scopeId","data-v-b7a9e89e"]]),ze={class:"page-container"},Fe={class:"card-header"},Le={class:"stats-grid"},Re={class:"stat-item"},Ne={class:"stat-value"},Me={class:"stat-item"},Be={class:"stat-value"},qe={class:"stat-item"},je={class:"stat-value"},Ge={class:"stat-item"},He={class:"stat-value"},Je={__name:"AdminAI",setup(ne){const x=v(!1),b=v({total_agents:0,total_features:0,total_calls:0,success_rate:0}),T=Z(()=>Number(b.value.success_rate||0).toFixed(1)),k=async()=>{x.value=!0;try{const{data:g}=await D.get("/ai/stats");b.value={total_agents:g.total_agents??0,total_features:g.total_features??g.total_functions??0,total_calls:g.total_calls??0,success_rate:g.success_rate??0}}catch(g){U.error("获取统计信息失败"),console.error(g)}finally{x.value=!1}};return te(()=>{k()}),(g,a)=>{const A=i("el-button"),_=i("el-card"),P=i("el-tab-pane"),L=i("el-tabs"),E=le("loading");return c(),V("div",ze,[a[6]||(a[6]=o("div",{class:"page-header"},[o("h2",null,"AI 管理"),o("p",{class:"subtitle"},"统一管理智能体、功能点配置与调用日志")],-1)),ae((c(),F(_,{class:"stats-card"},{header:l(()=>[o("div",Fe,[a[1]||(a[1]=o("span",null,"概览统计",-1)),e(A,{type:"primary",link:"",onClick:k},{default:l(()=>[...a[0]||(a[0]=[m("刷新",-1)])]),_:1})])]),default:l(()=>[o("div",Le,[o("div",Re,[o("div",Ne,f(b.value.total_agents),1),a[2]||(a[2]=o("div",{class:"stat-label"},"智能体数量",-1))]),o("div",Me,[o("div",Be,f(b.value.total_features),1),a[3]||(a[3]=o("div",{class:"stat-label"},"功能点数量",-1))]),o("div",qe,[o("div",je,f(b.value.total_calls),1),a[4]||(a[4]=o("div",{class:"stat-label"},"调用次数",-1))]),o("div",Ge,[o("div",He,f(T.value)+"%",1),a[5]||(a[5]=o("div",{class:"stat-label"},"成功率",-1))])])]),_:1})),[[E,x.value]]),e(L,{type:"border-card",class:"mt-16"},{default:l(()=>[e(P,{label:"配置（智能体与功能点）"},{default:l(()=>[e(ke)]),_:1}),e(P,{label:"调用日志"},{default:l(()=>[e(Pe)]),_:1})]),_:1})])}}},We=ee(Je,[["__scopeId","data-v-4cc4d5a1"]]);export{We as default};
