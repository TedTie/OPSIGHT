import{P as gt}from"./plus-D71D2uAo.js";import{S as ft}from"./search-CNhkWBrQ.js";import{R as yt}from"./refresh-CdRpkY-J.js";import{U as Ne}from"./user-vR_SDjOu.js";import{m as Qe,c as x,o as r,a as l,_ as vt,e as V,C as Ve,d as ht,b as Me,w as He,f as wt,k as s,j as o,h as k,x as H,E as R,u as bt,A as Je,B as ve,i as _,q as F,l as C,F as I,r as P,p as b,t as u,G as me,y as Vt}from"./index-D85A-Gbf.js";import{f as q,a as xt}from"./date-qiPTsFx8.js";const Tt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function kt(Ie,J){return r(),x("svg",Tt,[...J[0]||(J[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 21h18M9 8h1m-1 4h1m-1 4h1m4-8h1m-1 4h1m-1 4h1M5 21V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2v16"},null,-1)])])}const Ct=Qe({name:"tabler-building",render:kt}),St={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function $t(Ie,J){return r(),x("svg",St,[...J[0]||(J[0]=[l("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm12-4v4M8 3v4m-4 4h16m-9 4h1m0 0v3"},null,-1)])])}const ge=Qe({name:"tabler-calendar",render:$t}),Ut={class:"page-container"},Nt={class:"card-header"},Dt={class:"table-toolbar"},jt={class:"table-filters"},Rt={class:"table-actions"},zt={class:"pagination-container"},Mt={class:"completed-tasks-section"},It={key:0,class:"summary-scope-controls"},At={class:"task-hierarchy-section"},Ft={class:"task-card-header"},Lt={class:"task-title"},Pt={class:"task-card-body"},Yt={class:"task-meta"},qt={class:"meta-row"},Bt={class:"meta-value"},Ot={class:"meta-row"},Et={class:"meta-value"},Gt={class:"task-progress"},Kt={class:"progress-label"},Ht={class:"percent-text"},Jt={class:"task-card-footer"},Qt={class:"task-card-header"},Wt={class:"task-title"},Xt={class:"task-card-body"},Zt={class:"task-meta"},ea={class:"meta-row"},ta={class:"meta-value"},aa={class:"meta-row"},la={class:"meta-value"},sa={class:"task-progress"},oa={class:"progress-label"},na={class:"percent-text"},ra={class:"task-card-footer"},ua={class:"task-card-header"},da={class:"task-title"},ia={class:"task-card-body"},ca={class:"task-meta"},_a={class:"meta-row"},pa={class:"meta-value"},ma={class:"meta-row"},ga={class:"meta-value"},fa={class:"task-progress"},ya={class:"progress-label"},va={class:"percent-text"},ha={class:"task-card-footer"},wa={class:"task-card-header"},ba={class:"task-title"},Va={class:"task-card-body"},xa={class:"task-meta"},Ta={class:"meta-row"},ka={class:"meta-value"},Ca={class:"meta-row"},Sa={class:"meta-value"},$a={class:"task-progress"},Ua={class:"progress-label"},Na={class:"percent-text"},Da={class:"task-card-footer"},ja={class:"dialog-footer"},Ra={key:0,class:"report-detail"},za={class:"report-header"},Ma={class:"report-meta"},Ia={class:"report-section"},Aa={class:"report-section"},Fa={key:0,class:"task-hierarchy-section"},La={class:"task-card-header"},Pa={class:"task-title"},Ya={class:"task-card-body"},qa={class:"task-meta"},Ba={class:"meta-row"},Oa={class:"meta-value"},Ea={class:"meta-row"},Ga={class:"meta-value"},Ka={class:"task-progress"},Ha={class:"progress-label"},Ja={class:"percent-text"},Qa={class:"task-card-header"},Wa={class:"task-title"},Xa={class:"task-card-body"},Za={class:"task-meta"},el={class:"meta-row"},tl={class:"meta-value"},al={class:"meta-row"},ll={class:"meta-value"},sl={class:"task-progress"},ol={class:"progress-label"},nl={class:"percent-text"},rl={class:"task-card-header"},ul={class:"task-title"},dl={class:"task-card-body"},il={class:"task-meta"},cl={class:"meta-row"},_l={class:"meta-value"},pl={class:"meta-row"},ml={class:"meta-value"},gl={class:"task-progress"},fl={class:"progress-label"},yl={class:"percent-text"},vl={key:1},hl={key:0,class:"report-section"},wl={class:"report-section"},bl={__name:"Reports",setup(Ie){var Ee,Ge;const J=V(!1),xe=V([]),Q=Ve({dateRange:[],search:""}),T=ht(),oe=Me(()=>{var a,e;return!!((a=T.user)!=null&&a.is_admin)&&!((e=T.user)!=null&&e.is_super_admin)}),B=Me(()=>{var a;return!!((a=T.user)!=null&&a.is_super_admin)}),fe=V(null),ae=V(null),Te=V(null),ke=V([]),O=V([]),E=Ve({page:1,size:20,total:0}),le=V(!1),De=V(!1),se=V(!1),je=V(!1),he=V(),v=V(null),D=Ve({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),We=Me(()=>{var e,d,i,y,m,f,c,h,w;const a=(d=(e=v.value)==null?void 0:e.ai_analysis)==null?void 0:d.tasks_snapshot;return!!(a&&((i=a.completed_today)!=null&&i.length||(y=a.completedToday)!=null&&y.length||(m=a.due_today)!=null&&m.length||(f=a.dueToday)!=null&&f.length||(c=a.ongoing)!=null&&c.length||(h=a.ongoing_uncompleted)!=null&&h.length||(w=a.overdue_uncompleted)!=null&&w.length))}),n=Ve({report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0,actual_amount:0,new_sign_amount:0,referral_amount:0,referral_count:0,renewal_amount:0,upgrade_amount:0,renewal_count:0,upgrade_count:0});V([]);const Xe=V([]),Ae=V(!1),Fe=V(!1),Re=V(!1),$=Ve({completedToday:[],dueToday:[],ongoing:[],overdue:[]}),Ze=bt(),Y=V("all"),we=V(null),ye=V(null),Ce=V(null),et=V([{label:"CC(顾问)",value:"cc"},{label:"SS(班主任)",value:"ss"},{label:"LP(英文辅导)",value:"lp"}]),tt={report_date:[{required:!0,message:"请选择日报日期",trigger:"change"}],summary:[{required:!0,message:"请输入工作摘要",trigger:"blur"},{min:10,max:500,message:"摘要长度在 10 到 500 个字符",trigger:"blur"}],completed_tasks:[],next_day_plan:[{required:!0,message:"请输入明日计划",trigger:"blur"}]},ne=a=>({pending:"待处理",processing:"进行中",done:"已完成"})[a]||a,re=a=>{const e=String(a||"").toLowerCase(),d=(e.match(/(pending|processing|done)/)||[])[1]||e;return{pending:"info",processing:"warning",done:"success"}[d]||"info"},ue=a=>{const e={user:"指定用户",group:"指定组",identity:"指定身份",all:"所有人"},d=String(a||"").toLowerCase(),i=(d.match(/(user|group|identity|all)/)||[])[1]||d;return e[i]||i},de=a=>{var e,d,i,y;switch(a.assignment_type){case"user":if(a.assigned_to_username)return a.assigned_to_username;if(a.assigned_to&&((e=T.user)==null?void 0:e.id)===a.assigned_to)return((d=T.user)==null?void 0:d.username)||"";if(a.assigned_to){const m=(O.value||[]).find(f=>f.id===a.assigned_to);return(m==null?void 0:m.username)||"未知用户"}return"未知用户";case"group":if(a.target_group_name)return a.target_group_name;if(a.target_group_id!=null){const m=Number(a.target_group_id),f=(ke.value||[]).find(c=>Number(c.id)===m);return f!=null&&f.name?f.name:((i=T.user)==null?void 0:i.group_id)===m&&((y=T.user)!=null&&y.group_name)?T.user.group_name:"未知组"}return"未知组";case"identity":return a.target_identity||"-";case"all":return"所有人";default:return"-"}},ie=a=>{const e=String(a||"").toLowerCase(),d=(e.match(/(user|group|identity|all)/)||[])[1]||e;return{user:Ne,group:Ct,identity:Ne,all:Ne}[d]||Ne},Se=a=>{a!=null&&a.id&&Ze.push({path:"/tasks",query:{openTaskId:a.id}})},$e=(...a)=>{for(const e of a)if(e!=null)return e;return 0},ze=(a,e)=>{const d=Number(a)||0,i=Number(e);return!i||i<=0?0:d/i},W=a=>{if(!a)return 0;let e=0;switch(a.task_type){case"amount":e=ze(a.current_amount,a.target_amount);break;case"quantity":e=ze(a.current_quantity,a.target_quantity);break;case"jielong":{const d=$e(a.personal_jielong_current_count,a.jielong_current_count,0),i=$e(a.personal_jielong_target_count,a.jielong_target_count,0);e=ze(d,i);break}case"checkbox":e=a.is_completed?1:0;break;default:e=a.status==="done"?1:0}return isFinite(e)||(e=0),Math.max(0,Math.min(1,e))},A=a=>Math.round(W(a)*100),ce=a=>{if(!a)return"-";switch(a.task_type){case"amount":return`${a.current_amount||0} / ${a.target_amount||0}`;case"quantity":return`${a.current_quantity||0} / ${a.target_quantity||0}`;case"jielong":{const e=$e(a.personal_jielong_current_count,a.jielong_current_count,0),d=$e(a.personal_jielong_target_count,a.jielong_target_count,0);return`${e} / ${d}`}case"checkbox":return a.is_completed?"已完成":"未完成";default:return"-"}},_e=a=>a>=.8?"#67C23A":a>=.3?"#E6A23C":"#F56C6C",Ue=a=>({id:a.id,title:a.title,task_type:a.task_type,assignment_type:a.assignment_type,assigned_to:a.assigned_to,target_group_id:a.target_group_id,target_identity:a.target_identity,assigned_to_username:a.assigned_to_username,target_group_name:a.target_group_name,status:a.status,is_completed:a.is_completed,due_date:a.due_date,updated_at:a.updated_at,target_amount:a.target_amount,current_amount:a.current_amount,target_quantity:a.target_quantity,current_quantity:a.current_quantity,personal_jielong_target_count:a.personal_jielong_target_count,personal_jielong_current_count:a.personal_jielong_current_count,jielong_target_count:a.jielong_target_count,jielong_current_count:a.jielong_current_count}),Le=()=>({completed_today:($.completedToday||[]).map(Ue),due_today:($.dueToday||[]).map(Ue),ongoing:($.ongoing||[]).map(Ue),overdue_uncompleted:($.overdue||[]).map(Ue)}),at=async()=>{var a,e,d,i,y;Ae.value=!0;try{const m={page:1,size:100};B.value&&Y.value==="user"&&we.value&&(m.assigned_to=we.value);const f=await H.get("/tasks",{params:m});let c=Array.isArray(f.data)?f.data:((a=f.data)==null?void 0:a.items)||f.data||[];const h=w=>{const p=String(w||"").toLowerCase(),g=p.match(/(user|group|identity|all)/);return g?g[1]:p};if(oe.value&&Y.value==="group"){const w=ye.value||((e=T.user)==null?void 0:e.group_id);if(w){const p=(O.value||[]).map(g=>g.id);c=c.filter(g=>{const S=h(g.assignment_type);return S==="group"&&g.target_group_id===w||S==="user"&&p.includes(g.assigned_to)||S==="all"})}}else if(!oe.value&&!B.value){const w=(d=T.user)==null?void 0:d.id,p=(i=T.user)==null?void 0:i.group_id,g=String(((y=T.user)==null?void 0:y.identity_type)||"").toLowerCase();c=c.filter(S=>{const U=h(S.assignment_type);return U==="user"&&S.assigned_to===w||U==="group"&&S.target_group_id===p||U==="identity"&&String(S.target_identity||"").toLowerCase()===g||U==="all"})}else if(B.value){if(Y.value==="group"&&ye.value){const w=ye.value,p=(O.value||[]).filter(g=>g.group_id===w).map(g=>g.id);c=c.filter(g=>{const S=h(g.assignment_type);return S==="group"&&g.target_group_id===w||S==="user"&&p.includes(g.assigned_to)||S==="all"})}if(Y.value==="identity"&&Ce.value){const w=String(Ce.value||"").toLowerCase();c=c.filter(p=>h(p.assignment_type)==="identity"&&String(p.target_identity||"").toLowerCase()===w)}}return c}catch{return R.error("获取任务用于汇总失败"),[]}finally{Ae.value=!1}},Pe=(a,e)=>{if(!a||!e)return!1;const d=new Date(a),i=new Date(e);return d.getFullYear()===i.getFullYear()&&d.getMonth()===i.getMonth()&&d.getDate()===i.getDate()},X=async()=>{Fe.value=!0;try{const a=n.report_date||q(new Date),e=new Date(a+"T00:00:00"),d=await at(),i=[],y=[],m=[],f=[],c=[];d.forEach(p=>{const g=String(p.status||"").toLowerCase(),U=((g.match(/(pending|processing|done)/)||[])[1]||g)==="done"||p.is_completed===!0,N=p.due_date?new Date(p.due_date.replace(" ","T")):null,L=p.updated_at?new Date(String(p.updated_at).replace(" ","T")):null,z=!!(N&&Pe(N,e)),Z=!!(N&&N<e);U&&L&&Pe(L,e)&&m.push(p),z?U?i.push(p):y.push(p):!N||N&&N>e?U||f.push(p):!U&&Z&&c.push(p)});const h=[];m.length&&h.push(`【今日完成】
`+m.map(p=>`• ${p.title}`).join(`
`));const w=[];i.length&&w.push(...i.map(p=>`• ${p.title}（已完成）`)),y.length&&w.push(...y.map(p=>`• ${p.title}（未完成）`)),w.length&&h.push(`【今日到期】
`+w.join(`
`)),f.length&&h.push(`【正在进行（未到期/无截止）】
`+f.map(p=>`• ${p.title}`).join(`
`)),c.length&&h.push(`【逾期未完成】
`+c.map(p=>`• ${p.title}`).join(`
`)),n.completed_tasks=h.length?h.join(`

`):`【今日完成】
无

【今日到期】
无

【正在进行（未到期/无截止）】
无`,$.completedToday=m,$.dueToday=[...i,...y],$.ongoing=f,$.overdue=c}catch{R.error("自动加载任务汇总失败")}finally{Fe.value=!1}};B.value?Y.value="all":oe.value?(Y.value="group",ye.value=((Ee=T.user)==null?void 0:Ee.group_id)||null):(Y.value="user",we.value=((Ge=T.user)==null?void 0:Ge.id)||null),He(()=>le.value,a=>{a&&X()}),He(()=>n.report_date,()=>{le.value&&X()});const G=async()=>{var a,e,d;J.value=!0;try{const i={page:E.page,size:E.size,search:Q.search};Q.dateRange&&Q.dateRange.length===2&&(i.start_date=Q.dateRange[0],i.end_date=Q.dateRange[1]),B.value?(fe.value&&(i.group_id=fe.value),ae.value&&(i.user_id=ae.value)):oe.value?((a=T.user)!=null&&a.group_id&&(i.group_id=T.user.group_id),ae.value&&(i.user_id=ae.value)):(e=T.user)!=null&&e.id&&(i.user_id=T.user.id);const m=(await H.get("/reports",{params:i})).data,f=c=>({id:c.id,report_date:c.work_date,summary:c.work_summary??c.title??"",completed_tasks:c.task_progress??"",issues_encountered:c.challenges??"",next_day_plan:c.tomorrow_plan??"",call_count:c.call_count??0,call_duration:c.call_duration??0,actual_amount:c.actual_amount??0,new_sign_amount:c.new_sign_amount??0,referral_amount:c.referral_amount??0,referral_count:c.referral_count??0,renewal_amount:c.renewal_amount??0,upgrade_amount:c.upgrade_amount??0,renewal_count:c.renewal_count??0,upgrade_count:c.upgrade_count??0,ai_analysis:c.ai_analysis||{},created_at:c.created_at,updated_at:c.updated_at});if(Array.isArray(m))xe.value=m.map(f),E.total=m.length||0;else if(m&&typeof m=="object"){const c=m.items||[];xe.value=c.map(f),E.total=typeof m.total=="number"?m.total:((d=m.items)==null?void 0:d.length)||0}else xe.value=[],E.total=0}catch{R.error("获取日报列表失败")}finally{J.value=!1}},lt=async()=>{try{const a=await H.get("/groups",{params:{page:1,size:100}});ke.value=a.data.items||[]}catch{}},Ye=async()=>{var a;if(!((a=T.user)!=null&&a.group_id)){O.value=[];return}try{const e=await H.get(`/groups/${T.user.group_id}/members`);O.value=e.data||[]}catch{O.value=[]}},qe=async()=>{try{let e=(await H.get("/users",{params:{page:1,size:100}})).data.items||[];fe.value&&(e=e.filter(d=>d.group_id===fe.value)),Te.value&&(e=e.filter(d=>String(d.identity_type||"").toLowerCase()===String(Te.value||"").toLowerCase())),O.value=e}catch{O.value=[]}},Be=async()=>{B.value?await qe():oe.value&&await Ye()},st=async()=>{await Be(),await G()},ot=()=>{se.value=!1,n.report_date=new Date().toISOString().split("T")[0],le.value=!0,X()},Oe=V(!1),nt=async a=>{var i,y,m,f,c,h,w,p,g;const e=(i=a==null?void 0:a.ai_analysis)==null?void 0:i.tasks_snapshot;if(!(e&&((y=e.completed_today)!=null&&y.length||(m=e.completedToday)!=null&&m.length||(f=e.due_today)!=null&&f.length||(c=e.dueToday)!=null&&c.length||(h=e.ongoing)!=null&&h.length||(w=e.ongoing_uncompleted)!=null&&w.length))){Oe.value=!0;try{const U=((p=(await H.post(`/reports/${parseInt(a.id)}/build-snapshot`)).data)==null?void 0:p.ai_analysis)||{};v.value&&(v.value.ai_analysis=U);const N=(U==null?void 0:U.tasks_snapshot)||null;N&&(D.completedToday=N.completed_today||N.completedToday||[],D.dueToday=N.due_today||N.dueToday||[],D.ongoing=N.ongoing||N.ongoing_uncompleted||N.ongoingUncompleted||[],D.overdue=N.overdue_uncompleted||[])}catch(S){((g=S==null?void 0:S.response)==null?void 0:g.status)!==403&&(console.error("[Reports] build-snapshot failed",S),R.error("构建任务卡片快照失败"))}finally{Oe.value=!1}}},rt=async a=>{var d;v.value=a;const e=((d=a==null?void 0:a.ai_analysis)==null?void 0:d.tasks_snapshot)||null;e?(D.completedToday=e.completed_today||e.completedToday||[],D.dueToday=e.due_today||e.dueToday||[],D.ongoing=e.ongoing||e.ongoing_uncompleted||e.ongoingUncompleted||[],D.overdue=e.overdue_uncompleted||[]):(D.completedToday=[],D.dueToday=[],D.ongoing=[],D.overdue=[]),De.value=!0,await nt(a)},ut=a=>{se.value=!0,Object.assign(n,{id:parseInt(a.id),report_date:a.report_date,summary:a.summary,completed_tasks:"",issues_encountered:a.issues_encountered||"",next_day_plan:a.next_day_plan,call_count:a.call_count||0,call_duration:a.call_duration||0}),le.value=!0,X()},dt=()=>{he.value&&he.value.resetFields(),Object.assign(n,{report_date:"",summary:"",completed_tasks:"",issues_encountered:"",next_day_plan:"",call_count:0,call_duration:0,actual_amount:0,new_sign_amount:0,referral_amount:0,referral_count:0,renewal_amount:0,upgrade_amount:0,renewal_count:0,upgrade_count:0}),Xe.value=[]},it=async()=>{var a,e;if(he.value)try{await he.value.validate(),je.value=!0,await X();const i=[...$.completedToday||[],...$.dueToday||[],...$.ongoing||[]].map(h=>W(h)).filter(h=>Number.isFinite(h)),y=i.length?i.reduce((h,w)=>h+w,0)/i.length:.7,m=Math.max(1,Math.min(10,Math.round(y*10))),c=[`【工作摘要】
${n.summary||""}`,`【完成任务】
${n.completed_tasks||""}`,`【遇到问题】
${n.issues_encountered||""}`,`【明日计划】
${n.next_day_plan||""}`].join(`

`);if(se.value){const h={work_summary:n.summary||void 0,task_progress:n.completed_tasks||void 0,challenges:n.issues_encountered||void 0,tomorrow_plan:n.next_day_plan||void 0,call_count:Number.isFinite(Number(n.call_count))?Number(n.call_count):void 0,call_duration:Number.isFinite(Number(n.call_duration))?Number(n.call_duration):void 0,content:c||void 0,title:(n.summary||`日报 ${n.report_date||""}`).slice(0,200),tasks_snapshot:Le(),actual_amount:Number(n.actual_amount)||0,new_sign_amount:Number(n.new_sign_amount)||0,referral_amount:Number(n.referral_amount)||0,referral_count:Number(n.referral_count)||0,renewal_amount:Number(n.renewal_amount)||0,upgrade_amount:Number(n.upgrade_amount)||0,renewal_count:Number(n.renewal_count)||0,upgrade_count:Number(n.upgrade_count)||0};await H.put(`/reports/${n.id}`,h),R.success("日报更新成功")}else{const h=q(new Date),w=n.report_date||h,p={work_date:w,title:(n.summary||`日报 ${w}`).slice(0,200),content:c,work_hours:0,task_progress:n.completed_tasks||"",work_summary:n.summary||"",mood_score:0,efficiency_score:m,call_count:Number.isFinite(Number(n.call_count))?Number(n.call_count):0,call_duration:Number.isFinite(Number(n.call_duration))?Number(n.call_duration):0,achievements:void 0,challenges:n.issues_encountered||void 0,tomorrow_plan:n.next_day_plan||void 0,tasks_snapshot:Le(),actual_amount:Number(n.actual_amount)||0,new_sign_amount:Number(n.new_sign_amount)||0,referral_amount:Number(n.referral_amount)||0,referral_count:Number(n.referral_count)||0,renewal_amount:Number(n.renewal_amount)||0,upgrade_amount:Number(n.upgrade_amount)||0,renewal_count:Number(n.renewal_count)||0,upgrade_count:Number(n.upgrade_count)||0};console.debug("[Reports] POST /reports payload",p),await H.post("/reports",p),R.success("日报提交成功")}le.value=!1,G()}catch(d){const i=(a=d==null?void 0:d.response)==null?void 0:a.status,y=(e=d==null?void 0:d.response)==null?void 0:e.data;if(y!=null&&y.detail)R.error(y.detail);else if(i)if(i===500)R.error("服务器内部错误：请稍后重试或联系管理员");else if(i===422){const m=Array.isArray(y==null?void 0:y.detail)?y.detail.map(f=>f.msg).join("; "):"请求参数不合法";R.error(`提交失败：${m}`)}else R.error(`提交失败（HTTP ${i}）`);else R.error(se.value?"更新失败":"提交失败");console.error("[Reports] Submit error",{isEdit:se.value,reportForm:{...n},status:i,data:y})}finally{je.value=!1}},ct=async a=>{try{await Vt.confirm(`确定要删除${q(a.report_date)}的日报吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await H.delete(`/reports/${parseInt(a.id)}`),R.success("删除成功"),G()}catch(e){e!=="cancel"&&R.error("删除失败")}},_t=async()=>{var a,e;Re.value=!0;try{const d=new Date().toISOString().split("T")[0],i=await H.post("/task-sync/auto-generate-daily-report",{date:d});i.data.success?(R.success("自动生成日报成功"),G()):R.warning(i.data.message||"自动生成日报失败")}catch(d){console.error("自动生成日报失败:",d),(e=(a=d.response)==null?void 0:a.data)!=null&&e.detail?R.error(d.response.data.detail):R.error("自动生成日报失败")}finally{Re.value=!1}};return wt(async()=>{await lt(),B.value?await qe():oe.value&&await Ye(),await G()}),(a,e)=>{const d=k("el-button"),i=k("el-date-picker"),y=k("el-input"),m=k("el-option"),f=k("el-select"),c=k("el-table-column"),h=k("el-table"),w=k("el-pagination"),p=k("el-card"),g=k("el-form-item"),S=k("el-alert"),U=k("el-radio-button"),N=k("el-radio-group"),L=k("el-tag"),z=k("el-icon"),Z=k("el-progress"),j=k("el-col"),ee=k("el-row"),pe=k("el-empty"),K=k("el-input-number"),pt=k("el-form"),Ke=k("el-dialog"),be=Je("can"),mt=Je("loading");return r(),x("div",Ut,[e[70]||(e[70]=l("div",{class:"page-header"},[l("h1",{class:"page-title"},"日报管理"),l("p",{class:"page-description"},"查看和管理您的日报")],-1)),s(p,{class:"content-card"},{header:o(()=>[l("div",Nt,[e[30]||(e[30]=l("span",null,"日报列表",-1)),ve((r(),_(d,{type:"primary",icon:C(gt),onClick:ot},{default:o(()=>[...e[29]||(e[29]=[b(" 写日报 ",-1)])]),_:1},8,["icon"])),[[be,"reports:create"]])])]),default:o(()=>[l("div",Dt,[l("div",jt,[s(i,{modelValue:Q.dateRange,"onUpdate:modelValue":e[0]||(e[0]=t=>Q.dateRange=t),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),s(y,{modelValue:Q.search,"onUpdate:modelValue":e[1]||(e[1]=t=>Q.search=t),placeholder:"搜索日报...","prefix-icon":C(ft),clearable:""},null,8,["modelValue","prefix-icon"]),oe.value?(r(),_(f,{key:0,modelValue:ae.value,"onUpdate:modelValue":e[2]||(e[2]=t=>ae.value=t),placeholder:"筛选本组用户",clearable:"",onChange:G},{default:o(()=>[(r(!0),x(I,null,P(O.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),B.value?(r(),_(f,{key:1,modelValue:fe.value,"onUpdate:modelValue":e[3]||(e[3]=t=>fe.value=t),placeholder:"选择组别",clearable:"",onChange:st},{default:o(()=>[(r(!0),x(I,null,P(ke.value,t=>(r(),_(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),B.value?(r(),_(f,{key:2,modelValue:Te.value,"onUpdate:modelValue":e[4]||(e[4]=t=>Te.value=t),placeholder:"身份类型(CC(顾问)/SS(班主任)/LP(英文辅导))",clearable:"",onChange:Be},{default:o(()=>[s(m,{label:"CC(顾问)",value:"cc"}),s(m,{label:"SS(班主任)",value:"ss"}),s(m,{label:"LP(英文辅导)",value:"lp"})]),_:1},8,["modelValue"])):F("",!0),B.value?(r(),_(f,{key:3,modelValue:ae.value,"onUpdate:modelValue":e[5]||(e[5]=t=>ae.value=t),placeholder:"筛选用户",clearable:"",onChange:G},{default:o(()=>[(r(!0),x(I,null,P(O.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)]),l("div",Rt,[s(d,{icon:C(yt),onClick:G},{default:o(()=>[...e[31]||(e[31]=[b("刷新",-1)])]),_:1},8,["icon"]),ve((r(),_(d,{type:"info",onClick:_t,loading:Re.value},{default:o(()=>[...e[32]||(e[32]=[b(" 自动生成今日日报 ",-1)])]),_:1},8,["loading"])),[[be,"reports:auto_generate"]])])]),ve((r(),_(h,{data:xe.value,stripe:"",style:{width:"100%"}},{default:o(()=>[s(c,{prop:"report_date",label:"日期",width:"120"},{default:o(({row:t})=>[b(u(C(q)(t.report_date)),1)]),_:1}),s(c,{prop:"summary",label:"摘要","min-width":"300"}),s(c,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:t})=>[b(u(C(xt)(t.created_at)),1)]),_:1}),s(c,{label:"操作",width:"200",fixed:"right"},{default:o(({row:t})=>[ve((r(),_(d,{type:"primary",size:"small",onClick:te=>rt(t)},{default:o(()=>[...e[33]||(e[33]=[b(" 查看 ",-1)])]),_:1},8,["onClick"])),[[be,t,"report",{view:!0}]]),ve((r(),_(d,{type:"warning",size:"small",onClick:te=>ut(t)},{default:o(()=>[...e[34]||(e[34]=[b(" 编辑 ",-1)])]),_:1},8,["onClick"])),[[be,t,"report",{edit:!0}]]),ve((r(),_(d,{type:"danger",size:"small",onClick:te=>ct(t)},{default:o(()=>[...e[35]||(e[35]=[b(" 删除 ",-1)])]),_:1},8,["onClick"])),[[be,t,"report",{delete:!0}]])]),_:1})]),_:1},8,["data"])),[[mt,J.value]]),l("div",zt,[s(w,{"current-page":E.page,"onUpdate:currentPage":e[6]||(e[6]=t=>E.page=t),"page-size":E.size,"onUpdate:pageSize":e[7]||(e[7]=t=>E.size=t),total:E.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:G,onCurrentChange:G},null,8,["current-page","page-size","total"])])]),_:1}),s(Ke,{modelValue:le.value,"onUpdate:modelValue":e[27]||(e[27]=t=>le.value=t),title:se.value?"编辑日报":"写日报",width:"800px",onClose:dt},{footer:o(()=>[l("span",ja,[s(d,{onClick:e[26]||(e[26]=t=>le.value=!1)},{default:o(()=>[...e[56]||(e[56]=[b("取消",-1)])]),_:1}),s(d,{type:"primary",onClick:it,loading:je.value},{default:o(()=>[b(u(se.value?"更新":"提交"),1)]),_:1},8,["loading"])])]),default:o(()=>[s(pt,{ref_key:"formRef",ref:he,model:n,rules:tt,"label-width":"100px"},{default:o(()=>[s(g,{label:"日报日期",prop:"report_date"},{default:o(()=>[s(i,{modelValue:n.report_date,"onUpdate:modelValue":e[8]||(e[8]=t=>n.report_date=t),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",disabled:se.value},null,8,["modelValue","disabled"])]),_:1}),s(g,{label:"工作摘要",prop:"summary"},{default:o(()=>[s(y,{modelValue:n.summary,"onUpdate:modelValue":e[9]||(e[9]=t=>n.summary=t),type:"textarea",rows:3,placeholder:"请简要描述今日工作内容",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(g,{label:"完成任务",prop:"completed_tasks"},{default:o(()=>[l("div",Mt,[s(S,{title:"已自动加载：当日到期（已/未完成） + 正在进行未完成 + 逾期（今日完成/未完成）",type:"info",closable:!1,style:{"margin-bottom":"10px"}}),B.value?(r(),x("div",It,[s(N,{modelValue:Y.value,"onUpdate:modelValue":e[10]||(e[10]=t=>Y.value=t),size:"small",onChange:X},{default:o(()=>[s(U,{label:"all"},{default:o(()=>[...e[36]||(e[36]=[b("全部",-1)])]),_:1}),s(U,{label:"user"},{default:o(()=>[...e[37]||(e[37]=[b("个人",-1)])]),_:1}),s(U,{label:"group"},{default:o(()=>[...e[38]||(e[38]=[b("组别",-1)])]),_:1}),s(U,{label:"identity"},{default:o(()=>[...e[39]||(e[39]=[b("角色",-1)])]),_:1})]),_:1},8,["modelValue"]),Y.value==="user"?(r(),_(f,{key:0,modelValue:we.value,"onUpdate:modelValue":e[11]||(e[11]=t=>we.value=t),placeholder:"选择用户",filterable:"",style:{width:"220px"},onChange:X},{default:o(()=>[(r(!0),x(I,null,P(O.value,t=>(r(),_(m,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),Y.value==="group"?(r(),_(f,{key:1,modelValue:ye.value,"onUpdate:modelValue":e[12]||(e[12]=t=>ye.value=t),placeholder:"选择组别",filterable:"",style:{width:"220px"},onChange:X},{default:o(()=>[(r(!0),x(I,null,P(ke.value,t=>(r(),_(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0),Y.value==="identity"?(r(),_(f,{key:2,modelValue:Ce.value,"onUpdate:modelValue":e[13]||(e[13]=t=>Ce.value=t),placeholder:"选择角色",filterable:"",style:{width:"220px"},onChange:X},{default:o(()=>[(r(!0),x(I,null,P(et.value,t=>(r(),_(m,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):F("",!0)])):F("",!0),l("div",At,[e[52]||(e[52]=l("h4",{class:"hierarchy-title"},"今日完成",-1)),$.completedToday.length>0?(r(),_(ee,{key:0,gutter:12},{default:o(()=>[(r(!0),x(I,null,P($.completedToday,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`completed-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",Ft,[l("span",Lt,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",Pt,[l("div",Yt,[l("div",qt,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[40]||(e[40]=l("span",{class:"meta-label"},"分配：",-1)),l("span",Bt,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",Ot,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[41]||(e[41]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Et,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",Gt,[l("span",Kt,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Ht,u(A(t))+"%",1)])]),l("div",Jt,[s(d,{type:"primary",size:"small",onClick:te=>Se(t)},{default:o(()=>[...e[42]||(e[42]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:1,description:"无"})),e[53]||(e[53]=l("h4",{class:"hierarchy-title"},"今日到期",-1)),$.dueToday.length>0?(r(),_(ee,{key:2,gutter:12},{default:o(()=>[(r(!0),x(I,null,P($.dueToday,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`due-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",Qt,[l("span",Wt,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",Xt,[l("div",Zt,[l("div",ea,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[43]||(e[43]=l("span",{class:"meta-label"},"分配：",-1)),l("span",ta,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",aa,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[44]||(e[44]=l("span",{class:"meta-label"},"截止：",-1)),l("span",la,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",sa,[l("span",oa,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",na,u(A(t))+"%",1)])]),l("div",ra,[s(d,{type:"primary",size:"small",onClick:te=>Se(t)},{default:o(()=>[...e[45]||(e[45]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:3,description:"无"})),e[54]||(e[54]=l("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),$.ongoing.length>0?(r(),_(ee,{key:4,gutter:12},{default:o(()=>[(r(!0),x(I,null,P($.ongoing,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`ongoing-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",ua,[l("span",da,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",ia,[l("div",ca,[l("div",_a,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[46]||(e[46]=l("span",{class:"meta-label"},"分配：",-1)),l("span",pa,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",ma,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[47]||(e[47]=l("span",{class:"meta-label"},"截止：",-1)),l("span",ga,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",fa,[l("span",ya,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",va,u(A(t))+"%",1)])]),l("div",ha,[s(d,{type:"primary",size:"small",onClick:te=>Se(t)},{default:o(()=>[...e[48]||(e[48]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:5,description:"无"})),e[55]||(e[55]=l("h4",{class:"hierarchy-title"},"逾期（未完成）",-1)),$.overdue.length>0?(r(),_(ee,{key:6,gutter:12},{default:o(()=>[(r(!0),x(I,null,P($.overdue,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`overdue-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",wa,[l("span",ba,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",Va,[l("div",xa,[l("div",Ta,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[49]||(e[49]=l("span",{class:"meta-label"},"分配：",-1)),l("span",ka,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",Ca,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[50]||(e[50]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Sa,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",$a,[l("span",Ua,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Na,u(A(t))+"%",1)])]),l("div",Da,[s(d,{type:"primary",size:"small",onClick:te=>Se(t)},{default:o(()=>[...e[51]||(e[51]=[b("编辑记录",-1)])]),_:1},8,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:7,description:"无"}))])])]),_:1}),s(g,{label:"遇到问题",prop:"issues_encountered"},{default:o(()=>[s(y,{modelValue:n.issues_encountered,"onUpdate:modelValue":e[14]||(e[14]=t=>n.issues_encountered=t),type:"textarea",rows:3,placeholder:"描述工作中遇到的问题和困难",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(g,{label:"明日计划",prop:"next_day_plan"},{default:o(()=>[s(y,{modelValue:n.next_day_plan,"onUpdate:modelValue":e[15]||(e[15]=t=>n.next_day_plan=t),type:"textarea",rows:3,placeholder:"描述明日的工作计划",maxlength:"1000","show-word-limit":""},null,8,["modelValue"])]),_:1}),s(ee,{gutter:20},{default:o(()=>[s(j,{span:12},{default:o(()=>[s(g,{label:"KPI 通次",prop:"call_count"},{default:o(()=>[s(K,{modelValue:n.call_count,"onUpdate:modelValue":e[16]||(e[16]=t=>n.call_count=t),min:0,step:1,placeholder:"今日拨打次数"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"KPI 通时",prop:"call_duration"},{default:o(()=>[s(K,{modelValue:n.call_duration,"onUpdate:modelValue":e[17]||(e[17]=t=>n.call_duration=t),min:0,step:1,placeholder:"拨打总时长（分钟）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),s(ee,{gutter:20},{default:o(()=>{var t,te;return[String(((t=C(T).user)==null?void 0:t.identity_type)||"").toLowerCase()==="cc"?(r(),x(I,{key:0},[s(j,{span:12},{default:o(()=>[s(g,{label:"当日实收金额",prop:"actual_amount"},{default:o(()=>[s(K,{modelValue:n.actual_amount,"onUpdate:modelValue":e[18]||(e[18]=M=>n.actual_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"新签金额",prop:"new_sign_amount"},{default:o(()=>[s(K,{modelValue:n.new_sign_amount,"onUpdate:modelValue":e[19]||(e[19]=M=>n.new_sign_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"转介绍金额",prop:"referral_amount"},{default:o(()=>[s(K,{modelValue:n.referral_amount,"onUpdate:modelValue":e[20]||(e[20]=M=>n.referral_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"转介绍单量",prop:"referral_count"},{default:o(()=>[s(K,{modelValue:n.referral_count,"onUpdate:modelValue":e[21]||(e[21]=M=>n.referral_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})],64)):String(((te=C(T).user)==null?void 0:te.identity_type)||"").toLowerCase()==="ss"?(r(),x(I,{key:1},[s(j,{span:12},{default:o(()=>[s(g,{label:"续费金额",prop:"renewal_amount"},{default:o(()=>[s(K,{modelValue:n.renewal_amount,"onUpdate:modelValue":e[22]||(e[22]=M=>n.renewal_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"升级金额",prop:"upgrade_amount"},{default:o(()=>[s(K,{modelValue:n.upgrade_amount,"onUpdate:modelValue":e[23]||(e[23]=M=>n.upgrade_amount=M),min:0,step:.01,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"续费单量",prop:"renewal_count"},{default:o(()=>[s(K,{modelValue:n.renewal_count,"onUpdate:modelValue":e[24]||(e[24]=M=>n.renewal_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1}),s(j,{span:12},{default:o(()=>[s(g,{label:"升级单量",prop:"upgrade_count"},{default:o(()=>[s(K,{modelValue:n.upgrade_count,"onUpdate:modelValue":e[25]||(e[25]=M=>n.upgrade_count=M),min:0,step:1,"controls-position":"right"},null,8,["modelValue"])]),_:1})]),_:1})],64)):F("",!0)]}),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),s(Ke,{modelValue:De.value,"onUpdate:modelValue":e[28]||(e[28]=t=>De.value=t),title:"查看日报",width:"800px"},{default:o(()=>[v.value?(r(),x("div",Ra,[l("div",za,[l("h3",null,u(C(q)(v.value.report_date))+" 日报",1),l("div",Ma,[v.value.call_count!==void 0&&v.value.call_duration!==void 0?(r(),_(L,{key:0,type:"success"},{default:o(()=>[b(" KPI 通次/通时: "+u(v.value.call_count)+"/"+u(v.value.call_duration),1)]),_:1})):F("",!0),v.value.actual_amount||v.value.new_sign_amount||v.value.referral_amount||v.value.referral_count?(r(),_(L,{key:1,type:"warning",style:{"margin-left":"8px"}},{default:o(()=>[b(" CC 金额/单量: "+u(v.value.actual_amount)+" / 新签 "+u(v.value.new_sign_amount)+" / 转介 "+u(v.value.referral_amount)+" / 转介单量 "+u(v.value.referral_count),1)]),_:1})):F("",!0),v.value.renewal_amount||v.value.upgrade_amount||v.value.renewal_count||v.value.upgrade_count?(r(),_(L,{key:2,type:"info",style:{"margin-left":"8px"}},{default:o(()=>[b(" SS 金额/单量: 续费 "+u(v.value.renewal_amount)+" / 升级 "+u(v.value.upgrade_amount)+" / 续费单量 "+u(v.value.renewal_count)+" / 升级单量 "+u(v.value.upgrade_count),1)]),_:1})):F("",!0)])]),l("div",Ia,[e[57]||(e[57]=l("h4",null,"工作摘要",-1)),l("p",null,u(v.value.summary),1)]),l("div",Aa,[e[67]||(e[67]=l("h4",null,"完成任务",-1)),We.value?(r(),x("div",Fa,[e[64]||(e[64]=l("h4",{class:"hierarchy-title"},"今日完成",-1)),D.completedToday.length>0?(r(),_(ee,{key:0,gutter:12},{default:o(()=>[(r(!0),x(I,null,P(D.completedToday,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`view-completed-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",La,[l("span",Pa,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",Ya,[l("div",qa,[l("div",Ba,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[58]||(e[58]=l("span",{class:"meta-label"},"分配：",-1)),l("span",Oa,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",Ea,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[59]||(e[59]=l("span",{class:"meta-label"},"截止：",-1)),l("span",Ga,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",Ka,[l("span",Ha,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",Ja,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:1,description:"无"})),e[65]||(e[65]=l("h4",{class:"hierarchy-title"},"今日到期",-1)),D.dueToday.length>0?(r(),_(ee,{key:2,gutter:12},{default:o(()=>[(r(!0),x(I,null,P(D.dueToday,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`view-due-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",Qa,[l("span",Wa,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",Xa,[l("div",Za,[l("div",el,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[60]||(e[60]=l("span",{class:"meta-label"},"分配：",-1)),l("span",tl,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",al,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[61]||(e[61]=l("span",{class:"meta-label"},"截止：",-1)),l("span",ll,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",sl,[l("span",ol,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",nl,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:3,description:"无"})),e[66]||(e[66]=l("h4",{class:"hierarchy-title"},"正在进行（未到期/无截止）",-1)),D.ongoing.length>0?(r(),_(ee,{key:4,gutter:12},{default:o(()=>[(r(!0),x(I,null,P(D.ongoing,t=>(r(),_(j,{xs:24,sm:12,md:12,lg:8,key:`view-ongoing-${t.id}`},{default:o(()=>[s(p,{class:"task-card",shadow:"always"},{default:o(()=>[l("div",rl,[l("span",ul,u(t.title),1),s(L,{type:re(t.status),size:"small"},{default:o(()=>[b(u(ne(t.status)),1)]),_:2},1032,["type"])]),l("div",dl,[l("div",il,[l("div",cl,[s(z,{class:"meta-icon"},{default:o(()=>[(r(),_(me(ie(t.assignment_type))))]),_:2},1024),e[62]||(e[62]=l("span",{class:"meta-label"},"分配：",-1)),l("span",_l,u(ue(t.assignment_type))+" · "+u(de(t)),1)]),l("div",pl,[s(z,{class:"meta-icon"},{default:o(()=>[s(C(ge))]),_:1}),e[63]||(e[63]=l("span",{class:"meta-label"},"截止：",-1)),l("span",ml,u(t.due_date?C(q)(t.due_date):"无"),1)])]),l("div",gl,[l("span",fl,u(ce(t)),1),s(Z,{percentage:A(t),"stroke-width":10,color:_e(W(t)),"show-text":!1},null,8,["percentage","color"]),l("span",yl,u(A(t))+"%",1)])])]),_:2},1024)]),_:2},1024))),128))]),_:1})):(r(),_(pe,{key:5,description:"无"}))])):(r(),x("p",vl,u(v.value.completed_tasks),1))]),v.value.issues_encountered?(r(),x("div",hl,[e[68]||(e[68]=l("h4",null,"遇到问题",-1)),l("p",null,u(v.value.issues_encountered),1)])):F("",!0),l("div",wl,[e[69]||(e[69]=l("h4",null,"明日计划",-1)),l("p",null,u(v.value.next_day_plan),1)])])):F("",!0)]),_:1},8,["modelValue"])])}}},$l=vt(bl,[["__scopeId","data-v-34478fb1"]]);export{$l as default};
