import{a as lt,c as S,r as T,L as M,o as nt,l as E,f as t,g as a,w as e,b as c,d as A,m as I,P as D,E as it,e as u,k as x,F as U,n as P,t as n,h as _,D as rt,T as dt,G as ct,_ as ut,$ as pt}from"./index-g0Sg6k74.js";import{u as mt,i as _t,c as vt,a as gt,b as ht,d as ft,e as yt,f as bt,g as kt,H as Y}from"./index.esm.min-qddng1nX.js";import{g as N,b as wt}from"./date-CxVpZo2G.js";import{_ as St}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Tt={class:"page-container"},xt={class:"time-range-selector"},Ct={class:"stats-grid"},Et={class:"stat-content"},At={class:"stat-value"},Dt={class:"stat-icon"},Rt={class:"stat-content"},Vt={class:"stat-value"},Ot={class:"stat-icon"},Mt={class:"stat-content"},Yt={class:"stat-value"},$t={class:"stat-icon"},Ft={class:"stat-content"},It={class:"stat-value"},Ut={class:"stat-icon"},Pt={class:"stat-content"},zt={class:"stat-value"},qt={class:"stat-icon"},Bt={class:"charts-grid"},jt={class:"chart-container"},Gt={class:"chart-container"},Kt={class:"chart-container"},Nt={class:"chart-container"},Lt={class:"ai-stats-content"},Ht={class:"ai-stat-item"},Wt={class:"ai-stat-value"},Xt={class:"ai-stat-item"},Jt={class:"ai-stat-value"},Qt={class:"ai-stat-item"},Zt={class:"ai-stat-value"},ts={class:"ai-stat-item"},ss={class:"ai-stat-value"},as={class:"user-performance-content"},es={style:{"margin-left":"8px"}},os={class:"ai-insights-content"},ls={class:"insights-grid"},ns={class:"insight-item"},is={class:"insight-stats"},rs={class:"insight-stat"},ds={class:"value"},cs={class:"insight-stat"},us={class:"value"},ps={class:"insight-stat"},ms={class:"value"},_s={class:"insight-item"},vs={class:"keywords-container"},gs={class:"insight-item"},hs={class:"model-usage"},fs={class:"model-name"},ys={class:"model-stats"},bs={__name:"Analytics",setup(ks){mt([_t,vt,gt,ht,ft,yt,bt,kt]);const L=lt(),v=S(()=>L.user),g=T(!1),b=T("month"),$=T([]),R=T(null),z=T([]),k=M({totalTasks:0,completedTasks:0,completionRate:0,totalReports:0,avgEmotionScore:0}),p=M({taskTrend:[],taskStatus:[],emotionTrend:[],priorityDistribution:[]}),C=M({totalCalls:0,totalTokens:0,totalCost:0,avgProcessingTime:0}),q=T([]),h=M({emotionStats:{totalAnalyzed:0,avgEmotion:0,minEmotion:0,maxEmotion:0},commonKeywords:[],modelUsage:[]}),H=S(()=>{if(b.value==="custom")return $.value;const o=new Date;switch(b.value){case"week":return wt(o);case"month":return N(o);case"quarter":const s=new Date(o.getFullYear(),Math.floor(o.getMonth()/3)*3,1),r=new Date(s.getFullYear(),s.getMonth()+3,0);return[s.toISOString().split("T")[0],r.toISOString().split("T")[0]];default:return N(o)}}),W=S(()=>({tooltip:{trigger:"axis"},legend:{data:["已完成","新增"]},xAxis:{type:"category",data:p.taskTrend.map(o=>o.date)},yAxis:{type:"value"},series:[{name:"已完成",type:"line",data:p.taskTrend.map(o=>o.completed),smooth:!0,itemStyle:{color:"#67C23A"}},{name:"新增",type:"line",data:p.taskTrend.map(o=>o.created),smooth:!0,itemStyle:{color:"#409EFF"}}]})),X=S(()=>({tooltip:{trigger:"item"},legend:{orient:"vertical",left:"left"},series:[{type:"pie",radius:"50%",data:p.taskStatus,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})),J=S(()=>({tooltip:{trigger:"axis"},xAxis:{type:"category",data:p.emotionTrend.map(o=>o.date)},yAxis:{type:"value",min:0,max:1},series:[{name:"情感分数",type:"line",data:p.emotionTrend.map(o=>o.score),smooth:!0,itemStyle:{color:"#E6A23C"},areaStyle:{opacity:.3}}]})),Q=S(()=>({tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:p.priorityDistribution.map(o=>o.priority)},yAxis:{type:"value"},series:[{type:"bar",data:p.priorityDistribution.map(o=>({value:o.count,itemStyle:{color:o.priority==="高优先级"?"#F56C6C":o.priority==="中优先级"?"#E6A23C":"#67C23A"}}))}]})),Z=o=>o>=.7?"#67C23A":o>=.4?"#E6A23C":"#F56C6C",tt=o=>o>=10?"large":o>=5?"default":"small",st=()=>{b.value!=="custom"&&V()},at=async()=>{var o,s;if((o=v.value)!=null&&o.is_admin||(s=v.value)!=null&&s.is_super_admin)try{const r=await D.get("/groups");z.value=r.data}catch(r){console.error("获取用户组失败:",r)}},V=async()=>{var o,s;g.value=!0;try{const[r,F]=H.value,f={start_date:r,end_date:F};R.value&&(f.group_id=R.value);const O=await D.get("/analytics/stats",{params:f});Object.assign(k,O.data);const d=await D.get("/analytics/charts",{params:f});if(Object.assign(p,d.data.taskTrend?d.data:{taskTrend:d.data.task_trend||[],taskStatus:d.data.task_status||[],emotionTrend:d.data.emotion_trend||[],priorityDistribution:d.data.priority_distribution||[]}),d.data.ai_stats&&Object.assign(C,{totalCalls:d.data.ai_stats.total_calls,totalTokens:d.data.ai_stats.total_tokens,totalCost:d.data.ai_stats.total_cost,avgProcessingTime:d.data.ai_stats.avg_processing_time}),(o=v.value)!=null&&o.is_admin||(s=v.value)!=null&&s.is_super_admin){const y=await D.get("/analytics/user-performance",{params:f});q.value=y.data}const i=await D.get("/analytics/ai-insights",{params:f});Object.assign(h,{emotionStats:i.data.emotion_stats,commonKeywords:i.data.common_keywords,modelUsage:i.data.model_usage})}catch(r){it.error("获取分析数据失败"),console.error("Analytics fetch error:",r)}finally{g.value=!1}};return nt(async()=>{await at(),await V()}),(o,s)=>{var j,G;const r=c("el-radio-button"),F=c("el-radio-group"),f=c("el-date-picker"),O=c("el-option"),d=c("el-select"),i=c("el-card"),y=c("el-icon"),w=c("el-table-column"),B=c("el-tag"),et=c("el-progress"),ot=c("el-table");return u(),E("div",Tt,[s[30]||(s[30]=t("div",{class:"page-header"},[t("h1",{class:"page-title"},"数据分析"),t("p",{class:"page-description"},"查看任务和日报的统计分析")],-1)),a(i,{class:"content-card"},{header:e(()=>[...s[3]||(s[3]=[t("div",{class:"card-header"},[t("span",null,"时间范围")],-1)])]),default:e(()=>{var l,K;return[t("div",xt,[a(F,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=m=>b.value=m),onChange:st},{default:e(()=>[a(r,{label:"week"},{default:e(()=>[...s[4]||(s[4]=[x("本周",-1)])]),_:1}),a(r,{label:"month"},{default:e(()=>[...s[5]||(s[5]=[x("本月",-1)])]),_:1}),a(r,{label:"quarter"},{default:e(()=>[...s[6]||(s[6]=[x("本季度",-1)])]),_:1}),a(r,{label:"custom"},{default:e(()=>[...s[7]||(s[7]=[x("自定义",-1)])]),_:1})]),_:1},8,["modelValue"]),b.value==="custom"?(u(),A(f,{key:0,modelValue:$.value,"onUpdate:modelValue":s[1]||(s[1]=m=>$.value=m),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:V},null,8,["modelValue"])):I("",!0),(l=v.value)!=null&&l.is_admin||(K=v.value)!=null&&K.is_super_admin?(u(),A(d,{key:1,modelValue:R.value,"onUpdate:modelValue":s[2]||(s[2]=m=>R.value=m),placeholder:"选择用户组",clearable:"",onChange:V,style:{width:"200px"}},{default:e(()=>[a(O,{label:"全部用户组",value:null}),(u(!0),E(U,null,P(z.value,m=>(u(),A(O,{key:m.id,label:m.name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):I("",!0)])]}),_:1}),t("div",Ct,[a(i,{class:"stat-card"},{default:e(()=>[t("div",Et,[t("div",At,n(k.totalTasks),1),s[8]||(s[8]=t("div",{class:"stat-label"},"总任务数",-1))]),t("div",Dt,[a(y,null,{default:e(()=>[a(_(rt))]),_:1})])]),_:1}),a(i,{class:"stat-card"},{default:e(()=>[t("div",Rt,[t("div",Vt,n(k.completedTasks),1),s[9]||(s[9]=t("div",{class:"stat-label"},"已完成任务",-1))]),t("div",Ot,[a(y,null,{default:e(()=>[a(_(dt))]),_:1})])]),_:1}),a(i,{class:"stat-card"},{default:e(()=>[t("div",Mt,[t("div",Yt,n(k.completionRate)+"%",1),s[10]||(s[10]=t("div",{class:"stat-label"},"完成率",-1))]),t("div",$t,[a(y,null,{default:e(()=>[a(_(ct))]),_:1})])]),_:1}),a(i,{class:"stat-card"},{default:e(()=>[t("div",Ft,[t("div",It,n(k.totalReports),1),s[11]||(s[11]=t("div",{class:"stat-label"},"日报数量",-1))]),t("div",Ut,[a(y,null,{default:e(()=>[a(_(ut))]),_:1})])]),_:1}),a(i,{class:"stat-card"},{default:e(()=>[t("div",Pt,[t("div",zt,n(k.avgEmotionScore),1),s[12]||(s[12]=t("div",{class:"stat-label"},"平均情感分数",-1))]),t("div",qt,[a(y,null,{default:e(()=>[a(_(pt))]),_:1})])]),_:1})]),t("div",Bt,[a(i,{class:"chart-card"},{header:e(()=>[...s[13]||(s[13]=[t("span",null,"任务完成趋势",-1)])]),default:e(()=>[t("div",jt,[a(_(Y),{option:W.value,loading:g.value,style:{height:"300px"}},null,8,["option","loading"])])]),_:1}),a(i,{class:"chart-card"},{header:e(()=>[...s[14]||(s[14]=[t("span",null,"任务状态分布",-1)])]),default:e(()=>[t("div",Gt,[a(_(Y),{option:X.value,loading:g.value,style:{height:"300px"}},null,8,["option","loading"])])]),_:1}),a(i,{class:"chart-card"},{header:e(()=>[...s[15]||(s[15]=[t("span",null,"情感分数趋势",-1)])]),default:e(()=>[t("div",Kt,[a(_(Y),{option:J.value,loading:g.value,style:{height:"300px"}},null,8,["option","loading"])])]),_:1}),a(i,{class:"chart-card"},{header:e(()=>[...s[16]||(s[16]=[t("span",null,"任务优先级分布",-1)])]),default:e(()=>[t("div",Nt,[a(_(Y),{option:Q.value,loading:g.value,style:{height:"300px"}},null,8,["option","loading"])])]),_:1}),a(i,{class:"chart-card"},{header:e(()=>[...s[17]||(s[17]=[t("span",null,"AI使用统计",-1)])]),default:e(()=>[t("div",Lt,[t("div",Ht,[s[18]||(s[18]=t("div",{class:"ai-stat-label"},"总调用次数",-1)),t("div",Wt,n(C.totalCalls),1)]),t("div",Xt,[s[19]||(s[19]=t("div",{class:"ai-stat-label"},"总Token数",-1)),t("div",Jt,n(C.totalTokens),1)]),t("div",Qt,[s[20]||(s[20]=t("div",{class:"ai-stat-label"},"总成本",-1)),t("div",Zt,"$"+n(C.totalCost),1)]),t("div",ts,[s[21]||(s[21]=t("div",{class:"ai-stat-label"},"平均处理时间",-1)),t("div",ss,n(C.avgProcessingTime)+"s",1)])])]),_:1}),(j=v.value)!=null&&j.is_admin||(G=v.value)!=null&&G.is_super_admin?(u(),A(i,{key:0,class:"chart-card user-performance-card"},{header:e(()=>[...s[22]||(s[22]=[t("span",null,"用户绩效排行",-1)])]),default:e(()=>[t("div",as,[a(ot,{data:q.value,style:{width:"100%"},loading:g.value,size:"small"},{default:e(()=>[a(w,{prop:"username",label:"用户名",width:"120"}),a(w,{prop:"totalTasks",label:"总任务",width:"80"}),a(w,{prop:"completedTasks",label:"已完成",width:"80"}),a(w,{prop:"completionRate",label:"完成率",width:"80"},{default:e(l=>[a(B,{type:l.row.completionRate>=80?"success":l.row.completionRate>=60?"warning":"danger"},{default:e(()=>[x(n(l.row.completionRate)+"% ",1)]),_:2},1032,["type"])]),_:1}),a(w,{prop:"totalReports",label:"日报数",width:"80"}),a(w,{prop:"avgEmotionScore",label:"情感分数",width:"100"},{default:e(l=>[a(et,{percentage:l.row.avgEmotionScore*100,color:Z(l.row.avgEmotionScore),"show-text":!1,style:{width:"60px"}},null,8,["percentage","color"]),t("span",es,n(l.row.avgEmotionScore),1)]),_:1})]),_:1},8,["data","loading"])])]),_:1})):I("",!0)]),a(i,{class:"ai-insights-card"},{header:e(()=>[...s[23]||(s[23]=[t("span",null,"AI分析洞察",-1)])]),default:e(()=>[t("div",os,[t("div",ls,[t("div",ns,[s[27]||(s[27]=t("h4",null,"情感分析统计",-1)),t("div",is,[t("div",rs,[s[24]||(s[24]=t("span",{class:"label"},"已分析报告:",-1)),t("span",ds,n(h.emotionStats.totalAnalyzed),1)]),t("div",cs,[s[25]||(s[25]=t("span",{class:"label"},"平均情感分数:",-1)),t("span",us,n(h.emotionStats.avgEmotion),1)]),t("div",ps,[s[26]||(s[26]=t("span",{class:"label"},"情感分数范围:",-1)),t("span",ms,n(h.emotionStats.minEmotion)+" - "+n(h.emotionStats.maxEmotion),1)])])]),t("div",_s,[s[28]||(s[28]=t("h4",null,"常见关键词",-1)),t("div",vs,[(u(!0),E(U,null,P(h.commonKeywords.slice(0,10),l=>(u(),A(B,{key:l.keyword,class:"keyword-tag",size:tt(l.frequency)},{default:e(()=>[x(n(l.keyword)+" ("+n(l.frequency)+") ",1)]),_:2},1032,["size"]))),128))])]),t("div",gs,[s[29]||(s[29]=t("h4",null,"AI模型使用情况",-1)),t("div",hs,[(u(!0),E(U,null,P(h.modelUsage,l=>(u(),E("div",{key:l.model,class:"model-item"},[t("div",fs,n(l.model),1),t("div",ys,[t("span",null,"使用次数: "+n(l.count),1),t("span",null,"平均处理时间: "+n(l.avgProcessingTime)+"s",1)])]))),128))])])])])]),_:1})])}}},Cs=St(bs,[["__scopeId","data-v-3948cf74"]]);export{Cs as default};
