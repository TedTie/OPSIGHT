import{S as Ke}from"./search-BJMowTUF.js";import{P as Pe}from"./plus-QCcyPRoI.js";import{R as He}from"./refresh-D2P9cjYi.js";import{m as K,c as m,o as s,a as n,_ as qe,d as Ne,b as j,e as p,C as re,x as h,w as Ye,f as Ge,k as o,i as k,q as C,j as a,h as u,E as v,u as Oe,A as Qe,F as H,r as q,s as Je,G as We,t as r,B as Xe,l as S,p as d,y as ue}from"./index-B9ntIOOh.js";import{E as Ze}from"./edit-BdcnGOSH.js";import{D as et}from"./trash-oj3xyLEj.js";import{D as tt}from"./file-text-RiLVEpJL.js";import{U as lt}from"./user-CuZwciWH.js";const ot={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function at(T,c){return s(),m("svg",ot,[...c[0]||(c[0]=[n("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[n("path",{d:"M10 12a2 2 0 1 0 4 0a2 2 0 0 0-4 0"}),n("path",{d:"M21 12q-3.6 6-9 6t-9-6q3.6-6 9-6t9 6"})],-1)])])}const nt=K({name:"tabler-eye",render:at}),st={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function it(T,c){return s(),m("svg",st,[...c[0]||(c[0]=[n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 9l5-5l5 5m-5-5v12"},null,-1)])])}const rt=K({name:"tabler-upload",render:it}),ut={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function dt(T,c){return s(),m("svg",ut,[...c[0]||(c[0]=[n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 17v2a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2M7 11l5 5l5-5m-5-7v12"},null,-1)])])}const ct=K({name:"tabler-download",render:dt}),pt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function mt(T,c){return s(),m("svg",pt,[...c[0]||(c[0]=[n("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[n("path",{d:"M3 3v18h18"}),n("path",{d:"M7 15a2 2 0 1 0 4 0a2 2 0 1 0-4 0m4-10a2 2 0 1 0 4 0a2 2 0 1 0-4 0m5 7a2 2 0 1 0 4 0a2 2 0 1 0-4 0m5-9l-6 1.5m-.887 2.15l2.771 3.695M16 12.5l-5 2"})],-1)])])}const ft=K({name:"tabler-chart-dots-2",render:mt}),vt={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function _t(T,c){return s(),m("svg",vt,[...c[0]||(c[0]=[n("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[n("path",{d:"M22 9L12 5L2 9l10 4zv6"}),n("path",{d:"M6 10.6V16a6 3 0 0 0 12 0v-5.4"})],-1)])])}const gt=K({name:"tabler-school",render:_t}),yt={class:"knowledge-base-container"},wt={class:"module-content"},ht={class:"module-stats"},kt={class:"toolbar"},bt={class:"toolbar-left"},Ct={class:"toolbar-right"},xt={class:"knowledge-title"},Vt={class:"pagination-container"},St={key:0,class:"uploaded-files"},Ut={class:"dialog-footer"},Dt={key:0,class:"knowledge-detail"},Mt={class:"knowledge-meta"},zt={class:"meta-info"},Bt={class:"meta-info"},$t={key:0,class:"knowledge-description"},Rt={class:"knowledge-content"},Ft={class:"content-text"},Et={key:1,class:"knowledge-files"},At={class:"file-list"},Lt={class:"file-size"},Tt={__name:"KnowledgeBase",setup(T){const c=Ne();Oe();const _=j(()=>c.user),de=j(()=>{var l,e;return((l=_.value)==null?void 0:l.is_admin)||((e=_.value)==null?void 0:e.is_super_admin)}),W=p([{type:"SUMMARY",name:"汇总模块",description:"数据汇总和分析相关知识",icon:ft,count:0},{type:"CC",name:"CC模块",description:"顾问相关知识和经验",icon:lt,count:0},{type:"SS",name:"SS模块",description:"班主任相关知识和经验",icon:gt,count:0},{type:"LP",name:"LP模块",description:"英文辅导相关知识",icon:tt,count:0}]),U=p("SUMMARY"),N=p(""),Y=p(""),G=p(""),P=p(!1),O=p(!1),X=p([]),Z=p([]),g=re({page:1,size:20,total:0}),B=p(!1),Q=p(!1),$=p(!1),f=p(null),ee=p(),i=re({title:"",description:"",content:"",module_type:"SUMMARY",category:"",status:"DRAFT",is_public:!1,tags:[]}),R=p(""),D=p([]),ce={title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}]},pe=j(()=>`${h.defaults.baseURL}/knowledge-base/upload`),me=j(()=>({})),fe=j(()=>({knowledge_id:i.id||null})),ve=l=>{U.value=l,i.module_type=l,y()},_e=()=>{g.page=1,y()},ge=({prop:l,order:e})=>{y()},ye=l=>{g.size=l,g.page=1,y()},we=l=>{g.page=l,y()},he=()=>{y()},ke=()=>{$.value=!1,Ve(),B.value=!0},be=l=>{$.value=!0,Object.assign(i,l),R.value=l.tags?l.tags.join(", "):"",D.value=l.files||[],B.value=!0},te=async l=>{try{const e=await h.get(`/knowledge-base/${l.id}`);f.value=e.data,Q.value=!0}catch{v.error("获取知识详情失败")}},Ce=async l=>{try{await ue.confirm(`确定要删除知识"${l.title}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await h.delete(`/knowledge-base/${l.id}`),v.success("删除成功"),y()}catch(e){e!=="cancel"&&v.error("删除失败")}},xe=async()=>{try{await ee.value.validate(),O.value=!0,i.tags=R.value?R.value.split(",").map(l=>l.trim()).filter(l=>l):[],$.value?(await h.put(`/knowledge-base/${i.id}`,i),v.success("更新成功")):(await h.post("/knowledge-base/",i),v.success("创建成功")),B.value=!1,y()}catch{v.error($.value?"更新失败":"创建失败")}finally{O.value=!1}},Ve=()=>{Object.assign(i,{title:"",description:"",content:"",module_type:U.value,category:"",status:"DRAFT",is_public:!1,tags:[]}),R.value="",D.value=[]},Se=l=>{ue.confirm("确定要关闭吗？未保存的更改将丢失。").then(()=>{l()}).catch(()=>{})},Ue=l=>{const b=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","text/plain"].includes(l.type),w=l.size/1024/1024<10;return b?w?!0:(v.error("文件大小不能超过 10MB!"),!1):(v.error("只支持 doc/docx/pdf/txt/xlsx/pptx 格式的文件!"),!1)},De=(l,e)=>{l.success&&l.file_info?(D.value.push(l.file_info),v.success("文件上传成功")):v.error(l.message||"文件上传失败")},Me=(l,e)=>{v.error("文件上传失败")},ze=async l=>{try{await h.delete(`/knowledge-base/files/${l.id}`),D.value=D.value.filter(e=>e.id!==l.id),v.success("文件删除成功")}catch{v.error("文件删除失败")}},Be=l=>{window.open(`${h.defaults.baseURL}/knowledge-base/files/${l.id}/download`)},y=async()=>{try{P.value=!0;const l={module_type:U.value,page:g.page,size:g.size,search:N.value,category:Y.value,status:G.value},e=await h.get("/knowledge-base/search",{params:l});X.value=e.data.items,g.total=e.data.total;const b=await h.get("/knowledge-base/stats");W.value.forEach(w=>{const x=b.data.find(I=>I.module_type===w.type);w.count=x?x.count:0})}catch{v.error("获取知识列表失败")}finally{P.value=!1}},le=async()=>{try{const l=await h.get("/knowledge-base/categories",{params:{module_type:U.value}});Z.value=l.data}catch(l){console.error("获取分类失败:",l)}},oe=l=>({DRAFT:"info",PUBLISHED:"success",ARCHIVED:"warning"})[l]||"info",ae=l=>({DRAFT:"草稿",PUBLISHED:"已发布",ARCHIVED:"已归档"})[l]||"未知",ne=l=>l?new Date(l).toLocaleString("zh-CN"):"",$e=l=>{if(!l)return"0 B";const e=1024,b=["B","KB","MB","GB"],w=Math.floor(Math.log(l)/Math.log(e));return parseFloat((l/Math.pow(e,w)).toFixed(2))+" "+b[w]},Re=l=>_.value?!!(_.value.is_super_admin||l.created_by===_.value.id||_.value.is_admin&&String(l.module_type||"").toUpperCase()===String(_.value.identity_type||"").toUpperCase()):!1,Fe=l=>_.value?!!(_.value.is_super_admin||l.created_by===_.value.id||_.value.is_admin&&String(l.module_type||"").toUpperCase()===String(_.value.identity_type||"").toUpperCase()):!1;return Ye(U,()=>{le(),y()}),Ge(()=>{le(),y()}),(l,e)=>{const b=u("el-icon"),w=u("el-card"),x=u("el-col"),I=u("el-row"),F=u("el-input"),M=u("el-option"),J=u("el-select"),z=u("el-button"),se=u("el-link"),E=u("el-tag"),A=u("el-table-column"),Ee=u("el-table"),Ae=u("el-pagination"),V=u("el-form-item"),Le=u("el-switch"),Te=u("el-upload"),Ie=u("el-form"),ie=u("el-dialog"),je=Qe("loading");return s(),m("div",yt,[e[27]||(e[27]=n("div",{class:"page-header"},[n("h1",null,"知识库管理"),n("p",null,"管理和组织团队知识资源")],-1)),o(I,{gutter:20,class:"module-cards"},{default:a(()=>[(s(!0),m(H,null,q(W.value,t=>(s(),k(x,{span:6,key:t.type},{default:a(()=>[o(w,{class:Je(["module-card",{active:U.value===t.type}]),onClick:L=>ve(t.type),shadow:"hover"},{default:a(()=>[n("div",wt,[o(b,{size:32,class:"module-icon"},{default:a(()=>[(s(),k(We(t.icon)))]),_:2},1024),n("h3",null,r(t.name),1),n("p",null,r(t.description),1),n("div",ht,[n("span",null,r(t.count||0)+" 条知识",1)])])]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),U.value?(s(),k(w,{key:0,class:"content-card"},{default:a(()=>[n("div",kt,[n("div",bt,[o(F,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),placeholder:"搜索知识...",style:{width:"300px"},clearable:"",onInput:_e},{prefix:a(()=>[o(b,null,{default:a(()=>[o(S(Ke))]),_:1})]),_:1},8,["modelValue"]),o(J,{modelValue:Y.value,"onUpdate:modelValue":e[1]||(e[1]=t=>Y.value=t),placeholder:"选择分类",clearable:"",style:{width:"150px","margin-left":"10px"}},{default:a(()=>[(s(!0),m(H,null,q(Z.value,t=>(s(),k(M,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(J,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=t=>G.value=t),placeholder:"状态",clearable:"",style:{width:"120px","margin-left":"10px"}},{default:a(()=>[o(M,{label:"草稿",value:"DRAFT"}),o(M,{label:"已发布",value:"PUBLISHED"}),o(M,{label:"已归档",value:"ARCHIVED"})]),_:1},8,["modelValue"])]),n("div",Ct,[de.value?(s(),k(z,{key:0,type:"primary",onClick:ke,icon:S(Pe)},{default:a(()=>[...e[15]||(e[15]=[d(" 新建知识 ",-1)])]),_:1},8,["icon"])):C("",!0),o(z,{onClick:he,icon:S(He),loading:P.value},{default:a(()=>[...e[16]||(e[16]=[d(" 刷新 ",-1)])]),_:1},8,["icon","loading"])])]),Xe((s(),k(Ee,{data:X.value,style:{width:"100%"},onSortChange:ge},{default:a(()=>[o(A,{prop:"title",label:"标题","min-width":"200",sortable:"custom"},{default:a(({row:t})=>[n("div",xt,[o(se,{onClick:L=>te(t),type:"primary"},{default:a(()=>[d(r(t.title),1)]),_:2},1032,["onClick"]),t.tags&&t.tags.length>0?(s(),k(E,{key:0,size:"small",style:{"margin-left":"8px"}},{default:a(()=>[d(r(t.tags[0]),1)]),_:2},1024)):C("",!0)])]),_:1}),o(A,{prop:"category",label:"分类",width:"120"},{default:a(({row:t})=>[o(E,{size:"small",type:"info"},{default:a(()=>[d(r(t.category||"未分类"),1)]),_:2},1024)]),_:1}),o(A,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[o(E,{type:oe(t.status),size:"small"},{default:a(()=>[d(r(ae(t.status)),1)]),_:2},1032,["type"])]),_:1}),o(A,{prop:"view_count",label:"查看次数",width:"100",sortable:"custom"}),o(A,{prop:"created_at",label:"创建时间",width:"180",sortable:"custom"},{default:a(({row:t})=>[d(r(ne(t.created_at)),1)]),_:1}),o(A,{label:"操作",width:"200",fixed:"right"},{default:a(({row:t})=>[o(z,{size:"small",onClick:L=>te(t),icon:S(nt)},{default:a(()=>[...e[17]||(e[17]=[d(" 查看 ",-1)])]),_:1},8,["onClick","icon"]),Re(t)?(s(),k(z,{key:0,size:"small",onClick:L=>be(t),icon:S(Ze)},{default:a(()=>[...e[18]||(e[18]=[d(" 编辑 ",-1)])]),_:1},8,["onClick","icon"])):C("",!0),Fe(t)?(s(),k(z,{key:1,size:"small",type:"danger",onClick:L=>Ce(t),icon:S(et)},{default:a(()=>[...e[19]||(e[19]=[d(" 删除 ",-1)])]),_:1},8,["onClick","icon"])):C("",!0)]),_:1})]),_:1},8,["data"])),[[je,P.value]]),n("div",Vt,[o(Ae,{"current-page":g.page,"onUpdate:currentPage":e[3]||(e[3]=t=>g.page=t),"page-size":g.size,"onUpdate:pageSize":e[4]||(e[4]=t=>g.size=t),"page-sizes":[10,20,50,100],total:g.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ye,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),_:1})):C("",!0),o(ie,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=t=>B.value=t),title:$.value?"编辑知识":"新建知识",width:"80%","before-close":Se},{footer:a(()=>[n("span",Ut,[o(z,{onClick:e[12]||(e[12]=t=>B.value=!1)},{default:a(()=>[...e[23]||(e[23]=[d("取消",-1)])]),_:1}),o(z,{type:"primary",onClick:xe,loading:O.value},{default:a(()=>[d(r($.value?"更新":"创建"),1)]),_:1},8,["loading"])])]),default:a(()=>[o(Ie,{ref_key:"knowledgeFormRef",ref:ee,model:i,rules:ce,"label-width":"100px"},{default:a(()=>[o(I,{gutter:20},{default:a(()=>[o(x,{span:12},{default:a(()=>[o(V,{label:"标题",prop:"title"},{default:a(()=>[o(F,{modelValue:i.title,"onUpdate:modelValue":e[5]||(e[5]=t=>i.title=t),placeholder:"请输入知识标题"},null,8,["modelValue"])]),_:1})]),_:1}),o(x,{span:12},{default:a(()=>[o(V,{label:"分类",prop:"category"},{default:a(()=>[o(F,{modelValue:i.category,"onUpdate:modelValue":e[6]||(e[6]=t=>i.category=t),placeholder:"请输入分类"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(I,{gutter:20},{default:a(()=>[o(x,{span:12},{default:a(()=>[o(V,{label:"状态",prop:"status"},{default:a(()=>[o(J,{modelValue:i.status,"onUpdate:modelValue":e[7]||(e[7]=t=>i.status=t),style:{width:"100%"}},{default:a(()=>[o(M,{label:"草稿",value:"DRAFT"}),o(M,{label:"已发布",value:"PUBLISHED"}),o(M,{label:"已归档",value:"ARCHIVED"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),o(x,{span:12},{default:a(()=>[o(V,{label:"是否公开"},{default:a(()=>[o(Le,{modelValue:i.is_public,"onUpdate:modelValue":e[8]||(e[8]=t=>i.is_public=t)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),o(V,{label:"标签"},{default:a(()=>[o(F,{modelValue:R.value,"onUpdate:modelValue":e[9]||(e[9]=t=>R.value=t),placeholder:"请输入标签，用逗号分隔"},null,8,["modelValue"])]),_:1}),o(V,{label:"描述"},{default:a(()=>[o(F,{modelValue:i.description,"onUpdate:modelValue":e[10]||(e[10]=t=>i.description=t),type:"textarea",rows:3,placeholder:"请输入知识描述"},null,8,["modelValue"])]),_:1}),o(V,{label:"内容",prop:"content"},{default:a(()=>[o(F,{modelValue:i.content,"onUpdate:modelValue":e[11]||(e[11]=t=>i.content=t),type:"textarea",rows:10,placeholder:"请输入知识内容"},null,8,["modelValue"])]),_:1}),o(V,{label:"附件"},{default:a(()=>[o(Te,{ref:"uploadRef",action:pe.value,headers:me.value,data:fe.value,"on-success":De,"on-error":Me,"before-upload":Ue,multiple:"",drag:""},{tip:a(()=>[...e[20]||(e[20]=[n("div",{class:"el-upload__tip"}," 支持 doc/docx/pdf/txt/xlsx/pptx 等格式，单个文件不超过 10MB ",-1)])]),default:a(()=>[o(b,{class:"el-icon--upload"},{default:a(()=>[o(S(rt))]),_:1}),e[21]||(e[21]=n("div",{class:"el-upload__text"},[d(" 将文件拖到此处，或"),n("em",null,"点击上传")],-1))]),_:1},8,["action","headers","data"]),D.value.length>0?(s(),m("div",St,[e[22]||(e[22]=n("h4",null,"已上传文件：",-1)),(s(!0),m(H,null,q(D.value,t=>(s(),k(E,{key:t.id,closable:"",onClose:L=>ze(t),style:{margin:"5px"}},{default:a(()=>[d(r(t.original_filename),1)]),_:2},1032,["onClose"]))),128))])):C("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),o(ie,{modelValue:Q.value,"onUpdate:modelValue":e[14]||(e[14]=t=>Q.value=t),title:"查看知识",width:"70%"},{default:a(()=>[f.value?(s(),m("div",Dt,[n("h2",null,r(f.value.title),1),n("div",Mt,[o(E,null,{default:a(()=>[d(r(f.value.category||"未分类"),1)]),_:1}),o(E,{type:oe(f.value.status)},{default:a(()=>[d(r(ae(f.value.status)),1)]),_:1},8,["type"]),n("span",zt," 创建时间："+r(ne(f.value.created_at)),1),n("span",Bt," 查看次数："+r(f.value.view_count||0),1)]),f.value.description?(s(),m("div",$t,[e[24]||(e[24]=n("h4",null,"描述：",-1)),n("p",null,r(f.value.description),1)])):C("",!0),n("div",Rt,[e[25]||(e[25]=n("h4",null,"内容：",-1)),n("div",Ft,r(f.value.content),1)]),f.value.files&&f.value.files.length>0?(s(),m("div",Et,[e[26]||(e[26]=n("h4",null,"附件：",-1)),n("div",At,[(s(!0),m(H,null,q(f.value.files,t=>(s(),m("div",{key:t.id,class:"file-item"},[o(se,{onClick:L=>Be(t),icon:S(ct)},{default:a(()=>[d(r(t.original_filename),1)]),_:2},1032,["onClick","icon"]),n("span",Lt,"("+r($e(t.file_size))+")",1)]))),128))])])):C("",!0)])):C("",!0)]),_:1},8,["modelValue"])])}}},Gt=qe(Tt,[["__scopeId","data-v-6a38cd8c"]]);export{Gt as default};
